<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>任成の博客</title>
  
  <subtitle>朝闻道，夕可眠矣</subtitle>
  <link href="https://rencheng.cc/atom.xml" rel="self"/>
  
  <link href="https://rencheng.cc/"/>
  <updated>2023-06-07T02:10:18.000Z</updated>
  <id>https://rencheng.cc/</id>
  
  <author>
    <name>任成</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS逆向砸壳</title>
    <link href="https://rencheng.cc/2023/06/07/ios/general/iOS%E9%80%86%E5%90%91%E7%A0%B8%E5%A3%B3/"/>
    <id>https://rencheng.cc/2023/06/07/ios/general/iOS%E9%80%86%E5%90%91%E7%A0%B8%E5%A3%B3/</id>
    <published>2023-06-07T02:10:18.000Z</published>
    <updated>2023-06-07T02:10:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>苹果商店下载的安装包是加壳的，故需要脱壳后才可操作</p><span id="more"></span><p><a href="https://rencheng.cc/2018/11/18/ios/general/App%E5%88%86%E6%9E%90/?highlight=apple+con#%E8%8E%B7%E5%8F%96App%E5%AE%89%E8%A3%85%E5%8C%85">如何获取商店的安装包</a></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol><li>下载<a href="https://github.com/stefanesser/dumpdecrypted">dumpdecrypted</a></li><li>越狱设备</li><li>越狱设备安装插件<code>Apple File Conduit “2”</code></li><li>Mac电脑安装iFunBox</li></ol><h2 id="生成砸壳工具动态库"><a href="#生成砸壳工具动态库" class="headerlink" title="生成砸壳工具动态库"></a>生成砸壳工具动态库</h2><ol><li>将下载的dumpdecrypted-master.zip解压</li><li>终端进入解压后的根目录</li><li>执行<code>make</code>命令</li></ol><blockquote><p>得到一个名为<code>dumpdecrypted.dylib</code>的动态库</p></blockquote><h2 id="将生成的动态库注入至需要砸壳APP的沙盒目录"><a href="#将生成的动态库注入至需要砸壳APP的沙盒目录" class="headerlink" title="将生成的动态库注入至需要砸壳APP的沙盒目录"></a>将生成的动态库注入至需要砸壳APP的沙盒目录</h2><h3 id="SSH进入越狱设备"><a href="#SSH进入越狱设备" class="headerlink" title="SSH进入越狱设备"></a>SSH进入越狱设备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ip</span><br></pre></td></tr></table></figure><blockquote><p>如果觉得WIFI慢，可以使用usbmux进行转发</p></blockquote><h3 id="Cycript操作目标APP"><a href="#Cycript操作目标APP" class="headerlink" title="Cycript操作目标APP"></a>Cycript操作目标APP</h3><ol><li>获取目标APP名称 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure><blockquote><p>通过进程列表可以拿到<code>App可执行文件名称</code>以及<code>App可执行文件绝对路径</code></p></blockquote></li><li>进入cycript操作APP的交互环境 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cycript -p App可执行文件名称</span><br></pre></td></tr></table></figure><h3 id="通过cycript语言获取沙盒目录"><a href="#通过cycript语言获取沙盒目录" class="headerlink" title="通过cycript语言获取沙盒目录"></a>通过cycript语言获取沙盒目录</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="built_in">NSFileManager</span> defaultManager] URLsForDirectory:<span class="built_in">NSDocumentDirectory</span> inDomains:<span class="built_in">NSUserDomainMask</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>如果导入过mjcript，可以使用如下命令<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@import mjcript</span><br><span class="line">MJDocPath</span><br></pre></td></tr></table></figure></li></ol><h3 id="将动态库拷贝至沙盒目录下"><a href="#将动态库拷贝至沙盒目录下" class="headerlink" title="将动态库拷贝至沙盒目录下"></a>将动态库拷贝至沙盒目录下</h3><ol><li>使用iFunBox进入设备的沙盒目录（Documents目录下）</li><li>拖拽进去即可</li></ol><h2 id="执行砸壳命令"><a href="#执行砸壳命令" class="headerlink" title="执行砸壳命令"></a>执行砸壳命令</h2><p>先进入沙盒目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Documents目录</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib App可执行文件绝对路径</span><br></pre></td></tr></table></figure><p>eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/D99C9215-D954-4067-BFD8-0F542C086F54/BitAutoPlusStore.app/BitAutoPlusStore</span><br></pre></td></tr></table></figure><p><strong>问题</strong><br>如果出现以下错误：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">could not load inserted library &#x27;dumpdecrypted.dylib&#x27; into hardened process because no suitable image found</span><br></pre></td></tr></table></figure><p>在Mac环境下将dumpdecrypted.dylib进行签名</p><ol><li>获取所有证书，从中选一个 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security find-identity -v -p codesigning</span><br></pre></td></tr></table></figure></li><li>签名     <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codesign --force --verify --verbose --sign &quot;Apple Development: Cheng Ren (A699T56LQP)&quot; dumpdecrypted.dylib</span><br></pre></td></tr></table></figure></li><li>将新的dumpdecrypted.dylib文件拖入至沙盒</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;苹果商店下载的安装包是加壳的，故需要脱壳后才可操作&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>autoreleasepool底层原理</title>
    <link href="https://rencheng.cc/2022/03/16/ios/general/autoreleasepool%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"/>
    <id>https://rencheng.cc/2022/03/16/ios/general/autoreleasepool%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</id>
    <published>2022-03-16T07:22:59.000Z</published>
    <updated>2022-03-16T07:22:59.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://developer.apple.com/documentation/foundation/nsautoreleasepool">官方文档介绍</a></p><p>自动释放池存储在池本身排出时发送发布消息的对象。</p><p>如果你使用自动引用计数(ARC)，你不能直接使用自动释放池。相反，你可以使用@autoreleasepool块。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line"><span class="comment">// Code benefitting from a local autorelease pool.</span></span><br><span class="line">[pool release]; </span><br></pre></td></tr></table></figure><p>可以写成：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">    <span class="comment">// Code benefitting from a local autorelease pool.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><p>在我们的ARC模式下，我们不可以直接使用自动释放池，可以用@autoreleasepool的block块代替。@autoreleasepool的block块比直接使用NSAutoreleasePool实例使用更有效。即使不是ARC模式，也可以使用。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><strong>Q：主线程创建临时变量，什么时候会销毁？</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/documentation/foundation/nsautoreleasepool&quot;&gt;官方文档介绍&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;自动释放池存储在池本身排出时发送发布消息的对象。&lt;/p&gt;
&lt;p&gt;如果你使用自动引用计数(ARC)，你不能直接使用自动释放池。相反，你可以使用@autoreleasepool块。&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSAutoreleasePool&lt;/span&gt; *pool = [[&lt;span class=&quot;built_in&quot;&gt;NSAutoreleasePool&lt;/span&gt; alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Code benefitting from a local autorelease pool.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[pool release]; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以写成：&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@autoreleasepool&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Code benefitting from a local autorelease pool.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>YYDiskCache源码解析</title>
    <link href="https://rencheng.cc/2022/03/05/ios/general/YYDiskCache%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://rencheng.cc/2022/03/05/ios/general/YYDiskCache%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</id>
    <published>2022-03-05T06:04:08.000Z</published>
    <updated>2022-03-05T06:04:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>YYDiskCache</code>是<code>YYCache</code>组件中负责磁盘缓存的。</p><p>涉及知识点：</p><ul><li>磁盘缓存策略的分流优化</li><li>KVStore非关系型数据存储</li><li>线程同步锁（信号量）</li></ul><span id="more"></span><p>由于<code>YYDiskCache</code>是对<code>YYKVStorage</code>的封装调用</p><h2 id="YYKVStorage"><a href="#YYKVStorage" class="headerlink" title="YYKVStorage"></a>YYKVStorage</h2><p><strong>3种存储方式</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, YYKVStorageType) &#123;</span><br><span class="line">    <span class="comment">/// 文件形式存储</span></span><br><span class="line">    YYKVStorageTypeFile = <span class="number">0</span>,</span><br><span class="line">    <span class="comment">/// sqlite 的 blob type.</span></span><br><span class="line">    YYKVStorageTypeSQLite = <span class="number">1</span>,</span><br><span class="line">    <span class="comment">/// 根据情况选择文件还是SQLite</span></span><br><span class="line">    YYKVStorageTypeMixed = <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>本地文件路径</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/path/</span><br><span class="line">  /manifest.sqlite</span><br><span class="line">  /manifest.sqlite-shm</span><br><span class="line">  /manifest.sqlite-wal</span><br><span class="line">  /data/</span><br><span class="line">       /e10adc3949ba59abbe56e057f20f883e</span><br><span class="line">       /e10adc3949ba59abbe56e057f20f883e</span><br><span class="line">  /trash/</span><br><span class="line">        /unused_file_or_folder</span><br></pre></td></tr></table></figure><p><code>YYKVStorage</code>会根据存储方式进行数据的增删改查；</p><blockquote><p><code>YYKVStorage</code> 不是线程安全的</p></blockquote><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> manifest (</span><br><span class="line">key                 text,</span><br><span class="line">filename            text,</span><br><span class="line">size                <span class="type">integer</span>,</span><br><span class="line">inline_data         <span class="type">blob</span>,</span><br><span class="line">modification_time   <span class="type">integer</span>,</span><br><span class="line">last_access_time    <span class="type">integer</span>,</span><br><span class="line">extended_data       <span class="type">blob</span>,</span><br><span class="line"><span class="keyword">primary</span> key(key)</span><br><span class="line">); </span><br><span class="line"><span class="keyword">create</span> index if <span class="keyword">not</span> <span class="keyword">exists</span> last_access_time_idx <span class="keyword">on</span> manifest(last_access_time);</span><br></pre></td></tr></table></figure><blockquote><p>日志模式采用wal方式；sqlite3.7版本之后支持；</p></blockquote><h4 id="检查点"><a href="#检查点" class="headerlink" title="检查点"></a>检查点</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在合适的时机，将 `sqlite-wal` 文件合并到 `sqlite` 文件。因为`sqlite-wal`文件过大会影响性能</span></span><br><span class="line">- (<span class="type">void</span>)_dbCheckpoint &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> _dbCheck]) <span class="keyword">return</span>;</span><br><span class="line">    sqlite3_wal_checkpoint(_db, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="YYKVStorageItem"><a href="#YYKVStorageItem" class="headerlink" title="YYKVStorageItem"></a>YYKVStorageItem</h3><p>数据流context</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">YYKVStorageItem</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *key;                <span class="comment">///&lt; key</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSData</span> *value;                <span class="comment">///&lt; value</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *filename; <span class="comment">///&lt; filename (nil if inline)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="type">int</span> size;                             <span class="comment">///&lt; value&#x27;s size in bytes</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="type">int</span> modTime;                          <span class="comment">///&lt; modification unix timestamp</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="type">int</span> accessTime;                       <span class="comment">///&lt; last access unix timestamp</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSData</span> *extendedData; <span class="comment">///&lt; extended data (nil if no extended data)</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="YYDiskCache"><a href="#YYDiskCache" class="headerlink" title="YYDiskCache"></a>YYDiskCache</h2><h3 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> Lock() dispatch_semaphore_wait(self-&gt;_lock, DISPATCH_TIME_FOREVER)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Unlock() dispatch_semaphore_signal(self-&gt;_lock)</span></span><br></pre></td></tr></table></figure><p>读写的时候都用到了该锁</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setObject:(<span class="type">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)object forKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    Lock();</span><br><span class="line">    [_kv saveItemWithKey:key value:value filename:filename extendedData:extendedData];</span><br><span class="line">    Unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)objectForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    Lock();</span><br><span class="line">    YYKVStorageItem *item = [_kv getItemForKey:key];</span><br><span class="line">    Unlock();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自动清理"><a href="#自动清理" class="headerlink" title="自动清理"></a>自动清理</h3><p><code>YYDiskCache</code>也使用了LRU的算法，定时清理</p><h2 id="成长"><a href="#成长" class="headerlink" title="成长"></a>成长</h2><ul><li>磁盘缓存的解决方案</li><li>信号量实现线程锁</li><li>数据库wal的存储方式</li><li>封装同步执行和异步执行的思路</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;YYDiskCache&lt;/code&gt;是&lt;code&gt;YYCache&lt;/code&gt;组件中负责磁盘缓存的。&lt;/p&gt;
&lt;p&gt;涉及知识点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;磁盘缓存策略的分流优化&lt;/li&gt;
&lt;li&gt;KVStore非关系型数据存储&lt;/li&gt;
&lt;li&gt;线程同步锁（信号量）&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>YYMemoryCache源码解析</title>
    <link href="https://rencheng.cc/2022/02/25/ios/general/YYMemoryCache%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://rencheng.cc/2022/02/25/ios/general/YYMemoryCache%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</id>
    <published>2022-02-25T07:02:50.000Z</published>
    <updated>2022-02-25T07:02:50.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>YYMemoryCache</code>是<code>YYCache</code>组件中负责内存缓存的。</p><p>涉及知识点：</p><ul><li>双向链表</li><li>哈希表</li><li>LRU（算法实现是使用上面两种数据结构）</li><li>线程同步锁</li></ul><span id="more"></span><h2 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h2><p><code>LRU</code>（Least recently used，最近最少使用）<br>核心思想：如果数据最近被访问过，那么将来被访问的几率也更高”。</p><p>通过上面的思想，整理思路如下</p><ol><li>需要一个有序集合作为队列进行优先级(访问概率)控制；集合使用双向链表</li><li>找到队列中已存在数据，并提高优先级；使用哈希表快速定位</li></ol><blockquote><p><strong>为什么使用链表而不使用顺序表？为什么使用双向链表？</strong></p><ul><li>链表的增加和删除的操作时间复杂度是O(1)，而顺序表涉及到扩容的问题（开新内存，内存拷贝）</li><li>如果我们想删除最后一个元素，链表的操作是拿到最后一个元素的前一个元素，并将它的next设置成null，那怎么拿到最后一个元素的上一个元素呢？如果队列中已经有了元素，需要把它提到队头，那怎么拿到该元素的上一个元素呢？<br>我们可以维护一个链表的头节点和尾节点，但是没办法找到尾节点的上一个节点，所以需要双向链表</li></ul></blockquote><h2 id="YYMemoryCache源码实现"><a href="#YYMemoryCache源码实现" class="headerlink" title="YYMemoryCache源码实现"></a>YYMemoryCache源码实现</h2><h3 id="链表节点封装"><a href="#链表节点封装" class="headerlink" title="链表节点封装"></a>链表节点封装</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">_YYLinkedMapNode</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在当前module中生效</span></span><br><span class="line">    <span class="keyword">@package</span></span><br><span class="line">    <span class="comment">// 上一个节点</span></span><br><span class="line">    __<span class="keyword">unsafe_unretained</span> _YYLinkedMapNode *_prev; <span class="comment">// retained by dic</span></span><br><span class="line">    <span class="comment">// 下一个节点</span></span><br><span class="line">    __<span class="keyword">unsafe_unretained</span> _YYLinkedMapNode *_next; <span class="comment">// retained by dic</span></span><br><span class="line">    <span class="comment">// 节点key</span></span><br><span class="line">    <span class="type">id</span> _key;</span><br><span class="line">    <span class="comment">// 节点值</span></span><br><span class="line">    <span class="type">id</span> _value;</span><br><span class="line">    <span class="comment">// 花费的内存</span></span><br><span class="line">    <span class="built_in">NSUInteger</span> _cost;</span><br><span class="line">    <span class="comment">// 缓存的时间</span></span><br><span class="line">    <span class="built_in">NSTimeInterval</span> _time;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">_YYLinkedMapNode</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="链表的封装-包含增删改查等操作"><a href="#链表的封装-包含增删改查等操作" class="headerlink" title="链表的封装 - 包含增删改查等操作"></a>链表的封装 - 包含增删改查等操作</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">_YYLinkedMap</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">@package</span></span><br><span class="line">    <span class="comment">// c语言的 NSMutableDictionary - 速度肯定比NSMutableDictionary快</span></span><br><span class="line">    <span class="built_in">CFMutableDictionaryRef</span> _dic; <span class="comment">// do not set object directly</span></span><br><span class="line">    <span class="comment">// 当前链表 总花费的内存</span></span><br><span class="line">    <span class="built_in">NSUInteger</span> _totalCost;</span><br><span class="line">    <span class="comment">// 当前链表长度</span></span><br><span class="line">    <span class="built_in">NSUInteger</span> _totalCount;</span><br><span class="line">    <span class="comment">// 头结点</span></span><br><span class="line">    _YYLinkedMapNode *_head; <span class="comment">// MRU, do not change it directly</span></span><br><span class="line">    <span class="comment">// 尾节点</span></span><br><span class="line">    _YYLinkedMapNode *_tail; <span class="comment">// LRU, do not change it directly</span></span><br><span class="line">    <span class="comment">// 是否在主线程中释放</span></span><br><span class="line">    <span class="type">BOOL</span> _releaseOnMainThread;</span><br><span class="line">    <span class="comment">// 异步释放</span></span><br><span class="line">    <span class="type">BOOL</span> _releaseAsynchronously;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">_YYLinkedMap</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="variable language_">super</span> init];</span><br><span class="line">    _dic = <span class="built_in">CFDictionaryCreateMutable</span>(<span class="built_in">CFAllocatorGetDefault</span>(), <span class="number">0</span>, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</span><br><span class="line">    _releaseOnMainThread = <span class="literal">NO</span>;</span><br><span class="line">    _releaseAsynchronously = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">CFRelease</span>(_dic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 在最头部插入一个node，更新总花费内存和长度</span></span><br><span class="line"><span class="comment">/// Node and node.key 不能为 nil.</span></span><br><span class="line">- (<span class="type">void</span>)insertNodeAtHead:(_YYLinkedMapNode *)node &#123;</span><br><span class="line">    <span class="built_in">CFDictionarySetValue</span>(_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(node-&gt;_key), (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(node));</span><br><span class="line">    _totalCost += node-&gt;_cost;</span><br><span class="line">    _totalCount++;</span><br><span class="line">    <span class="keyword">if</span> (_head) &#123;</span><br><span class="line">        node-&gt;_next = _head;</span><br><span class="line">        _head-&gt;_prev = node;</span><br><span class="line">        _head = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _head = _tail = node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果node已经在链表中，提升某个node优先级</span></span><br><span class="line">- (<span class="type">void</span>)bringNodeToHead:(_YYLinkedMapNode *)node &#123;</span><br><span class="line">    <span class="keyword">if</span> (_head == node) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (_tail == node) &#123;</span><br><span class="line">        _tail = node-&gt;_prev;</span><br><span class="line">        _tail-&gt;_next = <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node-&gt;_next-&gt;_prev = node-&gt;_prev;</span><br><span class="line">        node-&gt;_prev-&gt;_next = node-&gt;_next;</span><br><span class="line">    &#125;</span><br><span class="line">    node-&gt;_next = _head;</span><br><span class="line">    node-&gt;_prev = <span class="literal">nil</span>;</span><br><span class="line">    _head-&gt;_prev = node;</span><br><span class="line">    _head = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果node已经在链表中，删除它，更新总花费内存和长度</span></span><br><span class="line">- (<span class="type">void</span>)removeNode:(_YYLinkedMapNode *)node &#123;</span><br><span class="line">    <span class="built_in">CFDictionaryRemoveValue</span>(_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(node-&gt;_key));</span><br><span class="line">    _totalCost -= node-&gt;_cost;</span><br><span class="line">    _totalCount--;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;_next) node-&gt;_next-&gt;_prev = node-&gt;_prev;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;_prev) node-&gt;_prev-&gt;_next = node-&gt;_next;</span><br><span class="line">    <span class="keyword">if</span> (_head == node) _head = node-&gt;_next;</span><br><span class="line">    <span class="keyword">if</span> (_tail == node) _tail = node-&gt;_prev;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果存在尾部节点，将其删除，更新总花费内存和长度</span></span><br><span class="line">- (_YYLinkedMapNode *)removeTailNode &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_tail) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    _YYLinkedMapNode *tail = _tail;</span><br><span class="line">    <span class="built_in">CFDictionaryRemoveValue</span>(_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(_tail-&gt;_key));</span><br><span class="line">    _totalCost -= _tail-&gt;_cost;</span><br><span class="line">    _totalCount--;</span><br><span class="line">    <span class="keyword">if</span> (_head == _tail) &#123;</span><br><span class="line">        _head = _tail = <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _tail = _tail-&gt;_prev;</span><br><span class="line">        _tail-&gt;_next = <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 在后台线程中删除所有节点，更新总花费内存和长度</span></span><br><span class="line">- (<span class="type">void</span>)removeAll &#123;</span><br><span class="line">    _totalCost = <span class="number">0</span>;</span><br><span class="line">    _totalCount = <span class="number">0</span>;</span><br><span class="line">    _head = <span class="literal">nil</span>;</span><br><span class="line">    _tail = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CFDictionaryGetCount</span>(_dic) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">CFMutableDictionaryRef</span> holder = _dic;</span><br><span class="line">        _dic = <span class="built_in">CFDictionaryCreateMutable</span>(<span class="built_in">CFAllocatorGetDefault</span>(), <span class="number">0</span>, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (_releaseAsynchronously) &#123;</span><br><span class="line">            <span class="built_in">dispatch_queue_t</span> queue = _releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">            <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">                <span class="built_in">CFRelease</span>(holder); <span class="comment">// hold and release in specified queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_releaseOnMainThread &amp;&amp; !pthread_main_np()) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="built_in">CFRelease</span>(holder); <span class="comment">// hold and release in specified queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">CFRelease</span>(holder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="YYMemoryCache类解析"><a href="#YYMemoryCache类解析" class="headerlink" title="YYMemoryCache类解析"></a>YYMemoryCache类解析</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">YYMemoryCache</span> </span>&#123;</span><br><span class="line">    <span class="comment">// pthread_mutex 锁</span></span><br><span class="line">    pthread_mutex_t _lock;</span><br><span class="line">    <span class="comment">// 封装lru操作的链表</span></span><br><span class="line">    _YYLinkedMap *_lru;</span><br><span class="line">    <span class="comment">// 优先级低的串行的异步队列</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> _queue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定时释放</span></span><br><span class="line">- (<span class="type">void</span>)_trimRecursively &#123;</span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) _<span class="keyword">self</span> = <span class="keyword">self</span>;</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(_autoTrimInterval * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, <span class="number">0</span>), ^&#123;</span><br><span class="line">        __<span class="keyword">strong</span> <span class="keyword">typeof</span>(_<span class="keyword">self</span>) <span class="keyword">self</span> = _<span class="keyword">self</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">self</span>) <span class="keyword">return</span>;</span><br><span class="line">        [<span class="keyword">self</span> _trimInBackground];</span><br><span class="line">        [<span class="keyword">self</span> _trimRecursively];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子线程，缩减资源</span></span><br><span class="line">- (<span class="type">void</span>)_trimInBackground &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(_queue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> _trimToCost:<span class="keyword">self</span>-&gt;_costLimit];</span><br><span class="line">        [<span class="keyword">self</span> _trimToCount:<span class="keyword">self</span>-&gt;_countLimit];</span><br><span class="line">        [<span class="keyword">self</span> _trimToAge:<span class="keyword">self</span>-&gt;_ageLimit];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据限制，减少花费</span></span><br><span class="line">- (<span class="type">void</span>)_trimToCost:(<span class="built_in">NSUInteger</span>)costLimit &#123;</span><br><span class="line">    <span class="type">BOOL</span> finish = <span class="literal">NO</span>;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (costLimit == <span class="number">0</span>) &#123;</span><br><span class="line">        [_lru removeAll];</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_lru-&gt;_totalCost &lt;= costLimit) &#123;</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (finish) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 存储被删除的节点</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *holder = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">    <span class="keyword">while</span> (!finish) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pthread_mutex_trylock(&amp;_lock) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 链表总消费大于消费限制</span></span><br><span class="line">            <span class="keyword">if</span> (_lru-&gt;_totalCost &gt; costLimit) &#123;</span><br><span class="line">                _YYLinkedMapNode *node = [_lru removeTailNode];</span><br><span class="line">                <span class="keyword">if</span> (node) [holder addObject:node];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                finish = <span class="literal">YES</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            usleep(<span class="number">10</span> * <span class="number">1000</span>); <span class="comment">//10 ms</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (holder.count) &#123;</span><br><span class="line">        <span class="built_in">dispatch_queue_t</span> queue = _lru-&gt;_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">            [holder count]; <span class="comment">// release in queue</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据限制，减少长度</span></span><br><span class="line">- (<span class="type">void</span>)_trimToCount:(<span class="built_in">NSUInteger</span>)countLimit &#123;</span><br><span class="line">    <span class="type">BOOL</span> finish = <span class="literal">NO</span>;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (countLimit == <span class="number">0</span>) &#123;</span><br><span class="line">        [_lru removeAll];</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_lru-&gt;_totalCount &lt;= countLimit) &#123;</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (finish) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 存储被删除的节点</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *holder = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">    <span class="keyword">while</span> (!finish) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pthread_mutex_trylock(&amp;_lock) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 链表总长度大于长度限制</span></span><br><span class="line">            <span class="keyword">if</span> (_lru-&gt;_totalCount &gt; countLimit) &#123;</span><br><span class="line">                _YYLinkedMapNode *node = [_lru removeTailNode];</span><br><span class="line">                <span class="keyword">if</span> (node) [holder addObject:node];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                finish = <span class="literal">YES</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            usleep(<span class="number">10</span> * <span class="number">1000</span>); <span class="comment">//10 ms</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (holder.count) &#123;</span><br><span class="line">        <span class="built_in">dispatch_queue_t</span> queue = _lru-&gt;_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">            [holder count]; <span class="comment">// release in queue</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放过期的资源</span></span><br><span class="line">- (<span class="type">void</span>)_trimToAge:(<span class="built_in">NSTimeInterval</span>)ageLimit &#123;</span><br><span class="line">    <span class="type">BOOL</span> finish = <span class="literal">NO</span>;</span><br><span class="line">    <span class="built_in">NSTimeInterval</span> now = <span class="built_in">CACurrentMediaTime</span>();</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (ageLimit &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        [_lru removeAll];</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!_lru-&gt;_tail || (now - _lru-&gt;_tail-&gt;_time) &lt;= ageLimit) &#123;</span><br><span class="line">        finish = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">if</span> (finish) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 存储被删除的节点</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *holder = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">    <span class="keyword">while</span> (!finish) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pthread_mutex_trylock(&amp;_lock) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 当前时间 - 链表尾节点的时间 &gt; 时间限制</span></span><br><span class="line">            <span class="keyword">if</span> (_lru-&gt;_tail &amp;&amp; (now - _lru-&gt;_tail-&gt;_time) &gt; ageLimit) &#123;</span><br><span class="line">                _YYLinkedMapNode *node = [_lru removeTailNode];</span><br><span class="line">                <span class="keyword">if</span> (node) [holder addObject:node];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                finish = <span class="literal">YES</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            usleep(<span class="number">10</span> * <span class="number">1000</span>); <span class="comment">//10 ms</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (holder.count) &#123;</span><br><span class="line">        <span class="built_in">dispatch_queue_t</span> queue = _lru-&gt;_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">            [holder count]; <span class="comment">// release in queue</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内存警告监听并回调；如果设置了`收到内存警告后删除所有缓存的属性`为YES，则删除所有元素。</span></span><br><span class="line">- (<span class="type">void</span>)_appDidReceiveMemoryWarningNotification &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.didReceiveMemoryWarningBlock) &#123;</span><br><span class="line">        <span class="keyword">self</span>.didReceiveMemoryWarningBlock(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.shouldRemoveAllObjectsOnMemoryWarning) &#123;</span><br><span class="line">        [<span class="keyword">self</span> removeAllObjects];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用已经进入后台监听并回调；如果设置了`进入后台后删除所有缓存的属性`为YES，则删除所有元素。</span></span><br><span class="line">- (<span class="type">void</span>)_appDidEnterBackgroundNotification &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.didEnterBackgroundBlock) &#123;</span><br><span class="line">        <span class="keyword">self</span>.didEnterBackgroundBlock(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.shouldRemoveAllObjectsWhenEnteringBackground) &#123;</span><br><span class="line">        [<span class="keyword">self</span> removeAllObjects];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - public</span></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = <span class="variable language_">super</span>.init;</span><br><span class="line">    pthread_mutex_init(&amp;_lock, <span class="literal">NULL</span>);</span><br><span class="line">    _lru = [_YYLinkedMap new];</span><br><span class="line">    _queue = dispatch_queue_create(<span class="string">&quot;com.ibireme.cache.memory&quot;</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    _countLimit = <span class="built_in">NSUIntegerMax</span>;</span><br><span class="line">    _costLimit = <span class="built_in">NSUIntegerMax</span>;</span><br><span class="line">    _ageLimit = DBL_MAX;</span><br><span class="line">    _autoTrimInterval = <span class="number">5.0</span>;</span><br><span class="line">    _shouldRemoveAllObjectsOnMemoryWarning = <span class="literal">YES</span>;</span><br><span class="line">    _shouldRemoveAllObjectsWhenEnteringBackground = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(_appDidReceiveMemoryWarningNotification) name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(_appDidEnterBackgroundNotification) name:<span class="built_in">UIApplicationDidEnterBackgroundNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> _trimRecursively];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放销毁</span></span><br><span class="line">- (<span class="type">void</span>)dealloc &#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span> name:<span class="built_in">UIApplicationDidEnterBackgroundNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    [_lru removeAll];</span><br><span class="line">    pthread_mutex_destroy(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line">- (<span class="built_in">NSUInteger</span>)totalCount &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="built_in">NSUInteger</span> count = _lru-&gt;_totalCount;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getter</span></span><br><span class="line">- (<span class="built_in">NSUInteger</span>)totalCost &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="built_in">NSUInteger</span> totalCost = _lru-&gt;_totalCost;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> totalCost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getter</span></span><br><span class="line">- (<span class="type">BOOL</span>)releaseOnMainThread &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="type">BOOL</span> releaseOnMainThread = _lru-&gt;_releaseOnMainThread;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> releaseOnMainThread;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line">- (<span class="type">void</span>)setReleaseOnMainThread:(<span class="type">BOOL</span>)releaseOnMainThread &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    _lru-&gt;_releaseOnMainThread = releaseOnMainThread;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getter</span></span><br><span class="line">- (<span class="type">BOOL</span>)releaseAsynchronously &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="type">BOOL</span> releaseAsynchronously = _lru-&gt;_releaseAsynchronously;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> releaseAsynchronously;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line">- (<span class="type">void</span>)setReleaseAsynchronously:(<span class="type">BOOL</span>)releaseAsynchronously &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    _lru-&gt;_releaseAsynchronously = releaseAsynchronously;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包含</span></span><br><span class="line">- (<span class="type">BOOL</span>)containsObjectForKey:(<span class="type">id</span>)key &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    <span class="type">BOOL</span> contains = <span class="built_in">CFDictionaryContainsKey</span>(_lru-&gt;_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(key));</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> contains;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值 - 将node节点前置</span></span><br><span class="line">- (<span class="type">id</span>)objectForKey:(<span class="type">id</span>)key &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    _YYLinkedMapNode *node = <span class="built_in">CFDictionaryGetValue</span>(_lru-&gt;_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(key));</span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">        node-&gt;_time = <span class="built_in">CACurrentMediaTime</span>();</span><br><span class="line">        [_lru bringNodeToHead:node];</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">    <span class="keyword">return</span> node ? node-&gt;_value : <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增键值对</span></span><br><span class="line">- (<span class="type">void</span>)setObject:(<span class="type">id</span>)object forKey:(<span class="type">id</span>)key &#123;</span><br><span class="line">    [<span class="keyword">self</span> setObject:object forKey:key withCost:<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增键值对</span></span><br><span class="line">- (<span class="type">void</span>)setObject:(<span class="type">id</span>)object forKey:(<span class="type">id</span>)key withCost:(<span class="built_in">NSUInteger</span>)cost &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!object) &#123;</span><br><span class="line">        [<span class="keyword">self</span> removeObjectForKey:key];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    _YYLinkedMapNode *node = <span class="built_in">CFDictionaryGetValue</span>(_lru-&gt;_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(key));</span><br><span class="line">    <span class="built_in">NSTimeInterval</span> now = <span class="built_in">CACurrentMediaTime</span>();</span><br><span class="line">    <span class="comment">// 如果已经存在，将其提到链表头</span></span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">        _lru-&gt;_totalCost -= node-&gt;_cost;</span><br><span class="line">        _lru-&gt;_totalCost += cost;</span><br><span class="line">        node-&gt;_cost = cost;</span><br><span class="line">        node-&gt;_time = now;</span><br><span class="line">        node-&gt;_value = object;</span><br><span class="line">        [_lru bringNodeToHead:node];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 不存在，新建node添加链表头</span></span><br><span class="line">        node = [_YYLinkedMapNode new];</span><br><span class="line">        node-&gt;_cost = cost;</span><br><span class="line">        node-&gt;_time = now;</span><br><span class="line">        node-&gt;_key = key;</span><br><span class="line">        node-&gt;_value = object;</span><br><span class="line">        [_lru insertNodeAtHead:node];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果总花销大于限制，就缩小</span></span><br><span class="line">    <span class="keyword">if</span> (_lru-&gt;_totalCost &gt; _costLimit) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(_queue, ^&#123;</span><br><span class="line">            [<span class="keyword">self</span> trimToCost:_costLimit];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果总长度大于限制，就缩小</span></span><br><span class="line">    <span class="keyword">if</span> (_lru-&gt;_totalCount &gt; _countLimit) &#123;</span><br><span class="line">        _YYLinkedMapNode *node = [_lru removeTailNode];</span><br><span class="line">        <span class="keyword">if</span> (_lru-&gt;_releaseAsynchronously) &#123;</span><br><span class="line">            <span class="built_in">dispatch_queue_t</span> queue = _lru-&gt;_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">            <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">                [node <span class="keyword">class</span>]; <span class="comment">//hold and release in queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_lru-&gt;_releaseOnMainThread &amp;&amp; !pthread_main_np()) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                [node <span class="keyword">class</span>]; <span class="comment">//hold and release in queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除某个元素；加锁</span></span><br><span class="line">- (<span class="type">void</span>)removeObjectForKey:(<span class="type">id</span>)key &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span>;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    _YYLinkedMapNode *node = <span class="built_in">CFDictionaryGetValue</span>(_lru-&gt;_dic, (__bridge <span class="keyword">const</span> <span class="type">void</span> *)(key));</span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">        [_lru removeNode:node];</span><br><span class="line">        <span class="keyword">if</span> (_lru-&gt;_releaseAsynchronously) &#123;</span><br><span class="line">            <span class="built_in">dispatch_queue_t</span> queue = _lru-&gt;_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();</span><br><span class="line">            <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">                [node <span class="keyword">class</span>]; <span class="comment">//hold and release in queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_lru-&gt;_releaseOnMainThread &amp;&amp; !pthread_main_np()) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                [node <span class="keyword">class</span>]; <span class="comment">//hold and release in queue</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除所有数据；加锁</span></span><br><span class="line">- (<span class="type">void</span>)removeAllObjects &#123;</span><br><span class="line">    pthread_mutex_lock(&amp;_lock);</span><br><span class="line">    [_lru removeAll];</span><br><span class="line">    pthread_mutex_unlock(&amp;_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)trimToCount:(<span class="built_in">NSUInteger</span>)count &#123;</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> removeAllObjects];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> _trimToCount:count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)trimToCost:(<span class="built_in">NSUInteger</span>)cost &#123;</span><br><span class="line">    [<span class="keyword">self</span> _trimToCost:cost];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)trimToAge:(<span class="built_in">NSTimeInterval</span>)age &#123;</span><br><span class="line">    [<span class="keyword">self</span> _trimToAge:age];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">if</span> (_name) <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;&lt;%@: %p&gt; (%@)&quot;</span>, <span class="keyword">self</span>.class, <span class="keyword">self</span>, _name];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;&lt;%@: %p&gt;&quot;</span>, <span class="keyword">self</span>.class, <span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="成长"><a href="#成长" class="headerlink" title="成长"></a>成长</h3><ul><li><code>CFMutableDictionaryRef</code>的使用</li><li><code>异步release</code></li><li>线程锁<code>pthread_mutex</code></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;YYMemoryCache&lt;/code&gt;是&lt;code&gt;YYCache&lt;/code&gt;组件中负责内存缓存的。&lt;/p&gt;
&lt;p&gt;涉及知识点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;双向链表&lt;/li&gt;
&lt;li&gt;哈希表&lt;/li&gt;
&lt;li&gt;LRU（算法实现是使用上面两种数据结构）&lt;/li&gt;
&lt;li&gt;线程同步锁&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="数据结构和算法" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift监听方法耗时</title>
    <link href="https://rencheng.cc/2022/02/20/ios/swift/Swift-%E7%9B%91%E5%90%AC%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6/"/>
    <id>https://rencheng.cc/2022/02/20/ios/swift/Swift-%E7%9B%91%E5%90%AC%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6/</id>
    <published>2022-02-20T04:48:42.000Z</published>
    <updated>2022-02-20T04:48:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>封装监听方法耗时操作<br><em>开始算法练习之旅</em><br><a href="https://github.com/cheng-ren/Leet-code">Swift LeetCode 算法实现（2022持续更新）</a></p><span id="more"></span><p><strong>基类 Core.swift</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Core</span>: <span class="title class_">NSObject</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        swizzle_class(clz: object_getClass(<span class="keyword">self</span>), originalSelector: <span class="keyword">#selector</span>(run), swizzledSelector: <span class="keyword">#selector</span>(run_swizzle))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">func</span> <span class="title function_">run</span>() &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;需实现run方法并且不要调用父类方法&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">func</span> <span class="title function_">run_swizzle</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;开始执行 --&gt; <span class="subst">\(object_getClass(<span class="keyword">self</span>)<span class="operator">!</span>)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> startTimeInterval <span class="operator">=</span> <span class="type">Date</span>().timeIntervalSince1970 <span class="operator">*</span> <span class="number">1000</span></span><br><span class="line">        run_swizzle()</span><br><span class="line">        <span class="keyword">let</span> endTimeInterval <span class="operator">=</span> <span class="type">Date</span>().timeIntervalSince1970 <span class="operator">*</span> <span class="number">1000</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(format: <span class="string">&quot;运行耗时 --&gt; %.3f毫秒&quot;</span>, endTimeInterval <span class="operator">-</span> startTimeInterval))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">run</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> object <span class="operator">=</span> <span class="keyword">self</span>.<span class="keyword">init</span>()</span><br><span class="line">        object.run()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">swizzle_class</span>(<span class="params">clz</span>: <span class="type">AnyClass</span>?, <span class="params">originalSelector</span>: <span class="type">Selector</span>, <span class="params">swizzledSelector</span>: <span class="type">Selector</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> originalMethod <span class="operator">=</span> class_getInstanceMethod(clz, originalSelector)</span><br><span class="line">    <span class="keyword">let</span> swizzledMethod <span class="operator">=</span> class_getInstanceMethod(clz, swizzledSelector)</span><br><span class="line">    <span class="keyword">let</span> didAddMethod: <span class="type">Bool</span> <span class="operator">=</span> class_addMethod(clz, originalSelector, method_getImplementation(swizzledMethod<span class="operator">!</span>), method_getTypeEncoding(swizzledMethod<span class="operator">!</span>))</span><br><span class="line">    <span class="keyword">if</span> didAddMethod &#123;</span><br><span class="line">        class_replaceMethod(clz, swizzledSelector, method_getImplementation(originalMethod<span class="operator">!</span>), method_getTypeEncoding(originalMethod<span class="operator">!</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod<span class="operator">!</span>, swizzledMethod<span class="operator">!</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调用方 main.swift</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">剑指_Offer_09_用两个栈实现队列.run()</span><br></pre></td></tr></table></figure><p><strong>算法实现类</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CQueue</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> stackAdd: [<span class="type">Int</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> stackRemove: [<span class="type">Int</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        stackAdd <span class="operator">=</span> []</span><br><span class="line">        stackRemove <span class="operator">=</span> []</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">appendTail</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> stackAdd.count <span class="operator">&gt;</span> <span class="number">10000</span> &#123;</span><br><span class="line">            <span class="comment">// fatalError(&quot;数据太多&quot;)</span></span><br><span class="line">        &#125;</span><br><span class="line">        stackAdd.append(value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">deleteHead</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> stackAdd.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            stackRemove <span class="operator">=</span> stackAdd.reversed()</span><br><span class="line">        &#125;</span><br><span class="line">        stackAdd.removeFirst()</span><br><span class="line">        <span class="keyword">return</span> stackRemove.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> 剑指<span class="title class_">_Offer_09_</span>用两个栈实现队列: <span class="title class_">Core</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">run</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> obj <span class="operator">=</span> <span class="type">CQueue</span>()</span><br><span class="line">        <span class="built_in">print</span>(obj.deleteHead())</span><br><span class="line">        obj.appendTail(<span class="number">5</span>)</span><br><span class="line">        obj.appendTail(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(obj.deleteHead())</span><br><span class="line">        <span class="built_in">print</span>(obj.deleteHead())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在<code>Swift</code>中实现方法交换须满足条件：</p></blockquote><ol><li>类必须继承自<code>NSObject</code></li><li>被交换的两个方法，必须用<code>dynamic</code>关键字标记</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;封装监听方法耗时操作&lt;br&gt;&lt;em&gt;开始算法练习之旅&lt;/em&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/cheng-ren/Leet-code&quot;&gt;Swift LeetCode 算法实现（2022持续更新）&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>自动签到脚本</title>
    <link href="https://rencheng.cc/2022/02/08/crawler/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC/"/>
    <id>https://rencheng.cc/2022/02/08/crawler/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC/</id>
    <published>2022-02-08T07:08:44.000Z</published>
    <updated>2022-02-08T07:08:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在使用xx流量的时候，发现流量不够用，所以写了一个脚本用来自动签到来获取流量</p><span id="more"></span><p><strong>class FeiniaoSign</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FeiniaoSign</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">&#x27;https://xxx/auth/login&#x27;</span></span><br><span class="line">        self.browser = open_browser(url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">input_account</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 输入账号 &quot;&quot;&quot;</span></span><br><span class="line">        account_ele = self.browser.find_element(by=By.ID, value=<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">        account_ele.send_keys(<span class="string">&#x27;renchengqi12@gmail.com&#x27;</span>)</span><br><span class="line">        logging.info(<span class="string">&#x27;账号ele:&#x27;</span> + self.check_element_value(account_ele))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">input_password</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 输入密码 &quot;&quot;&quot;</span></span><br><span class="line">        pwd_ele = self.browser.find_element(by=By.ID, value=<span class="string">&#x27;passwd&#x27;</span>)</span><br><span class="line">        pwd_ele.send_keys(<span class="string">&#x27;NoD7nhA3_Yg&#x27;</span>)</span><br><span class="line">        logging.info(<span class="string">&#x27;密码ele:&#x27;</span> + self.check_element_value(pwd_ele))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">click_login_btn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 点击登录按钮 &quot;&quot;&quot;</span></span><br><span class="line">        submit_btn = self.browser.find_element(by=By.ID, value=<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">        submit_btn.click()</span><br><span class="line">        logging.info(<span class="string">&#x27;submit_btn:&#x27;</span> + self.check_element_value(submit_btn))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">click_sign_btn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 点击签到按钮 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sign_btn = self.browser.find_element(by=By.ID, value=<span class="string">&#x27;checkin&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> sign_btn <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                ActionChains(self.browser).move_to_element(sign_btn).perform()</span><br><span class="line">                sign_btn.click()</span><br><span class="line">                <span class="comment"># js = &#x27;document.getElementById(&quot;checkin&quot;).click()&#x27;</span></span><br><span class="line">                <span class="comment"># self.browser.execute_script(js)</span></span><br><span class="line">            logging.info(<span class="string">&#x27;sign_btn:&#x27;</span> + (<span class="string">&quot;正确&quot;</span> <span class="keyword">if</span> sign_btn <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">&quot;错误&quot;</span>))</span><br><span class="line">        <span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">            logging.info(<span class="string">&#x27;sign_btn:&#x27;</span> + <span class="string">&#x27;未找到&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_screenshot</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 截图 &quot;&quot;&quot;</span></span><br><span class="line">        path = <span class="string">&#x27;/www/wwwroot/peanuts.rencheng.cc/script/Python.png&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> is_debug:</span><br><span class="line">            path = <span class="string">&#x27;Python.png&#x27;</span></span><br><span class="line">        self.browser.save_screenshot(path)</span><br><span class="line">        logging.info(<span class="string">&#x27;截图完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_element_value</span>(<span class="params">self, element</span>):</span><br><span class="line">        <span class="keyword">if</span> element <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;正确&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;错误&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">destroy</span>(<span class="params">self</span>):</span><br><span class="line">        self.browser.quit()</span><br></pre></td></tr></table></figure><p><strong>.py main</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> apscheduler.schedulers.blocking <span class="keyword">import</span> BlockingScheduler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logger_config</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 打印器配置 &quot;&quot;&quot;</span></span><br><span class="line">    logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_browser</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 打开浏览器并访问地址</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param url: 网页地址</span></span><br><span class="line"><span class="string">    :return: 浏览器</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    binary_location = <span class="string">&#x27;/usr/bin/google-chrome&#x27;</span></span><br><span class="line">    chrome_driver_binary = <span class="string">&#x27;/usr/bin/chromedriver&#x27;</span></span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">&#x27;打开站点:&#x27;</span> + url)</span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_argument(</span><br><span class="line">        <span class="string">&#x27;user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">        <span class="string">&#x27;Chrome/98.0.4758.80 Safari/537.36&#x27;</span>)</span><br><span class="line">    options.add_argument(<span class="string">&#x27;window-size=1920,1080&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_debug:</span><br><span class="line">        options.headless = <span class="literal">True</span></span><br><span class="line">        os.environ[<span class="string">&quot;webdriver.chrome.driver&quot;</span>] = chrome_driver_binary</span><br><span class="line">        options.binary_location = binary_location</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--no-sandbox&#x27;</span>)</span><br><span class="line">        options.add_argument(<span class="string">&#x27;--disable-dev-shm-usage&#x27;</span>)</span><br><span class="line">    browser = webdriver.Chrome(options=options)</span><br><span class="line">    browser.get(url)</span><br><span class="line">    <span class="keyword">return</span> browser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">is_debug = <span class="literal">False</span></span><br><span class="line">logger_config()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    is_debug = <span class="string">&#x27;debug&#x27;</span> <span class="keyword">in</span> sys.argv</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">&#x27;脚本开始执行: 环境&#x27;</span> + (<span class="string">&#x27;DEBUG&#x27;</span> <span class="keyword">if</span> is_debug <span class="keyword">else</span> <span class="string">&#x27;RELEASE&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    __handler()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 本地执行, 需要执行定时调度</span></span><br><span class="line">    <span class="keyword">if</span> is_debug:</span><br><span class="line">        scheduler = BlockingScheduler()</span><br><span class="line">        scheduler.add_job(__handler, <span class="string">&#x27;interval&#x27;</span>, seconds=<span class="number">86400</span>, <span class="built_in">id</span>=<span class="string">&#x27;test_job2&#x27;</span>, timezone=<span class="string">&#x27;Asia/Shanghai&#x27;</span>)</span><br><span class="line">        scheduler.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近在使用xx流量的时候，发现流量不够用，所以写了一个脚本用来自动签到来获取流量&lt;/p&gt;</summary>
    
    
    
    
    <category term="爬虫" scheme="https://rencheng.cc/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>LLDB操作指令总结</title>
    <link href="https://rencheng.cc/2022/01/14/ios/general/LLDB%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <id>https://rencheng.cc/2022/01/14/ios/general/LLDB%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4%E6%80%BB%E7%BB%93/</id>
    <published>2022-01-14T08:32:37.000Z</published>
    <updated>2022-01-14T08:32:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>LLDB全称轻量级的高性能调试器（Low Level Debugger），默认内置于Xcode中。能够很好的运用它会使我们的开发效率事半功倍。</p><span id="more"></span><h2 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h2><p>LLDB命令语法特性，可简写<br><code>print</code>命令可简写成，<code>p</code>,<code>pr</code>,<code>pri</code>,<code>prin</code>。其他命令以此类推。</p><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="print、po命令"><a href="#print、po命令" class="headerlink" title="print、po命令"></a>print、po命令</h3><p>他们可以输出，可以调用方法，可以写表达式。</p><ul><li><code>print</code>/<code>p</code>：打印变量</li><li><code>po</code>: 打印值；如果是对象，打印其description的信息</li></ul><p><strong>语法</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p 变量名</span><br><span class="line">print 变量名</span><br><span class="line"># 或</span><br><span class="line">po 变量名</span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(lldb) p object</span><br><span class="line">(Person *) <span class="variable">$1</span> = 0x00000001010c7810</span><br><span class="line">(lldb) po object</span><br><span class="line">&lt;Person: 0x1010c7810&gt;</span><br></pre></td></tr></table></figure><h3 id="expression"><a href="#expression" class="headerlink" title="expression"></a>expression</h3><p>执行一个表达式，并将表达式返回的结果输出。<br>可以执行表达式来动态改变程序运行的轨迹。 假如我们在运行过程中，突然想把 self.view 颜色改成红色，看看效果。我们不必写下代码，重新run，只需暂停程序，用expression改变颜色，再刷新一下界面，就能看到效果。</p><p><strong>语法</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression 变量名 = 数值</span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression <span class="variable">$1</span> = 10</span><br></pre></td></tr></table></figure><h3 id="x"><a href="#x" class="headerlink" title="x"></a>x</h3><p>查看内存中读取一个地址的信息</p><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x/数量-格式-字节大小 内存地址</span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(lldb) x 0x00000001010c7c70</span><br><span class="line">0x1010c7c70: c9 3f 82 ea 01 00 00 01 00 00 00 00 00 00 00 00  .?..............</span><br><span class="line">0x1010c7c80: 50 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  P...............</span><br></pre></td></tr></table></figure><blockquote><ul><li>格式 <ul><li>x：16进制；</li><li>f：浮点数；</li><li>d：十进制</li></ul></li><li>字节大小<ul><li>b - byte 1字节</li><li>h - half word 2字节</li><li>w - word 4字节</li><li>giant word 8字节</li></ul></li></ul></blockquote><h3 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h3><p>修改内存中的值<br><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory write 内存地址 数值</span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory write 0x0000010 10</span><br></pre></td></tr></table></figure><h2 id="进阶指令"><a href="#进阶指令" class="headerlink" title="进阶指令"></a>进阶指令</h2><h3 id="breakpoint"><a href="#breakpoint" class="headerlink" title="breakpoint"></a>breakpoint</h3><h4 id="列出部分或者所有的断点"><a href="#列出部分或者所有的断点" class="headerlink" title="列出部分或者所有的断点"></a>列出部分或者所有的断点</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">breakpoint list</span><br><span class="line">或者</span><br><span class="line">br l</span><br></pre></td></tr></table></figure><p><strong>参数</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看某一组的信息</span></span><br><span class="line">breakpoint list 断点组<span class="built_in">id</span></span><br><span class="line"><span class="comment"># 显示断点信息格式化</span></span><br><span class="line">breakpoint list -v </span><br><span class="line"><span class="comment"># 显示断点摘要</span></span><br><span class="line">breakpoint list -b</span><br></pre></td></tr></table></figure><h4 id="给所有函数名为xxx的都设置断点"><a href="#给所有函数名为xxx的都设置断点" class="headerlink" title="给所有函数名为xxx的都设置断点"></a>给所有函数名为xxx的都设置断点</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">breakpoint <span class="built_in">set</span> –name c函数名/oc方法</span><br><span class="line">br s -n 函数名</span><br><span class="line">b 函数名</span><br></pre></td></tr></table></figure><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># C</span></span><br><span class="line">breakpoint <span class="built_in">set</span> -n <span class="string">&quot;main&quot;</span></span><br><span class="line"><span class="comment"># OC </span></span><br><span class="line">breakpoint <span class="built_in">set</span> -n <span class="string">&quot;-[ViewController viewDidLoad:]&quot;</span></span><br><span class="line"><span class="comment"># OC 同时设置多个方法</span></span><br><span class="line">breakpoint <span class="built_in">set</span> -n <span class="string">&quot;-[ViewController playGame:]&quot;</span> -n <span class="string">&quot;-[ViewController pauseGame:]&quot;</span> -n <span class="string">&quot;-[ViewController continueGame:]&quot;</span></span><br></pre></td></tr></table></figure><h4 id="给某个文件的行设置断点"><a href="#给某个文件的行设置断点" class="headerlink" title="给某个文件的行设置断点"></a>给某个文件的行设置断点</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">breakpoint <span class="built_in">set</span> –file 文件名 –line 行号</span><br><span class="line">br s -f 文件名 -l 行号</span><br><span class="line">b 文件名:行号</span><br></pre></td></tr></table></figure><h4 id="给某个文件的方法设置断点"><a href="#给某个文件的方法设置断点" class="headerlink" title="给某个文件的方法设置断点"></a>给某个文件的方法设置断点</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">breakpoint <span class="built_in">set</span> --file 文件名 --selector 方法名</span><br><span class="line">br s -f 文件名 -s 方法名</span><br></pre></td></tr></table></figure><h4 id="删除断点某一组"><a href="#删除断点某一组" class="headerlink" title="删除断点某一组"></a>删除断点某一组</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">breakpoint delete 断点组<span class="built_in">id</span></span><br><span class="line">br del 断点组<span class="built_in">id</span></span><br></pre></td></tr></table></figure><h4 id="显示调用栈"><a href="#显示调用栈" class="headerlink" title="显示调用栈"></a>显示调用栈</h4><p><strong>语法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;LLDB全称轻量级的高性能调试器（Low Level Debugger），默认内置于Xcode中。能够很好的运用它会使我们的开发效率事半功倍。&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>HTTP</title>
    <link href="https://rencheng.cc/2022/01/13/network/HTTP/"/>
    <id>https://rencheng.cc/2022/01/13/network/HTTP/</id>
    <published>2022-01-13T11:40:29.000Z</published>
    <updated>2022-01-13T11:40:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>总结一下最近关于HTTP的理解</p><ul><li>HTTP/1.1</li><li>HTTP/2</li><li>HTTP/3</li></ul><span id="more"></span><h2 id="时间线"><a href="#时间线" class="headerlink" title="时间线"></a>时间线</h2><table><thead><tr><th align="left">时间</th><th align="left">版本</th><th align="left">功能</th></tr></thead><tbody><tr><td align="left">1991</td><td align="left">0.9</td><td align="left">只支持<code>GET</code>请求方法获取文本数据（比如HTML文档），且不支持请求头、响应头等，无法向服务器传递太多信息</td></tr><tr><td align="left">1996</td><td align="left">1.0</td><td align="left">支持<code>POST</code>、<code>HEAD</code>等请求方法，支持请求头、响应头等，支持更多种数据类型（不再局限于文本数据）</br>浏览器的每次请求都需要与服务器建立-个TCP连接，请求处理完成后立即断开TCP连接</td></tr><tr><td align="left">1997</td><td align="left">1.1</td><td align="left">最经典、使用最广泛的版本</br>支持<code>PUT</code>、<code>DELETE</code>等请求方法</br>采用持久连接 (Connection: keep-alive），多个请求可以共用同一个TCP连接</td></tr><tr><td align="left">2015</td><td align="left">2.0</td><td align="left"></td></tr><tr><td align="left">2018</td><td align="left">3.0</td><td align="left"></td></tr></tbody></table><h2 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h2><p>口由万维网协会 (W3C）、互联网工程任务组 （ETF） 协调制定，最终发布了一系列的<a href="https://www.rfc-editor.org/standards">RFC</a></p><blockquote><p>在RFC 5234中表明：ABNF用作internet中通信协议的定义语言</p></blockquote><p><a href="https://datatracker.ietf.org/doc/html/rfc7230">ABNF</a>是最严谨的HTTP报文格式描述形式</p><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><p><img src="https://cdn.rencheng.cc/blog/4ryrp.png"></p><h2 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h2><table><thead><tr><th align="left">方法名</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">GET</td><td align="left">常用于读取的操作，请求参数直接拼接在URL的后面（浏览器对URL是有长度限制的）</td></tr><tr><td align="left">POST</td><td align="left">常用于添加、修改、删除的操作，请求参数可以放到请求体中（没有大小限制）</td></tr><tr><td align="left">HEAD</td><td align="left">请求得到与GET请求相同的响应，但没有响应体；</br>使用场景：下载大文件前，先获取其大小，再決定是否要下载。以此可以节约带宽资源</td></tr><tr><td align="left">OPTIONS</td><td align="left">用于获取目的资源所支持的通信选项，比如服务器支持的请求方法</td></tr><tr><td align="left">PUT</td><td align="left">用于对已存在的资源进行整体覆盖</td></tr><tr><td align="left">PATCH</td><td align="left">用于对资源进行部分修改（资源不存在，会创建新的资源）</td></tr><tr><td align="left">DELETE</td><td align="left">用于删除指定的资源</td></tr><tr><td align="left">TRACE</td><td align="left">请求服务器回显其收到的请求信息，主要用于HTTP请求的测试或诊断</td></tr><tr><td align="left">CONNECT</td><td align="left">可以开启一个客户端与所请求资源之间的双向沟通的通道，它可以用来创建隧道 (tunnel)</br>可以用来访问采用了 SSL (HTTPS) 协议的站点</td></tr></tbody></table><h2 id="头部字段"><a href="#头部字段" class="headerlink" title="头部字段"></a>头部字段</h2><h3 id="请求头字段"><a href="#请求头字段" class="headerlink" title="请求头字段"></a>请求头字段</h3><table><thead><tr><th align="left">字段</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">User-Agent</td><td align="left">浏览器的身份标识字符串</td><td align="left">User-Agent: Mozilla/5.0 (X11;Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0</td></tr><tr><td align="left">Host</td><td align="left">服务器的域名、端口号</td><td align="left">Host: localhost:80</td></tr><tr><td align="left">Date</td><td align="left">发送该消息的日期和时间</td><td align="left">Date: Tue, 15 Nov 1994 08:12:31 GMT</td></tr><tr><td align="left">Referer</td><td align="left">表示浏览器所访问的前一个页面</br>正是前一个页面的某个链接将浏览器带到了当前这个页面</td><td align="left">Referer: <a href="https://www.baidu.com/">https://www.baidu.com</a></td></tr><tr><td align="left">Content-Type</td><td align="left">请求体的类型</td><td align="left">Content-Type: multipart/form-data</td></tr><tr><td align="left">Content-Length</td><td align="left">请求体的长度(字节为单位）</td><td align="left">Content-Length: 232</td></tr><tr><td align="left">Accept</td><td align="left">能够接受的响应内容类型</br>(Content-Types)</td><td align="left">Accept: text/plain</td></tr><tr><td align="left">Accept-Charset</td><td align="left">能够接受的符集</td><td align="left">Accept-Charset: GB2312,utf-8;q=0.7,*; q=0.7</td></tr><tr><td align="left">Accept-Encoding</td><td align="left">能够接受的编码方式列表</td><td align="left">Accept-Encoding: gzip, deflate</td></tr><tr><td align="left">Accept-Language</td><td align="left">能够接受的响应内容的自然语言列表</td><td align="left">Accept-Language: en-US</td></tr><tr><td align="left">Range</td><td align="left">仅请求某个实体的一部分。字节偏移以0开始</td><td align="left">Range: bytes=500-999</td></tr><tr><td align="left">Origin</td><td align="left">发起一个针对跨域资源共享的请求</td><td align="left">Origin: <a href="https://www.baidu.com/">https://www.baidu.com</a></td></tr><tr><td align="left">Cookie</td><td align="left">之前由服务器通过set-Cookie发送的cookie</td><td align="left">Cookie: Version=1; Skin=new;</td></tr><tr><td align="left">Connection</td><td align="left">该浏览器根要优先伅用的连接类型</td><td align="left">Connection: keep-alive</td></tr><tr><td align="left">Cache-Control</td><td align="left">用来指定在这次的请求/响应链中的所有缓存机制都必须遵守的指令</td><td align="left">Cache-Control: no-cache</td></tr></tbody></table><blockquote><p>q值越大，优先级越高。默认1.0</p></blockquote><h3 id="响应头字段"><a href="#响应头字段" class="headerlink" title="响应头字段"></a>响应头字段</h3><table><thead><tr><th align="left">字段</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Content-Type</td><td align="left">响应体的类型</td><td align="left">Content-Type: text/html; charset=utf-8</td></tr><tr><td align="left">Content-Encoding</td><td align="left">内容所使用的编码类型</td><td align="left">Content-Encoding: gzip</td></tr><tr><td align="left">Content-Length</td><td align="left">响应体的长度(字节为单位）</td><td align="left">Content-Length: 348</td></tr><tr><td align="left">Content-Disposition</td><td align="left">一个可以让客户端下载文件并建议文件名的头部</td><td align="left">Content-Disposition: attachment;filename=”fname.ext”</td></tr><tr><td align="left">Accept-Ranges</td><td align="left">服务器支持哪些种类的部分内容范围</td><td align="left">Accept-Ranges: bytes</td></tr><tr><td align="left">Content-Range</td><td align="left">这条部分消息是属于完整消息的哪部分</td><td align="left">Content-Range: bytes 21010-47021/47022</td></tr><tr><td align="left">Access-Control-Allow-Origin</td><td align="left">指定哪些网站可参与到跨来源资源共享过程中</td><td align="left">Access-Control-Allow-Origin:*</td></tr><tr><td align="left">Location</td><td align="left">用来进行重定向，或者在创建了某个新资源时使用</td><td align="left">Location: <a href="http://www.w3.org/">http://www.w3.org</a></td></tr><tr><td align="left">Set-Cookie</td><td align="left">返回一个Cookie让客户端去保存</td><td align="left">Set-Cookie: UserID=JohnDoe; Max Age=3600; Version=1</td></tr><tr><td align="left">Connection</td><td align="left">针对该连接所预期的选项</td><td align="left">Connection: close</td></tr><tr><td align="left">Cache-Control</td><td align="left">向从服务器直到客户端在内的所有缓存机制告知，它们是否可以缓存这个对象。单位为秒</td><td align="left">Cache-Control: max-age=3600</td></tr></tbody></table><h2 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2"></a>HTTP2</h2><p><strong>数据流</strong>：已建立的连接内的双向字节流，可以承载一条或多条消息</p><blockquote><p>所有通信都在一个TCP连接上完成，此连接可以承载任意数量的双向数据流</p></blockquote><p><strong>消息</strong>：与逻辑HTTP请求或响应消息对应，由一系列帧组成<br><strong>帧</strong>：<code>HTTP/2</code>通信的最小单位，每个帧都包含帧头 （会标识出当前帧所属的数据流）</p><blockquote><p>来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装</p></blockquote><p><a href="http://www.http2demo.io/"><code>HTTP/1.1</code>与<code>HTTP/2</code>速度对比</a></p><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><h4 id="二进制格式"><a href="#二进制格式" class="headerlink" title="二进制格式"></a>二进制格式</h4><p><code>HTTP/2.0</code>采用二进制格式传输数据，而非<code>HTTP/1.1</code>的文本传输</p><blockquote><p>二进制格式在协议的解析和优化扩展上带来更多的优势和可能</p></blockquote><h4 id="多路复用"><a href="#多路复用" class="headerlink" title="多路复用"></a>多路复用</h4><p>客户端和服务器可以将 HTTP消息分解为互不依赖的帧，然后交错发送，最后再在另一端把它们重新组装起来</p><ul><li>并行交错地发送多个请求，请求之间互不影响</li><li>并行交错地发送多个响应，响应之间互不干扰</li></ul><p><img src="https://cdn.rencheng.cc/blog/3tdd8.jpg"></p><blockquote><p>不必再为绕过 HTTP/1.1限制而做很多工作<br>比如image sprites、合并CSS\JS. 内嵌CSS\JS\Bas64图片，城名分片等</p></blockquote><h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><p><code>HTTP/2</code>标准允许每个数据流都有一个关联的权重和依赖关系</p><ul><li>可以向每个数据流分配一个介于1至256之间的整数</li><li>每个数据流与其他数据流之问可以存在显式依赖关系<br>客户端可以构建和传递“优先级树”，表明它倾向于如何接收响应</li></ul><p>服务器可以使用此信意通过控制CPU，内存和其他资源的分配设定数据流处理的优先级，在资源数据可用之后，确保将高优先级响应以最优方式传输至客户端。</p><h4 id="头部压缩"><a href="#头部压缩" class="headerlink" title="头部压缩"></a>头部压缩</h4><p><code>HTTP/2</code>使用<code>HPACK</code>压缩请求头和响应头，可以极大减少头部开销，进而提高性能。</p><h4 id="服务器推送"><a href="#服务器推送" class="headerlink" title="服务器推送"></a>服务器推送</h4><p>服务器可以对一个客户端请求发送多个响应，除了对最初请求的响应外，服务器还可以向客户端推送额外资源，而无需客户端额外明确地请求。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="队头阻塞"><a href="#队头阻塞" class="headerlink" title="队头阻塞"></a>队头阻塞</h4><p><code>HTTP/2</code>是基于<code>TCP</code>协议的, 传输过程相当于队列，串行发送。如果第一个数据包丢失，为了保证有序性，后续数据要等到队头数据重传后才可继续。</p><h4 id="握手延迟"><a href="#握手延迟" class="headerlink" title="握手延迟"></a>握手延迟</h4><p>由于<code>HTTP/2</code>的连接是基于TCP，并且前身SPDY的原因又做TLS/SSL安全套接层，所以握手时间太长。</p><h2 id="HTTP-3"><a href="#HTTP-3" class="headerlink" title="HTTP/3"></a>HTTP/3</h2><p><img src="https://cdn.rencheng.cc/blog/f515q.jpg"></p><h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><h4 id="连接迁移"><a href="#连接迁移" class="headerlink" title="连接迁移"></a>连接迁移</h4><p>TCP基于4要素 （源1P、源端口、目标1P、目标端口）,切换网络时至少会有一个要素发生变化，导致连接发生变化。当连接发生变化时，如果还使用原来的TCP连接，则会导致连接失败，就得等原来的连接超时后重新建立连接，所以我们有时候发现切换到一个新网络时，即使新网络状況良好，但内容还是需要加载很久，如果实现得好，当检测到网络变化时立刻建立新的TCP连接，即使这样，建立新的连接还是需要几百毫秒的时间。</p><p>QUIC的连接不受4要素的影响，当4要素发生变化时，原连接依然维持。QUIC连接不以4要素作为标识，而是使用一组Connection 1D（连接D）来标识一个连接。即使IP或者端口发生变化，只要Connection 1D没有变化，那么连接依然可以维持</p><blockquote><p>当设备连接到Wi-Fi时，将进行中的下载从蜂窝网络连接转移到更快速的Wi-Fi连接<br>当Wi-Fi连接不再可用时，将连接转移到蜂窝网络连接</p></blockquote><h4 id="解决了HTTP-2的队头阻塞和握手延迟"><a href="#解决了HTTP-2的队头阻塞和握手延迟" class="headerlink" title="解决了HTTP/2的队头阻塞和握手延迟"></a>解决了HTTP/2的队头阻塞和握手延迟</h4>]]></content>
    
    
    <summary type="html">&lt;p&gt;总结一下最近关于HTTP的理解&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP/1.1&lt;/li&gt;
&lt;li&gt;HTTP/2&lt;/li&gt;
&lt;li&gt;HTTP/3&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="计算机网络" scheme="https://rencheng.cc/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark抓包</title>
    <link href="https://rencheng.cc/2022/01/11/network/Wireshark%E6%8A%93%E5%8C%85/"/>
    <id>https://rencheng.cc/2022/01/11/network/Wireshark%E6%8A%93%E5%8C%85/</id>
    <published>2022-01-11T12:11:58.000Z</published>
    <updated>2022-01-11T12:11:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>记录一下<code>Wireshark</code>使用</p><span id="more"></span><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><h3 id="捕获过滤器"><a href="#捕获过滤器" class="headerlink" title="捕获过滤器"></a>捕获过滤器</h3><p>捕获过滤器表达式作用在wireshark开始捕获数据包之前，只捕获符合条件的数据包</p><h4 id="表达式语法"><a href="#表达式语法" class="headerlink" title="表达式语法"></a>表达式语法</h4><table><thead><tr><th align="left">协议列表</th></tr></thead><tbody><tr><td align="left">tcp</td></tr><tr><td align="left">udp</td></tr><tr><td align="left">arp</td></tr><tr><td align="left">tcp</td></tr><tr><td align="left">ip</td></tr><tr><td align="left">ip6</td></tr></tbody></table><table><thead><tr><th align="left">逻辑关键字</th></tr></thead><tbody><tr><td align="left">or</td></tr><tr><td align="left">and</td></tr></tbody></table><table><thead><tr><th align="left">取反关键字</th></tr></thead><tbody><tr><td align="left">no</td></tr></tbody></table><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><ol><li><p>协议是<code>tcp</code>并且端口号是<code>443</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcp port 443</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">tcp port https</span><br></pre></td></tr></table></figure></li><li><p>协议是<code>tcp</code>并且端口号<strong>不是</strong><code>443</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp and not port 443</span><br></pre></td></tr></table></figure></li><li><p>域名是<code>baidu.com</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host baidu.com</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">host 220.181.38.148</span><br></pre></td></tr></table></figure></li><li><p>网卡的mac地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ether host 00:00:5e:00:53:10</span><br></pre></td></tr></table></figure></li></ol><h3 id="显示过滤器"><a href="#显示过滤器" class="headerlink" title="显示过滤器"></a>显示过滤器</h3><p>显示过滤器表达式作用在在wireshark捕获数据包之后，从已捕获的所有数据包中显示出符合条件的数据包，隐藏不符合条件的数据包。</p><h4 id="表达式语法-1"><a href="#表达式语法-1" class="headerlink" title="表达式语法"></a>表达式语法</h4><table><thead><tr><th align="left">逻辑关键字</th></tr></thead><tbody><tr><td align="left">||</td></tr><tr><td align="left">&amp;&amp;</td></tr></tbody></table><table><thead><tr><th align="left">取反关键字</th></tr></thead><tbody><tr><td align="left">!</td></tr></tbody></table><h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><ol><li>IP地址是<code>106.152.175.199</code>并且端口号是<code>56147</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr == 106.152.175.199 &amp;&amp; tcp.port == 56147</span><br></pre></td></tr></table></figure></li><li>IP地址是<code>106.152.175.199</code>并且端口号<strong>不是</strong><code>56147</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr == 106.152.175.199 &amp;&amp; tcp.port != 56147</span><br></pre></td></tr></table></figure></li><li>目标IP地址是<code>106.152.175.199</code>并且源IP地址是<code>16.52.175.199</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.dst == 106.52.175.199 &amp;&amp; ip.src == 16.52.175.199</span><br></pre></td></tr></table></figure></li><li>url中包含.js的http数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.request.uri contains <span class="string">&quot;.js&quot;</span></span><br></pre></td></tr></table></figure></li><li>内容包含username的http数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains <span class="string">&quot;username&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="捕获HTTPS数据（MacOS）"><a href="#捕获HTTPS数据（MacOS）" class="headerlink" title="捕获HTTPS数据（MacOS）"></a>捕获HTTPS数据（MacOS）</h2><ol><li>命令行启动谷歌浏览器，并指定<code>ssl-key-log-file=/tmp/.ssl-key.log</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --user-data-dir=/tmp/chrome --ssl-key-log-file=/tmp/.ssl-key.log</span><br></pre></td></tr></table></figure></li><li>配置Wireshark，依次打开<code>首选项</code>-&gt;<code>protocol</code>-&gt;<code>TLS</code></li><li>在输入框内输入<code>/tmp/.ssl-key.log</code><br><img src="https://cdn.rencheng.cc/blog/84byj.png"></li><li>在新开启的浏览器窗口，访问要抓取的内容</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;记录一下&lt;code&gt;Wireshark&lt;/code&gt;使用&lt;/p&gt;</summary>
    
    
    
    
    <category term="工具" scheme="https://rencheng.cc/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="计算机网络" scheme="https://rencheng.cc/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    <category term="抓包" scheme="https://rencheng.cc/tags/%E6%8A%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>2022面试题整理</title>
    <link href="https://rencheng.cc/2022/01/03/ios/general/2022%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/"/>
    <id>https://rencheng.cc/2022/01/03/ios/general/2022%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/</id>
    <published>2022-01-03T11:51:46.000Z</published>
    <updated>2022-01-03T11:51:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>2022面试题整理</p><span id="more"></span><h2 id="字节跳动"><a href="#字节跳动" class="headerlink" title="字节跳动"></a>字节跳动</h2><h3 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h3><h3 id="之前项目的亮点，难点，擅长点"><a href="#之前项目的亮点，难点，擅长点" class="headerlink" title="之前项目的亮点，难点，擅长点"></a>之前项目的亮点，难点，擅长点</h3><h3 id="实例对象的内存结构？isa-t包含哪些信息"><a href="#实例对象的内存结构？isa-t包含哪些信息" class="headerlink" title="实例对象的内存结构？isa_t包含哪些信息"></a>实例对象的内存结构？isa_t包含哪些信息</h3><h3 id="block内为什么要实现-strong？"><a href="#block内为什么要实现-strong？" class="headerlink" title="block内为什么要实现__strong？"></a>block内为什么要实现__strong？</h3><h3 id="Swift的方法调度是什么？跟OC的区别？如何强制用消息发送"><a href="#Swift的方法调度是什么？跟OC的区别？如何强制用消息发送" class="headerlink" title="Swift的方法调度是什么？跟OC的区别？如何强制用消息发送"></a>Swift的方法调度是什么？跟OC的区别？如何强制用消息发送</h3><h3 id="Swift的写时复制底层如何实现？"><a href="#Swift的写时复制底层如何实现？" class="headerlink" title="Swift的写时复制底层如何实现？"></a>Swift的写时复制底层如何实现？</h3><h3 id="进程，线程；串行，并行；同步，异步；并行，并发"><a href="#进程，线程；串行，并行；同步，异步；并行，并发" class="headerlink" title="进程，线程；串行，并行；同步，异步；并行，并发"></a>进程，线程；串行，并行；同步，异步；并行，并发</h3><p>进程是资源分配的最小单位，线程是CPU调度的最小单位</p><p>并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔发生。<br>并发的关键是你有处理多个任务的能力，不一定要同时。<br>并行的关键是你有同时处理多个任务的能力。</p><p>串行：一个程序执行没结束前，另一个不能开始，要一个一个的执行。<br>并行：一个程序执行没结束，另一个已经开始。</p><p>同步：当程序1调用程序2时，程序1停下不动，直到程序2完成回到程序1来，程序1才继续执行下去。<br>异步：当程序1调用程序2时，程序1径自继续自己的下一个动作，不受程序2的的影响。</p><h3 id="APP启动流程，启动优化"><a href="#APP启动流程，启动优化" class="headerlink" title="APP启动流程，启动优化"></a>APP启动流程，启动优化</h3><h3 id="字符串为什么用copy"><a href="#字符串为什么用copy" class="headerlink" title="字符串为什么用copy"></a>字符串为什么用copy</h3><h3 id="属性特性内存管理上有哪些关键字"><a href="#属性特性内存管理上有哪些关键字" class="headerlink" title="属性特性内存管理上有哪些关键字"></a>属性特性内存管理上有哪些关键字</h3><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><h4 id="信号量semaphore初始信号量为0会发生什么？"><a href="#信号量semaphore初始信号量为0会发生什么？" class="headerlink" title="信号量semaphore初始信号量为0会发生什么？"></a>信号量semaphore初始信号量为0会发生什么？</h4><h3 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h3><h3 id="使用过的设计模式"><a href="#使用过的设计模式" class="headerlink" title="使用过的设计模式"></a>使用过的设计模式</h3><h3 id="静态编译的流程"><a href="#静态编译的流程" class="headerlink" title="静态编译的流程"></a>静态编译的流程</h3><h3 id="LinkMap是如何静态分析无用类的"><a href="#LinkMap是如何静态分析无用类的" class="headerlink" title="LinkMap是如何静态分析无用类的"></a>LinkMap是如何静态分析无用类的</h3><h3 id="runloop"><a href="#runloop" class="headerlink" title="runloop"></a>runloop</h3><h4 id="runloop跟UI渲染有哪些关系"><a href="#runloop跟UI渲染有哪些关系" class="headerlink" title="runloop跟UI渲染有哪些关系"></a>runloop跟UI渲染有哪些关系</h4><h4 id="source0和source1都包含哪些东西"><a href="#source0和source1都包含哪些东西" class="headerlink" title="source0和source1都包含哪些东西"></a>source0和source1都包含哪些东西</h4><h4 id="子线程是如何利用runloop进行线程保活的"><a href="#子线程是如何利用runloop进行线程保活的" class="headerlink" title="子线程是如何利用runloop进行线程保活的"></a>子线程是如何利用runloop进行线程保活的</h4><h3 id="如何hook-C函数"><a href="#如何hook-C函数" class="headerlink" title="如何hook C函数"></a>如何hook C函数</h3><h3 id="上机题"><a href="#上机题" class="headerlink" title="上机题"></a>上机题</h3><h4 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h4><h4 id="算法题"><a href="#算法题" class="headerlink" title="算法题"></a>算法题</h4><p>含有n个数字的圆圈中每次删除第m个元素，求最后剩下的数字</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="LRU算法原理，包含哪些数据结构"><a href="#LRU算法原理，包含哪些数据结构" class="headerlink" title="LRU算法原理，包含哪些数据结构"></a>LRU算法原理，包含哪些数据结构</h4><h4 id="链表反转"><a href="#链表反转" class="headerlink" title="链表反转"></a>链表反转</h4><h2 id="BI安"><a href="#BI安" class="headerlink" title="BI安"></a>BI安</h2><h3 id="栅栏函数的实现细节"><a href="#栅栏函数的实现细节" class="headerlink" title="栅栏函数的实现细节"></a>栅栏函数的实现细节</h3><h2 id="京东"><a href="#京东" class="headerlink" title="京东"></a>京东</h2><h3 id="简述下KVC的处理流程，是否会触发KVO"><a href="#简述下KVC的处理流程，是否会触发KVO" class="headerlink" title="简述下KVC的处理流程，是否会触发KVO"></a>简述下KVC的处理流程，是否会触发KVO</h3><h3 id="启动优化方式"><a href="#启动优化方式" class="headerlink" title="启动优化方式"></a>启动优化方式</h3><h3 id="简述下TCP三次握手流程，为什么2次和4次不行？"><a href="#简述下TCP三次握手流程，为什么2次和4次不行？" class="headerlink" title="简述下TCP三次握手流程，为什么2次和4次不行？"></a>简述下TCP三次握手流程，为什么2次和4次不行？</h3><h3 id="阅读过哪些第三方源码？挑一个介绍一下？"><a href="#阅读过哪些第三方源码？挑一个介绍一下？" class="headerlink" title="阅读过哪些第三方源码？挑一个介绍一下？"></a>阅读过哪些第三方源码？挑一个介绍一下？</h3><h3 id="AutoreleasePool的底层结构"><a href="#AutoreleasePool的底层结构" class="headerlink" title="AutoreleasePool的底层结构"></a>AutoreleasePool的底层结构</h3><p>@autoreleasepool{} 本质上是一个结构体：<br>autoreleasepool会被转换成__AtAutoreleasePool<br>__AtAutoreleasePool 里面有两个函数objc_autoreleasePoolPush(),objc_autoreleasePoolPop().，其实一些列下来之后实际上调用得是AutoreleasePoolPage类中得push 和 pop两个类方法<br>push就是压栈操作，<br>pop就是出栈操作于此同时对其对象发送release消息进行释放</p><h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><h4 id="如何实现一个哈希表"><a href="#如何实现一个哈希表" class="headerlink" title="如何实现一个哈希表"></a>如何实现一个哈希表</h4><h2 id="快看漫画"><a href="#快看漫画" class="headerlink" title="快看漫画"></a>快看漫画</h2><h3 id="load-和-initilze-的调用情况，以及子类的调用顺序问题？"><a href="#load-和-initilze-的调用情况，以及子类的调用顺序问题？" class="headerlink" title="load 和 initilze 的调用情况，以及子类的调用顺序问题？"></a>load 和 initilze 的调用情况，以及子类的调用顺序问题？</h3><p><code>initialize</code>这个方法是第一次给某给类发送消息的时候调用，并且只会调用一次。 如果某一个类一直没有被用到，此方法也不会执行。<br><code>initialize</code>先初始化父类， 在初始化子类，子类的initialize 会覆盖父类的方法。<br>分类中实现了<code>initialize</code>会覆盖本来的initialize方法，如果多个分类都执行了initialize ，那么只是执行最后编译的那个。<br>load当程序被加载的时候就会调用， 其加载顺序为， 如果子类实现类load 先执行父类 -&gt; 在执行子类，而分类的在最后执行。<br>如果子类不实现load，父类的load就不会被执行。<br>load是线程安全的，其内部使用了锁，所以我们应该避免在load方法中线程阻塞。<br>load在分类中，重写了load方法， 不会影响其主类的方法。即不会覆盖本类的load方法<br>当有多个类的时候，每个类的load的执行顺序和编译顺序一致。</p><h3 id="frame和bounds的区别？UIScrollView滚动的时候bounds会发生变化吗？"><a href="#frame和bounds的区别？UIScrollView滚动的时候bounds会发生变化吗？" class="headerlink" title="frame和bounds的区别？UIScrollView滚动的时候bounds会发生变化吗？"></a>frame和bounds的区别？UIScrollView滚动的时候bounds会发生变化吗？</h3><h3 id="简述下事件传递过程"><a href="#简述下事件传递过程" class="headerlink" title="简述下事件传递过程"></a>简述下事件传递过程</h3><h3 id="weak的内存管理机制？"><a href="#weak的内存管理机制？" class="headerlink" title="weak的内存管理机制？"></a>weak的内存管理机制？</h3><h3 id="手势和触摸事件的优先级谁高？"><a href="#手势和触摸事件的优先级谁高？" class="headerlink" title="手势和触摸事件的优先级谁高？"></a>手势和触摸事件的优先级谁高？</h3><h3 id="如何实现一个内存缓存？如何实现一个磁盘缓存？"><a href="#如何实现一个内存缓存？如何实现一个磁盘缓存？" class="headerlink" title="如何实现一个内存缓存？如何实现一个磁盘缓存？"></a>如何实现一个内存缓存？如何实现一个磁盘缓存？</h3><h3 id="iOS消息转发的流程是什么？"><a href="#iOS消息转发的流程是什么？" class="headerlink" title="iOS消息转发的流程是什么？"></a>iOS消息转发的流程是什么？</h3><h3 id="iOS中定时器有哪些？dispatch-source-t为什么是准时的？"><a href="#iOS中定时器有哪些？dispatch-source-t为什么是准时的？" class="headerlink" title="iOS中定时器有哪些？dispatch_source_t为什么是准时的？"></a>iOS中定时器有哪些？dispatch_source_t为什么是准时的？</h3><h3 id="如何实现限速下载？"><a href="#如何实现限速下载？" class="headerlink" title="如何实现限速下载？"></a>如何实现限速下载？</h3><h2 id="中国婚博会"><a href="#中国婚博会" class="headerlink" title="中国婚博会"></a>中国婚博会</h2><h3 id="介绍下HTTP和HTTPS，HTTPS建立连接的过程"><a href="#介绍下HTTP和HTTPS，HTTPS建立连接的过程" class="headerlink" title="介绍下HTTP和HTTPS，HTTPS建立连接的过程"></a>介绍下HTTP和HTTPS，HTTPS建立连接的过程</h3><h3 id="介绍下pod-install的执行流程"><a href="#介绍下pod-install的执行流程" class="headerlink" title="介绍下pod install的执行流程"></a>介绍下<code>pod install</code>的执行流程</h3><h3 id="SDWebImage的实现原理，它是如何解决tableView的复用时出现图片错乱问题的呢？"><a href="#SDWebImage的实现原理，它是如何解决tableView的复用时出现图片错乱问题的呢？" class="headerlink" title="SDWebImage的实现原理，它是如何解决tableView的复用时出现图片错乱问题的呢？"></a>SDWebImage的实现原理，它是如何解决tableView的复用时出现图片错乱问题的呢？</h3><h2 id="微光"><a href="#微光" class="headerlink" title="微光"></a>微光</h2><h3 id="block和delegate的区别？"><a href="#block和delegate的区别？" class="headerlink" title="block和delegate的区别？"></a>block和delegate的区别？</h3><h3 id="OC的分类是什么设计模式"><a href="#OC的分类是什么设计模式" class="headerlink" title="OC的分类是什么设计模式"></a>OC的分类是什么设计模式</h3><h3 id="介绍下离屏渲染"><a href="#介绍下离屏渲染" class="headerlink" title="介绍下离屏渲染"></a>介绍下离屏渲染</h3><h3 id="两个category中出现同名方法，如何解决优先级问题？"><a href="#两个category中出现同名方法，如何解决优先级问题？" class="headerlink" title="两个category中出现同名方法，如何解决优先级问题？"></a>两个category中出现同名方法，如何解决优先级问题？</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;2022面试题整理&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>2021年终总结</title>
    <link href="https://rencheng.cc/2021/12/31/summary/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://rencheng.cc/2021/12/31/summary/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2021-12-31T03:21:48.000Z</published>
    <updated>2021-12-31T03:21:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>一转眼，年终总结已经坚持到第5个年头了，这个总结对我来说非常有意义，每年都有收获。今年得到了一次晋升的机会，上升了一个新的高度后心态上的变化，身份上的变化，以及思考方式的变化，让我这一年改变很多。主要体现在几个方面：</p><ul><li>团队管理<ul><li>团队建设</li><li>活动组织</li><li>任务拆解</li><li>任务派发</li></ul></li><li>技术上<ul><li>服务架构</li><li>技术选型</li><li>方案落地</li><li>涉猎新技术</li></ul></li></ul><p>今年总结主要关键词：<strong>成长，管理</strong></p><span id="more"></span><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><h3 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h3><p>今年的工作没有以往的纯粹，以前只需要对相关任务进行拆解开发并提测，今年所做的是挑战性有大幅增强，以前大多面对的事，今年大多面对的是人。因为做项目不是自己可以独立完成的，需要大家通力配合才能有好的结果。所以在不影响现有平台的工作前提下，我大多精力做的就是沟通协调的工作。虽说项目结果不是特别好，但是收获一帮可以为之奋斗的兄弟。👍🏻</p><h3 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h3><ul><li>办了婚礼</li><li>长三角旅游</li><li>逛了很多公园</li><li>给老家投资了个卫生间</li></ul><h2 id="反省"><a href="#反省" class="headerlink" title="反省"></a>反省</h2><ul><li>加强韧性：明明再再再坚持下，结果就不一样</li><li>时间规划：今年在抖音上浪费了500个小时，罪过</li></ul><h2 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h2><ul><li>将学到的<code>Swift</code>，<code>Flutter</code>等技术进行落地；</li><li>敏捷迭代，系统分解，人员管理，计算机网络知识深层回顾；</li><li>对后端(Java)微服务架构有基本了解；</li></ul><h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><p>2022年TODO：</p><ol><li>C++达到可开发程度</li><li>数据结构和算法（LeetCode-TOP300题）</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;一转眼，年终总结已经坚持到第5个年头了，这个总结对我来说非常有意义，每年都有收获。今年得到了一次晋升的机会，上升了一个新的高度后心态上的变化，身份上的变化，以及思考方式的变化，让我这一年改变很多。主要体现在几个方面：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;团队管理&lt;ul&gt;
&lt;li&gt;团队建设&lt;/li&gt;
&lt;li&gt;活动组织&lt;/li&gt;
&lt;li&gt;任务拆解&lt;/li&gt;
&lt;li&gt;任务派发&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;技术上&lt;ul&gt;
&lt;li&gt;服务架构&lt;/li&gt;
&lt;li&gt;技术选型&lt;/li&gt;
&lt;li&gt;方案落地&lt;/li&gt;
&lt;li&gt;涉猎新技术&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今年总结主要关键词：&lt;strong&gt;成长，管理&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="年度总结" scheme="https://rencheng.cc/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>特殊的键值结构</title>
    <link href="https://rencheng.cc/2021/11/16/ios/objc/%E7%89%B9%E6%AE%8A%E7%9A%84%E9%94%AE%E5%80%BC%E7%BB%93%E6%9E%84/"/>
    <id>https://rencheng.cc/2021/11/16/ios/objc/%E7%89%B9%E6%AE%8A%E7%9A%84%E9%94%AE%E5%80%BC%E7%BB%93%E6%9E%84/</id>
    <published>2021-11-16T06:58:56.000Z</published>
    <updated>2021-11-16T06:58:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>平时开发中，大部分使用<code>NSDictionary</code>和<code>NSMutableDictionary</code>。下面介绍个特殊的。</p><ul><li>NSMapTable</li><li>NXMapTable（objc源码）</li></ul><span id="more"></span><h2 id="NSMapTable"><a href="#NSMapTable" class="headerlink" title="NSMapTable"></a>NSMapTable</h2><p><code>NSMapTable</code>是更广泛意义的<code>NSMutableDictionary</code>，区别于<code>NSMutableDictionary</code>，<code>NSMapTable</code>有如下特性：</p><ul><li>NSMapTable 是可变的；</li><li><strong>NSMapTable 可以持有 weak 类型的key和value变量；</strong></li><li>NSMapTable 可以在添加成员变量的时候复制成员；</li><li>NSMapTable 可以随意的存储指针并且利用指针的唯一性来进行 hash 同一性检查（检查成员变量是否有重复）和对比操作（equal）；</li></ul><p>使用方法</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSObject</span> *object = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"><span class="built_in">NSMapTable</span> *map = [[<span class="built_in">NSMapTable</span> alloc] initWithKeyOptions:<span class="built_in">NSPointerFunctionsWeakMemory</span> valueOptions:<span class="built_in">NSPointerFunctionsWeakMemory</span> capacity:<span class="number">10</span>];</span><br><span class="line">[map setObject:object forKey:<span class="string">@&quot;key&quot;</span>];</span><br><span class="line">[map removeObjectForKey:<span class="string">@&quot;key&quot;</span>];</span><br></pre></td></tr></table></figure><p>NSMapTableOptions介绍（源码中是使用静态常量做关联）</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    <span class="comment">// 默认行为，强引用集合中的对象，等同于NSMutableSet</span></span><br><span class="line">    <span class="built_in">NSMapTableStrongMemory</span>             = <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// 在将对象添加到集合之前，会拷贝对象</span></span><br><span class="line">    <span class="built_in">NSMapTableCopyIn</span>                   = <span class="built_in">NSPointerFunctionsCopyIn</span>,</span><br><span class="line">    <span class="comment">// 使用移位指针(shifted pointer)来做hash检测和确定两个对象是否相等；</span></span><br><span class="line">    <span class="comment">// 同时使用description方法来做描述字符串</span></span><br><span class="line">    <span class="built_in">NSMapTableObjectPointerPersonality</span> = <span class="built_in">NSPointerFunctionsObjectPointerPersonality</span>,</span><br><span class="line">    <span class="comment">// 弱引用集合中的对象，且在对象被释放后，会被正确的移除。</span></span><br><span class="line">    <span class="built_in">NSMapTableWeakMemory</span>               = <span class="built_in">NSPointerFunctionsWeakMemory</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NSUInteger</span> <span class="built_in">NSMapTableOptions</span>;</span><br></pre></td></tr></table></figure><h2 id="NXMapTable"><a href="#NXMapTable" class="headerlink" title="NXMapTable"></a>NXMapTable</h2><p>在objc源码中，找到了关于NSMapTable的类似实现。可以参考下</p><blockquote><p>Hash冲突解决方案：开放地址法</p></blockquote><p>NXMapTable存储结构（精简过）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NXMapTable</span> &#123;</span></span><br><span class="line">    <span class="comment">// 附属实体</span></span><br><span class="line">    <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NXMapTablePrototype</span>* <span class="title">prototype</span>;</span></span><br><span class="line">    <span class="comment">// 真实的长度（存储了多少有效数据）</span></span><br><span class="line">    <span class="type">unsigned</span>count;</span><br><span class="line">    <span class="comment">// buckets实际所占用的空间大小-1；如果count * 4 &gt; numBuckets * 3 就扩容buckets</span></span><br><span class="line">    <span class="type">unsigned</span>nbBucketsMinusOne;</span><br><span class="line">    <span class="comment">// 数据[MapPair?]</span></span><br><span class="line">    <span class="type">void</span>* buckets;</span><br><span class="line">&#125; NXMapTable;</span><br></pre></td></tr></table></figure><p>NXMapTablePrototype存储结构（精简过）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NXMapTablePrototype</span> &#123;</span></span><br><span class="line">    <span class="comment">// hash的函数指针</span></span><br><span class="line">    <span class="type">unsigned</span>(* hash)(NXMapTable *,</span><br><span class="line">                                  <span class="type">const</span> <span class="type">void</span> * key);</span><br><span class="line">    <span class="comment">// 相等的函数指针</span></span><br><span class="line">    <span class="type">int</span>(* isEqual)(NXMapTable *,</span><br><span class="line">                                     <span class="type">const</span> <span class="type">void</span> * key1,</span><br><span class="line">                                     <span class="type">const</span> <span class="type">void</span> * key2);</span><br><span class="line">    <span class="comment">// 释放函数指针</span></span><br><span class="line">    <span class="type">void</span>(* <span class="built_in">free</span>)(NXMapTable *,</span><br><span class="line">                                  <span class="type">void</span> * key,</span><br><span class="line">                                  <span class="type">void</span> * value);</span><br><span class="line">    <span class="comment">// 预留字段</span></span><br><span class="line">    <span class="type">int</span>style;</span><br><span class="line">&#125; NXMapTablePrototype;</span><br></pre></td></tr></table></figure><p>MapPair存储结构</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">MapPair</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*key;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*value;</span><br><span class="line">&#125; MapPair;</span><br></pre></td></tr></table></figure><p><code>NXMapTable的</code>构造器<code>NXCreateMapTable</code>和<code>NXCreateMapTableFromZone</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">NXMapTable *<span class="title function_">NXCreateMapTable</span><span class="params">(NXMapTablePrototype prototype, <span class="type">unsigned</span> capacity)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> NXCreateMapTableFromZone(prototype, capacity, malloc_default_zone());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NXMapTable *<span class="title function_">NXCreateMapTableFromZone</span><span class="params">(NXMapTablePrototype prototype, <span class="type">unsigned</span> capacity, <span class="type">void</span> *z)</span> &#123;</span><br><span class="line">    NXMapTable*table = (NXMapTable *)malloc_zone_malloc((<span class="type">malloc_zone_t</span> *)z, <span class="keyword">sizeof</span>(NXMapTable));</span><br><span class="line">    NXMapTablePrototype*proto;</span><br><span class="line">    <span class="keyword">if</span> (! prototypes) prototypes = NXCreateHashTable(protoPrototype, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (! prototype.hash || ! prototype.isEqual || ! prototype.<span class="built_in">free</span> || prototype.style) &#123;</span><br><span class="line">_objc_inform(<span class="string">&quot;*** NXCreateMapTable: invalid creation parameters\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    proto = (NXMapTablePrototype *)NXHashGet(prototypes, &amp;prototype); </span><br><span class="line">    <span class="keyword">if</span> (! proto) &#123;</span><br><span class="line">proto = (NXMapTablePrototype *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(NXMapTablePrototype));</span><br><span class="line">*proto = prototype;</span><br><span class="line">    (<span class="type">void</span>)NXHashInsert(prototypes, proto);</span><br><span class="line">    &#125;</span><br><span class="line">    table-&gt;prototype = proto; table-&gt;count = <span class="number">0</span>;</span><br><span class="line">    table-&gt;nbBucketsMinusOne = exp2u(log2u(capacity)+<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    table-&gt;buckets = allocBuckets(z, table-&gt;nbBucketsMinusOne + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> table;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>取数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">NXMapGet</span><span class="params">(NXMapTable *table, <span class="type">const</span> <span class="type">void</span> *key)</span> &#123;</span><br><span class="line">    <span class="type">void</span>*value;</span><br><span class="line">    <span class="keyword">return</span> (_NXMapMember(table, key, &amp;value) != NX_MAPNOTAKEY) ? value : <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> *_NXMapMember(NXMapTable *table, <span class="type">const</span> <span class="type">void</span> *key, <span class="type">void</span> **value) &#123;</span><br><span class="line">    MapPair*pairs = (MapPair *)table-&gt;buckets;</span><br><span class="line">    <span class="type">unsigned</span>index = bucketOf(table, key);</span><br><span class="line">    MapPair*<span class="built_in">pair</span> = pairs + index;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) <span class="keyword">return</span> NX_MAPNOTAKEY;</span><br><span class="line">    validateKey(table, <span class="built_in">pair</span>, index, index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;</span><br><span class="line">*value = (<span class="type">void</span> *)<span class="built_in">pair</span>-&gt;value;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *)<span class="built_in">pair</span>-&gt;key;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">unsigned</span>index2 = index;</span><br><span class="line"><span class="keyword">while</span> ((index2 = nextIndex(table, index2)) != index) &#123;</span><br><span class="line">    <span class="built_in">pair</span> = pairs + index2;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) <span class="keyword">return</span> NX_MAPNOTAKEY;</span><br><span class="line">    validateKey(table, <span class="built_in">pair</span>, index, index2);</span><br><span class="line">    <span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;</span><br><span class="line">    *value = (<span class="type">void</span> *)<span class="built_in">pair</span>-&gt;value;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *)<span class="built_in">pair</span>-&gt;key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> NX_MAPNOTAKEY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>插入数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">NXMapInsert</span><span class="params">(NXMapTable *table, <span class="type">const</span> <span class="type">void</span> *key, <span class="type">const</span> <span class="type">void</span> *value)</span> &#123;</span><br><span class="line">    MapPair*pairs = (MapPair *)table-&gt;buckets;</span><br><span class="line">    <span class="type">unsigned</span>index = bucketOf(table, key);</span><br><span class="line">    MapPair*<span class="built_in">pair</span> = pairs + index;</span><br><span class="line">    <span class="keyword">if</span> (key == NX_MAPNOTAKEY) &#123;</span><br><span class="line">_objc_inform(<span class="string">&quot;*** NXMapInsert: invalid key: -1\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> numBuckets = table-&gt;nbBucketsMinusOne + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) &#123;</span><br><span class="line"><span class="built_in">pair</span>-&gt;key = key; <span class="built_in">pair</span>-&gt;value = value;</span><br><span class="line">table-&gt;count++;</span><br><span class="line"><span class="keyword">if</span> (table-&gt;count * <span class="number">4</span> &gt; numBuckets * <span class="number">3</span>) _NXMapRehash(table);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">void</span>*old = <span class="built_in">pair</span>-&gt;value;</span><br><span class="line"><span class="keyword">if</span> (old != value) <span class="built_in">pair</span>-&gt;value = value;<span class="comment">/* avoid writing unless needed! */</span></span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *)old;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (table-&gt;count == numBuckets) &#123;</span><br><span class="line"><span class="comment">/* no room: rehash and retry */</span></span><br><span class="line">_NXMapRehash(table);</span><br><span class="line"><span class="keyword">return</span> NXMapInsert(table, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">unsigned</span>index2 = index;</span><br><span class="line"><span class="keyword">while</span> ((index2 = nextIndex(table, index2)) != index) &#123;</span><br><span class="line">    <span class="built_in">pair</span> = pairs + index2;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) &#123;</span><br><span class="line"><span class="built_in">pair</span>-&gt;key = key; <span class="built_in">pair</span>-&gt;value = value;</span><br><span class="line">table-&gt;count++;</span><br><span class="line"><span class="keyword">if</span> (table-&gt;count * <span class="number">4</span> &gt; numBuckets * <span class="number">3</span>) _NXMapRehash(table);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">void</span>*old = <span class="built_in">pair</span>-&gt;value;</span><br><span class="line"><span class="keyword">if</span> (old != value) <span class="built_in">pair</span>-&gt;value = value;<span class="comment">/* avoid writing unless needed! */</span></span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *)old;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* no room: can&#x27;t happen! */</span></span><br><span class="line">_objc_inform(<span class="string">&quot;**** NXMapInsert: bug\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">NXMapRemove</span><span class="params">(NXMapTable *table, <span class="type">const</span> <span class="type">void</span> *key)</span> &#123;</span><br><span class="line">    MapPair*pairs = (MapPair *)table-&gt;buckets;</span><br><span class="line">    <span class="type">unsigned</span>index = bucketOf(table, key);</span><br><span class="line">    MapPair*<span class="built_in">pair</span> = pairs + index;</span><br><span class="line">    <span class="type">unsigned</span>chain = <span class="number">1</span>; <span class="comment">/* number of non-nil pairs in a row */</span></span><br><span class="line">    <span class="type">int</span>found = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*old = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">/* compute chain */</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="type">unsigned</span>index2 = index;</span><br><span class="line"><span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;found ++; old = <span class="built_in">pair</span>-&gt;value; &#125;</span><br><span class="line"><span class="keyword">while</span> ((index2 = nextIndex(table, index2)) != index) &#123;</span><br><span class="line">    <span class="built_in">pair</span> = pairs + index2;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">pair</span>-&gt;key == NX_MAPNOTAKEY) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> (isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) &#123;found ++; old = <span class="built_in">pair</span>-&gt;value; &#125;</span><br><span class="line">    chain++;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! found) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (found != <span class="number">1</span>) _objc_inform(<span class="string">&quot;**** NXMapRemove: incorrect table\n&quot;</span>);</span><br><span class="line">    <span class="comment">/* remove then reinsert */</span></span><br><span class="line">    &#123;</span><br><span class="line">MapPairbuffer[<span class="number">16</span>];</span><br><span class="line">MapPair*aux = (chain &gt; <span class="number">16</span>) ? (MapPair *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(MapPair)*(chain<span class="number">-1</span>)) : buffer;</span><br><span class="line"><span class="type">unsigned</span>auxnb = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span>nb = chain;</span><br><span class="line"><span class="type">unsigned</span>index2 = index;</span><br><span class="line"><span class="keyword">while</span> (nb--) &#123;</span><br><span class="line">    <span class="built_in">pair</span> = pairs + index2;</span><br><span class="line">    <span class="keyword">if</span> (! isEqual(table, <span class="built_in">pair</span>-&gt;key, key)) aux[auxnb++] = *<span class="built_in">pair</span>;</span><br><span class="line">    <span class="built_in">pair</span>-&gt;key = NX_MAPNOTAKEY; <span class="built_in">pair</span>-&gt;value = <span class="literal">NULL</span>;</span><br><span class="line">    index2 = nextIndex(table, index2);</span><br><span class="line">&#125;</span><br><span class="line">table-&gt;count -= chain;</span><br><span class="line"><span class="keyword">if</span> (auxnb != chain<span class="number">-1</span>) _objc_inform(<span class="string">&quot;**** NXMapRemove: bug\n&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (auxnb--) NXMapInsert(table, aux[auxnb].key, aux[auxnb].value);</span><br><span class="line"><span class="keyword">if</span> (chain &gt; <span class="number">16</span>) <span class="built_in">free</span>(aux);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)old;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;平时开发中，大部分使用&lt;code&gt;NSDictionary&lt;/code&gt;和&lt;code&gt;NSMutableDictionary&lt;/code&gt;。下面介绍个特殊的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSMapTable&lt;/li&gt;
&lt;li&gt;NXMapTable（objc源码）&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-Runtime</title>
    <link href="https://rencheng.cc/2021/04/26/ios/swift/Swift-Runtime/"/>
    <id>https://rencheng.cc/2021/04/26/ios/swift/Swift-Runtime/</id>
    <published>2021-04-26T07:09:49.000Z</published>
    <updated>2021-04-26T07:09:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>在OC中，因其动态性我们经常会用到<a href="https://rencheng.cc/2018/05/31/ios/objc/OC-Runtime/">Runtime</a>相关的API，探索一下Runtime在Swift中的注意点</p><span id="more"></span><ul><li>对于<code>纯Swift</code>类来说，没有动态特性。方法和属性不加任何修饰符的情况下，这个时候其实已经不具备我们所谓的<code>Runtime</code>特性了，这和C++方法调度(V-Table调度) 是不谋而合的。</li><li>对于<code>纯Swift</code>类，方法和属性添加<code>@objc</code>标识的情况下，当前我们可以通过<code>Runtime API</code>拿到，但是在我们的OC中是没法进行调度的。</li><li>对于继承自<code>NSObject</code>的类，如果我们想要动态的获取当前的属性和方法，必须在其声明前添加<code>@objc</code>关键字。否则也是没有办法通过<code>Runtime</code> API 获取的。</li><li>如果想使用OC的动态转发机制，必须同时加<a href="https://rencheng.cc/2021/02/15/ios/swift/Swift-%E5%87%BD%E6%95%B0%E6%B4%BE%E5%8F%91/#objc-dynamic"><code>@objc</code>和<code>dynamic</code></a>关键字</li></ul><h2 id="获取方法列表和属性列表"><a href="#获取方法列表和属性列表" class="headerlink" title="获取方法列表和属性列表"></a>获取方法列表和属性列表</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span>: <span class="title class_">NSObject</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">teach</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;你好啊&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">func</span> <span class="title function_">teac1</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;你好啊&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">traversalMethod</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> methodCount: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> methodList <span class="operator">=</span> class_copyMethodList(<span class="type">Teacher</span>.<span class="keyword">self</span>, <span class="operator">&amp;</span>methodCount)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="built_in">numericCast</span>(methodCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> method <span class="operator">=</span> methodList<span class="operator">?</span>[i] &#123;</span><br><span class="line">            <span class="keyword">let</span> methodName <span class="operator">=</span> method_getName(method)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;方法:<span class="subst">\(methodName)</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未找到方法&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">traversalProperty</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> propertyCount: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> propertyList <span class="operator">=</span> class_copyPropertyList(<span class="type">Teacher</span>.<span class="keyword">self</span>, <span class="operator">&amp;</span>propertyCount)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="built_in">numericCast</span>(propertyCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> property <span class="operator">=</span> propertyList<span class="operator">?</span>[i] &#123;</span><br><span class="line">            <span class="keyword">let</span> propertyName <span class="operator">=</span> property_getName(property)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;属性:<span class="subst">\(String(utf8String: propertyName) <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未找到属性&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">traversalMethod()</span><br><span class="line">traversalProperty()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在OC中，因其动态性我们经常会用到&lt;a href=&quot;https://rencheng.cc/2018/05/31/ios/objc/OC-Runtime/&quot;&gt;Runtime&lt;/a&gt;相关的API，探索一下Runtime在Swift中的注意点&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift源码编译</title>
    <link href="https://rencheng.cc/2021/04/25/ios/swift/Swift%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
    <id>https://rencheng.cc/2021/04/25/ios/swift/Swift%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</id>
    <published>2021-04-25T12:18:04.000Z</published>
    <updated>2021-04-25T12:18:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在网上经常能看到源码编译的文章，整理一下关于源码编译的问题。</p><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="硬件环境"><a href="#硬件环境" class="headerlink" title="硬件环境"></a>硬件环境</h3><ol><li><code>Macbook Pro</code> (Retina, 15-inch, Mid 2015)</li><li>磁盘空间**<code>60G</code>**</li></ol><h3 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h3><ol><li>macOS Big Sur 11.2.3</li><li>Xcode 12.4 (12D4e)</li><li>Visual studio Code (1.55.2)</li><li>Python 3.9.4</li><li>cmake 3.20.1</li><li>ninja 1.10.2</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install cmake ninja</span><br></pre></td></tr></table></figure><blockquote><p>macOS，Xcode，swift最好用对应的版本，以防等待半个小时失败后骂骂咧咧</p></blockquote><h2 id="编译步骤"><a href="#编译步骤" class="headerlink" title="编译步骤"></a>编译步骤</h2><h3 id="一、克隆-swift-源码"><a href="#一、克隆-swift-源码" class="headerlink" title="一、克隆 swift 源码"></a>一、克隆 swift 源码</h3><ol><li><p>创建文件夹，并进入该文件夹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> swift-source &amp;&amp; <span class="built_in">cd</span> swift-source</span><br></pre></td></tr></table></figure></li><li><p>开始克隆代码 </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --branch  swift-5.3.2-RELEASE git@github.com:apple/swift.git</span><br></pre></td></tr></table></figure><blockquote><p>5.4版本克隆下来842M</p></blockquote></li></ol><h3 id="二、拉取编译需要的依赖-git-submodule"><a href="#二、拉取编译需要的依赖-git-submodule" class="headerlink" title="二、拉取编译需要的依赖(git submodule)"></a>二、拉取编译需要的依赖(git submodule)</h3><ol><li>切换到swift-source文件夹（<strong>注意看</strong>） <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果在这个文件夹请忽略</span></span><br><span class="line"><span class="built_in">cd</span> swift-source</span><br></pre></td></tr></table></figure></li><li>执行脚本 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./swift/utils/update-checkout --tag swift-5.4-RELEASE --<span class="built_in">clone</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>执行结果</strong><br><img src="https://cdn.rencheng.cc/blog/2w1fe.png"></p><blockquote><ol><li>如果出现Git错误请执行如下命令</li></ol></blockquote><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.postBuffer 524288000 &amp;&amp; git config --global http.sslVerify <span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure></code></pre><blockquote><ol start="2"><li>文件大小大概3.67G左右(包含开始克隆的Swift源码)</li></ol></blockquote><h3 id="三、编译"><a href="#三、编译" class="headerlink" title="三、编译"></a>三、编译</h3><p>编译的过程中可以使用<code>ninja</code>，也可以使用<code>Xcode</code>。由于<code>Xcode</code>需要和特定版本绑定，并且<code>Xcode</code>编译之后的支持性不是特别好。推荐使用<code>njnja</code>来作为编译工具。</p><p>使用<code>ninja</code>编译（推荐）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./swift/utils/build-script -r --debug-swift-stdlib --lldb</span><br></pre></td></tr></table></figure><p>使用<code>Xcode</code>编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./swift/utils/build-script -x -R --debug-swift</span><br></pre></td></tr></table></figure><blockquote><p>输出没有Error代表编译完成</p></blockquote><blockquote><p>编译是挺耗时并且烧设备。我的Mac温度到了95℃</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近在网上经常能看到源码编译的文章，整理一下关于源码编译的问题。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Dictionary原理</title>
    <link href="https://rencheng.cc/2021/04/22/ios/swift/Dictionary%E5%8E%9F%E7%90%86/"/>
    <id>https://rencheng.cc/2021/04/22/ios/swift/Dictionary%E5%8E%9F%E7%90%86/</id>
    <published>2021-04-22T07:55:22.000Z</published>
    <updated>2021-04-22T07:55:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>字典这种数据结构在现代的开发语言中比较常见（PHP叫关联数组）<br>探索一下其底层原理。</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>现在市面上有很多的场景需要Key-Value对存储方式。比如iOS的键值编码，后端的缓存（Redis和Memcached），和一些KVStore配置等都需要这种结构存储。为什么不用数组，链表等其他方式呢？因为它“快”，为什么快呢？下面就来探索一下。</p><h3 id="哈希表（散列表）"><a href="#哈希表（散列表）" class="headerlink" title="哈希表（散列表）"></a>哈希表（散列表）</h3><p>根据关键字（Key Value）而直接访问在内存存储位置的数据结构。也就是说，它通过计算一个关于键值映射到表中一个位置来访问记录，这加快了查找速度。这个映射函数称作散列函数，存放记录的数组成为散列表。</p><h3 id="哈希函数（散列函数）"><a href="#哈希函数（散列函数）" class="headerlink" title="哈希函数（散列函数）"></a>哈希函数（散列函数）</h3><ul><li>直接寻址法</li><li>数字分析法</li><li>平方取中法</li><li>折叠法</li><li>随机余数法</li><li>除留余数法</li></ul><h3 id="哈希冲突"><a href="#哈希冲突" class="headerlink" title="哈希冲突"></a>哈希冲突</h3><p>当两个Key值通过哈希函数映射的索引为同一位置时，则产生哈希冲突</p><p><strong>解决方法：</strong></p><ul><li>开放地址法</li><li>拉链法</li></ul><h3 id="负载因子"><a href="#负载因子" class="headerlink" title="负载因子"></a>负载因子</h3><p>填入表中的元素个数 / 哈希表的长度</p><blockquote><p>注：一般<strong>3/4</strong>的时候需要对哈希表扩容</p></blockquote><h2 id="Swift中Dictionary的原理"><a href="#Swift中Dictionary的原理" class="headerlink" title="Swift中Dictionary的原理"></a>Swift中Dictionary的原理</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;字典这种数据结构在现代的开发语言中比较常见（PHP叫关联数组）&lt;br&gt;探索一下其底层原理。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>CI</title>
    <link href="https://rencheng.cc/2021/03/30/ios/general/CI/"/>
    <id>https://rencheng.cc/2021/03/30/ios/general/CI/</id>
    <published>2021-03-30T07:07:50.000Z</published>
    <updated>2021-03-30T07:07:50.000Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p><strong>代码检测</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成用于后续代码检测的解析文件</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">set</span> +e</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> MCShow</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">swiftlint lint --path MCShow &gt; MCShow-swiftlint.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> $?</span><br></pre></td></tr></table></figure><p><strong>环境配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> MCShow</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作Jenkins打包环境配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$Environment</span>&quot;</span> == <span class="string">&quot;ONLINE&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; ./domain_config</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$Environment</span>&quot;</span> == <span class="string">&quot;RELEASE&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; ./domain_config</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$Environment</span>&quot;</span> == <span class="string">&quot;TEST&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; ./domain_config</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$Environment</span>&quot;</span> == <span class="string">&quot;DEV&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3&quot;</span> &gt; ./domain_config</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><strong>拷贝依赖</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">startInfo=<span class="string">&quot;开始引入依赖库&quot;</span></span><br><span class="line">endInfo=<span class="string">&quot;依赖库引入完成&quot;</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"><span class="built_in">cd</span> MCShow</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://10.0.72.225:7890 http_proxy=http://10.0.72.225:7890 all_proxy=socks5://10.0.72.225:7890</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$startInfo</span></span><br><span class="line">pod install</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$endInfo</span></span><br><span class="line"><span class="comment"># 拷贝资源库</span></span><br><span class="line"><span class="comment"># targetUmdevicePath=&quot;./Pods/UMDevice/UMDevice_1.1.0/UMDevice.framework/&quot;</span></span><br><span class="line"><span class="comment"># srcUmdevicePath=&quot;../Resource/libs/UMDevice.framework/&quot;</span></span><br><span class="line"><span class="comment"># rm -rf $targetUmdevicePath</span></span><br><span class="line"><span class="comment"># cp -r $srcUmdevicePath $targetUmdevicePath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝融云资源</span></span><br><span class="line">targetRongcloudPath=<span class="string">&quot;./Pods/RongCloudIM/RongCloudIM/RongCloud.bundle/&quot;</span></span><br><span class="line">srcRongcloudPath=<span class="string">&quot;../Resource/RongCloud.bundle/&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$targetRongcloudPath</span></span><br><span class="line"><span class="built_in">cp</span> -r <span class="variable">$srcRongcloudPath</span> <span class="variable">$targetRongcloudPath</span></span><br></pre></td></tr></table></figure><p><strong>分发</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">offical=<span class="string">&quot;Fir.im-Official&quot;</span></span><br><span class="line">standby=<span class="string">&quot;Fir.im-Standby&quot;</span></span><br><span class="line">testflight=<span class="string">&quot;TestFlight&quot;</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"><span class="built_in">cd</span> MCShow</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;授权钥匙串访问权限&quot;</span></span><br><span class="line">security unlock-keychain -p 111111 <span class="variable">$HOME</span>/Library/Keychains/login.keychain</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;开始打包&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">checkIpa</span></span>()&#123;</span><br><span class="line">    fileName=<span class="string">&quot;MCShow.ipa&quot;</span></span><br><span class="line">filePath=<span class="string">&quot;app/<span class="variable">$fileName</span>&quot;</span></span><br><span class="line">fileCreateTimeInterval=`<span class="built_in">date</span> -r <span class="string">&quot;<span class="variable">$filePath</span>&quot;</span> +%s`</span><br><span class="line">    nowTimeInterval=`<span class="built_in">date</span> +%s`</span><br><span class="line">    diff=$((<span class="variable">$fileCreateTimeInterval</span>-<span class="variable">$nowTimeInterval</span>))</span><br><span class="line">    <span class="keyword">if</span> [ 0 -gt <span class="variable">$diff</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">let</span> diff=0-<span class="variable">$diff</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    limitTimeInterval=1800</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$diff</span> -gt <span class="variable">$limitTimeInterval</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;安装包检测有问题&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span> 2005</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">firPublish</span></span>()&#123;</span><br><span class="line">    fir publish app/MCShow.ipa --token=<span class="variable">$1</span> --specify-icon-file=fastlane/logo.jpg --changelog=<span class="variable">$ReleaseNotes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ShowPlatform</span>&quot;</span> == <span class="string">&quot;<span class="variable">$offical</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$offical</span>;</span><br><span class="line">fastlane archive;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;打包结束&quot;</span></span><br><span class="line">    checkIpa;</span><br><span class="line">firPublish 9e878f3339b1c1efb036ccf17ca96072;</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$ShowPlatform</span>&quot;</span> == <span class="string">&quot;<span class="variable">$standby</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$standby</span>;</span><br><span class="line">fastlane archive;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;打包结束&quot;</span></span><br><span class="line">    checkIpa;</span><br><span class="line">    firPublish 909f3f4743198a622a0540c0685beab7;</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$ShowPlatform</span>&quot;</span> == <span class="string">&quot;<span class="variable">$testflight</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$testflight</span>;</span><br><span class="line">fastlane beta;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;打包结束&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><strong>通知</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> MCShow</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line">appName=<span class="string">&quot;&quot;</span></span><br><span class="line">appVersion=<span class="string">&quot;&quot;</span></span><br><span class="line">appBuild=<span class="string">&quot;&quot;</span></span><br><span class="line">appBundleId=<span class="string">&quot;&quot;</span></span><br><span class="line">platform=<span class="string">&quot;iOS&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">getAppInfo</span></span>()&#123;</span><br><span class="line">basePath=`<span class="built_in">pwd</span>`</span><br><span class="line">ipaFilePath=<span class="string">&quot;<span class="variable">$basePath</span>/app/MCShow.ipa&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$ipaFilePath</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;未找到ipa包 <span class="variable">$ipaFilePath</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 2002</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">temIpaDirName=<span class="string">&quot;TempPayload&quot;</span></span><br><span class="line">temIpaDirPath=<span class="string">&quot;<span class="variable">$&#123;basePath&#125;</span>/<span class="variable">$&#123;temIpaDirName&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$temIpaDirPath</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$&#123;temIpaDirPath&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -f <span class="string">&quot;<span class="variable">$ipaFilePath</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    unzip <span class="string">&quot;<span class="variable">$ipaFilePath</span>&quot;</span> -d <span class="string">&quot;<span class="variable">$temIpaDirPath</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">appDir=<span class="string">&quot;<span class="variable">$temIpaDirPath</span>/Payload/`ls &quot;</span><span class="variable">$temIpaDirPath</span>/<span class="string">&quot;Payload`&quot;</span></span><br><span class="line">lcmInfoPlist=<span class="string">&quot;<span class="variable">$&#123;appDir&#125;</span>/Info.plist&quot;</span></span><br><span class="line"></span><br><span class="line">appName=`/usr/libexec/PlistBuddy -c <span class="string">&quot;Print :CFBundleDisplayName&quot;</span> <span class="variable">$lcmInfoPlist</span>`</span><br><span class="line">appVersion=`/usr/libexec/PlistBuddy -c <span class="string">&quot;Print :CFBundleShortVersionString&quot;</span> <span class="variable">$lcmInfoPlist</span>`</span><br><span class="line">appBuild=`/usr/libexec/PlistBuddy -c <span class="string">&quot;Print :CFBundleVersion&quot;</span> <span class="variable">$lcmInfoPlist</span>`</span><br><span class="line">appBundleId=`/usr/libexec/PlistBuddy -c <span class="string">&quot;Print :CFBundleIdentifier&quot;</span> <span class="variable">$lcmInfoPlist</span>`</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$temIpaDirPath</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$&#123;temIpaDirPath&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getAppInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">offical=<span class="string">&quot;Fir.im-Official&quot;</span></span><br><span class="line">standby=<span class="string">&quot;Fir.im-Standby&quot;</span></span><br><span class="line">testflight=<span class="string">&quot;TestFlight&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ShowPlatform</span>&quot;</span> == <span class="string">&quot;<span class="variable">$testflight</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">exit</span> 2001</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#钉钉通知</span></span><br><span class="line">accessToken=<span class="string">&quot;c50924ce66e3f842e454089c2f6e75222892d56e9e7f143ef8c235539a66f984&quot;</span></span><br><span class="line">iconUrl=<span class="string">&quot;https://tva1.sinaimg.cn/large/008eGmZEly1gomwuhsuu7j305k05k748.jpg&quot;</span></span><br><span class="line">downloadUrl=<span class="string">&quot;http://fir.renchengqi.com/showios&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ShowPlatform</span>&quot;</span> == <span class="string">&quot;<span class="variable">$offical</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">downloadUrl=<span class="string">&quot;http://fir.hulai.com/shai&quot;</span></span><br><span class="line">    accessToken=<span class="string">&quot;c50924ce66e3f842e454089c2f6e75222892d56e9e7f143ef8c235539a66f984&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;https://oapi.dingtalk.com/robot/send?access_token=<span class="variable">$accessToken</span>&quot;</span></span><br><span class="line">header=<span class="string">&quot;Content-Type: application/json&quot;</span></span><br><span class="line"></span><br><span class="line">title=<span class="string">&quot;<span class="variable">$appName</span>(<span class="variable">$platform</span>)更新&quot;</span></span><br><span class="line">text=<span class="string">&quot;[<span class="variable">$appName</span>(<span class="variable">$platform</span>)更新](<span class="variable">$downloadUrl</span>)\n\n \</span></span><br><span class="line"><span class="string">![<span class="variable">$appName</span>](<span class="variable">$iconUrl</span>)\n\n \</span></span><br><span class="line"><span class="string">链接:[<span class="variable">$downloadUrl</span>](<span class="variable">$downloadUrl</span>)\n\n \</span></span><br><span class="line"><span class="string">版本: <span class="variable">$appVersion</span> (Build: <span class="variable">$appBuild</span>)\n\n \</span></span><br><span class="line"><span class="string">更新内容: <span class="variable">$ReleaseNotes</span>\n\n \</span></span><br><span class="line"><span class="string">Git记录: [https://jenkins.hulai.com/view/shai/job/shai-ios/<span class="variable">$&#123;BUILD_NUMBER&#125;</span>/changes](https://jenkins.hulai.com/view/shai/job/shai-ios/<span class="variable">$&#123;BUILD_NUMBER&#125;</span>/changes)\n&quot;</span></span><br><span class="line"></span><br><span class="line">rawData=<span class="string">&quot;&#123;  \&quot;msgtype\&quot;:\&quot;actionCard\&quot;,  \</span></span><br><span class="line"><span class="string">            \&quot;actionCard\&quot;: &#123; \</span></span><br><span class="line"><span class="string">                \&quot;title\&quot;: \&quot;<span class="variable">$title</span>\&quot;, \</span></span><br><span class="line"><span class="string">                \&quot;text\&quot;: \&quot;<span class="variable">$text</span>\&quot;,  \</span></span><br><span class="line"><span class="string">                \&quot;hideAvatar\&quot;: \&quot;0\&quot;,  \</span></span><br><span class="line"><span class="string">                \&quot;btnOrientation\&quot;: \&quot;0\&quot;,  \</span></span><br><span class="line"><span class="string">                \&quot;singleTitle\&quot;: \&quot;\&quot; \</span></span><br><span class="line"><span class="string">            &#125; \</span></span><br><span class="line"><span class="string">        &#125;&quot;</span></span><br><span class="line"></span><br><span class="line">curl --request POST <span class="string">&quot;<span class="variable">$url</span>&quot;</span> -H <span class="string">&quot;<span class="variable">$header</span>&quot;</span> --data-raw <span class="string">&quot;<span class="variable">$rawData</span>&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;&lt;strong&gt;代码检测&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;</summary>
      
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-指针</title>
    <link href="https://rencheng.cc/2021/03/18/ios/swift/Swift-%E6%8C%87%E9%92%88/"/>
    <id>https://rencheng.cc/2021/03/18/ios/swift/Swift-%E6%8C%87%E9%92%88/</id>
    <published>2021-03-18T05:41:31.000Z</published>
    <updated>2021-03-18T05:41:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>在使用C/C++/OC语言中，经常会用到指针的语法，也理解指针的意义。<br>在Swift中，将指针包装成<strong>不安全</strong>的<code>指针类型</code>。</p><span id="more"></span><h2 id="定义概念对齐"><a href="#定义概念对齐" class="headerlink" title="定义概念对齐"></a>定义概念对齐</h2><table><thead><tr><th align="left">C</th><th align="left">Swift</th></tr></thead><tbody><tr><td align="left"><code>const Pointee *</code></td><td align="left"><code>UnsafePointer&lt;Pointee&gt;</code></td></tr><tr><td align="left"><code>Pointee *</code></td><td align="left"><code>UnsafeMutablePointer&lt;Pointee&gt;</code></td></tr><tr><td align="left"><code>const void *</code></td><td align="left"><code>UnsafeRawPointer</code></td></tr><tr><td align="left"><code>void *</code></td><td align="left"><code>UnsafeMutableRawPointer</code></td></tr></tbody></table><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="示例一"><a href="#示例一" class="headerlink" title="示例一"></a>示例一</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test1</span>(<span class="keyword">_</span> <span class="params">ptr</span>: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int</span>&gt;)&#123;</span><br><span class="line">    ptr.pointee <span class="operator">+=</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test2</span>(<span class="keyword">_</span> <span class="params">ptr</span>: <span class="type">UnsafePointer</span>&lt;<span class="type">Int</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(ptr.pointee)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test1(<span class="operator">&amp;</span>age)</span><br><span class="line">test2(<span class="operator">&amp;</span>age) <span class="comment">// 20</span></span><br><span class="line"><span class="built_in">print</span>(age) <span class="comment">// 20</span></span><br></pre></td></tr></table></figure><h3 id="示例二"><a href="#示例二" class="headerlink" title="示例二"></a>示例二</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test3</span>(<span class="keyword">_</span> <span class="params">ptr</span>: <span class="type">UnsafeMutableRawPointer</span>) &#123;</span><br><span class="line">    ptr.storeBytes (of: <span class="number">20</span>, as: <span class="type">Int</span>.<span class="keyword">self</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test4</span>(<span class="keyword">_</span> <span class="params">ptr</span>: <span class="type">UnsafeRawPointer</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(ptr.load(as: <span class="type">Int</span>.<span class="keyword">self</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test3(<span class="operator">&amp;</span>age)</span><br><span class="line">test4(<span class="operator">&amp;</span>age) <span class="comment">// 20</span></span><br><span class="line"><span class="built_in">print</span>(age) <span class="comment">// 20</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在使用C/C++/OC语言中，经常会用到指针的语法，也理解指针的意义。&lt;br&gt;在Swift中，将指针包装成&lt;strong&gt;不安全&lt;/strong&gt;的&lt;code&gt;指针类型&lt;/code&gt;。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-内存访问冲突</title>
    <link href="https://rencheng.cc/2021/03/17/ios/swift/%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E5%86%B2%E7%AA%81/"/>
    <id>https://rencheng.cc/2021/03/17/ios/swift/%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E5%86%B2%E7%AA%81/</id>
    <published>2021-03-17T06:43:19.000Z</published>
    <updated>2021-03-17T06:43:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>内存访问冲突产生条件</p><ul><li>至少一个是写入操作</li><li>它们访问的是同一块内存</li><li>它们的访问时间重叠（比如在同一个函数内）</li></ul><span id="more"></span><h2 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h2><p><strong>不存在访问冲突</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">increment</span>(<span class="keyword">_</span> <span class="params">num</span>: <span class="keyword">inout</span> <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    num <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> step <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">step <span class="operator">=</span> increment(<span class="operator">&amp;</span>step)</span><br></pre></td></tr></table></figure><p><strong>存在访问冲突</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> step <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">increment</span>(<span class="keyword">_</span> <span class="params">num</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    num <span class="operator">+=</span> step</span><br><span class="line">&#125;</span><br><span class="line">increment(<span class="operator">&amp;</span>step)</span><br></pre></td></tr></table></figure><p>报错<br><img src="https://cdn.rencheng.cc/blog/3h9m8.png"><br>如何解决</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> step <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> copyOfStep <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">increment</span>(<span class="keyword">_</span> <span class="params">num</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    num <span class="operator">+=</span> step</span><br><span class="line">&#125;</span><br><span class="line">increment(<span class="operator">&amp;</span>copyOfStep)</span><br></pre></td></tr></table></figure><h2 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h2><p><img src="https://cdn.rencheng.cc/blog/0k2u1.png"><br><img src="https://cdn.rencheng.cc/blog/i0x6v.png"></p><h2 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a>案例三</h2><p>tulpe是一块结构体内存内存，所以修改内部的数据也会报错<br><img src="https://cdn.rencheng.cc/blog/7q2eg.png"></p><p><img src="https://cdn.rencheng.cc/blog/2qlcg.png"></p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>如果下面的条件可以满足，就说明重叠访问结构体的属性是安全的</p><ul><li>你只访问实例存储属性 ，不是计算属性或者类属性</li><li>结构体是局部变量而非全局变量</li><li>结构体要么没有被闭包捕获要么只被非逃逸闭包捕获</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> tulpe <span class="operator">=</span> (health: <span class="number">10</span>, energy: <span class="number">20</span>)</span><br><span class="line">    balance(<span class="operator">&amp;</span>tulpe. health, <span class="operator">&amp;</span>tulpe.energy)</span><br><span class="line">    <span class="keyword">var</span> holly <span class="operator">=</span> <span class="type">Player</span> (name: <span class="string">&quot;Holly&quot;</span>, health: <span class="number">10</span>, energy: <span class="number">10</span>)</span><br><span class="line">    balance(<span class="operator">&amp;</span>holly.health, <span class="operator">&amp;</span>holly, energy)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;内存访问冲突产生条件&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;至少一个是写入操作&lt;/li&gt;
&lt;li&gt;它们访问的是同一块内存&lt;/li&gt;
&lt;li&gt;它们的访问时间重叠（比如在同一个函数内）&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-SIL调试</title>
    <link href="https://rencheng.cc/2021/02/27/ios/swift/Swift-SIL%E8%B0%83%E8%AF%95/"/>
    <id>https://rencheng.cc/2021/02/27/ios/swift/Swift-SIL%E8%B0%83%E8%AF%95/</id>
    <published>2021-02-27T12:03:11.000Z</published>
    <updated>2021-02-27T12:03:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>SIL</p><span id="more"></span><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="生成SIL文件"><a href="#生成SIL文件" class="headerlink" title="生成SIL文件"></a>生成SIL文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swiftc -emit-sil main.swift &gt;&gt; ./main.sil</span><br></pre></td></tr></table></figure><h3 id="阅读SIL"><a href="#阅读SIL" class="headerlink" title="阅读SIL"></a>阅读SIL</h3><p><a href="https://github.com/apple/swift/blob/main/docs/SIL.rst">解释文档</a></p><ul><li>@main这里标识我们当前main.swift的入口函数，SIL 中的标识符名称以@作<br>为前缀</li><li>%0，%1…在SIL也叫做寄存器，这里我们可以理解为我们日常开发中的常量，一旦赋值之后就不可以再修改，如果SIL中还要继续使用，那么就不断的累加数字。同时这里所说的寄存器是虚拟的，最终运行到我们的机器上，会使用真的寄存器。</li><li>alloc_global创建一个全局变量</li><li>global_addr拿到全局变量的地址</li><li>metatype拿到LGTeacher的Metadata</li><li>apply 代表调用方法，类似于objc里面的objc_msgSend函数</li><li>alloc_ref创建某一个类型的实例对象，当前实例对象引用计数为1</li></ul><ol><li>乱码的字符串，执行如下代码恢复 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun swift-demangle s4main7TeacherC3ageSivg</span><br></pre></td></tr></table></figure></li><li>%1， %2<br> 这些可以理解为虚拟的寄存器，或者理解为常量（赋值之后不会改变）</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;SIL&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>AVFoundation实践</title>
    <link href="https://rencheng.cc/2021/02/23/ios/general/AVFoundation%E4%BD%BF%E7%94%A8/"/>
    <id>https://rencheng.cc/2021/02/23/ios/general/AVFoundation%E4%BD%BF%E7%94%A8/</id>
    <published>2021-02-23T03:23:07.000Z</published>
    <updated>2021-02-23T03:23:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>TODO:</p><p>功能点：</p><ul><li>媒体（图片/视频/音频）捕捉功能（采集）</li><li>截屏（只支持MacOS）</li></ul><p>捕捉会话：AVCaptureSession<br>捕捉设备：AVCaptureDevice<br>捕捉设备输入：AVCaptureDeviceInput<br>捕捉设备输入：AVCaptureOutput(抽象类)<br>    AVCaptureStillImageOutput<br>    AVCaptureMovieFileOutput<br>    AVCaptureAudioDataOutput<br>    AVCaptureVideoDataOutput<br>捕捉连接：AVCaptureConnection<br>捕捉预览：AVCaptureVideoPreviewLayer</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;TODO:&lt;/p&gt;
&lt;p&gt;功能点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;媒体（图片/视频/音频）捕捉功能（采集）&lt;/li&gt;
&lt;li&gt;截屏（只支持MacOS）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;捕捉会话：AVCaptureSession&lt;br&gt;捕捉设备：AVCaptureDevice&lt;br&gt;</summary>
      
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-self与Self</title>
    <link href="https://rencheng.cc/2021/02/16/ios/swift/self%E5%92%8CSelf/"/>
    <id>https://rencheng.cc/2021/02/16/ios/swift/self%E5%92%8CSelf/</id>
    <published>2021-02-16T07:04:52.000Z</published>
    <updated>2021-02-16T07:04:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="self"><a href="#self" class="headerlink" title="self"></a>self</h2><p>代表当前对象</p><h2 id="Self"><a href="#Self" class="headerlink" title="Self"></a>Self</h2><p>代表当前类型</p><span id="more"></span><p>Self一般作为返回值类型，限定返回值和方法调用者必须是同一类型（也可以作为参数类型）</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() -&gt; <span class="keyword">Self</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">self</span>.age)</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">Self</span>.count)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="built_in">type</span>(of: <span class="keyword">self</span>).<span class="keyword">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line"><span class="built_in">print</span>(p.test())</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">0</span><br><span class="line">10</span><br><span class="line">0</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;self&quot;&gt;&lt;a href=&quot;#self&quot; class=&quot;headerlink&quot; title=&quot;self&quot;&gt;&lt;/a&gt;self&lt;/h2&gt;&lt;p&gt;代表当前对象&lt;/p&gt;
&lt;h2 id=&quot;Self&quot;&gt;&lt;a href=&quot;#Self&quot; class=&quot;headerlink&quot; title=&quot;Self&quot;&gt;&lt;/a&gt;Self&lt;/h2&gt;&lt;p&gt;代表当前类型&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-函数派发</title>
    <link href="https://rencheng.cc/2021/02/15/ios/swift/Swift-%E5%87%BD%E6%95%B0%E6%B4%BE%E5%8F%91/"/>
    <id>https://rencheng.cc/2021/02/15/ios/swift/Swift-%E5%87%BD%E6%95%B0%E6%B4%BE%E5%8F%91/</id>
    <published>2021-02-15T08:01:58.000Z</published>
    <updated>2021-02-15T08:01:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>Swift有三种函数派发方式，总结一下</p><ul><li>静态派发</li><li>函数表派发</li><li>消息派发<span id="more"></span></li></ul><h2 id="派发方式概述"><a href="#派发方式概述" class="headerlink" title="派发方式概述"></a>派发方式概述</h2><h3 id="静态派发"><a href="#静态派发" class="headerlink" title="静态派发"></a>静态派发</h3><p><code>静态派发</code>是三种派发方式中最快的。<code>CPU</code>直接拿到函数地址并进行调用。编译器优化时，也常常将函数进行内联，将其转换为静态派发方式，提升执行速度。<br><code>C++</code>默认使用静态派发；在<code>Swift</code>中给函数加上<code>final</code>关键字，也会变成<code>静态派发</code>。</p><p><strong>优点：</strong><br>使用最少的指令集，办最快的事情。</p><p><strong>缺点：</strong><br>静态派发最大的弊病就是没有动态性，不支持继承。</p><h3 id="函数表派发"><a href="#函数表派发" class="headerlink" title="函数表派发"></a>函数表派发</h3><p>编译型语言中最常见的派发方式，既保证了动态性也兼顾了执行效率。<br>函数所在的类会维护一个“函数表”(虚函数表)，存取了每个函数实现的指针。<br>每个类的 V-Table 在编译时就会被构建，所以与静态派发相比多出了两个读取的工作：</p><ul><li>读取该类的 V-Table</li><li>读取函数的指针</li></ul><p><strong>优点：</strong></p><ul><li>查表是一种简单，易实现，而且性能可预知的方式。</li><li>理论上说，函数表派发也是一种高效的方式。</li></ul><p><strong>缺点：</strong></p><ul><li>与静态派发相比，从字节码角度来看，多了两次读和一次跳转。</li><li>与静态派发相比，编译器对某些含有副作用的函数无法优化。(过度拆解，无法内联)</li><li><code>Swift</code>类扩展里面的函数无法动态加入该类的函数表中，只能使用静态派发的方式。</li></ul><h3 id="消息派发"><a href="#消息派发" class="headerlink" title="消息派发"></a>消息派发</h3><p>消息机制是调用函数最动态的方式。由于<code>Swfit</code>使用的依旧是<code>Objective-C</code>的运行时系统，消息派发其实也就是<code>Objective-C</code>的<code>Message Passing(消息传递)</code>。由于消息传递大家看的文章很多了，这里不做过多赘述。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id returnValue = [obj messageName:param];</span><br><span class="line">// 底层代码</span><br><span class="line">id returnValue = objc_msgSend(obj, @selector(messageName:), param);</span><br></pre></td></tr></table></figure><p><strong>优点：</strong></p><ul><li>动态性高</li><li>Method Swizzling</li><li>isa Swizzling</li><li>…</li></ul><p><strong>缺点：</strong></p><ul><li>执行效率是三种派发方式中最低的</li></ul><blockquote><p>所幸的是<code>objc_msgSend</code>会将匹配的结果缓存到一个映射表中，每个类都有这样一块缓存。若是之后发送相同的消息，执行速率会很快。</p></blockquote><h2 id="Swift的派发机制"><a href="#Swift的派发机制" class="headerlink" title="Swift的派发机制"></a>Swift的派发机制</h2><p>Swift的派发机制受到4个因素的影响：</p><ul><li>数据类型</li><li>函数声明的位置</li><li>指定派发方式</li><li>编译器优化</li></ul><h3 id="数据类型-amp-amp-声明位置"><a href="#数据类型-amp-amp-声明位置" class="headerlink" title="数据类型 &amp;&amp; 声明位置"></a>数据类型 &amp;&amp; 声明位置</h3><table><thead><tr><th align="left">类型\位置</th><th align="left">初始声明</th><th align="left">扩展</th></tr></thead><tbody><tr><td align="left">值类型</td><td align="left">静态派发</td><td align="left">静态派发</td></tr><tr><td align="left">协议</td><td align="left">函数表派发</td><td align="left">静态派发</td></tr><tr><td align="left">类</td><td align="left">函数表派发</td><td align="left">静态派发</td></tr><tr><td align="left">NSObject子类</td><td align="left">函数表派发</td><td align="left">静态派发</td></tr></tbody></table><blockquote><p>声明在 协议 或者 类 中的函数是使用函数表派发的<br>声明在 扩展 中的函数则是静态派发</p></blockquote><h3 id="指定派发方式"><a href="#指定派发方式" class="headerlink" title="指定派发方式"></a>指定派发方式</h3><p>给函数添加<strong>关键字</strong>的修饰也会改变其派发方式。</p><h4 id="final"><a href="#final" class="headerlink" title="final"></a>final</h4><p>添加了<code>final</code>关键字的函数无法被重写，使用静态派发，不会在<code>vtable</code>中出现，且对<code>objc</code>运行时不可见。</p><h4 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h4><p>函数均可添加<code>dynamic</code>关键字，为非objc类和值类型的函数赋予动态性，但派发方式还是函数表派发。</p><h4 id="objc"><a href="#objc" class="headerlink" title="@objc"></a>@objc</h4><p>该关键字可以将Swift函数暴露给Objc运行时，但并不会改变其派发方式，依旧是函数表派发。</p><h4 id="objc-dynamic"><a href="#objc-dynamic" class="headerlink" title="@objc + dynamic"></a>@objc + dynamic</h4><p>这两个关键字组合使用，将采用<code>消息派发</code>的方式</p><h4 id="inline"><a href="#inline" class="headerlink" title="@inline"></a>@inline</h4><p>告诉编译器将此函数静态派发，但将其转换成SIL代码后，依旧是<code>函数表派发</code>。</p><h4 id="static"><a href="#static" class="headerlink" title="static"></a>static</h4><p>static 关键字会将函数变为静态派发，不会在 vtable 中出现。</p><table><thead><tr><th align="left">类型</th><th align="left">静态派发</th><th align="left">函数表派发</th><th align="left">消息派发</th></tr></thead><tbody><tr><td align="left">值类型</td><td align="left">所有方法</td><td align="left">-</td><td align="left">-</td></tr><tr><td align="left">协议</td><td align="left">extension</td><td align="left">主体创建</td><td align="left">-</td></tr><tr><td align="left">类</td><td align="left">extension/final/static</td><td align="left">主体创建</td><td align="left">@objc + dynamic</td></tr><tr><td align="left">NSObject子类</td><td align="left">extension/final/static</td><td align="left">主体创建</td><td align="left">@objc + dynamic</td></tr></tbody></table><blockquote><p>除此之外，编译器可能将某些方法优化为静态派发。例如，私有函数。</p></blockquote><h3 id="编译器优化"><a href="#编译器优化" class="headerlink" title="编译器优化"></a>编译器优化</h3><p><code>Swift</code>会尽可能的去优化函数派发方式。当一个类声明了一个私有函数时，该函数很<em>可能</em>会被优化为静态派发。<br>这也就是为什么在<code>Swift</code>中使用<code>target-action</code>模式时，私有<code>selector</code>会报错的原因(<code>Objective-C</code>无法获取<code>#selector</code>指定的函数)。</p><p>另一个需要注意的是，<code>NSObject子类</code>中的<code>属性</code>，如果没有使用<code>dynamic</code>修饰的话，这个优化会默认让<code>KVO</code>失效。因为，这个属性的<code>getter</code>和<code>setter</code>会被优化为静态派发。虽然，代码可以通过编译，不过动态生成的<code>KVO</code>函数就不会被触发。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Swift有三种函数派发方式，总结一下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;静态派发&lt;/li&gt;
&lt;li&gt;函数表派发&lt;/li&gt;
&lt;li&gt;消息派发</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-断言</title>
    <link href="https://rencheng.cc/2021/01/16/ios/swift/%E6%96%AD%E8%A8%80%E5%A4%84%E7%90%86/"/>
    <id>https://rencheng.cc/2021/01/16/ios/swift/%E6%96%AD%E8%A8%80%E5%A4%84%E7%90%86/</id>
    <published>2021-01-16T09:15:33.000Z</published>
    <updated>2021-01-16T09:15:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="断言机制"><a href="#断言机制" class="headerlink" title="断言机制"></a>断言机制</h2><ul><li>很多编程语言都有断言机制 ：不符合指定条件就拋出运行时错误 ，常用于调试（Debug） 阶段的条件判断</li><li>默认情况下，Swift的断言只会在Debug模式下生效，Release模式下会忽略</li></ul><span id="more"></span><p>当判断某段程序在某种状态肯定会出问题后，我们可以增加断言处理，提供很好的提示<br><img src="https://cdn.rencheng.cc/blog/6lepz.png"><br>增加断言之后<br><img src="https://cdn.rencheng.cc/blog/3xojt.png"></p><blockquote><p>ps：Xcode大多数情况是不会给出好的错误提示的，需要我们去增加断言处理</p></blockquote><h2 id="强制启动Release模式断言和强制关掉Debug模式断言"><a href="#强制启动Release模式断言和强制关掉Debug模式断言" class="headerlink" title="强制启动Release模式断言和强制关掉Debug模式断言"></a>强制启动Release模式断言和强制关掉Debug模式断言</h2><p>在<code>build setting</code>增加<code>Other Swift Flags</code>修改断言的默认行为<br><code>-assert-config Release</code>：强制关闭断言<br><code>-assert-config Debug</code> ：强制开启断言<br><img src="https://cdn.rencheng.cc/blog/zkp06.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;断言机制&quot;&gt;&lt;a href=&quot;#断言机制&quot; class=&quot;headerlink&quot; title=&quot;断言机制&quot;&gt;&lt;/a&gt;断言机制&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;很多编程语言都有断言机制 ：不符合指定条件就拋出运行时错误 ，常用于调试（Debug） 阶段的条件判断&lt;/li&gt;
&lt;li&gt;默认情况下，Swift的断言只会在Debug模式下生效，Release模式下会忽略&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift-CustomPrint</title>
    <link href="https://rencheng.cc/2021/01/16/ios/swift/%E6%89%93%E5%8D%B0%E5%8D%8F%E8%AE%AE/"/>
    <id>https://rencheng.cc/2021/01/16/ios/swift/%E6%89%93%E5%8D%B0%E5%8D%8F%E8%AE%AE/</id>
    <published>2021-01-16T06:48:03.000Z</published>
    <updated>2021-01-16T06:48:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>自定义打印协议<code>CustomStringConvertible</code>和<code>CustomDebugStringConvertible</code></p><span id="more"></span><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Person</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;person age: <span class="subst">\(age)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Person</span>: <span class="title class_">CustomDebugStringConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> debugDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;debugPerson age: <span class="subst">\(age)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>调用</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">debugPrint</span>(p)</span><br></pre></td></tr></table></figure><p>打印结果</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person age: <span class="number">10</span></span><br><span class="line">debugPerson age: <span class="number">10</span></span><br></pre></td></tr></table></figure><blockquote><p>当处于Release模式的时候，debugPrint也仍然会输出。目前看不出区别  </p><p>当在控制台po的时候，调用的是<code>CustomDebugStringConvertible</code>的<code>debugDescription</code>方法</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;自定义打印协议&lt;code&gt;CustomStringConvertible&lt;/code&gt;和&lt;code&gt;CustomDebugStringConvertible&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>2020年终总结</title>
    <link href="https://rencheng.cc/2020/12/31/summary/2020%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://rencheng.cc/2020/12/31/summary/2020%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2020-12-31T06:37:00.000Z</published>
    <updated>2020-12-31T06:37:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>今年工作上有些杂乱无章，没有持久的大目标，一直处于救火的状态。这缺人赶进度，<strong>补上</strong>；那离职需交接，<strong>接住</strong>。这一年看似杂乱无章，但是有很多的零散时间供自己调研，学习，成长，<strong>还好</strong>自己抓住了。要不然这一年干的真的没劲。</p><p>今年总结主要关键词：<strong>自我驱动</strong></p><span id="more"></span><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><h3 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h3><p>今年处在各种救火的路上，也让我学到了很多知识。</p><ul><li><strong>短视频开发</strong> - 视频压缩有了经验</li><li><strong>接手游戏SDK</strong> - 对于SDK打包流程有了新的认识，也对游戏开发有了些了解</li><li><strong>强哥离职沟通</strong> - 学到了很多语言层面的底层原理</li><li><strong>新项目启动</strong> - 这个项目启动了<strong>一年</strong>，但是给自己充分的时间做前期技术储备；使用新语言<strong>Swift</strong>落地开发；使用<strong>Flutter</strong>落地开发</li></ul><h3 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h3><ul><li>领结婚证</li><li>拍婚纱照</li><li>带父母去旅游</li><li>齐心协力抗疫</li></ul><h2 id="反省"><a href="#反省" class="headerlink" title="反省"></a>反省</h2><h3 id="心态"><a href="#心态" class="headerlink" title="心态"></a>心态</h3><p>今年年初的时候，心里有一股奋斗的力量，到了年底已经感受不到这股力量了，不知道是项目失败或者是救火还是疫情导致的，所有的计划都赶不上变化，变得快，跟不上了就懒得跟了。身边好多同事都有这种感觉。</p><blockquote><p>新的一年2021。给自己的要求：适应变化，及时调整</p></blockquote><h2 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h2><p>今年的收获比较务实，有底层知识的探索，有新语言，新业务的实践，更有跨平台方案的落地。收获不大，但是一步一个脚印。</p><h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><p>2021年TODO：</p><ol><li>熟悉<code>Flutter</code>开发</li><li>熟悉<code>Swift</code>语言</li><li>深化<code>iOS底层</code>知识</li><li><code>算法</code>和<code>数据结构</code></li><li>有时间继续了解AI</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;今年工作上有些杂乱无章，没有持久的大目标，一直处于救火的状态。这缺人赶进度，&lt;strong&gt;补上&lt;/strong&gt;；那离职需交接，&lt;strong&gt;接住&lt;/strong&gt;。这一年看似杂乱无章，但是有很多的零散时间供自己调研，学习，成长，&lt;strong&gt;还好&lt;/strong&gt;自己抓住了。要不然这一年干的真的没劲。&lt;/p&gt;
&lt;p&gt;今年总结主要关键词：&lt;strong&gt;自我驱动&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="年度总结" scheme="https://rencheng.cc/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>注册香港苹果开发者账号</title>
    <link href="https://rencheng.cc/2020/12/23/ios/general/%E6%B3%A8%E5%86%8C%E9%A6%99%E6%B8%AF%E8%8B%B9%E6%9E%9C%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/"/>
    <id>https://rencheng.cc/2020/12/23/ios/general/%E6%B3%A8%E5%86%8C%E9%A6%99%E6%B8%AF%E8%8B%B9%E6%9E%9C%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/</id>
    <published>2020-12-23T03:13:58.000Z</published>
    <updated>2020-12-23T03:13:58.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>注册邮箱</li><li>申请邓白氏编码</li><li>申请Apple账号</li></ul><span id="more"></span><h2 id="一、注册QQ及其邮箱"><a href="#一、注册QQ及其邮箱" class="headerlink" title="一、注册QQ及其邮箱"></a>一、注册<a href="https://ssl.zc.qq.com/v3/index-chs.html">QQ</a>及其邮箱</h2><blockquote><p>邓白氏邮件163邮箱可能收不到，建议用<strong>QQ邮箱</strong>统一管理账户（邓白氏/AppleId)</p></blockquote><h2 id="二、申请邓白氏编码"><a href="#二、申请邓白氏编码" class="headerlink" title="二、申请邓白氏编码"></a>二、申请邓白氏编码</h2><h3 id="1-拨打电话00852-25161111（香港）"><a href="#1-拨打电话00852-25161111（香港）" class="headerlink" title="1. 拨打电话00852 25161111（香港）"></a>1. 拨打电话<code>00852 25161111</code>（香港）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; 对面说英文，你就说`你好`，她会说`你好`，等待帮你转接；</span><br><span class="line">&gt; 说需要用于`申请苹果开发者账号`需要的邓白氏编码；</span><br><span class="line">&gt; 提供邮箱`example@qq.com`；</span><br></pre></td></tr></table></figure><h3 id="2-收取邮件"><a href="#2-收取邮件" class="headerlink" title="2. 收取邮件"></a>2. 收取邮件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Dear Customer,</span><br><span class="line">        </span><br><span class="line">For DUNS number request, please fill the form &quot;D-U-N-S Number Request Form Free20161007.doc&quot;  (Hong Kong and Macau company only)</span><br><span class="line">1) complete the application form with authorized signature and company chop</span><br><span class="line">2) tick the [I declare that the information in this application form is complete and true] box.</span><br><span class="line">3) fill the reason for apply a DUNS number (For example : Apple Developer Program, FDA, etc.)</span><br><span class="line">4) attach your company business registry copy/CI Copy (NNC1/NC1[Incorporation Form] or NAR1[Annual Return])</span><br><span class="line">    and return to us at dbreg.hk@dnb.com</span><br><span class="line">Normally, the processing time for free service is around 30 days.</span><br><span class="line">*Hong Kong D&amp;B accept Hong Kong/Macau fixed landline phone number (excluded mobile phone number) for general phone field only</span><br><span class="line">*The company phone number should be your company general phone number.</span><br><span class="line"></span><br><span class="line">Regards,</span><br><span class="line">DUNSRight Hong Kong</span><br></pre></td></tr></table></figure><h3 id="3-打印附件"><a href="#3-打印附件" class="headerlink" title="3.打印附件"></a>3.打印附件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D-U-N-S Number Request Form Free20161007.doc</span><br></pre></td></tr></table></figure><h3 id="4-书写文档"><a href="#4-书写文档" class="headerlink" title="4. 书写文档"></a>4. 书写文档</h3><p><img src="https://cdn.rencheng.cc/blog/lbr3c.png-thumb100"><br><img src="https://cdn.rencheng.cc/blog/c5z8p.png-thumb100"><br><img src="https://cdn.rencheng.cc/blog/noyvf.png-thumb100"></p><h3 id="5-回复邮件（扫描成PDF）"><a href="#5-回复邮件（扫描成PDF）" class="headerlink" title="5. 回复邮件（扫描成PDF）"></a>5. 回复邮件（扫描成PDF）</h3><h3 id="6-收到邮件回复"><a href="#6-收到邮件回复" class="headerlink" title="6. 收到邮件回复"></a>6. 收到邮件回复</h3><p><img src="https://cdn.rencheng.cc/blog/886mf.png-thumb100"></p><h2 id="三、申请苹果开发者账号"><a href="#三、申请苹果开发者账号" class="headerlink" title="三、申请苹果开发者账号"></a>三、<a href="https://developer.apple.com/account/#/welcome">申请苹果开发者账号</a></h2><p><strong>1. 注册准备物料</strong></p><ul><li>公司英文名</li><li>DNUS编码（9位）</li><li>公司地址</li><li>Web官网</li></ul><blockquote><p>用<strong>香港IP</strong>进行注册<br>注册完成后，苹果会通过邮件回复，索要更多信息<br>邓白氏可能没有那么及时同步，尽量等1-2天再注册。</p></blockquote><p><strong>2. 邮件准备物料</strong></p><ul><li>由政府核發並附有相片的申請人身分證明文件</li><li>商業登記文件</li><li>申請人的在職證明</li><li>申請人的員工識別證或名片</li></ul><blockquote><p>回复邮件后，会让打电话联系他。但是咱们注册的是香港的，打电话是说英文和粤语。那我们找一个国内的账号进行联系就好。</p></blockquote><p><strong>3. 支付准备</strong></p><ul><li>VISA, MasterCard卡</li><li>账单地址（英文）</li><li>卡绑定手机号码</li></ul><blockquote><p>支付费用<code>HK$788</code><br>支付后24h后账号可用</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;注册邮箱&lt;/li&gt;
&lt;li&gt;申请邓白氏编码&lt;/li&gt;
&lt;li&gt;申请Apple账号&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>优化Xcode编译速度</title>
    <link href="https://rencheng.cc/2020/11/29/ios/general/%E4%BC%98%E5%8C%96Xcode%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6/"/>
    <id>https://rencheng.cc/2020/11/29/ios/general/%E4%BC%98%E5%8C%96Xcode%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6/</id>
    <published>2020-11-29T14:05:46.000Z</published>
    <updated>2020-11-29T14:05:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>随着项目的不断迭代，工程变得越来越庞大。大项目不仅面临着架构调整的问题，还要面对每次编译时长不断增加的问题。现在我们的项目全量编译要半个小时。</p><p>操作环境<br>操作系统：MacOS 11<br>开发工具：Xcode12<br>CPU：i7 2.2GHz 4核8线程<br>内存：16GB</p><blockquote><p>业务驱动技术提升</p></blockquote><span id="more"></span><h2 id="查看编译时长"><a href="#查看编译时长" class="headerlink" title="查看编译时长"></a>查看编译时长</h2><h3 id="查看总时长"><a href="#查看总时长" class="headerlink" title="查看总时长"></a>查看总时长</h3><ol><li>关闭Xcode</li><li>执行如下命令<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dt.Xcode ShowBuildOperationDuration YES</span><br></pre></td></tr></table></figure></li><li>启动Xcode<br><img src="https://cdn.rencheng.cc/blog/rauk5.png-thumb100"></li></ol><h3 id="查看单个编译单元的时长"><a href="#查看单个编译单元的时长" class="headerlink" title="查看单个编译单元的时长"></a>查看单个编译单元的时长</h3><p><a href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode">BuildTimeAnalyzer-for-Xcode</a></p><blockquote><p>该插件会罗列单个编译单元的时长</p></blockquote><p><img src="https://cdn.rencheng.cc/blog/uyj8k.png-thumb100"></p><blockquote><p>首次启动该工程，根据配置指导走完后，需重新运行。</p></blockquote><h2 id="优化Xcode配置"><a href="#优化Xcode配置" class="headerlink" title="优化Xcode配置"></a>优化Xcode配置</h2><p>以下配置都是在工程对应<code>Target</code>的<code>Build Settings</code>中操作</p><h3 id="全模块编译（Whole-Module-Optimization，WMO）"><a href="#全模块编译（Whole-Module-Optimization，WMO）" class="headerlink" title="全模块编译（Whole-Module Optimization，WMO）"></a>全模块编译（Whole-Module Optimization，WMO）</h3><p>在编译项目时，将同属于一个<code>Module</code>（可以理解为一个 Target、一个 Package）的所有源代码都串起来，进行整体的一个分析与优化，区别于 <code>Single-File Optimizatin</code>（单文件优化，以下简称SFO），<code>WMO</code>可以更好的统筹全局，去<code>inline</code>函数调用、排除死函数（即写了却从不调用的函数）等</p><p>在<code>User-Define</code>中增加<code>SWIFT_WHOLE_MODULE_OPTIMIZATION</code>选项卡，值为<code>Yes</code></p><blockquote><p>在<code>Release</code>模式中，建议打开此选项。</p></blockquote><h3 id="调试信息处理"><a href="#调试信息处理" class="headerlink" title="调试信息处理"></a>调试信息处理</h3><p>将<code>Debug Information Format</code>选项中，</p><ul><li><code>Debug</code>模式的值<code>DWARF with dSYM</code>改为<code>DWARF</code>；</li><li><code>Release</code>模式的值是<code>DWARF with dSYM</code>，因为一般工程都会集成Bugly，而Bugly问题分析是需要<code>.dSYM</code>文件的，如果不生成，线上崩溃是没有办法定位信息的。</li></ul><blockquote><p>DWARF意思是矮小的，不作数的。</p></blockquote><h3 id="架构配置"><a href="#架构配置" class="headerlink" title="架构配置"></a>架构配置</h3><p>将<code>Build Active Architecture Only</code>选项里的<code>Debug</code>模式的值<code>No</code>改为<code>Yes</code></p><blockquote><p><code>Release</code>模式的值必须是<code>No</code>；虽说现在苹果全线都Arm架构了，但是仍然有arm64，armv7，armv7s等区分。</p></blockquote><h3 id="编译优化等级-Optimization-Level"><a href="#编译优化等级-Optimization-Level" class="headerlink" title="编译优化等级(Optimization Level)"></a>编译优化等级(Optimization Level)</h3><p><img src="https://cdn.rencheng.cc/blog/1yb0t.png-thumb100"></p><blockquote><p>在设置编译优化之后，Xcode断点和调试信息会不正常，所以一般静态库或者其他Target可以这样设置。</p></blockquote><h2 id="系统级提升"><a href="#系统级提升" class="headerlink" title="系统级提升"></a>系统级提升</h2><h3 id="增加编译线程数"><a href="#增加编译线程数" class="headerlink" title="增加编译线程数"></a>增加编译线程数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.Xcode PBXNumberOfParallelBuildSubtasks 4</span><br></pre></td></tr></table></figure><h3 id="虚拟盘"><a href="#虚拟盘" class="headerlink" title="虚拟盘"></a>虚拟盘</h3><p>使用虚拟磁盘。编译过程中需要大量的磁盘 IO，这主要发生在<code>Derived Data</code>目录下，因此如果内存足够，可以考虑划出<code>4G</code>左右的内存，建一个虚拟磁盘，这样将会把<code>磁盘IO</code>优化为<code>内存IO</code>，从而提高速度。<br>由于打包机器每次都会重编译，因此不需要担心重启机器后缓存丢失的问题。</p><h2 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h2><ol><li>去除警告</li><li>三目运算符</li><li>提前计算常量</li><li>宏定义</li><li>类型推断</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;随着项目的不断迭代，工程变得越来越庞大。大项目不仅面临着架构调整的问题，还要面对每次编译时长不断增加的问题。现在我们的项目全量编译要半个小时。&lt;/p&gt;
&lt;p&gt;操作环境&lt;br&gt;操作系统：MacOS 11&lt;br&gt;开发工具：Xcode12&lt;br&gt;CPU：i7 2.2GHz 4核8线程&lt;br&gt;内存：16GB&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;业务驱动技术提升&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="App优化" scheme="https://rencheng.cc/tags/App%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>创建Framework</title>
    <link href="https://rencheng.cc/2020/11/13/ios/general/%E5%88%9B%E5%BB%BAFramework/"/>
    <id>https://rencheng.cc/2020/11/13/ios/general/%E5%88%9B%E5%BB%BAFramework/</id>
    <published>2020-11-13T07:25:35.000Z</published>
    <updated>2020-11-13T07:25:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>平时都是用Cocoapods创建私有库。最近技术群有一个小白不想用Cocoapods，给他写一篇教程。</p><ul><li>操作系统：MacOS 11</li><li>Xcode版本号： Xcode12.2</li><li>平台： iOS14.2</li><li>开发语言： Swift</li></ul><span id="more"></span><h2 id="新建-Cocoa-Touch-Framework"><a href="#新建-Cocoa-Touch-Framework" class="headerlink" title="新建 Cocoa Touch Framework"></a>新建 Cocoa Touch Framework</h2><p><strong>第一步：</strong>启动Xcode，依次点击<code>File-&gt;New-&gt;Project</code>。<br><img src="https://cdn.rencheng.cc/blog/7ghuc.png-thumb100"><br><strong>第二步：</strong>双击<code>Framework &amp; Library</code>栏目下的<code>Cocoa Touch Framework</code>项。<br><img src="https://cdn.rencheng.cc/blog/ekd3p.png-thumb100"><br><strong>第三步：</strong>在<code>Choose options for your new project</code>窗口填写Project的相关信息。我们这里的<code>Product Name</code>为<code>ChannelSDK</code>。然后点击<code>Next</code>按钮。<br><strong>第四步：</strong>选择 <code>ChannelSDK</code> Project的保存位置，并单击<code>Create</code>按钮。此时Xcode会打开当前Project窗口。<br><img src="https://cdn.rencheng.cc/blog/b1o3p.png-thumb100"></p><h2 id="新建-Workspace"><a href="#新建-Workspace" class="headerlink" title="新建 Workspace"></a>新建 Workspace</h2><p><strong>第一步：</strong>依次点击<code>File-&gt;New-&gt;Workspace</code>。<br><strong>第二步：</strong>将Workspace的名字填写为 <code>ChannelSDK</code> ，选择存储位置为第一步创建的 <code>ChannelSDK Project</code> 根目录下。<br><img src="https://cdn.rencheng.cc/blog/51mqx.png-thumb100"><br><strong>第三步：</strong>点击保存，此时Xcode会打开<code>ChannelSDK Workspace</code>窗口<br><img src="https://cdn.rencheng.cc/blog/lk5y3.png-thumb100"><br><strong>第四步：</strong>在当前的 <code>ChannelSDK Workspace</code> 窗口，依次点击<code>File-&gt;Add Files to “ChannelSDK”</code>。选择<code>ChannelSDK.xcodeproj</code>文件，将之前创建好的Project添加到当前工作空间中。最后点击<code>Add</code>按钮<br><img src="https://cdn.rencheng.cc/blog/s0u8a.png-thumb100"><br><strong>第五步：</strong>此时，<code>ChannelSDK Workspace</code>的目录结构如下图。如果仅仅只有一个工程文件，那么关掉Xcode，重新打开<code>ChannelSDK Workspace</code>。<code>ChannelSDK Workspace</code>文件名是<code>ChannelSDK.xcworkspace</code></p><h2 id="创建-Example-工程"><a href="#创建-Example-工程" class="headerlink" title="创建 Example 工程"></a>创建 Example 工程</h2><p><strong>第一步：</strong>启动Xcode，依次点击<code>File-&gt;New-&gt;Project</code>。双击<code>App</code>图标。<br><img src="https://cdn.rencheng.cc/blog/otpwz.png-thumb100"><br><strong>第二步：</strong><code>Product Name</code>为<code>Example</code>。然后点击<code>Next</code>按钮。<br><img src="https://cdn.rencheng.cc/blog/n0mvo.png-thumb100"><br><strong>第三步：</strong>选择<code>Example Project</code>的保存位置为<code>ChannelSDK Project</code>同级目录，并单击<code>Create</code>按钮<br><img src="https://cdn.rencheng.cc/blog/ed62t.png-thumb100"><br><strong>第四步：</strong>出现下面窗口后，关闭该窗口<br><img src="https://cdn.rencheng.cc/blog/ww25u.png-thumb100"><br><strong>第五步：</strong>返回到<code>ChannelSDK Workspace</code>窗口，依次点击<code>File-&gt;Add Files to “ChannelSDK”</code>，选择Example.xcodeproj文件。<br><img src="https://cdn.rencheng.cc/blog/q82w8.png-thumb100"><br><strong>第六步：</strong>点击<code>Add</code>按钮，将<code>Example Project</code>添加到<code>ChannelSDK Workspace</code>中。<br><img src="https://cdn.rencheng.cc/blog/033cz.png-thumb100"></p><h2 id="添加依赖关系"><a href="#添加依赖关系" class="headerlink" title="添加依赖关系"></a>添加依赖关系</h2><p><strong>第一步：</strong>在<code>ChannelSDK Workspace</code>窗口中，单击<code>Example Target</code>, 依次点击<code>General-&gt;Embedded Binaries</code>，单击添加（+）按钮。<br><img src="https://cdn.rencheng.cc/blog/4i54j.png-thumb100"><br><strong>第二步：</strong>找到ChannelSDK.framework，单击<code>Add</code>按钮。<br><img src="https://cdn.rencheng.cc/blog/pkmca.png-thumb100"></p><h2 id="ChannelSDK开发"><a href="#ChannelSDK开发" class="headerlink" title="ChannelSDK开发"></a>ChannelSDK开发</h2><p><strong>第一步：</strong>选中<code>ChannelSDK Project</code>中的<code>ChannelSDK Group</code>，依次点击<code>File-&gt;New-&gt;File</code>。选择<code>Cocoa Touch Class</code>，点击<code>Next</code>按钮<br><img src="https://cdn.rencheng.cc/blog/cvcm1.png-thumb100"><br><strong>第二步：</strong>填入Class为<code>ChannelSDK</code>，然后单击<code>Next</code>按钮，选择默认的保存位置<br><img src="https://cdn.rencheng.cc/blog/n0gkt.png-thumb100"><br><strong>第三步：</strong>在ChannelSDK.swift中写个方法</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">func</span> <span class="title class_">version</span>() -&gt; <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(ChannelSDKVersionNumber)</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>第四步：</strong>在AppDelegate中调用</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(ChannelSDK.version())</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Objective创建Framework"><a href="#Objective创建Framework" class="headerlink" title="Objective创建Framework"></a>Objective创建Framework</h2><p>跟Swift基本相同。但是在开发的时候，要注意</p><blockquote><p>import的方式要用<code>&lt;&gt;</code>而不是<code>&quot;&quot;</code>，<br>在ChannelSDK.h中，声明公开的头文件</p></blockquote><h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><ol><li>ChannelSDK.h中的<code>ChannelSDKVersionString[]</code>值无参考意义，<code>ChannelSDKVersionNumber</code>可以设置</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;平时都是用Cocoapods创建私有库。最近技术群有一个小白不想用Cocoapods，给他写一篇教程。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;操作系统：MacOS 11&lt;/li&gt;
&lt;li&gt;Xcode版本号： Xcode12.2&lt;/li&gt;
&lt;li&gt;平台： iOS14.2&lt;/li&gt;
&lt;li&gt;开发语言： Swift&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Android-Support支持库</title>
    <link href="https://rencheng.cc/2020/11/09/android/Android-Support%E6%94%AF%E6%8C%81%E5%BA%93/"/>
    <id>https://rencheng.cc/2020/11/09/android/Android-Support%E6%94%AF%E6%8C%81%E5%BA%93/</id>
    <published>2020-11-09T03:27:44.000Z</published>
    <updated>2020-11-09T03:27:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>研究Flutter的时候，看见了AndroidX的概念。<br>顺便了解一下Android支持库</p><span id="more"></span><p>Android跟iOS开发上很大的区别</p><table><thead><tr><th align="left"></th><th align="left">iOS</th><th align="left">Android</th></tr></thead><tbody><tr><td align="left">审核要求</td><td align="left">需兼容很多新特性</td><td align="left">对新特性几乎无要求</td></tr><tr><td align="left">系统更新</td><td align="left">升级体验新系统用户量大</td><td align="left">不升级都卡，升级更卡；设备碎片化严重</td></tr><tr><td align="left">开发层面</td><td align="left">使用新系统特性，</br>工程最小兼容的版本低于新特性兼容版本</br>那么Xcode会报错提示不兼容</br>不会造成运行时崩溃</td><td align="left">使用新系统特性</br>工程最小兼容的版本低于新特性兼容版本</br>那么AS会报错提示不兼容</br>但是有全局开关可关闭这一类型提示</br>会造成运行时崩溃</td></tr></tbody></table><blockquote><p>由于在审核层面的硬性要求，导致iOS开发者的Xcode经常是最新的大版本；而Android则不需要升级。</p></blockquote><p>Google为了让老版本系统用上新版本的特性，就提供了很多的版本支持库，用于兼容。<br>由于兼容库太多，所以Google提供了AndroidX兼容库统一管理，去避免兼容库太多，每个版本的小版本太多导致的开发低效，重复依赖等问题</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;研究Flutter的时候，看见了AndroidX的概念。&lt;br&gt;顺便了解一下Android支持库&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="https://rencheng.cc/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - Key</title>
    <link href="https://rencheng.cc/2020/10/27/flutter/FlutterKey/"/>
    <id>https://rencheng.cc/2020/10/27/flutter/FlutterKey/</id>
    <published>2020-10-27T09:00:02.000Z</published>
    <updated>2020-10-27T09:00:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter中Key非常重要</p><ul><li>解决重用问题，提升性能</li><li>标识Widget，获取State对象</li></ul><span id="more"></span><h3 id="LocalKey"><a href="#LocalKey" class="headerlink" title="LocalKey"></a>LocalKey</h3><p>抽象类</p><ul><li>diff算法的核心所在</li><li>Element和Widget比较</li></ul><h4 id="ValueKey"><a href="#ValueKey" class="headerlink" title="ValueKey"></a>ValueKey</h4><p>以数据作为Key。如：数字，字符</p><h4 id="ObjectKey"><a href="#ObjectKey" class="headerlink" title="ObjectKey"></a>ObjectKey</h4><p>以Object对象作为Key。如：Text()</p><h4 id="UniqueKey"><a href="#UniqueKey" class="headerlink" title="UniqueKey"></a>UniqueKey</h4><p>可以保证Key的唯一性</p><blockquote><p>一旦使用它，就不存在Element复用了</p></blockquote><h3 id="GlobalKey"><a href="#GlobalKey" class="headerlink" title="GlobalKey"></a>GlobalKey</h3><p>抽象类</p><ul><li>帮助我们获取到对应Widget的State对象，然后进行操作。</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Flutter中Key非常重要&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决重用问题，提升性能&lt;/li&gt;
&lt;li&gt;标识Widget，获取State对象&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>深究iOS启动图问题</title>
    <link href="https://rencheng.cc/2020/10/09/ios/general/%E6%B7%B1%E7%A9%B6iOS%E5%90%AF%E5%8A%A8%E5%9B%BE%E9%97%AE%E9%A2%98/"/>
    <id>https://rencheng.cc/2020/10/09/ios/general/%E6%B7%B1%E7%A9%B6iOS%E5%90%AF%E5%8A%A8%E5%9B%BE%E9%97%AE%E9%A2%98/</id>
    <published>2020-10-09T08:55:48.000Z</published>
    <updated>2020-10-09T08:55:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>在开发中遇见如下问题</p><ul><li>应用更新后，启动图没有更新</li><li>启动图渲染失败</li><li>实现动态更换启动图的需求</li></ul><span id="more"></span><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li>应用更新后，启动图没有更新</li><li>启动图渲染失败</li><li>实现动态更换启动图的需求</li></ul><h3 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h3><p>首先怀疑是配置方式、编译缓存等导致的问题。针对这些猜测做了以下测试：</p><ul><li>不同系统、不同机型测试，均有复现，排除该问题只发生在特定机型或系统上；</li><li>清空编译缓存，仍旧复现，故排除编译缓存问题；</li><li>给imageView添加背景色，启动时正常显示imageView的背景色，但图片内容未显示，故排除了布局问题；</li><li>将图片从Assets中迁移至工程根目录下，出现空白启动图概率降低，但仍会偶现；</li><li>修改图片名，前几次正常，之后依旧偶现；</li><li>卸载应用重新安装，大概率恢复正常，仍复现；</li><li>将LaunchScreen.storyboard文件复制到新建的空工程中，仍复现；</li></ul><p><strong>结论：系统缓存问题</strong></p><h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><p>完全抛弃系统缓存的启动图，由自己生成的启动图替换。</p><blockquote><p>用户安装应用后，系统会自动生成启动图并缓存至沙盒目录，接着用户启动应用时，我们通过代码将沙盒目录下缓存的启动图文件全部替换为我们通过代码生成的启动图。</p></blockquote><h4 id="生成启动图"><a href="#生成启动图" class="headerlink" title="生成启动图"></a>生成启动图</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *launchScreenName = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@&quot;UILaunchStoryboardName&quot;</span>];</span><br><span class="line"><span class="built_in">UIStoryboard</span> *storyboard = [<span class="built_in">UIStoryboard</span> storyboardWithName:launchScreenName bundle:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">UIViewController</span> *vc = storyboard.instantiateInitialViewController;</span><br><span class="line"><span class="built_in">UIGraphicsBeginImageContextWithOptions</span>([<span class="built_in">UIScreen</span> mainScreen].bounds.size, <span class="literal">NO</span>, [<span class="built_in">UIScreen</span> mainScreen].scale);</span><br><span class="line">[vc.view.layer renderInContext:<span class="built_in">UIGraphicsGetCurrentContext</span>()];</span><br><span class="line"><span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br></pre></td></tr></table></figure><h4 id="替换启动图"><a href="#替换启动图" class="headerlink" title="替换启动图"></a>替换启动图</h4><p>通过测试，该方法不会报权限问题</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)moveItemAtPath:(<span class="built_in">NSString</span> *)srcPath </span><br><span class="line">                toPath:(<span class="built_in">NSString</span> *)dstPath </span><br><span class="line">                 error:(<span class="built_in">NSError</span> **)error API_AVAILABLE(macos(<span class="number">10.5</span>), ios(<span class="number">2.0</span>), watchos(<span class="number">2.0</span>), tvos(<span class="number">9.0</span>));</span><br></pre></td></tr></table></figure><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><pre class="mermaid">graph TDA(应用启动)-->B[监听被Kill通知]B-->C[应用Kill回调]C-->D[获取当前App版本号]D-->E{指定目录下</br>以版本号命名的</br>启动图是否存在}E--YES-->F[读取该文件]E--NO-->G[清空该目录文件]subgraph 此步骤耗时    G-->H[生成自定义启动图]    H-->I[以版本号为名写入指定目录]endI-->J[计算默认启动图MD5]F-->JJ-->K{遍历系统</br>缓存启动图</br>目录}K--遍历中-->L{iPhone </br>Or iPad}L--iPad-->M{对比图片</br>宽高是否</br>相同}M--YES-->X{对比图片</br>md5值是否</br>相同}X-->N[替换系统缓存启动图]K--遍历完成-->S(应用杀死)N--继续遍历-->KL--iPhone-->XX--NO-->K</pre><blockquote><p>缓存路径：<br>iOS13.0 及以上：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Library/SplashBoard/Snapshots/$&#123;PRODUCT_BUNDLE_IDENTIFIER&#125; - &#123;DEFAULT GROUP&#125;；</span><br></pre></td></tr></table></figure><p>iOS13.0 以下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Library/Caches/Snapshots/$&#123;PRODUCT_BUNDLE_IDENTIFIER&#125;；</span><br></pre></td></tr></table></figure><blockquote><p>图片格式：<br>iOS10.0 及以上：KTX；<br>iOS10.0 以下：PNG。</p></blockquote><blockquote><p>系统缓存图目录读写权限：<br>iOS10.0 及以上：有权限；<br>iOS10.0 以下：无权限。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;在开发中遇见如下问题&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;应用更新后，启动图没有更新&lt;/li&gt;
&lt;li&gt;启动图渲染失败&lt;/li&gt;
&lt;li&gt;实现动态更换启动图的需求&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="Objc" scheme="https://rencheng.cc/tags/Objc/"/>
    
  </entry>
  
  <entry>
    <title>iOS14和Xcode12踩坑</title>
    <link href="https://rencheng.cc/2020/09/21/ios/general/iOS14%E5%92%8CXcode12%E8%B8%A9%E5%9D%91/"/>
    <id>https://rencheng.cc/2020/09/21/ios/general/iOS14%E5%92%8CXcode12%E8%B8%A9%E5%9D%91/</id>
    <published>2020-09-21T09:34:45.000Z</published>
    <updated>2020-09-21T09:34:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>今年整体适配强度不大。<br><img src="https://cdn.rencheng.cc/blog/y3ady.jpg"></p><span id="more"></span><h2 id="权限相关"><a href="#权限相关" class="headerlink" title="权限相关"></a>权限相关</h2><p>如果设备开启了本地的服务，会弹出允许本地网络的权限提示框。<br>在Info.plist中增加隐私配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Privacy - Local Network Usage Description</span><br><span class="line">    - 使用本地网络进行数据请求访问，作为视频的预缓存</span><br><span class="line"></span><br><span class="line">Bonjour services</span><br><span class="line">    - _http._tcp</span><br></pre></td></tr></table></figure><blockquote><p>如果不加该配置，提审会被拒。</p></blockquote><h2 id="模拟器报错"><a href="#模拟器报错" class="headerlink" title="模拟器报错"></a>模拟器报错</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">building for iOS Simulator, but linking in object file built for iOS, xxxx for architecture arm64</span><br></pre></td></tr></table></figure><p><strong>原因：</strong></p><ul><li><code>Xcode12</code>以前，我们通过<code>Valid Architectures</code> 选项来配置支持的架构。</li><li><code>Xcode12</code>中， <code>Valid Architectures</code>这一选项被删掉了，改变成了<code>VALID_ARCHS</code>。</li></ul><blockquote><p>在<code>Xcode11</code>中，<code>x86_64</code>的架构支持是默认支持的，就算不写也支持。但<code>Xcode12</code>的时候，苹果将要推出了ARM架构的Mac，看来全面采用ARM架构已经成为苹果的趋势了，这使得Xcode其实就没必要再对<code>x86_64</code>架构默认支持。故需要手动添加上才能跑模拟器。</p></blockquote><p><strong>解决方案：</strong><br>在<code>VALID_ARCHS</code>选项上增加<code>x86_64</code>的架构配置 </p><blockquote><p>如果Cocoapods管理的组件，需要支持模拟器<br>需要手动设置<code>User-Defined</code>的<code>VALID_ARCHS</code></p></blockquote><h2 id="微信-Pasted-from-QQ"><a href="#微信-Pasted-from-QQ" class="headerlink" title="微信 Pasted from QQ"></a>微信 Pasted from QQ</h2><p>打开某款App，频繁提示<code>** Pasted from ***</code></p><blockquote><p>苹果强化了对系统剪切板内容访问的提示，适度减少访问频次吧。不过现在是大家都玩口令的年代，这很难控制住…</p></blockquote><h2 id="UIPageControl-子视图层级变更-及-新增-API"><a href="#UIPageControl-子视图层级变更-及-新增-API" class="headerlink" title="UIPageControl 子视图层级变更 及 新增 API"></a>UIPageControl 子视图层级变更 及 新增 API</h2><p>iOS14中，苹果对<code>UIPageControl</code>控件进行了调整，定制性更强了。可以通过官方的API设置图片了，而且也有几个样式供我们选择。</p><blockquote><p>注意点</p></blockquote><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[_pageControl setValue:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;xxx&quot;</span>] forKeyPath:<span class="string">@&quot;pageImage&quot;</span>];</span><br><span class="line">[_pageControl setValue:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;xxx&quot;</span>] forKeyPath:<span class="string">@&quot;currentPageImage&quot;</span>];</span><br></pre></td></tr></table></figure><p>上面代码在iOS14中，会出现崩溃。跟<a href="https://rencheng.cc/2019/07/24/ios/general/iOS13%E5%92%8CXcode11%E8%B8%A9%E5%9D%91/#KVC%E8%AE%BF%E9%97%AE%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7Crash">去年</a>的<code>UITextFlied</code>设置<code>_placeholderLabel.textColor.</code>一样抓狂的感觉。</p><blockquote><p>如果封装SDK，尽可能的不要给系统UI控件通过KVC赋值和访问私有属性。</p></blockquote><h2 id="UITableViewCell-层级调整"><a href="#UITableViewCell-层级调整" class="headerlink" title="UITableViewCell 层级调整"></a>UITableViewCell 层级调整</h2><p>自定义子视图，曾经可以添加在<code>self</code>、<code>self.contentView</code>上均可。 以后需要注意了，必须按照苹果的规范。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Custom subviews should be added to the content view.</span><br><span class="line">@property (nonatomic, readonly, strong) UIView *contentView;</span><br></pre></td></tr></table></figure><p><strong>影响：</strong> 不添加在 contentView 上的子视图，存在点击事件无法响应以及视图被系统默认高亮效果覆盖的问题。</p><h2 id="IDFA访问权限和无线局域网地址调整"><a href="#IDFA访问权限和无线局域网地址调整" class="headerlink" title="IDFA访问权限和无线局域网地址调整"></a>IDFA访问权限和无线局域网地址调整</h2><ul><li>在<code>iOS14</code>之前，IDFA的开关是统一管理的，开启关闭和还原都是针对所有App，但是好歹苹果还是默认开启的，如果要关闭，需要用户自己去设置页面关闭。WIFI地址是所有WIFI共用一个设备地址</li><li>但是iOS14出来后，Apple将IDFA进一步隐私强化，每个App将需要自己申请用户权限来获取<code>IDFA</code>，Apple不再默认开启，用户可以在<code>设置-&gt;隐私-&gt;Tracking</code>或者App的权限管理页面来设置。WIFI地址目前是每个网络都配一个虚拟地址</li></ul><blockquote><p>归因真的是越来越难了</p></blockquote><p><strong>如何应对</strong></p><ol><li>在Info.plist中增加隐私配置<code>Privacy - Tracking Usage Description</code>。</li><li>引入<code>AppTrackingTransparency</code>框架，调用<code>ATTrackingManager.requestTrackingAuthorization</code>方法来请求权限。</li><li>权限开启后，仍然使用<code>ASIdentifierManager.shared().advertisingIdentifier.uuidString</code>来获取IDFA。</li></ol><blockquote><p>在使用时会进行权限访问的申请，如果拒绝，将是一串无意义的0。</p></blockquote><p><strong>影响</strong></p><ol><li>多渠道推广时很难有效归因，从而分辨是哪个平台买量来的用户。</li><li>精准投放范围更小，转化成本上升。</li><li>三方归因平台话语权更强，因为他们可以自定义统一的标识符来供合作的广告主们使用，平台越大，标识符价值越高。</li><li>一旦用户单独关闭，推广时也无法区分老用户了，用户相当于进了黑盒，不过可以通过技术手段处理。</li><li>进一步提高了用户隐私权，IDFA开启率将会降低。尤其是亚洲国家，默认开启率很高，一旦进行安装提示，开启率以预计将收到较大影响。</li><li>一些无法升级更新的App，几乎无法进行有效推广。</li></ol><blockquote><p>可以尝试<a href="https://developer.apple.com/documentation/storekit/skadnetwork/verifying_an_install_validation_postback">SKAdNetwork</a>解决，统计更准确。但是应对场景过于单一。</p></blockquote><h2 id="对象存储结构发生改变"><a href="#对象存储结构发生改变" class="headerlink" title="对象存储结构发生改变"></a>对象存储结构发生改变</h2><ul><li>iOS14以前，类是有<code>MyClass</code>+<code>class_rw_t</code>(dirty memory) + <code>class_ro_t</code>（clean memery）三个数据结构存储信息<br><img src="https://cdn.rencheng.cc/blog/07w06.jpg"></li><li>iOS14，类里面的脏内存得到了优化，<code>class_rw_t</code>拆解成<code>class_rw_t</code>+<code>class_rw_ext_t</code><br><img src="https://cdn.rencheng.cc/blog/ciwxj.jpg"></li></ul><blockquote><p>官方解释：通过统计发现，开发中大多数的类是没有通过Runtime机制为其添加属性，方法等信息的。所以就没必要为每个类都开辟这个一段空间，造成不必要的浪费。。</p></blockquote><p><strong>dirty memory</strong><br>脏内存。指可读可写内存<br><strong>clean memory</strong><br>干净内存。指只读内存</p><p><strong>影响</strong><br>如果App内部没有通过系统API去访问脏内存的数据（属性或方法），那么就会产生错误，甚至崩溃。</p><p><strong>解决</strong><br>官方建议：访问内存信息，请一定要使用官方提供的API，这样在以后不断的迭代优化过程中，才不会出现兼容问题。</p><h2 id="新特性"><a href="#新特性" class="headerlink" title="新特性"></a>新特性</h2><h3 id="画中画"><a href="#画中画" class="headerlink" title="画中画"></a>画中画</h3><h3 id="PHPicker"><a href="#PHPicker" class="headerlink" title="PHPicker"></a>PHPicker</h3><p>在iOS14中，Apple优化了照片的隐私权限，可以让用户选择为该App共享哪些图片，而不是以前的允许访问（所有）图片。</p><p><strong>影响</strong></p><ul><li>废弃<code>AssetLibrary</code>， 请使用<code>PhotoKit</code></li><li>废弃<code>UIImagePickerController</code>，请使用<code>PHPickerViewController</code></li></ul><p><strong>特性</strong></p><ul><li>支持选择视频或图片</li><li>支持单选或多选</li><li>UI设计风格和操作手势与<code>照片App</code>完全相似</li><li>不需要授权隐私权限</li></ul><p><strong>官方说明</strong></p><blockquote><p>Also please don’t prompt for photo library access before showing the picker and don’t require the user to grant you access before showing the picker. There’s no need to do any of this. And it doesn’t help with the users trust into your app.If your app leverages PhotoKit to access the photos library please reconsider if it really needs to have access to the library or if you can use PHPicker instead.We really hope you like the new picker and API. We’re looking forward to you adopting it in your apps. Thank you.<br>另外，在显示选择器之前，请不要提示对图库的访问权限，也不要要求用户在显示选择器之前授予您访问权限。 无需执行任何操作。 如果您的应用程序利用PhotoKit访问照片库，请重新考虑它是否真的需要访问该库或是否可以使用PHPicker，我们真的希望您喜欢该应用程序。 新的选择器和API。 我们期待您在应用中采用它。 谢谢。</p></blockquote><h3 id="Widget-Extension"><a href="#Widget-Extension" class="headerlink" title="Widget Extension"></a>Widget Extension</h3><p>小组件功能<br>具体开发实现可以参考苹果的官方教程<br><a href="https://developer.apple.com/wwdc20/10028">为您介绍WidgetKit</a><br><a href="https://developer.apple.com/wwdc20/10041">SwiftUI新功能</a><br><a href="https://developer.apple.com/wwdc20/10194">为小组件添加配置和智能</a><br><a href="https://developer.apple.com/wwdc20/10033">为小组件构建SwiftUI视图</a></p><blockquote><p>小组件仅支持SwiftUI开发</p></blockquote><h3 id="App-Clips"><a href="#App-Clips" class="headerlink" title="App Clips"></a>App Clips</h3><h4 id="如何唤醒"><a href="#如何唤醒" class="headerlink" title="如何唤醒?"></a>如何唤醒?</h4><p>苹果对App Clip的使用场景非常明确，系统对调起方式做了严格的过滤，支持的发起入口有如下几种：</p><ul><li>NFC</li><li>QR Codes（也就是二维码，专门的生成工具会在年底开放）</li><li>Maps</li><li>Siri 建议</li><li>Safari链接</li><li>Messages</li></ul><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul><li>10M的限制</li><li>30天不使用，系统自动删除<code>App Clip</code>及<code>数据</code></li><li>支持地理位置，相机，麦克风和蓝牙等权限，限制访问 Health、Fitness、通讯录、信息、照片、文件等个人数据。</li><li>为了避免弹窗授权的糟糕体验，设计了免申请的通知、定位权限。当然还是有限制，免申请的通知只在 8 个小时内有效，地理位置只能获取一次。</li><li>支持Sign in with Apple，也支持ASWebAuthenticationSession来第三方登录，以及使用Apple Pay。</li><li>在使用App Clip的过程中，Apple也会明显提示主App的存在，方便用户直接去下载。</li><li>不会与App一起出现在用户的Setting App里，有单独的App Clips的分组。</li><li>一旦安装了主App，对应的App Clip将会被删除，再点击链接将会直接进入主App。</li></ul><h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><p><strong>依赖主APP</strong><br>虽然对于用户来说不需要下载主App，但开发者必须使App Clip跟随主App一同提交审核，App Clip并不能够独立开发并提审。（这与Apple设计之初的理念是一致的，目的是为了快速体验功能，而不是替代App）</p><p><strong>独立的Target</strong><br>在开发上，也是完全Native的实现，类似于一个新增的<code>Extension target</code>，例如<code>Keyboard Extension</code>、<code>iMessage Extension</code>等。</p><blockquote><p><code>App Clip</code>不仅支持<code>SwiftUI</code>，也支持<code>UIKit</code>，包括很多人还在坚守的<code>Objective-C</code>，完全都没有问题，并不存在上手难度。</p></blockquote><p><strong>数据共享</strong><br>由于Target依赖于主App，所以Target间的资源共享都是完全OK的，只需要在资源归属上勾选上<code>App Clip</code>就可以了；同时，与Extension一致，<code>App Clip</code>可以通过<code>App Groups</code>来与主App共享数据。</p><p><strong>引导转化</strong><br>Apple建议开发者可以在<code>App Clip</code>的视图中嵌入<code>SKOverlay</code>，当用户在<code>App Clip</code>中完成相关任务后展示<code>SKOverlay</code>，这样可以较好的引导用户</p><blockquote><p>比如可以将其放置在用户的付款确认界面之后。<br>新特性<a href="https://developer.apple.com/videos/play/wwdc2020/10661/">SKOverlay</a></p></blockquote><p><strong>支持一对多</strong><br>同时，主工程支持多个<code>App Clip</code> Target，目前并不清楚Apple对于数量的限制是多少，但是估计能够满足大部分App主要功能的拆分，以某团为例，可以存在多个<code>App Clip</code>：单车、外卖、酒店住宿、打车等等。</p><p><strong>支持不同参数</strong><br>只需要提供不同参数，就可以针对不同场景不同需求来提供不同的 <code>App Clip</code> 体验，例如官方提供的统一连锁下不同咖啡馆举例</p><p><strong>如何处理Universal Link和App Clip URL？</strong></p><p>官方Demo提供的解决方案是通过编译宏<code>APPCLIP</code>来做分支处理，这样能够最大程度共用代码：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">#if</span> <span class="type">APPCLIP</span></span><br><span class="line"><span class="keyword">import</span> AppClip</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FrutaApp</span>: <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">FrutaModel</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">#if</span> <span class="operator">!</span><span class="type">APPCLIP</span></span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> store <span class="operator">=</span> <span class="type">Store</span>()</span><br><span class="line">    <span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SceneBuilder</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="keyword">#if</span> <span class="type">APPCLIP</span></span><br><span class="line">            <span class="type">NavigationView</span> &#123;</span><br><span class="line">                <span class="type">SmoothieMenu</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            .environmentObject(model)</span><br><span class="line">            .onContinueUserActivity(<span class="type">NSUserActivityTypeBrowsingWeb</span>, perform: handleUserActivity)</span><br><span class="line">            <span class="keyword">#else</span></span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">                .environmentObject(model)</span><br><span class="line">                .environmentObject(store)</span><br><span class="line">            <span class="keyword">#endif</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">#if</span> <span class="type">APPCLIP</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">handleUserActivity</span>(<span class="keyword">_</span> <span class="params">userActivity</span>: <span class="type">NSUserActivity</span>) &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> incomingURL <span class="operator">=</span> userActivity.webpageURL,</span><br><span class="line">              <span class="keyword">let</span> components <span class="operator">=</span> <span class="type">NSURLComponents</span>(url: incomingURL, resolvingAgainstBaseURL: <span class="literal">true</span>),</span><br><span class="line">              <span class="keyword">let</span> queryItems <span class="operator">=</span> components.queryItems <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> smoothieID <span class="operator">=</span> queryItems.first(where: &#123; <span class="variable">$0</span>.name <span class="operator">==</span> <span class="string">&quot;smoothie&quot;</span> &#125;)<span class="operator">?</span>.value &#123;</span><br><span class="line">            model.selectSmoothie(id: smoothieID)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> payload <span class="operator">=</span> userActivity.appClipActivationPayload,</span><br><span class="line">              <span class="keyword">let</span> latitudeValue <span class="operator">=</span> queryItems.first(where: &#123; <span class="variable">$0</span>.name <span class="operator">==</span> <span class="string">&quot;latitude&quot;</span> &#125;)<span class="operator">?</span>.value,</span><br><span class="line">              <span class="keyword">let</span> longitudeValue <span class="operator">=</span> queryItems.first(where: &#123; <span class="variable">$0</span>.name <span class="operator">==</span> <span class="string">&quot;longitude&quot;</span> &#125;)<span class="operator">?</span>.value,</span><br><span class="line">              <span class="keyword">let</span> latitude <span class="operator">=</span> <span class="type">Double</span>(latitudeValue), <span class="keyword">let</span> longitude <span class="operator">=</span> <span class="type">Double</span>(longitudeValue) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">CLCircularRegion</span>(center: <span class="type">CLLocationCoordinate2D</span>(latitude: latitude,</span><br><span class="line">                            longitude: longitude), radius: <span class="number">100</span>, identifier: <span class="string">&quot;smoothie_location&quot;</span>)</span><br><span class="line">        payload.confirmAcquired(in: region) &#123; inRegion, error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> error &#123;</span><br><span class="line">                <span class="built_in">print</span>(error.localizedDescription)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                model.applePayAllowed <span class="operator">=</span> inRegion</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">#endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中<code>handleUserActivity</code>就是在处理<code>App Clip</code>链接。<br>当然，直接将主App和<code>App Clip</code>的代码分开也是可以的，但是这可能对于两者区别较大的产品更适合，但同时也违反了Apple的初衷，希望<code>App Clip</code>仅仅是主App的一部分，这可能会导致审核遇阻。</p><p><strong>与小程序的异同</strong></p><p>有些人认为<code>App Clip</code>是苹果小程序，像微信一样。如果仅从两者设计之初的理念来比较，确实比较相似，但是从其他方面来讲，两者差异较大：</p><ul><li>入口不同：App Clip支持多种打开方式，微信小程序只支持从微信进入，但是后者支持主动搜索。</li><li>性能不同：App Clip依赖于系统，微信小程序依赖于微信，原生性能会明显优于小程序。</li><li>体验路径不同：微信小程序需要打开微信，下拉小程序列表，找到并打开目标小程序，<code>App Clip</code>一步到位，实施降维打击。</li><li>定位不同：<code>App Clip</code>明确是主App功能的一部分，不能做主App无关的内容，但是微信小程序没有该限制，并且支持独立发布。</li></ul><p>也正是由于定位不同，微信小程序完全可以与<code>App Clip</code>共分天下，微信小程序已经形成生态圈，国内很多开发商专注于小程序的开发，都没有App，自然也就用不上<code>App Clip</code>，虽然<code>App Clip</code>必然会抢占小程序的市场，但是目前看，还是无法从根本上动摇小程序的地位。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;今年整体适配强度不大。&lt;br&gt;&lt;img src=&quot;https://cdn.rencheng.cc/blog/y3ady.jpg&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-App瘦身</title>
    <link href="https://rencheng.cc/2020/09/14/ios/general/App%E7%98%A6%E8%BA%AB/"/>
    <id>https://rencheng.cc/2020/09/14/ios/general/App%E7%98%A6%E8%BA%AB/</id>
    <published>2020-09-14T09:13:50.000Z</published>
    <updated>2020-09-14T09:13:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>关于App瘦身的实践<br><strong>构成</strong></p><ul><li>可执行文件</li><li>资源<span id="more"></span></li></ul><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><p><img src="https://cdn.rencheng.cc/blog/72mgl.png-thumb100"></p><h2 id="删除无用资源"><a href="#删除无用资源" class="headerlink" title="删除无用资源"></a>删除无用资源</h2><h3 id="未使用的图片"><a href="#未使用的图片" class="headerlink" title="未使用的图片"></a>未使用的图片</h3><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><p><a href="https://github.com/tinymind/LSUnusedResources">LSUnusedResources</a></p><blockquote><p>下载后用Xcode运行，会启动一个Mac程序。</p></blockquote><h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><ul><li>一般都是启动图比较大，往期启动图没有及时清理</li><li>不是特别大的工程，未使用图片没多少。不要灰心</li><li>要选中<code>ignore similar name</code>防止误删</li><li>序列图会误报，一定要检查好。防止误删</li><li>某些动画的资源，也会误报，要检查好</li></ul><blockquote><p>定期检查<br>防止误删</p></blockquote><h3 id="删除重复的资源"><a href="#删除重复的资源" class="headerlink" title="删除重复的资源"></a>删除重复的资源</h3><p>重复资源（主要指图片）不是指命名重复而是内容相同。<br><code>fdupes</code>是Linux下的一个工具，可以在指定的目录及子目录中查找重复的文件。<code>fdupes</code>通过对比文件的MD5签名，以及逐字节比较文件来识别重复内容。</p><p>项目中图片分两处存放，Assets.xcassets和images文件夹，所以在这两个目录查找就可以。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdupes -r xxx/images xxx/Images.xcassets</span><br></pre></td></tr></table></figure><h2 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h2><ul><li><a href="https://github.com/ImageOptim/ImageOptim">ImageOptim</a></li><li><a href="https://tinypng.com/">Tinypng</a></li><li>WebP图片压缩<br>  WebP是Google提供的一种图片编码格式，通常情况下WebP格式的图片是原始JPG/PNG图片的1/3，所以对于重度依赖图片显示的应用，转换使用WebP可以节省大量的网络传输数据和时间。对于APP瘦身，使用WebP格式可能是一种方式，可以使用WebP格式的图片替代现有的图片资源，可以一定程度的节省空间。</li></ul><h2 id="代码瘦身"><a href="#代码瘦身" class="headerlink" title="代码瘦身"></a>代码瘦身</h2><p><strong>AppCode代码静态检查</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">菜单栏 -&gt; code -&gt; Inspect Code</span><br></pre></td></tr></table></figure><h2 id="编译器优化"><a href="#编译器优化" class="headerlink" title="编译器优化"></a>编译器优化</h2><ul><li><code>Strip Linked Product</code>、<code>Make Strings Read-Only</code>、<code>Symbols Hidden by Default</code>设置为YES</li><li>去掉异常支持，Enable C++ Exceptions、Enable Objective-C Exceptions设置为NO， Other C Flags添加-fno-exceptions</li></ul><h2 id="LinkMap分析包大小"><a href="#LinkMap分析包大小" class="headerlink" title="LinkMap分析包大小"></a>LinkMap分析包大小</h2><p>生成LinkMap文件，可以查看可执行文件的具体组成<br><img src="https://cdn.rencheng.cc/blog/asfyo.jpg"><br>可借助第三方工具解析LinkMap文件： <a href="https://github.com/huanxsd/LinkMap">https://github.com/huanxsd/LinkMap</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;关于App瘦身的实践&lt;br&gt;&lt;strong&gt;构成&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可执行文件&lt;/li&gt;
&lt;li&gt;资源</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="App优化" scheme="https://rencheng.cc/tags/App%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>敏捷开发</title>
    <link href="https://rencheng.cc/2020/08/05/manager/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/"/>
    <id>https://rencheng.cc/2020/08/05/manager/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/</id>
    <published>2020-08-04T16:59:07.000Z</published>
    <updated>2020-08-04T16:59:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>关于软件开发模式的记录</p><span id="more"></span><h2 id="传统软件开发模式"><a href="#传统软件开发模式" class="headerlink" title="传统软件开发模式"></a>传统软件开发模式</h2><ol><li>需要经历问题评估、计划解决方案、设计系统架构、开发代码、测试、部署和使用系统、维护解决方案等过程。</li><li>如瀑布流模式: 它是以文档为驱动，在整个开发过程中，开发人员根据需求文档进行开发，一切以文档为依据。<br> <img src="https://cdn.rencheng.cc/blog/xvod4.jpg"></li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>由于开发模型是线性的，用户只有等到整个过程的末期才能见到开发成果，从而增加了开发的风险；</li><li>早期的错误可能要等到开发后期的测试阶段才能发现，进而带来严重的后果。</li><li>各个软件生命周期衔接花费时间较长，团队人员交流成本大。</li><li>在需求不明并且在项目进行过程中可能变化的情况下基本是不可行的。</li></ol><blockquote><p><a href="https://blog.csdn.net/xi_gua_gua/article/details/53107283">软件开发的11种模式</a></p></blockquote><h2 id="敏捷开发-Agile-Development"><a href="#敏捷开发-Agile-Development" class="headerlink" title="敏捷开发(Agile Development)"></a>敏捷开发(Agile Development)</h2><h3 id="什么是敏捷开发"><a href="#什么是敏捷开发" class="headerlink" title="什么是敏捷开发"></a>什么是敏捷开发</h3><ol><li>敏捷开发(Agile Development)是一种以人为核心、迭代、循序渐进的开发方式。</li><li>在敏捷开发中，软件项目的构建被切分成多个子项目，各个子项目的成果都经过测试，具备集成和可运行的特征。</li><li>它并不是一门技术，而是一种开发方式，是一种软件开发的流程。</li><li>作用指导我们用规定的环节去一步一步完成项目的开发。因为它采用的是迭代式开发，所以这种开发方式的主要驱动核心是人。</li></ol><h3 id="敏捷开发适用于"><a href="#敏捷开发适用于" class="headerlink" title="敏捷开发适用于"></a>敏捷开发适用于</h3><ul><li>客户不知道自己要啥的情况，这样的客户占绝大多数。因为客户不知道要啥，所以你需要不断帮客户弄明白他到底想要啥。换句话说，你需要和客户沟通，合作，倾听反馈，持续改进；</li><li>竞争激烈的市场，这样的情况下，赶在竞争对手前交付一个不完美但至少能用的产品非常重要；</li><li>快速变化的市场，你在埋头造一辆汽车的时候，客户已经想开飞机满天飞了，这就需要你能一步步的把汽车改成飞机，还能按时交付；</li><li>适用于在一个地方办公的小团队，一般 10 个人以内。这样能使敏捷中主要的沟通方式「Face to Face」是可行的。</li></ul><h3 id="敏捷开发流程"><a href="#敏捷开发流程" class="headerlink" title="敏捷开发流程"></a>敏捷开发流程</h3><p><img src="https://cdn.rencheng.cc/blog/umlyp.jpg"></p><h3 id="敏捷开发实现方式"><a href="#敏捷开发实现方式" class="headerlink" title="敏捷开发实现方式"></a>敏捷开发实现方式</h3><ul><li>Scrum</li><li>XP</li></ul><h4 id="Scrum"><a href="#Scrum" class="headerlink" title="Scrum"></a>Scrum</h4><p><img src="https://cdn.rencheng.cc/blog/6m04u.jpg"></p><p><strong>项目角色</strong></p><ul><li>产品负责人（Product Owner）：主要负责确定产品的功能和达到要求的标准，指定软件的发布日期和交付的内容，同时有权力接受或拒绝开发团队的工作成果。</li><li>流程管理员（Scrum Master）：主要负责整个Scrum流程在项目中的顺利实施和进行，以及清除挡在客户和开发工作之间的沟通障碍，使得客户可以直接驱动开发。</li><li>开发团队（Scrum Team）：主要负责软件产品在Scrum规定流程下进行开发工作，人数控制在5~10人左右，每个成员可能负责不同的技术方面，但要求每成员必须要有很强的自我管理能力，同时具有一定的表达能力；成员可以采用任何工作方式，只要能达到Sprint的目标。</li></ul><h4 id="XP（Extreme-Programming）"><a href="#XP（Extreme-Programming）" class="headerlink" title="XP（Extreme Programming）"></a>XP（Extreme Programming）</h4><p><strong>什么是XP</strong></p><ul><li>极限编程（eXtreme Programming），是一种全新的、轻量级的、灵巧的软件开发方法，是一种软件工程方法学。它强调程序设计团队与业务专家之间的紧密协作、面对面的沟通（比书面的文档更有效）、频繁交付新的软件版本、紧凑而自我组织型的团队、能够很好的适应需求变化的代码编写和团队组织方法，更注重软件开发中人的作用。</li><li>XP的核心是沟通（Communication）、简单（Simplicity）、反馈（Feedback）、勇气（Courage）四大价值观，它们是XP的基础，也是XP的灵魂。</li></ul><p><a href="https://blog.csdn.net/happylee6688/article/details/21551065">敏捷开发之XP</a></p><h4 id="敏捷开发中XP与SCRUM的区别"><a href="#敏捷开发中XP与SCRUM的区别" class="headerlink" title="敏捷开发中XP与SCRUM的区别"></a>敏捷开发中XP与SCRUM的区别</h4><ol><li><p>迭代长度的不同</p><ul><li>XP的一个Sprint的迭代长度大致为1<del>2周, 而Scrum的迭代长度一般为 2</del> 4周.</li></ul></li><li><p>在迭代中, 是否允许修改需求</p><ul><li>XP在一个迭代中，如果一个User Story(一个用户需求)还没有实现， 则可以考虑用另外的需求将其替换，替换的原则是需求实现的时间量是相等的。</li><li>而Scrum是不允许这样做的，一旦迭代开工会完毕, 任何需求都不允许添加进来，并有Scrum Master严格把关，不允许开发团队受到干扰</li><li>在迭代中，User Story是否严格按照优先级别来实现</li><li>XP是务必要遵守优先级别的。 但Scrum在这点做得很灵活， 可以不按照优先级别来做</li></ul><blockquote><p>Scrum这样处理的理由是：如果优先问题的解决者，由于其它事情耽搁，不能认领任务，那么整个进度就耽误了。 另外一个原因是，如果按优先级排序的User Story #6和#10，虽然#6优先级高，但是如果#6的实现要依赖于#10，则不得不优先做#10.</p></blockquote></li><li><p>软件的实施过程中，是否采用严格的工程方法，保证进度或者质量</p><ul><li>Scrum没有对软件的整个实施过程开出个工程实践的处方，要求开发者自觉保证。</li><li>但XP对整个流程方法定义非常严格，规定需要采用TDD, 自动测试， 结对编程，简单设计，重构等约束团队的行为。</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;关于软件开发模式的记录&lt;/p&gt;</summary>
    
    
    
    
    <category term="团队管理" scheme="https://rencheng.cc/tags/%E5%9B%A2%E9%98%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>iOS-灰度发布</title>
    <link href="https://rencheng.cc/2020/05/22/ios/general/iOS-%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/"/>
    <id>https://rencheng.cc/2020/05/22/ios/general/iOS-%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/</id>
    <published>2020-05-22T07:53:30.000Z</published>
    <updated>2020-05-22T07:53:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>打开头条总是让我参加内测，研究一下灰度发布。</p><span id="more"></span><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><p><img src="https://cdn.rencheng.cc/blog/8wjzx.png-thumb100"></p><h2 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h2><h3 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h3><ul><li>版本控制</li><li>版本回收</li><li>反馈机制</li></ul><h3 id="运营"><a href="#运营" class="headerlink" title="运营"></a>运营</h3><ul><li>A/BTest良性分发</li><li>报表统计</li><li>补偿机制</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;打开头条总是让我参加内测，研究一下灰度发布。&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS高级面试题</title>
    <link href="https://rencheng.cc/2020/04/30/ios/general/iOS%E9%AB%98%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>https://rencheng.cc/2020/04/30/ios/general/iOS%E9%AB%98%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%A2%98/</id>
    <published>2020-04-30T04:31:32.000Z</published>
    <updated>2020-04-30T04:31:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>以下是通过极客时间《iOS高级课》中总结的面试题，仅供参考。</p><span id="more"></span><ol><li><p>以下关于 objc_msgSend 和 fishhook 的说法中，哪些是正确的？<br> A. objc_msgSend 是使用 C 语言编写的<br> B. objc_msgSend 在运行时根据对象和方法的 selector 找到对应的函数指针，然后执行<br> C. 可以使用 fishhook 来 hook objc_msgSend<br> D. fishhook 通过重新绑定符号，实现对 c 方法的 hook</p><blockquote><p>答案：B, D<br>A 选项，objc_msgSend 是使用汇编语言编写的。<br>C 选项，hook objc_msgSend 还需要用到汇编。</p></blockquote></li><li><p>Auto Layout 的布局工作过程描述，哪些是正确的？<br> A. Layout Engine 在碰到约束变化后不会重新计算布局<br> B. Constraints Change 不会触发约束变化<br> C. Layout Engine 会将视图、约束、优先级、固定大小通过计算转换成最终的大小和位置<br> D. 在 Layout Engine 里，每当约束发生变化，就会触发 Deffered Layout Pass</p><blockquote><p>答案：C, D<br>A 选项，Layout Engine 在碰到约束变化后会重新计算布局，获取到布局后调用 superview.setNeedLayout()，然后进入 Deferred Layout Pass。<br>B 选项，Constraints Change 表示的就是约束变化，添加、删除视图时会触发约束变化。</p></blockquote></li><li><p>链接器对代码做的事情，哪些是正确的？<br> A. 去项目文件里查找目标代码文件里已经定义的变量<br> B. 扫描项目中的不同文件，将所有符号定义和引用地址收集起来，并放到全局符号表中<br> C. 计算合并后长度及位置，生成同类型的段进行合并，建立绑定<br> D. 对项目中不同文件里的变量进行地址重定位</p><blockquote><p>答案：B, C, D<br>A 选项，查找没有定义的变量。</p></blockquote></li><li><p>下面哪些工具可以作为静态分析器？<br> A. OCLint<br> B. Infer<br> C. Injection<br> D. ImageOptim</p><blockquote><p>答案：A, B<br>C 选项，Injection 的工具用来动态地将 Swift 或 Objective-C 的代码在已运行的程序中执行，以加快调试速度，同时保证程序不用重启。<br>D 选项，ImageOptim 是图片压缩工具。</p></blockquote></li><li><p>关于减少 App 包大小，哪些说法是正确的？<br> A. 通过 AppCode 找出无用代码<br> B. LinkMap 结合 Mach-O 找无用代码<br> C. 使用 LSUnusedResources 进行图片压缩<br> D. 使用 App Thining 可以减少包大小</p><blockquote><p>答案：A, B<br>C 选项，LSUnusedResources 是找无用图片的工具，TinyPng 或 ImageOptim 才是图片压缩的工具。</p></blockquote></li><li><p>下面哪些问题是信号可捕获的？<br> A. 内存被打爆<br> B. NSNotification 线程问题<br> C. 后台任务超时<br> D. 野指针</p><blockquote><p>答案：B, D<br>A 选项和 C 选项是无法通过信号捕获的。</p></blockquote></li><li><p>下面哪个异常编码，是表示 App 在一定时间内无响应而被 watchdog 杀掉的？<br> A. 0xdeadfa11<br> B. 0xc00010ff<br> C. 0x8badf00d<br> D. 0xdead10cc</p><blockquote><p>答案：C<br>A 选项，表示 App 被用户强制退出。<br>B 选项，表示 App 因为运行造成设备温度太高而被杀掉。<br>D 选项，表示死锁，当 App 在后台运行时，持有了系统资源。</p></blockquote></li><li><p>导致卡顿的原因，以下说法哪些是正确的？<br> A. 复杂 UI 、图文混排的绘制量过大<br> B. 在主线程上使用锁<br> C. 在主线程做大量的 IO 操作<br> D. 运算量过大，CPU 持续高占用</p><blockquote><p>答案：A, C, D<br>B 选项，主线程上使用锁不一定会导致卡顿，死锁和主子线程抢锁才会。</p></blockquote></li><li><p>以下哪些方法可以获取内存上限值？<br> A. 通过 JetsamEvent 日志计算内存限制值<br> B. 通过 XNU 获取内存限制值<br> C. 通过内存警告获取内存限制值<br> D. 通过 hook malloc_logger 函数来获取内存限制值</p><blockquote><p>答案：A, B, C<br>D 选项，hook malloc_logger 用来定位谁分配的内存。</p></blockquote></li><li><p>关于线程，以下哪些说法是正确的？<br> A. UIKit 是线程安全的<br> B. UIKit 没有使用多线程技术<br> C. 常驻线程一直存在于内存中<br> D. 线程开多了会有内存问题</p><blockquote><p>答案：B, C, D<br>A 选项，UIKit 不是线程安全的。</p></blockquote></li><li><p>以下哪些是可以在 iOS 中使用的 GUI 框架？<br> A. WebKit<br> B. Flutter<br> C. Blink<br> D. Texture</p><blockquote><p>答案：A, B, D<br>C 选项，Blink 是谷歌从 WebKit 中 WebCore 拉出的分支，用于 Chrome 中，无法用在 iOS 中。</p></blockquote></li><li><p>关于 iOS 开发中使用的开源库，下面哪些说法是正确的？<br> A. ReactiveCocoa、RxSwift、React.js 都是 iOS 响应式框架<br> B. Lottie 框架可以解决动画制作与开发隔离，以及多平台统一的问题<br> C. SkyLab 可以用来作 A/B 测试<br> D. Promise 可以提高 JSON 解析的性能</p><blockquote><p>答案：B, C<br>A 选项，React.js 是前端响应式框架。<br>D 选项，Promise 是一种专门针对异步数据操作编写的一套统一规则的模式，可以用于事件总线的数据订阅和数据发布事件。</p></blockquote></li><li><p>iOS 系统可以分为哪几层？<br> A. 最一层是 Topaz 层<br> B. 第二层是应用框架层<br> C. 第三层是微内核层<br> D. 第四层是 Darwin 层</p><blockquote><p>答案：B, D<br>A 选项，第一层是户体验层，主要是提供用户界面。这一层包含了 SpringBoard、Spotlight、Accessibility。Topaz 层是 Fuchsia 的系统基础应用层。<br>C 选项，第三层是核心框架层，是系统核心功能的框架层。</p></blockquote></li><li><p>关于 iOS 的 Runtime，以下说法哪些是正确的？<br> A. 可以帮助我们在运行时进行方法交换<br> B. 在原方法执行之前插入自定义方法<br> C. 直接使用 Runtime 方法交换开发很安全，无风险<br> D. Runtime 不光能够进行方法交换，还能够在运行时处理 Objective-C 特性相关（比如类、成员函数、继承）的增删改操作</p><blockquote><p>答案：A, B, D<br>C 选项，直接使用 Runtime 的方法进行方法交换会有很多风险，更安全的是使用 Aspects。</p></blockquote></li><li><p>关于函数调用，以下哪些说法是正确的？<br> A. dlsym() 无法通过函数名字符串获取函数地址<br> B. 编译时需要按照调用惯例针对不同 CPU 架构编译，生成汇编代码，确定好栈和寄存器<br> C. Objective-C 的函数调用采用的是发送消息的方式<br> D. Objective-C 具备动态调用函数的能力</p><blockquote><p>答案：B, C, D<br>选项 A，dlsym() 可以通过函数名字符串拿到函数地址。</p></blockquote></li><li><p>以下关于 libffi 的说法，哪些是正确的？<br> A. libffi 中 ffi 的全称是 Foundation Function Interface<br> B. libffi 还提供了可移植的高级语言接口，可以不使用函数签名间接调用 C 函数<br> C. libffi 通过发送消息的方式来进行函数调用<br> D. libffi 的作用类似于一个动态的编译器，在运行时就能够完成编译时所做的调用惯例函数调用代码生成</p><blockquote><p>答案：B, D<br>A 选项，全称是 Foreign Function Interface。<br>C 选项，libffi 是通过调用 ffi_call（函数调用） 来进行函数调用。</p></blockquote></li><li><p>关于 ffi_call_SYSV 处理过程，以下说法哪些是正确的？<br> A. ffi_call_SYSV 会先分配 stack 和 frame，保存记录 fn、rvalue、closure、flags<br> B. 将向量参数传到寄存器，按照参数放置规则，调整 sp 的位置<br> C. 将参数放入寄存器，存放完毕，就开始释放上下文，留下栈里的参数<br> D. 调用完函数指针，直接保存返回值</p><blockquote><p>答案：A, B, C<br>选项 D，调用完函数指针，保存返回值之前需要重新读取 rvalue 和  flags，析构部分栈指针。</p></blockquote></li><li><p>以下关于 JavaScriptCore 的说法，哪些是正确的？<br> A. JavaScriptCore 框架主要由 JSVirtualMachine 、JSContext、JSValue 类组成<br> B. JSVirtualMachine 里只包含一个 JSContext，一个 JSContext 中可以有多个 JSValue<br> C. JavaScriptCore 内部是由 Parser、Interpreter、Compiler、GC 等部分组成<br> D. 原生线程可以将类方法和属性提供给 JavaScriptCore 使用</p><blockquote><p>答案：A, C, D<br>B 选项，JSVirtualMachine 里可以有多个 JSContext。</p></blockquote></li><li><p>关于渲染原理，下面说法哪些是正确的？<br> A. CPU 内部流水线结构拥有并行计算能力，一般用于显示内容的计算<br> B. GPU 专门用来处理渲染内容的计算，比如视图创建、布局、图片解码等<br> C. GPU 的主要工作是将 3D 坐标转化成 2D 坐标，然后再把 2D 坐标转成实际像素<br> D. CPU 处理完渲染内容的计算，然后将图形结果显示在屏幕像素中</p><blockquote><p>答案：A, C<br>B 选项，GPU 并行计算能力强，通过计算将图形结果显示在屏幕像素中，渲染内容的计算，通常使用 CPU 完成。<br>D 选项，CPU 专门用来处理渲染内容的计算，比如视图创建、布局、图片解码等，内容计算完成后，再传输给 GPU 进行渲染。</p></blockquote></li><li><p>以下动态化方案的说法，哪些是正确的？<br> A. JIT 技术就是在 App 运行时创建机器代码，同时执行这些机器代码<br> B. LLVM IR 是 SSA 形式的<br> C. SSA 主要解决的是，多种数据流分析时种类多、难以维护的问题<br> D. LLVM 里有针对 iOS 系统可用的解释器</p><blockquote><p>答案：A, B, C<br>D 选项，LLVM 没有专门针对 iOS 做解释器，因为 iOS 动态化在 LLVM 所有工作中的优先级并不高。</p></blockquote></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;以下是通过极客时间《iOS高级课》中总结的面试题，仅供参考。&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>斐波那契数列</title>
    <link href="https://rencheng.cc/2020/04/11/algo/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/"/>
    <id>https://rencheng.cc/2020/04/11/algo/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/</id>
    <published>2020-04-11T06:29:15.000Z</published>
    <updated>2020-04-11T06:29:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>斐波那契数，通常用 F(n) 表示，形成的序列称为斐波那契数列。该数列由 0 和 1 开始，后面的每一项数字都是前面两项数字的和。也就是：</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">F(0) = 0,   F(1) = 1</span><br><span class="line">F(N) = F(N - 1) + F(N - 2), 其中 N &gt; 1.</span><br><span class="line">给定 N，计算 F(N)。</span><br></pre></td></tr></table></figure><p>示例 1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：2</span><br><span class="line">输出：1</span><br><span class="line">解释：F(2) = F(1) + F(0) = 1 + 0 = 1.</span><br></pre></td></tr></table></figure><p>示例 2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：3</span><br><span class="line">输出：2</span><br><span class="line">解释：F(3) = F(2) + F(1) = 1 + 1 = 2.</span><br></pre></td></tr></table></figure><p>示例 3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：4</span><br><span class="line">输出：3</span><br><span class="line">解释：F(4) = F(3) + F(2) = 2 + 1 = 3.</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 ≤ N ≤ 30</span><br></pre></td></tr></table></figure><p><strong>方法一</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过递归的方式计算 - 有性能问题</span></span><br><span class="line"><span class="comment">// 时间复杂度: O(2^n)</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fib</span>(<span class="keyword">_</span> <span class="params">n</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n <span class="operator">&lt;=</span> <span class="number">1</span> &#123; <span class="keyword">return</span> n &#125;</span><br><span class="line">    <span class="keyword">return</span> fib1(n <span class="operator">-</span> <span class="number">1</span>) <span class="operator">+</span> fib1(n <span class="operator">-</span> <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>方法二</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 时间复杂度: O(n)</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fib</span>(<span class="keyword">_</span> <span class="params">n</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n <span class="operator">&lt;</span> <span class="number">1</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> left <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> right <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">1</span><span class="operator">..&lt;</span>n &#123;</span><br><span class="line">        <span class="keyword">let</span> sum <span class="operator">=</span> (left <span class="operator">+</span> right) <span class="operator">%</span> <span class="type">Int</span>(<span class="number">1e9</span><span class="operator">+</span><span class="number">7</span>)</span><br><span class="line">        right <span class="operator">=</span> left</span><br><span class="line">        left <span class="operator">=</span> sum</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 时间复杂度: O(n)</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fib</span>(<span class="keyword">_</span> <span class="params">n</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n <span class="operator">&lt;</span> <span class="number">1</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> n <span class="operator">&lt;=</span> <span class="number">2</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">        <span class="keyword">var</span> array: [<span class="type">Int</span>] <span class="operator">=</span> <span class="type">Array</span>(repeating: <span class="number">0</span>, count: n<span class="operator">+</span><span class="number">1</span>)</span><br><span class="line">        array[<span class="number">1</span>] <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">2</span><span class="operator">...</span>n &#123;</span><br><span class="line">            array[i] <span class="operator">=</span> (array[i<span class="operator">-</span><span class="number">1</span>] <span class="operator">+</span> array[i<span class="operator">-</span><span class="number">2</span>]) <span class="operator">%</span> <span class="type">Int</span>(<span class="number">1e9</span> <span class="operator">+</span> <span class="number">7</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[n]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>Swift中如果数值越界，会崩溃。建议采用大值数作为容器。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;斐波那契数，通常用 F(n) 表示，形成的序列称为斐波那契数列。该数列由 0 和 1 开始，后面的每一项数字都是前面两项数字的和。也就是：&lt;/p&gt;</summary>
    
    
    
    
    <category term="数据结构和算法" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/"/>
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="LeetCode" scheme="https://rencheng.cc/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - Widget渲染流程</title>
    <link href="https://rencheng.cc/2020/03/06/flutter/FlutterWidget%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/"/>
    <id>https://rencheng.cc/2020/03/06/flutter/FlutterWidget%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/</id>
    <published>2020-03-06T11:03:29.000Z</published>
    <updated>2020-03-06T11:03:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>源码分析Widget渲染原理</p><p>并不是所有的Widget都会被独立渲染!<br>只有继承<code>RenderObjectWidget</code>的才会创建RenderObject对象!<br>在Flutter渲染的流程中，有三颗重要的树!Flutter引擎是针对Render树进行渲染!</p><span id="more"></span><p>每一个Widget都会创建一个Element对象。<br>隐式调用<code>createElement</code>方法，Element加入Element树中。</p><blockquote><p>它会创建三种Element</p></blockquote><ul><li>RenderElement主要是创建RenderObject对象<br>  继承RenderObjectWidget的Widget会创建RenderElement<ul><li>创建RanderElement</li><li>Flutter会凋用mount方法，调用createRanderObject方法</li></ul></li><li>StatefulElement继承ComponentElement<br>  StatefulWidget会创建StatefulElement<ul><li>调用createState方法, 创建State</li><li>将Widget赋值给state</li><li>凋用state的build方法并且將自己(Element)传出去</li><li>build里面的context 就是Widget的Element!</li></ul></li><li>StatelessElement继承ComponentElement<br>  StatelessWidget 会创建StatelessElement<ul><li>主要就是调用build方法并且将自己(Element) 传出去.</li></ul></li></ul><p>Q: Render树用于渲染，Widget用于定义开发。那么Element有什么意义？<br>A: Element持有Widget，同时也持有RenderObject。拿到context就可以更方便做事。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;源码分析Widget渲染原理&lt;/p&gt;
&lt;p&gt;并不是所有的Widget都会被独立渲染!&lt;br&gt;只有继承&lt;code&gt;RenderObjectWidget&lt;/code&gt;的才会创建RenderObject对象!&lt;br&gt;在Flutter渲染的流程中，有三颗重要的树!Flutter引擎是针对Render树进行渲染!&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - iOS通信开发</title>
    <link href="https://rencheng.cc/2020/03/04/flutter/Flutter%E4%B8%8EiOS%E9%80%9A%E4%BF%A1/"/>
    <id>https://rencheng.cc/2020/03/04/flutter/Flutter%E4%B8%8EiOS%E9%80%9A%E4%BF%A1/</id>
    <published>2020-03-04T03:12:11.000Z</published>
    <updated>2020-03-04T03:12:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>在做Flutter开发的时候通常离不了Flutter和Native之间的通信，比如：初始化Flutter时Native向Dart传递数据，Dart调用Native的相册选择图片，Dart调用Native的模块进行一些复杂的计算，Native将一些数据(GPS信息，陀螺仪，传感器等)主动传递给Dart等。</p><span id="more"></span><h2 id="简述："><a href="#简述：" class="headerlink" title="简述："></a>简述：</h2><p>接下来我将分场景来介绍<code>Dart</code>和<code>Native</code>之间的通信。</p><p><strong>几种通信场景：</strong></p><ul><li>  初始化Flutter时Native向Dart传递数据；</li><li>  Native发送数据给Dart；</li><li>  Dart发送数据给Native；</li><li>  Dart发送数据给Native，然后Native回传数据给Dart；</li></ul><p><img src="https://cdn.rencheng.cc/blog/0srxg.png"></p><p>在讲解 <code>Flutter</code> 与 <code>Native</code> 之间是如何传递数据之前，我们先来了解下 <code>Flutter</code> 与 <code>Native</code> 的通信机制，<code>Flutter</code> 和 <code>Native</code> 的通信是通过Channel来完成的。</p><p>消息使用Channel（平台通道）在客户端（UI）和主机（平台）之间传递，如下图所示：</p><p><img src="https://cdn.rencheng.cc/blog/oz11b.png"></p><blockquote><p>Flutter中消息的传递是完全异步的；</p></blockquote><h2 id="Channel所支持的数据类型对照表："><a href="#Channel所支持的数据类型对照表：" class="headerlink" title="Channel所支持的数据类型对照表："></a>Channel所支持的数据类型对照表：</h2><table><thead><tr><th align="left">Dart</th><th align="left">Android</th><th align="left">iOS</th></tr></thead><tbody><tr><td align="left">null</td><td align="left">null</td><td align="left">nil (NSNull when nested)</td></tr><tr><td align="left">bool</td><td align="left">java.lang.Boolean</td><td align="left">NSNumber numberWithBool:</td></tr><tr><td align="left">int</td><td align="left">java.lang.Integer</td><td align="left">NSNumber numberWithInt:</td></tr><tr><td align="left">int, if 32 bits not enough</td><td align="left">java.lang.Long</td><td align="left">NSNumber numberWithLong:</td></tr><tr><td align="left">double</td><td align="left">java.lang.Double</td><td align="left">NSNumber numberWithDouble:</td></tr><tr><td align="left">String</td><td align="left">java.lang.String</td><td align="left">NSString</td></tr><tr><td align="left">Uint8List</td><td align="left">byte[]</td><td align="left">FlutterStandardTypedData typedDataWithBytes:</td></tr><tr><td align="left">Int32List</td><td align="left">int[]</td><td align="left">FlutterStandardTypedData typedDataWithInt32:</td></tr><tr><td align="left">Int64List</td><td align="left">long[]</td><td align="left">FlutterStandardTypedData typedDataWithInt64:</td></tr><tr><td align="left">Float64List</td><td align="left">double[]</td><td align="left">FlutterStandardTypedData typedDataWithFloat64:</td></tr><tr><td align="left">List</td><td align="left">java.util.ArrayList</td><td align="left">NSArray</td></tr><tr><td align="left">Map</td><td align="left">java.util.HashMap</td><td align="left">NSDictionary</td></tr></tbody></table><h2 id="Flutter定义了三种不同类型的Channel："><a href="#Flutter定义了三种不同类型的Channel：" class="headerlink" title="Flutter定义了三种不同类型的Channel："></a>Flutter定义了三种不同类型的Channel：</h2><ul><li>  BasicMessageChannel：用于传递字符串和半结构化的信息，**<code>持续通信</code><strong>，</strong><code>收到消息后可以回复此次消息</code>**，如：Native将遍历到的文件信息陆续传递到Dart，再比如：Flutter将从服务端陆陆续获取到信息交个Native加工，Native处理完返回等；</li><li>  MethodChannel：用于传递方法调用（method invocation）**<code>一次性通信</code>**：如Flutter调用Native拍照；</li><li>  EventChannel: 用于数据流（event streams）的通信，**<code>持续通信</code><strong>，</strong><code>收到消息后无法回复此次消息</code>**；通过长用于Native向Dart的通信，如：手机电量变化，网络连接变化，陀螺仪，传感器等；</li></ul><p>这三种类型的类型的Channel都是全双工通信，即A &lt;=&gt; B，Dart可以主动发送消息给platform端，并且platform接收到消息后可以做出回应，同样，platform端可以主动发送消息给Dart端，dart端接收数后返回给platform端。</p><h3 id="BasicMessageChannel用法"><a href="#BasicMessageChannel用法" class="headerlink" title="BasicMessageChannel用法"></a>BasicMessageChannel用法</h3><h4 id="Native端："><a href="#Native端：" class="headerlink" title="Native端："></a>Native端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)messageChannelWithName:(<span class="built_in">NSString</span>*)name  binaryMessenger:(<span class="built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger  codec:(<span class="built_in">NSObject</span>&lt;FlutterMessageCodec&gt;*)codec;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">*   `<span class="built_in">NSString</span>* name` - Channel的名字，也是其唯一标识符；</span><br><span class="line">*   `FlutterBinaryMessenger* messenger` - 消息信使，是消息的发送与接收的工具；</span><br><span class="line">*   `FlutterMessageCodec codec` - 消息的编解码器，它有几种不同类型的实现：</span><br><span class="line">    *   `BinaryCodec` - 最为简单的一种Codec，因为其返回值类型和入参的类型相同，均为二进制格式（Android中为ByteBuffer，iOS中为<span class="built_in">NSData</span>）。实际上，BinaryCodec在编解码过程中什么都没做，只是原封不动将二进制数据消息返回而已。或许你会因此觉得BinaryCodec没有意义，但是在某些情况下它非常有用，比如使用BinaryCodec可以使传递内存数据块时在编解码阶段免于内存拷贝；</span><br><span class="line">    *   `FlutterStringCodec` - 用于字符串与二进制数据之间的编解码，其编码格式为UTF<span class="number">-8</span>；</span><br><span class="line">    *   `FlutterJSONMessageCodec` - 用于基础数据与二进制数据之间的编解码，其支持基础数据类型以及列表、字典。其在iOS端使用了<span class="built_in">NSJSONSerialization</span>作为序列化的工具，而在Android端则使用了其自定义的JSONUtil与StringCodec作为序列化工具；</span><br><span class="line">    *   `FlutterBinaryCodec` - 是FlutterBinaryMessenger的默认编解码器，其支持基础数据类型、二进制数据、列表、字典；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**setMessageHandler方法原型**</span><br><span class="line">``` objc</span><br><span class="line">- (<span class="type">void</span>)setMessageHandler:(FlutterMessageHandler _Nullable)handler;</span><br></pre></td></tr></table></figure><ul><li>  <code>FlutterMessageHandler handler</code> - 消息处理器，配合<code>BinaryMessenger</code>完成消息的处理；</li></ul><p>在创建好<code>BasicMessageChannel</code>后，如果要让其接收Dart发来的消息，则需要调用它的<code>setMessageHandler</code>方法为其设置一个消息处理器。</p><p><strong>BasicMessageChannel.MessageHandler原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> (^FlutterMessageHandler)(<span class="type">id</span> _Nullable message, FlutterReply callback);</span><br></pre></td></tr></table></figure><ul><li>  <code>^(NSString* message, FlutterReply reply)</code> - 用于接受消息，message是消息内容，reply是回复此消息的回调函数；</li></ul><p><strong>send方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)sendMessage:(<span class="type">id</span> _Nullable)message;</span><br><span class="line">- (<span class="type">void</span>)sendMessage:(<span class="type">id</span> _Nullable)message reply:(FlutterReply _Nullable)callback;</span><br></pre></td></tr></table></figure><ul><li>  <code>id message</code> - 要传递给Dart的具体信息；</li><li>  <code>FlutterReply callback</code> - 消息发出去后，收到Dart的回复的回调函数；</li></ul><p>在创建好<code>BasicMessageChannel</code>后，如果要向Dart发送消息，可以调用它的<code>sendMessage</code>方法向Dart传递数据。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用MessageChannel传递数据</span></span><br><span class="line">- (<span class="type">void</span>)initMessageChannel&#123;</span><br><span class="line">    <span class="keyword">self</span>.messageChannel = [FlutterBasicMessageChannel messageChannelWithName:<span class="string">@&quot;BasicMessageChannelPlugin&quot;</span> binaryMessenger:<span class="keyword">self</span>.flutterViewController codec:[FlutterStringCodec sharedInstance]];</span><br><span class="line">    MainViewController*  __<span class="keyword">weak</span> weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">//设置消息处理器，处理来自Dart的消息</span></span><br><span class="line">    [<span class="keyword">self</span>.messageChannel setMessageHandler:^(<span class="built_in">NSString</span>* message, FlutterReply reply) &#123;</span><br><span class="line">        reply([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;BasicMessageChannel收到：%@&quot;</span>,message]);</span><br><span class="line">        [weakSelf sendShow:message];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用MessageChannel传递数据</span></span><br><span class="line">[<span class="keyword">self</span>.messageChannel sendMessage: mesage reply:^(<span class="type">id</span>  _Nullable reply) &#123;</span><br><span class="line">    <span class="keyword">if</span> (reply != <span class="literal">nil</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> sendShow:reply];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><h4 id="Dart端："><a href="#Dart端：" class="headerlink" title="Dart端："></a>Dart端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BasicMessageChannel(<span class="keyword">this</span>.name, <span class="keyword">this</span>.codec);</span><br></pre></td></tr></table></figure><ul><li>  <code>String name</code> - Channel的名字，要和Native端保持一致；</li><li>  <code>MessageCodec&lt;T&gt; codec</code> - 消息的编解码器，要和Native端保持一致，有四种类型的实现具体可以参考Native端的介绍；</li></ul><p><strong>setMessageHandler方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> setMessageHandler(Future&lt;T&gt; handler(T message))</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">*   `Future&lt;T&gt; handler(T message)` - 消息处理器，配合`BinaryMessenger`完成消息的处理；</span><br><span class="line"></span><br><span class="line">在创建好`BasicMessageChannel`后，如果要让其接收Native发来的消息，则需要调用它的`setMessageHandler`方法为其设置一个消息处理器。</span><br><span class="line"></span><br><span class="line">**send方法原型**</span><br><span class="line">``` dart</span><br><span class="line">Future&lt;T&gt; send(T message)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">*   `T message` - 要传递给Native的具体信息；</span><br><span class="line">*   `Future&lt;T&gt;` - 消息发出去后，收到Native回复的回调函数；</span><br><span class="line"></span><br><span class="line">在创建好`BasicMessageChannel`后，如果要向Native发送消息，可以调用它的`send`方法向Native传递数据。</span><br><span class="line">``` dart</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> BasicMessageChannel _basicMessageChannel =</span><br><span class="line">      <span class="keyword">const</span> BasicMessageChannel(<span class="string">&#x27;BasicMessageChannelPlugin&#x27;</span>, StringCodec());</span><br><span class="line">...</span><br><span class="line"><span class="comment">//使用BasicMessageChannel接受来自Native的消息，并向Native回复</span></span><br><span class="line">_basicMessageChannel</span><br><span class="line">    .setMessageHandler((<span class="built_in">String</span> message) =&gt; Future&lt;<span class="built_in">String</span>&gt;(() &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            showMessage = message;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;收到Native的消息：&quot;</span> + message;</span><br><span class="line">        &#125;));</span><br><span class="line"><span class="comment">//使用BasicMessageChannel向Native发送消息，并接受Native的回复</span></span><br><span class="line"><span class="built_in">String</span> response;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   response = <span class="keyword">await</span> _basicMessageChannel.send(value);</span><br><span class="line">&#125; <span class="keyword">on</span> PlatformException <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">print</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://git.imooc.com/coding-321/flutter_trip">实例源码下载</a></p><h3 id="MethodChannel用法"><a href="#MethodChannel用法" class="headerlink" title="MethodChannel用法"></a>MethodChannel用法</h3><h4 id="Native端：-1"><a href="#Native端：-1" class="headerlink" title="Native端："></a>Native端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//会构造一个FlutterStandardMethodCodec类型的MethodCodec</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)methodChannelWithName:(<span class="built_in">NSString</span>*)name</span><br><span class="line">                      binaryMessenger:(<span class="built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger;</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)methodChannelWithName:(<span class="built_in">NSString</span>*)name</span><br><span class="line">binaryMessenger:(<span class="built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger</span><br><span class="line">        codec:(<span class="built_in">NSObject</span>&lt;FlutterMethodCodec&gt;*)codec;</span><br></pre></td></tr></table></figure><ul><li>  <code>FlutterBinaryMessenger* messenger</code> - 消息信使，是消息的发送与接收的工具；</li><li>  <code>NSString* name</code> - Channel的名字，也是其唯一标识符；</li><li>  <code>FlutterMethodCodec codec</code> - 用作<code>MethodChannel</code>的编解码器；</li></ul><p><strong>setMethodCallHandler方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setMethodCallHandler:(FlutterMethodCallHandler _Nullable)handler;</span><br></pre></td></tr></table></figure><ul><li>  <code>FlutterMethodCallHandler handler</code> - 消息处理器，配合BinaryMessenger完成消息的处理；</li></ul><p>在创建好MethodChannel后，需要调用它的setMessageHandler方法为其设置一个消息处理器，以便能加收来自Dart的消息。</p><p><strong>FlutterMethodCallHandler原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(FlutterMethodCall * _Nonnull call, FlutterResult  _Nonnull result)</span><br></pre></td></tr></table></figure><p>用于接受消息，call是消息内容，它有两个成员变量NSString类型的<code>call.method</code>表示调用的方法名，id 类型的<code>call.arguments</code>表示调用方法所传递的入参；<code>FlutterResult result</code>是回复此消息的回调函数；</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)initMethodChannel&#123;</span><br><span class="line">    <span class="keyword">self</span>.methodChannel = [FlutterMethodChannel methodChannelWithName:<span class="string">@&quot;MethodChannelPlugin&quot;</span> binaryMessenger:<span class="keyword">self</span>.flutterViewController];</span><br><span class="line">    MainViewController*  __<span class="keyword">weak</span> weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.methodChannel setMethodCallHandler:^(FlutterMethodCall * _Nonnull call, FlutterResult  _Nonnull result) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([<span class="string">@&quot;send&quot;</span> isEqualToString:call.method]) &#123;</span><br><span class="line">            result([<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;MethodChannelPlugin收到：%@&quot;</span>,call.arguments]);<span class="comment">//返回结果给Dart);</span></span><br><span class="line">            [weakSelf sendShow:call.arguments];</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dart端：-1"><a href="#Dart端：-1" class="headerlink" title="Dart端："></a>Dart端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MethodChannel(<span class="keyword">this</span>.name, [<span class="keyword">this</span>.codec = <span class="keyword">const</span> StandardMethodCodec()])</span><br></pre></td></tr></table></figure><ul><li>  <code>String name</code> - Channel的名字，要和Native端保持一致；</li><li>  <code>MethodCodec codec</code> - 消息的编解码器，默认是StandardMethodCodec，要和Native端保持一致；</li></ul><p><strong>invokeMethod方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;T&gt; invokeMethod&lt;T&gt;(<span class="built_in">String</span> method, [ <span class="built_in">dynamic</span> arguments ])</span><br></pre></td></tr></table></figure><ul><li>  <code>String method</code>：要调用Native的方法名；</li><li>  <code>[ dynamic arguments ]</code>：调用Native方法传递的参数，可不传；</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> MethodChannel _methodChannelPlugin =</span><br><span class="line">      <span class="keyword">const</span> MethodChannel(<span class="string">&#x27;MethodChannelPlugin&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="built_in">String</span> response;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">response = <span class="keyword">await</span> _methodChannelPlugin.invokeMethod(<span class="string">&#x27;send&#x27;</span>, value);</span><br><span class="line">    &#125; <span class="keyword">on</span> PlatformException <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><a href="https://git.imooc.com/coding-321/flutter_trip">实例源码下载</a></p><h3 id="EventChannel用法"><a href="#EventChannel用法" class="headerlink" title="EventChannel用法"></a>EventChannel用法</h3><h4 id="Native端：-2"><a href="#Native端：-2" class="headerlink" title="Native端："></a>Native端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//会构造一个FlutterStandardMethodCodec类型的MethodCodec</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)eventChannelWithName:(<span class="built_in">NSString</span>*)name</span><br><span class="line">                     binaryMessenger:(<span class="built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger;</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)eventChannelWithName:(<span class="built_in">NSString</span>*)name</span><br><span class="line">                     binaryMessenger:(<span class="built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger</span><br><span class="line">                               codec:(<span class="built_in">NSObject</span>&lt;FlutterMethodCodec&gt;*)codec;</span><br></pre></td></tr></table></figure><ul><li>  <code>FlutterBinaryMessenger* messenger</code> - 消息信使，是消息的发送与接收的工具；</li><li>  <code>NSString* name</code> - Channel的名字，也是其唯一标识符；</li><li>  <code>FlutterMethodCodec codec</code> - 用作<code>EventChannel</code>的编解码器；</li></ul><p><strong>setStreamHandler方法原型</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)setStreamHandler:(<span class="built_in">NSObject</span>&lt;FlutterStreamHandler&gt;* _Nullable)handler;</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">`FlutterStreamHandler handler` - 消息处理器，配合BinaryMessenger完成消息的处理；  </span><br><span class="line">在创建好EventChannel后，如果要让其接收Dart发来的消息，则需要调用它的`setStreamHandler`方法为其设置一个消息处理器。</span><br><span class="line"></span><br><span class="line">**FlutterStreamHandler**</span><br><span class="line">``` objc</span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">FlutterStreamHandler</span></span></span><br><span class="line">- (FlutterError* _Nullable)onListenWithArguments:(<span class="type">id</span> _Nullable)arguments eventSink:(FlutterEventSink)eventSink;</span><br><span class="line">- (FlutterError* _Nullable)onCancelWithArguments:(<span class="type">id</span> _Nullable)arguments;</span><br></pre></td></tr></table></figure><ul><li>  <code>(FlutterError* _Nullable)onListenWithArguments:(id _Nullable)arguments eventSink:(FlutterEventSink)eventSink</code> - Flutter Native监听事件时调用，<code>Object args</code>是传递的参数，<code>EventChannel.EventSink eventSink</code>是Native回调Dart时的会回调函数，<code>eventSink</code>提供<code>success</code>、<code>error</code>与<code>endOfStream</code>三个回调方法分别对应事件的不同状态；</li><li>  <code>(FlutterError* _Nullable)onCancelWithArguments:(id _Nullable)arguments</code> - Flutter取消监听时调用；</li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;MainViewController.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MainViewController</span> ()&lt;<span class="title">FlutterStreamHandler</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) FlutterViewController* flutterViewController;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) FlutterEventChannel* eventChannel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) FlutterEventSink eventSink;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainViewController</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - sendMessage</span></span><br><span class="line">- (<span class="type">void</span>)sendMessage:(<span class="built_in">NSNotification</span>*)notification&#123;</span><br><span class="line">    <span class="built_in">NSString</span>* mesage = [notification.object valueForKey:<span class="string">@&quot;message&quot;</span>];</span><br><span class="line">    <span class="comment">//用EventChannel传递数据</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.eventSink != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.eventSink(mesage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - naviagor</span></span><br><span class="line">- (<span class="type">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span>*)segue sender:(<span class="type">id</span>)sender &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([segue.destinationViewController isKindOfClass:[FlutterViewController <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.flutterViewController = segue.destinationViewController;</span><br><span class="line">        [<span class="keyword">self</span>.flutterViewController setInitialRoute:<span class="keyword">self</span>.inputParams];</span><br><span class="line">        [<span class="keyword">self</span> initChannel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - init Channel</span></span><br><span class="line">- (<span class="type">void</span>)initChannel&#123;</span><br><span class="line">    [<span class="keyword">self</span> initEventChannel];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)initEventChannel&#123;</span><br><span class="line">    <span class="keyword">self</span>.eventChannel = [FlutterEventChannel eventChannelWithName:<span class="string">@&quot;EventChannelPlugin&quot;</span> binaryMessenger:<span class="keyword">self</span>.flutterViewController];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置消息处理器，处理来自Dart的消息</span></span><br><span class="line">    [<span class="keyword">self</span>.eventChannel setStreamHandler:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - <span class="string">&lt;FlutterStreamHandler&gt;</span></span></span><br><span class="line"><span class="comment">//这个onListen是Flutter端开始监听这个channel时的回调，第二个参数 EventSink是用来传数据的载体</span></span><br><span class="line">- (FlutterError* _Nullable)onListenWithArguments:(<span class="type">id</span> _Nullable)arguments eventSink:(FlutterEventSink)eventSink &#123;</span><br><span class="line">    <span class="comment">// arguments flutter给native的参数</span></span><br><span class="line">    <span class="comment">// 回调给flutter， 建议使用实例指向，因为该block可以使用多次</span></span><br><span class="line">    <span class="keyword">self</span>.eventSink = eventSink;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// flutter不再接收</span></span><br><span class="line">- (FlutterError* _Nullable)onCancelWithArguments:(<span class="type">id</span> _Nullable)arguments &#123;</span><br><span class="line">    <span class="comment">// arguments flutter给native的参数</span></span><br><span class="line">    <span class="keyword">self</span>.eventSink = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h4 id="Dart端：-2"><a href="#Dart端：-2" class="headerlink" title="Dart端："></a>Dart端：</h4><p><strong>构造方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventChannel(<span class="keyword">this</span>.name, [<span class="keyword">this</span>.codec = <span class="keyword">const</span> StandardMethodCodec()]);</span><br></pre></td></tr></table></figure><ul><li>  <code>String name</code> - Channel的名字，要和Native端保持一致；</li><li>  <code>MethodCodec codec</code> - 消息的编解码器，默认是StandardMethodCodec，要和Native端保持一致；</li></ul><p><strong>receiveBroadcastStream方法原型</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="built_in">dynamic</span>&gt; receiveBroadcastStream([ <span class="built_in">dynamic</span> arguments ]) </span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">*   `<span class="built_in">dynamic</span> arguments` - 监听事件时向Native传递的数据；</span><br><span class="line"></span><br><span class="line">初始化一个广播流用于从channel中接收数据，它返回一个Stream接下来需要调用Stream的`listen`方法来完成注册，另外需要在页面销毁时调用Stream的`cancel`方法来取消监听；</span><br><span class="line"></span><br><span class="line">``` dart</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> EventChannel _eventChannelPlugin =</span><br><span class="line">          EventChannel(<span class="string">&#x27;EventChannelPlugin&#x27;</span>);</span><br><span class="line">StreamSubscription _streamSubscription;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  _streamSubscription=_eventChannelPlugin</span><br><span class="line">      .receiveBroadcastStream()</span><br><span class="line">      .listen(_onToDart, onError: _onToDartError);</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> dispose() &#123;</span><br><span class="line">  <span class="keyword">if</span> (_streamSubscription != <span class="keyword">null</span>) &#123;</span><br><span class="line">    _streamSubscription.cancel();</span><br><span class="line">    _streamSubscription = <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">super</span>.dispose();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> _onToDart(message) &#123;</span><br><span class="line">  setState(() &#123;</span><br><span class="line">    showMessage = message;</span><br><span class="line">  &#125;); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> _onToDartError(error) &#123;</span><br><span class="line">  <span class="built_in">print</span>(error);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="1-初始化Flutter时Native向Dart传递数据"><a href="#1-初始化Flutter时Native向Dart传递数据" class="headerlink" title="1. 初始化Flutter时Native向Dart传递数据"></a>1. 初始化Flutter时Native向Dart传递数据</h2><p><img src="https://cdn.rencheng.cc/blog/fbsog.gif"></p><p>在Flutter的API中提供了Native在初始化Dart页面时传递数据给Dart的方式，这种传递数据的方式比下文中所讲的其他几种传递数据的方式发生的时机都早。</p><p>因为很少有资料介绍这种方式，所以可能有很多同学还不知道这种方式，不过不要紧，接下来我就向大家介绍如何使用这种方式来传递数据给Dart。</p><p>Android向Flutter传递初始化数据<code>initialRoute</code></p><p>Flutter允许我们在初始化Flutter页面时向Flutter传递一个String类型的<code>initialRoute</code>参数，从参数名字它是用作路由名的，但是既然Flutter给我们开了这个口子，那我们是不是可以搞点事情啊，传递点我们想传的其他参数呢，比如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FragmentTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> getSupportFragmentManager().beginTransaction();</span><br><span class="line">tx.replace(R.id.someContainer, Flutter.createFragment(<span class="string">&quot;&#123;name:&#x27;devio&#x27;,dataList:[&#x27;aa&#x27;,&#x27;bb&#x27;,&#x27;&#x27;cc]&#125;&quot;</span>));</span><br><span class="line">tx.commit();</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="type">View</span> <span class="variable">flutterView</span> <span class="operator">=</span> Flutter.createView(</span><br><span class="line">      MainActivity.<span class="built_in">this</span>,</span><br><span class="line">      getLifecycle(),</span><br><span class="line">      <span class="string">&quot;route1&quot;</span></span><br><span class="line">    );</span><br><span class="line">FrameLayout.<span class="type">LayoutParams</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FrameLayout</span>.LayoutParams(<span class="number">600</span>, <span class="number">800</span>);</span><br><span class="line">layout.leftMargin = <span class="number">100</span>;</span><br><span class="line">layout.topMargin = <span class="number">200</span>;</span><br><span class="line">addContentView(flutterView, layout);</span><br></pre></td></tr></table></figure><p>然后在Flutter module通过如下方式获取：</p><pre><code class="dart">import &#39;dart:ui&#39;;//要使用window对象必须引入String initParams=window.defaultRouteName;//序列化成Dart obj 敢你想干的...</code></pre><p>通过上述方案的讲解是不是给大家分享了一个新的思路呢。<br>接下来，我们先来看一下如何在<code>Android</code>上来传递这些初始化数据。</p><h2 id="2-Native到Dart的通信-Native发送数据给Dart"><a href="#2-Native到Dart的通信-Native发送数据给Dart" class="headerlink" title="2. Native到Dart的通信(Native发送数据给Dart)"></a>2. Native到Dart的通信(Native发送数据给Dart)</h2><p>在Flutter 中Native向Dart传递消息可以通过<code>BasicMessageChannel</code>或<code>EventChannel</code>都可以实现：</p><h3 id="通过BasicMessageChannel的方式"><a href="#通过BasicMessageChannel的方式" class="headerlink" title="通过BasicMessageChannel的方式"></a>通过<code>BasicMessageChannel</code>的方式</h3><p><img src="https://cdn.rencheng.cc/blog/ul5ry.gif"></p><blockquote><p>如何实现？</p></blockquote><h3 id="通过EventChannel的方式"><a href="#通过EventChannel的方式" class="headerlink" title="通过EventChannel的方式"></a>通过<code>EventChannel</code>的方式</h3><p><img src="https://cdn.rencheng.cc/blog/ictvj.gif"></p><blockquote><p>如何实现？</p></blockquote><p>以上就是使用不同Channel实现Native到Dart通信的原理及方式，接下来我们来看一下实现Dart到Native之间通信的原理及方式。</p><h2 id="3-Dart到Native的通信-Dart发送数据给Native"><a href="#3-Dart到Native的通信-Dart发送数据给Native" class="headerlink" title="3. Dart到Native的通信(Dart发送数据给Native)"></a>3. Dart到Native的通信(Dart发送数据给Native)</h2><p>在Flutter 中Dart向Native传递消息可以通过<code>BasicMessageChannel</code>或<code>MethodChannel</code>都可以实现：</p><h3 id="通过BasicMessageChannel的方式-1"><a href="#通过BasicMessageChannel的方式-1" class="headerlink" title="通过BasicMessageChannel的方式"></a>通过<code>BasicMessageChannel</code>的方式</h3><p><img src="https://cdn.rencheng.cc/blog/uwndy.gif"></p><h3 id="通过MethodChannel的方式"><a href="#通过MethodChannel的方式" class="headerlink" title="通过MethodChannel的方式"></a>通过<code>MethodChannel</code>的方式</h3><p><img src="https://cdn.rencheng.cc/blog/d1dv3.gif"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在做Flutter开发的时候通常离不了Flutter和Native之间的通信，比如：初始化Flutter时Native向Dart传递数据，Dart调用Native的相册选择图片，Dart调用Native的模块进行一些复杂的计算，Native将一些数据(GPS信息，陀螺仪，传感器等)主动传递给Dart等。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - iOS集成开发</title>
    <link href="https://rencheng.cc/2020/03/02/flutter/Flutter%E4%B8%8EiOS%E9%9B%86%E6%88%90/"/>
    <id>https://rencheng.cc/2020/03/02/flutter/Flutter%E4%B8%8EiOS%E9%9B%86%E6%88%90/</id>
    <published>2020-03-02T01:48:40.000Z</published>
    <updated>2020-03-02T01:48:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>在Flutter的应用场景中，有时候一个APP只有部分页面是由Flutter实现的，比如：我们常用的闲鱼App，它宝贝详情页面是由Flutter实现的，这种开发模式被称为混合开发。</p><span id="more"></span><p><strong>混合开发的一些其他应用场景：</strong></p><ul><li><p>在原有项目中加入Flutter页面，在Flutter项目中加入原生页面</p><p>  <img src="https://cdn.rencheng.cc/blog/oxz8q.png"></p></li><li><p>原生页面中嵌入Flutter模块</p><p>  <img src="https://cdn.rencheng.cc/blog/ve7f0.png" alt="FlutterHybrid"></p></li></ul><ul><li><p>Flutter页面中嵌入原生模块</p><p>  <img src="https://cdn.rencheng.cc/blog/fw7be.png"></p></li></ul><h2 id="Flutter-混编方案介绍"><a href="#Flutter-混编方案介绍" class="headerlink" title="Flutter 混编方案介绍"></a>Flutter 混编方案介绍</h2><p>如果你想要在已有的原生 App 里嵌入一些 Flutter 页面，有两个办法：</p><ul><li>将原生工程作为 Flutter 工程的子工程，由 Flutter 统一管理。这种模式，就是统一管理模式。</li><li>将 Flutter 工程作为原生工程共用的子模块，维持原有的原生工程管理方式不变。这种模式，就是三端分离模式。<br><img src="https://cdn.rencheng.cc/blog/mj1jq.jpg"><br>由于 Flutter 早期提供的混编方式能力及相关资料有限，国内较早使用 Flutter 混合开发的团队大多使用的是统一管理模式。但是，随着功能迭代的深入，这种方案的弊端也随之显露，不仅三端（Android、iOS、Flutter）代码耦合严重，相关工具链耗时也随之大幅增长，导致开发效率降低。<br>所以，后续使用 Flutter 混合开发的团队陆续按照三端代码分离的模式来进行依赖治理，实现了 Flutter 工程的轻量级接入。<br>除了可以轻量级接入，<strong>三端代码分离模式</strong>把 Flutter 模块作为原生工程的子模块，还可以快速实现 Flutter 功能的“热插拔”，降低原生工程的改造成本。而 Flutter 工程通过 Android Studio 进行管理，无需打开原生工程，可直接进行 Dart 代码和原生代码的开发调试。<br>三端工程分离模式的关键是抽离 Flutter 工程，将不同平台的构建产物依照标准组件化的形式进行管理，即 Android 使用 aar、iOS 使用 pod。换句话说，接下来介绍的混编方案会将 Flutter 模块打包成 aar 和 pod，这样原生工程就可以像引用其他第三方原生组件库那样快速接入 Flutter 了。</li></ul><p><strong>将Flutter集成到现有的iOS应用中需要如下几个主要步骤：</strong></p><ul><li>  创建Flutter module；</li><li>  为已存在的iOS应用添加Flutter module依赖；</li><li>  在Object-c中调用Flutter module；</li><li>  编写Dart代码；</li><li>  运行项目；</li><li>  热重启/重新加载；</li><li>  调试Dart代码；</li><li>  发布应用；</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- flutter_hybrid</span><br><span class="line">    - flutter_module</span><br><span class="line">    - FlutterHybridAndroid </span><br><span class="line">    - FlutterHybridiOS</span><br></pre></td></tr></table></figure><p><code>flutter_hybrid</code>下面分别是<code>flutter模块</code>，<code>原生Android模块</code>，与<code>原生iOS模块</code>，并且这三个模块时并列结构</p><h3 id="创建Flutter-module"><a href="#创建Flutter-module" class="headerlink" title="创建Flutter module"></a>创建Flutter module</h3><p>在做混合开发之前我们首先需要创建一个Flutter module。</p><p>假如你的Native项目是这样的：<code>xxx/flutter_hybrid/FlutterHybridiOS</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> xxx/flutter_hybrid/</span><br><span class="line">$ flutter create -t module flutter_module</span><br></pre></td></tr></table></figure><p>上面代码会切换到你的iOS项目的上一级目录，并创建一个flutter模块：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.android</span><br><span class="line">.gitignore</span><br><span class="line">.idea</span><br><span class="line">.ios</span><br><span class="line">.metadata</span><br><span class="line">.packages</span><br><span class="line">build</span><br><span class="line">flutter_module_android.iml</span><br><span class="line">flutter_module.iml</span><br><span class="line">lib</span><br><span class="line">pubspec.lock</span><br><span class="line">pubspec.yaml</span><br><span class="line">README.md</span><br><span class="line">test</span><br></pre></td></tr></table></figure><p>上面是<code>flutter_module</code>中的文件结构，你会发现它里面包含<code>.android</code>与<code>.ios</code>，这两个文件夹是隐藏文件，也是这个<code>flutter_module</code>宿主工程：</p><ul><li>  <code>.android</code> - <code>flutter_module</code>的Android宿主工程；</li><li>  <code>.ios</code> - <code>flutter_module</code>的iOS宿主工程；</li><li>  <code>lib</code> - <code>flutter_module</code>的Dart部分的代码；</li><li>  <code>pubspec.yaml</code> - <code>flutter_module</code>的项目依赖配置文件；</li></ul><blockquote><p>因为宿主工程的存在，我们这个<code>flutter_module</code>在不加额外的配置的情况下是可以独立运行的，通过安装了Flutter与Dart插件的AndroidStudio打开这个<code>flutter_module</code>项目，通过运行按钮是可以直接运行它的。</p></blockquote><h3 id="为已存在的iOS应用添加Flutter-module依赖"><a href="#为已存在的iOS应用添加Flutter-module依赖" class="headerlink" title="为已存在的iOS应用添加Flutter module依赖"></a>为已存在的iOS应用添加Flutter module依赖</h3><p>接下来我们需要配置我们iOS项目的Flutter module依赖，接下来的配置需要用到CocoaPods，如果你还没有用到CocoaPods，可以参考<a href="https://cocoapods.org/">https://cocoapods.org/</a>上面的说明来安装CocoaPods。</p><h4 id="在Podfile文件中添加flutter依赖"><a href="#在Podfile文件中添加flutter依赖" class="headerlink" title="在Podfile文件中添加flutter依赖"></a>在<code>Podfile</code>文件中添加<code>flutter</code>依赖</h4><ol><li>如果你的iOS项目中没有<code>Podfile</code>文件可以通过： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod init</span><br></pre></td></tr></table></figure></li><li>找到<code>Podfile</code>文件，填入依赖信息<br> 版本的新旧，依赖信息引入的方式也不同<ol><li>Flutter &gt;= v1.10.14 版本添加的配置： <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter_application_path = <span class="string">&#x27;path/to/my_flutter/&#x27;</span></span><br><span class="line">load <span class="title class_">File</span>.join(flutter_application_path, <span class="string">&#x27;.ios&#x27;</span>, <span class="string">&#x27;Flutter&#x27;</span>, <span class="string">&#x27;podhelper.rb&#x27;</span>)</span><br><span class="line">install_all_flutter_pods(flutter_application_path)</span><br></pre></td></tr></table></figure> 下面是博主的配置：请参考 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">flutter_application_path = <span class="string">&#x27;../flutter_module/&#x27;</span></span><br><span class="line">load <span class="title class_">File</span>.join(flutter_application_path, <span class="string">&#x27;.ios&#x27;</span>, <span class="string">&#x27;Flutter&#x27;</span>, <span class="string">&#x27;podhelper.rb&#x27;</span>)</span><br><span class="line">target <span class="string">&#x27;FlutterHybridiOS&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># Step2 添加</span></span><br><span class="line">  install_all_flutter_pods(flutter_application_path)</span><br><span class="line"></span><br><span class="line">  target <span class="string">&#x27;FlutterHybridiOSTests&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    inherit! <span class="symbol">:search_paths</span></span><br><span class="line">    <span class="comment"># Pods for testing</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  target <span class="string">&#x27;FlutterHybridiOSUITests&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    inherit! <span class="symbol">:search_paths</span></span><br><span class="line">    <span class="comment"># Pods for testing</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li>老版本Flutter,<code>Podfile</code>配置<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter_application_path = <span class="string">&#x27;path/to/my_flutter/&#x27;</span></span><br><span class="line">  eval(<span class="title class_">File</span>.read(<span class="title class_">File</span>.join(flutter_application_path, <span class="string">&#x27;.ios&#x27;</span>, <span class="string">&#x27;Flutter&#x27;</span>, <span class="string">&#x27;podhelper.rb&#x27;</span>)), binding)</span><br></pre></td></tr></table></figure>下面是博主的配置：请参考<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">target <span class="string">&#x27;FlutterHybridiOS&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  flutter_application_path = <span class="string">&#x27;../flutter_module/&#x27;</span></span><br><span class="line">  eval(<span class="title class_">File</span>.read(<span class="title class_">File</span>.join(flutter_application_path, <span class="string">&#x27;.ios&#x27;</span>, <span class="string">&#x27;Flutter&#x27;</span>, <span class="string">&#x27;podhelper.rb&#x27;</span>)), binding)</span><br><span class="line"></span><br><span class="line">  target <span class="string">&#x27;FlutterHybridiOSTests&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    inherit! <span class="symbol">:search_paths</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  target <span class="string">&#x27;FlutterHybridiOSUITests&#x27;</span> <span class="keyword">do</span></span><br><span class="line">    inherit! <span class="symbol">:search_paths</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><p><strong>除此之外，老版本flutter还需要添加 build phase以构建Dart代码</strong></p><p><img src="https://cdn.rencheng.cc/blog/1dl8f.png"></p><p>根据上图的提示创建一个<code>build phase</code>，然后展开<code>Run Script</code>并添加下面配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;<span class="variable">$FLUTTER_ROOT</span>/packages/flutter_tools/bin/xcode_backend.sh&quot;</span> build</span><br><span class="line"><span class="string">&quot;<span class="variable">$FLUTTER_ROOT</span>/packages/flutter_tools/bin/xcode_backend.sh&quot;</span> embed</span><br></pre></td></tr></table></figure><p><img src="https://cdn.rencheng.cc/blog/arrk0.png"></p><p>最后记得根据上图的提示，将<code>Run Script</code>到<strong>紧挨着</strong><code>Target Dependencies phase</code>的下面，接下来就可以通过<code>⌘B</code>构建你的项目了。</p><blockquote><p>通过<code>flutter doctor</code>命令查看你的Flutter版本，不同Flutter版本需要添加的配置是不同的：</p></blockquote><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>在iOS项目的根目录运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure><p>你会看到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pod install </span><br><span class="line">Analyzing dependencies</span><br><span class="line">Fetching podspec <span class="keyword">for</span> `Flutter` from `../flutter_module/.ios/Flutter/engine`</span><br><span class="line">Fetching podspec <span class="keyword">for</span> `FlutterPluginRegistrant` from `../flutter_module/.ios/Flutter/FlutterPluginRegistrant`</span><br><span class="line">Downloading dependencies</span><br><span class="line">Installing Flutter (1.0.0)</span><br><span class="line">Installing FlutterPluginRegistrant (0.0.1)</span><br><span class="line">Generating Pods project</span><br><span class="line">Integrating client project</span><br><span class="line"></span><br><span class="line">[!] Please close any current Xcode sessions and use `FlutterHybridiOS.xcworkspace` <span class="keyword">for</span> this project from now on.</span><br><span class="line">Sending stats</span><br><span class="line">Pod installation complete! There are 2 dependencies from the Podfile and 2 total pods installed.</span><br><span class="line"></span><br><span class="line">[!] Automatically assigning platform `ios` with version `12.1` on target `FlutterHybridiOS` because no platform was specified. Please specify a platform <span class="keyword">for</span> this target <span class="keyword">in</span> your Podfile. See `https://guides.cocoapods.org/syntax/podfile.html<span class="comment">#platform`.</span></span><br></pre></td></tr></table></figure><p>当你在<code>flutter_module/pubspec.yaml</code>添加一个Flutter插件时，需要在<code>flutter_module</code>目录下运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter packages get</span><br></pre></td></tr></table></figure><p>来刷新<code>podhelper.rb</code>脚本中插件列表，然后在iOS目录下运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure><p>这样以来<code>podhelper.rb</code>脚本才能确保你的插件和Flutter.framework能够添加到你的iOS项目中。</p><h4 id="禁用Bitcode"><a href="#禁用Bitcode" class="headerlink" title="禁用Bitcode"></a>禁用Bitcode</h4><p>目前Flutter还不支持Bitcode，所以集成了Flutter的iOS项目需要禁用Bitcode：</p><p>用XCode打开你的项目如：<code>xxx.xcworkspace</code>：</p><p>然后在：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Build Settings-&gt;Build Options-&gt;Enable Bitcode</span><br></pre></td></tr></table></figure><p>目录下中禁用Bitcode：</p><p><img src="https://cdn.rencheng.cc/blog/uzrrv.png"></p><blockquote><p>如果在这个过程中遇到问题可以查看<a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#under-the-hood">Under the hood</a>文档。</p></blockquote><h3 id="在Object-c中调用Flutter-module"><a href="#在Object-c中调用Flutter-module" class="headerlink" title="在Object-c中调用Flutter module"></a>在Object-c中调用Flutter module</h3><p>至此，我们已经为我们的iOS项目添加了Flutter所必须的依赖，接下来我们来看如何在Object-c中调用Flutter模块：</p><p>在Object-c中调用Flutter模块有两种方式：</p><ul><li>  直接使用<code>FlutterViewController</code>的方式；</li><li>  使用<code>FlutterEngine</code>的方式；</li></ul><h4 id="FlutterViewController"><a href="#FlutterViewController" class="headerlink" title="FlutterViewController"></a>FlutterViewController</h4><pre><code>// ⁨flutter_hybrid⁩ ▸ ⁨FlutterHybridiOS⁩ ▸ ⁨FlutterHybridiOS⁩ ▸ ViewController.m #import &lt;Flutter/Flutter.h&gt;#import &quot;AppDelegate.h&quot;#import &quot;ViewController.h&quot;#import &lt;FlutterPluginRegistrant/GeneratedPluginRegistrant.h&gt; // 如果你需要用到Flutter插件时FlutterViewController *flutterViewController = [FlutterViewController new];GeneratedPluginRegistrant.register(with: flutterViewController);//如果你需要用到Flutter插件时[flutterViewController setInitialRoute:@&quot;route1&quot;];    [self presentViewController:flutterViewController animated:true completion:nil];</code></pre><p><a href="https://git.imooc.com/coding-321/flutter_trip/src/master/demo/flutter_hybrid">实例源码下载</a></p><p>通过这种方式我们可以使用<code>flutterViewController setInitialRoute</code>的方法为传递了字符串“route1”来告诉Dart代码在Flutter视图中显示哪个小部件。 Flutter模块项目的<code>lib/main.dart</code>文件需要通过<code>window.defaultRouteName</code>来获取Native指定要显示的路由名，以确定要创建哪个窗口小部件并传递给runApp：</p><pre><code>import &#39;dart:ui&#39;;import &#39;package:flutter/material.dart&#39;;void main() =&gt; runApp(_widgetForRoute(window.defaultRouteName));Widget _widgetForRoute(String route) &#123;  switch (route) &#123;    case &#39;route1&#39;:      return SomeWidget(...);    case &#39;route2&#39;:      return SomeOtherWidget(...);    default:      return Center(        child: Text(&#39;Unknown route: $route&#39;, textDirection: TextDirection.ltr),      );  &#125;&#125;</code></pre><p><a href="https://git.imooc.com/coding-321/flutter_trip/src/master/demo/flutter_hybrid">实例源码下载</a></p><h4 id="FlutterEngine"><a href="#FlutterEngine" class="headerlink" title="FlutterEngine"></a>FlutterEngine</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&lt;Flutter/Flutter.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> : <span class="title">FlutterAppDelegate</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) FlutterEngine *flutterEngine;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.m</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&lt;FlutterPluginRegistrant/GeneratedPluginRegistrant.h&gt; // 如果你需要用到Flutter插件时</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AppDelegate.h&quot;</span></span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line">- (<span class="type">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">self</span>.flutterEngine = [[FlutterEngine alloc] initWithName:<span class="string">@&quot;io.flutter&quot;</span> project:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">self</span>.flutterEngine runWithEntrypoint:<span class="literal">nil</span>];</span><br><span class="line">    [GeneratedPluginRegistrant registerWithRegistry:<span class="keyword">self</span>.flutterEngine]; <span class="comment">//如果你需要用到Flutter插件时</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="variable language_">super</span> application:application didFinishLaunchingWithOptions:launchOptions];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>如果你的项目的AppDelegate.h已经有了别的集成，那么可惨参考<a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#write-code-to-use-flutterviewcontroller-from-your-host-app">实现FlutterAppLifeCycleProvider的方式</a>进行配置。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ⁨flutter_hybrid⁩ ▸ ⁨FlutterHybridiOS⁩ ▸ ⁨FlutterHybridiOS⁩ ▸ ViewController.m </span></span><br><span class="line">    </span><br><span class="line">FlutterEngine *flutterEngine = [(AppDelegate *)[[<span class="built_in">UIApplication</span> sharedApplication] delegate] flutterEngine];</span><br><span class="line">FlutterViewController *flutterViewController = [[FlutterViewController alloc] initWithEngine:flutterEngine nibName:<span class="literal">nil</span> bundle:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span> presentViewController:flutterViewController animated:<span class="literal">false</span> completion:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><blockquote><p>因为我们在AppDelegate.m中提前初始化了<code>FlutterEngine</code>，所以这种方式打开一个Flutter模块的速度要比第一种方式要快一些。</p></blockquote><h4 id="调用Flutter-module时传递数据"><a href="#调用Flutter-module时传递数据" class="headerlink" title="调用Flutter module时传递数据"></a>调用Flutter module时传递数据</h4><p>在上文中，我们无论是通过直接使用<code>FlutterViewController</code>的方式还是通过<code>FlutterEngine</code>的方式，都允许我们在加载Flutter module时传递一个String类型的<code>initialRoute</code>参数，从参数名字它是用作路由名的，但是既然Flutter给我们开了这个口子，那我们是不是可以搞点事情啊，传递点我们想传的其他参数呢，比如：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[flutterViewController setInitialRoute:<span class="string">@&quot;&#123;name:&#x27;devio&#x27;,dataList:[&#x27;aa&#x27;,&#x27;bb&#x27;,&#x27;&#x27;cc]&#125;&quot;</span>];</span><br></pre></td></tr></table></figure><p>然后在Flutter module通过如下方式获取：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:ui&#x27;</span>;<span class="comment">//要使用window对象必须引入</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span> initParams=<span class="built_in">window</span>.defaultRouteName;</span><br><span class="line"><span class="comment">//序列化成Dart obj 敢你想干的</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>通过上述方案的讲解是不是给大家分享了一个新的思路呢。</p><blockquote><p>注意使用<code>FlutterEngine</code>的方式中调用<code>setInitialRoute</code>会无效，你会发现Dart拿到的永远是“/”，这个是Fltter SDK的一个<a href="https://github.com/flutter/flutter/issues/27216">Bug</a>，所以如果必须依赖<code>setInitialRoute</code>那么请使用方式一的形式；</p></blockquote><h4 id="编写Dart代码"><a href="#编写Dart代码" class="headerlink" title="编写Dart代码"></a>编写Dart代码</h4><p>接下来就是在编写Flutter module中的lib下编写Dart带了，快去<code>Enjoy Coding</code>吧！！！</p><h4 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h4><p>接下来，我们就可以运行它了，经过上述步骤，我们就可以以运行普通iOS项目的方式来通过XCode运行一个集成了Flutter的iOS项目了。</p><p><img src="https://cdn.rencheng.cc/blog/au9nm.png"></p><h3 id="热重启-重新加载"><a href="#热重启-重新加载" class="headerlink" title="热重启/重新加载"></a>热重启/重新加载</h3><p>大家知道我们在做Flutter开发的时候，它带有热重启/重新加载的功能，但是你可能会发现，混合开发中在iOS项目中集成了Flutter项目，Flutter的热重启/重新加载功能好像失效了，那怎么启用混合开发汇总Flutter的热重启/重新加载呢：</p><ul><li>  打开一个模拟器，或连接一个设备到电脑上；</li><li>  <strong>关闭我们的APP</strong>，然后运行<code>flutter attach</code>；</li></ul><p><img src="https://cdn.rencheng.cc/blog/sjte9.gif"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cd flutter_hybrid/flutter_module</span><br><span class="line">$ flutter attach</span><br><span class="line"></span><br><span class="line">Checking for advertised Dart observatories...</span><br><span class="line">Waiting for a connection from Flutter on iPhone X...</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 注意 </span><br><span class="line">如果，你同时有多个模拟器或连接的设备，运行`flutter attach`会提示你选择一个设备：</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Android SDK built for x86 • emulator-5554                        • android-x86 • Android 8.1.0 (API 27) (emulator)<br>iPhone X                  • 3E3FA943-715F-482F-B003-D46F5902C56C • ios         • iOS 12.1 (simulator)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接下来我们需要`flutter attach -d`来指定一个设备：</span><br><span class="line">``` bash</span><br><span class="line">flutter attach -d &#x27;emulator-5554&#x27;</span><br></pre></td></tr></table></figure><p>注意<code>-d</code>后面跟的设备ID。</p><p>运行APP，然后你会看到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ flutter attach</span><br><span class="line">More than one device connected; please specify a device with the &#x27;-d &lt;deviceId&gt;&#x27; flag, or use &#x27;-d all&#x27; to act on all devices.</span><br><span class="line">    </span><br><span class="line">Android SDK built for x86 • emulator-5554                        • android-x86 • Android 8.1.0 (API 27) (emulator)</span><br><span class="line">iPhone X                  • 3E3FA943-715F-482F-B003-D46F5902C56C • ios         • iOS 12.1 (simulator)</span><br><span class="line">renchengdeMacBook-Pro:flutter_module jph$ flutter attach -d &#x27;3E3FA943-715F-482F-B003-D46F5902C56C&#x27;</span><br><span class="line">Checking for advertised Dart observatories...</span><br><span class="line">Waiting for a connection from Flutter on iPhone X...</span><br><span class="line">Done.</span><br><span class="line">Syncing files to device iPhone X...                              1,613ms</span><br><span class="line">    </span><br><span class="line">?  To hot reload changes while running, press &quot;r&quot;. To hot restart (and rebuild state), press &quot;R&quot;.</span><br><span class="line">An Observatory debugger and profiler on iPhone X is available at: http://127.0.0.1:64108/</span><br><span class="line">For a more detailed help message, press &quot;h&quot;. To detach, press &quot;d&quot;; to quit, press &quot;q&quot;.</span><br></pre></td></tr></table></figure><p>说明连接成功了，接下来就可以通过上面的提示来进行热加载/热重启了，在终端输入：</p><ul><li>  r : 热加载；</li><li>  R : 热重启；</li><li>  h : 获取帮助；</li><li>  d : 断开连接；</li></ul><h3 id="调试Dart代码"><a href="#调试Dart代码" class="headerlink" title="调试Dart代码"></a>调试Dart代码</h3><p>混合开发的模式下，如何更好更高效的调试我们的代码呢，接下来我就跟大家分享一种混合开发模式下高效调试代码的方式：</p><ul><li><p>  <strong>关闭APP</strong>(这步很关键)</p></li><li><p>  点击AndroidStudio的<code>Flutter Attach</code>按钮(需要首先安装Flutter与Dart插件)</p></li><li><p>启动APP</p><p>  <img src="https://cdn.rencheng.cc/blog/uyu3j.png"></p></li></ul><p>接下来就可以像调试普通Flutter项目一样来调试混合开发的模式下的Dart代码了。</p><blockquote><p>除了以上步骤不同之外，接下来的调试和我们之前课程中的Flutter调试技巧都是通用的。<br>大家在运行iOS工程时一定要用Xcode运行，因为Flutter模式下的AndroidStudio运行的是Flutter module下的<code>.ios</code>中的iOS工程。</p></blockquote><h3 id="发布应用"><a href="#发布应用" class="headerlink" title="发布应用"></a>发布应用</h3><p>发布iOS应用我们需要有一个99美元的账号用于将App上传到AppStore，或者是299美元的企业级账号用于将App发布到自己公司的服务器或第三方公司的服务器。</p><p>接下来我们就需要:</p><ol><li>申请APPID</li><li>在Tunes Connect创建应用</li><li>打包程序</li><li>将应用提交到app store</li><li>等步骤。</li></ol><p>因为<a href="https://developer.apple.com/library/content/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/Chapters/About.html#//apple_ref/doc/uid/TP40011225-CH1-SW1">官方文档</a>中有详细的说明，在这我就不再重复了。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在Flutter的应用场景中，有时候一个APP只有部分页面是由Flutter实现的，比如：我们常用的闲鱼App，它宝贝详情页面是由Flutter实现的，这种开发模式被称为混合开发。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 列表实现</title>
    <link href="https://rencheng.cc/2020/02/27/flutter/Flutter%E5%88%97%E8%A1%A8/"/>
    <id>https://rencheng.cc/2020/02/27/flutter/Flutter%E5%88%97%E8%A1%A8/</id>
    <published>2020-02-27T08:33:47.000Z</published>
    <updated>2020-02-27T08:33:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>列表布局在手机上是最最常用的控件了。iOS的UITableView和Android上的RecycleView尤其的强大。<br>Flutter中也给我们提供了ListView，就目前的体验来看，流畅度跟原生的比还是有一点差距的，滑动起来还是丢帧。</p><span id="more"></span>    <h2 id="基于ListView实现水平和垂直方式滚动的列表"><a href="#基于ListView实现水平和垂直方式滚动的列表" class="headerlink" title="基于ListView实现水平和垂直方式滚动的列表"></a>基于ListView实现水平和垂直方式滚动的列表</h2><ul><li>如何实现垂直滚动的列表？</li><li>如何实现水平滚动列表？</li></ul><h3 id="如何实现垂直滚动列表？"><a href="#如何实现垂直滚动列表？" class="headerlink" title="如何实现垂直滚动列表？"></a>如何实现垂直滚动列表？</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"><span class="keyword">const</span> CITY_NAMES = [ <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;苏州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;郑州&#x27;</span>, <span class="string">&#x27;洛阳&#x27;</span>, <span class="string">&#x27;厦门&#x27;</span>, <span class="string">&#x27;青岛&#x27;</span>, <span class="string">&#x27;拉萨&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;Basic List&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: ListView(</span><br><span class="line">          children: _buildList(),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildList() &#123;</span><br><span class="line">    <span class="keyword">return</span> CITY_NAMES.map((city) =&gt; _item(city)).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _item(<span class="built_in">String</span> city) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">80</span>,</span><br><span class="line">      margin: EdgeInsets.only(bottom: <span class="number">5</span>),</span><br><span class="line">      alignment: Alignment.center,</span><br><span class="line">      decoration: BoxDecoration(color: Colors.teal),</span><br><span class="line">      child: Text(</span><br><span class="line">        city,</span><br><span class="line">        style: TextStyle(color: Colors.white, fontSize: <span class="number">20</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="如何实现水平滚动列表？"><a href="#如何实现水平滚动列表？" class="headerlink" title="如何实现水平滚动列表？"></a>如何实现水平滚动列表？</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"><span class="keyword">const</span> CITY_NAMES = [ <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;苏州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;郑州&#x27;</span>, <span class="string">&#x27;洛阳&#x27;</span>, <span class="string">&#x27;厦门&#x27;</span>, <span class="string">&#x27;青岛&#x27;</span>, <span class="string">&#x27;拉萨&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;水平&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: Container(</span><br><span class="line">          height: <span class="number">200</span>,</span><br><span class="line">          child: ListView(</span><br><span class="line">            scrollDirection: Axis.horizontal,</span><br><span class="line">            children: _buildList(),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildList() &#123;</span><br><span class="line">    <span class="keyword">return</span> CITY_NAMES.map((city) =&gt; _item(city)).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _item(<span class="built_in">String</span> city) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: <span class="number">160</span>,</span><br><span class="line">      margin: EdgeInsets.only(right: <span class="number">5</span>),</span><br><span class="line">      alignment: Alignment.center,</span><br><span class="line">      decoration: BoxDecoration(color: Colors.teal),</span><br><span class="line">      child: Text(</span><br><span class="line">        city,</span><br><span class="line">        style: TextStyle(color: Colors.white, fontSize: <span class="number">20</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="下拉刷新与上拉加载"><a href="#下拉刷新与上拉加载" class="headerlink" title="下拉刷新与上拉加载"></a>下拉刷新与上拉加载</h2><ul><li>如何实现列表下拉刷新？</li><li>如何实现上拉加载更多？</li></ul><h3 id="如何实现列表下拉刷新？"><a href="#如何实现列表下拉刷新？" class="headerlink" title="如何实现列表下拉刷新？"></a>如何实现列表下拉刷新？</h3><p>在Flutter中有一个<code>RefreshIndicator</code>，它是一个下拉刷新的widget，通过它我们可以实现列表的下拉刷新。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; cityNames = [ <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;苏州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;郑州&#x27;</span>, <span class="string">&#x27;洛阳&#x27;</span>, <span class="string">&#x27;厦门&#x27;</span>, <span class="string">&#x27;青岛&#x27;</span>, <span class="string">&#x27;拉萨&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyAppState createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;高级功能列表下拉刷新与上拉加载更多功能实现&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: RefreshIndicator(</span><br><span class="line">          onRefresh: _handleRefresh,</span><br><span class="line">          child: ListView(</span><br><span class="line">            children: _buildList(),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">Null</span>&gt; _handleRefresh() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">2</span>));</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      cityNames = cityNames.reversed.toList();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildList() &#123;</span><br><span class="line">    <span class="keyword">return</span> cityNames.map((city) =&gt; _item(city)).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _item(<span class="built_in">String</span> city) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">80</span>,</span><br><span class="line">      margin: EdgeInsets.only(bottom: <span class="number">5</span>),</span><br><span class="line">      alignment: Alignment.center,</span><br><span class="line">      decoration: BoxDecoration(color: Colors.teal),</span><br><span class="line">      child: Text(</span><br><span class="line">        city,</span><br><span class="line">        style: TextStyle(color: Colors.white, fontSize: <span class="number">20</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如何实现上拉加载更多？<br>为了给列表添加上了加载更多的功能，我们可以借助<code>ScrollController</code>，列表支持设置<code>controller</code>参数，通过<code>ScrollController</code>监听列表滚动的位置，来实现加载更多的功能。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; cityNames = [ <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;苏州&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;郑州&#x27;</span>, <span class="string">&#x27;洛阳&#x27;</span>, <span class="string">&#x27;厦门&#x27;</span>, <span class="string">&#x27;青岛&#x27;</span>, <span class="string">&#x27;拉萨&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyAppState createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  ScrollController _scrollController = ScrollController();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    _scrollController.addListener(() &#123;</span><br><span class="line">      <span class="keyword">if</span> (_scrollController.position.pixels ==</span><br><span class="line">          _scrollController.position.maxScrollExtent) &#123;</span><br><span class="line">        _loadData();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _scrollController.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;高级功能列表下拉刷新与上拉加载更多功能实现&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: RefreshIndicator(</span><br><span class="line">          onRefresh: _handleRefresh,</span><br><span class="line">          child: ListView(</span><br><span class="line">            controller: _scrollController,</span><br><span class="line">            children: _buildList(),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _loadData() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(milliseconds: <span class="number">200</span>));</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; list = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.from(cityNames);</span><br><span class="line">      list.addAll(cityNames);</span><br><span class="line">      cityNames = list;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">Null</span>&gt; _handleRefresh() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">2</span>));</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      cityNames = cityNames.reversed.toList();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _buildList() &#123;</span><br><span class="line">    <span class="keyword">return</span> cityNames.map((city) =&gt; _item(city)).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _item(<span class="built_in">String</span> city) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">80</span>,</span><br><span class="line">      margin: EdgeInsets.only(bottom: <span class="number">5</span>),</span><br><span class="line">      alignment: Alignment.center,</span><br><span class="line">      decoration: BoxDecoration(color: Colors.teal),</span><br><span class="line">      child: Text(</span><br><span class="line">        city,</span><br><span class="line">        style: TextStyle(color: Colors.white, fontSize: <span class="number">20</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;列表布局在手机上是最最常用的控件了。iOS的UITableView和Android上的RecycleView尤其的强大。&lt;br&gt;Flutter中也给我们提供了ListView，就目前的体验来看，流畅度跟原生的比还是有一点差距的，滑动起来还是丢帧。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 异步编程</title>
    <link href="https://rencheng.cc/2020/02/25/flutter/Flutter%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"/>
    <id>https://rencheng.cc/2020/02/25/flutter/Flutter%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</id>
    <published>2020-02-25T12:46:16.000Z</published>
    <updated>2020-02-25T12:46:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>首先<code>Dart</code>是一门单线程的语言，那么Dart对异步操作对支持，可以使我们在编写Dart程序时可以异步的来执行耗时操作。从而可以在等待一个操作完成的同时进行别的操作以下是一些常见的异步操作：</p><ul><li>通过网络获取数据。</li><li>写入数据库。</li><li>从文件读取数据。</li></ul><p>要在Dart中执行异步操作，可以使用Future类和async/await关键字。</p><span id="more"></span>    <h2 id="Dart的事件循环-event-loop"><a href="#Dart的事件循环-event-loop" class="headerlink" title="Dart的事件循环(event loop)"></a>Dart的事件循环(event loop)</h2><p>在Dart中，实际上有两种队列：</p><ol><li>事件队列(event queue)，包含所有的外来事件：I/O、mouse events、drawing events、timers、isolate之间的信息传递。</li><li>微任务队列(microtask queue)，表示一个短时间内就会完成的异步任务。它的优先级最高，高于event queue，只要队列中还有任务，就可以一直霸占着事件循环。microtask queue添加的任务主要是由Dart内部产生。</li></ol><blockquote><p>因为<code>microtask queue</code>的优先级高于<code>event queue</code>，所以如果<code>microtask queue</code>有太多的微任务， 那么就可能会霸占住当前的<code>event loop</code>。从而对event queue中的触摸、绘制等外部事件造成阻塞卡顿。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;首先&lt;code&gt;Dart&lt;/code&gt;是一门单线程的语言，那么Dart对异步操作对支持，可以使我们在编写Dart程序时可以异步的来执行耗时操作。从而可以在等待一个操作完成的同时进行别的操作以下是一些常见的异步操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过网络获取数据。&lt;/li&gt;
&lt;li&gt;写入数据库。&lt;/li&gt;
&lt;li&gt;从文件读取数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;要在Dart中执行异步操作，可以使用Future类和async/await关键字。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - Future与FutureBuilder实用技巧</title>
    <link href="https://rencheng.cc/2020/02/24/flutter/Flutter%E5%BC%82%E6%AD%A5/"/>
    <id>https://rencheng.cc/2020/02/24/flutter/Flutter%E5%BC%82%E6%AD%A5/</id>
    <published>2020-02-24T12:46:16.000Z</published>
    <updated>2020-02-24T12:46:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们知道Dart语言的执行环境是”单线程”。也就是指一次只能完成一件任务。如果有多个任务，就必须排队，前面一个任务完成，再执行后面一个任务。</p><p>为了解决这个问题，Dart语言将任务的执行模式分成两种：同步和异步。</p><span id="more"></span>    <h1 id="异步：Future与FutureBuilder实用技巧"><a href="#异步：Future与FutureBuilder实用技巧" class="headerlink" title="异步：Future与FutureBuilder实用技巧"></a>异步：Future与FutureBuilder实用技巧</h1><ul><li>什么是Future？</li><li>Future的常见用法？<ul><li>获取Future的结果？</li><li>捕获Future的异常？</li><li>结合async，await？</li><li>future.whenComplete？</li><li>future.timeout？</li></ul></li><li>什么是FutureBuilder？</li><li>FutureBuilder常见的用法？</li></ul><h2 id="什么是Future？"><a href="#什么是Future？" class="headerlink" title="什么是Future？"></a>什么是Future？</h2><p><code>Future</code>表示在接下来的某个时间的值或错误，借助<code>Future</code>我们可以在Flutter实现异步操作。</p><blockquote><p>它类似于ES6中的Promise，提供<code>then</code>和<code>catchError</code>的链式调用；</p></blockquote><p><code>Future</code>是<code>dart:async</code>包中的一个类，使用它时需要导入<code>dart:async</code>包，Future有两种状态：</p><ul><li>pending - 执行中；</li><li>completed - 执行结束，分两种情况要么成功要么失败；</li></ul><h2 id="Future的常见用法？"><a href="#Future的常见用法？" class="headerlink" title="Future的常见用法？"></a>Future的常见用法？</h2><ul><li>使用<code>future.then</code>获取future的值与捕获future的异常</li><li>结合<code>async</code>,<code>await</code></li><li><code>future.whenComplete</code></li><li><code>future.timeout</code></li></ul><h3 id="使用future-then获取future的值与捕获future的异常"><a href="#使用future-then获取future的值与捕获future的异常" class="headerlink" title="使用future.then获取future的值与捕获future的异常"></a>使用<code>future.then</code>获取future的值与捕获future的异常</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:async&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>&gt; testFuture() &#123;</span><br><span class="line"><span class="comment">//   throw new Error();</span></span><br><span class="line">  <span class="keyword">return</span> Future.value(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line"><span class="comment">//   return Future.error(&#x27;error&#x27;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  testFuture().then((s) &#123;</span><br><span class="line">    <span class="built_in">print</span>(s);</span><br><span class="line">  &#125;, onError: (e) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;onError:&#x27;</span>);</span><br><span class="line">    <span class="built_in">print</span>(e);</span><br><span class="line">  &#125;).catchError((e) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;catchError:&#x27;</span>);</span><br><span class="line">    <span class="built_in">print</span>(e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果catchError与onError同时存在，则会只调用onError；</p></blockquote><p><strong><code>Future</code>的then`的原型：</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;R&gt; then&lt;R&gt;(FutureOr&lt;R&gt; onValue(T value), &#123;<span class="built_in">Function</span> onError&#125;);</span><br></pre></td></tr></table></figure><p>第一个参数会成功的结果回调，第二个参数onError可选表示执行出现异常。</p><h3 id="结合async-await"><a href="#结合async-await" class="headerlink" title="结合async await"></a>结合async await</h3><p><code>Future</code>是异步的，如果我们要将异步转同步，那么可以借助<code>async await</code>来完成。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:async&#x27;</span>;</span><br><span class="line"></span><br><span class="line">test() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="built_in">int</span> result = <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(milliseconds: <span class="number">2000</span>), () &#123;</span><br><span class="line">    <span class="keyword">return</span> Future.value(<span class="number">123</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;t3:&#x27;</span> + <span class="built_in">DateTime</span>.now().toString());</span><br><span class="line">  <span class="built_in">print</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;t1:&#x27;</span> + <span class="built_in">DateTime</span>.now().toString());</span><br><span class="line">  test();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;t2:&#x27;</span> + <span class="built_in">DateTime</span>.now().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="future-whenComplete"><a href="#future-whenComplete" class="headerlink" title="future.whenComplete"></a>future.whenComplete</h3><p>有时候我们需要在<code>Future</code>结束的时候做些事情，我们知道<code>then().catchError()</code>的模式类似于<code>try-catch</code>，<code>try-catch</code>有个<code>finally</code>代码块，而<code>future.whenComplete</code>就是<code>Future</code>的finally。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:async&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> random = Random();</span><br><span class="line">  Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">3</span>), () &#123;</span><br><span class="line">    <span class="keyword">if</span> (random.nextBool()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="string">&#x27;boom!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).then(<span class="built_in">print</span>).catchError(<span class="built_in">print</span>).whenComplete(() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;done!&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="future-timeout"><a href="#future-timeout" class="headerlink" title="future.timeout"></a>future.timeout</h3><p>完成一个异步操作可能需要很长的时间，比如：网络请求，但有时我们需要为异步操作设置一个超时时间，那么，如何为<code>Future</code>设置超时时间呢？</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:async&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">new</span> Future.delayed(<span class="keyword">new</span> <span class="built_in">Duration</span>(seconds: <span class="number">3</span>), () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;).timeout(<span class="keyword">new</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>)).then(<span class="built_in">print</span>).catchError(<span class="built_in">print</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行上述代码会看到：<code>TimeoutException after 0:00:02.000000: Future not completed</code>。</p><h2 id="什么是FutureBuilder？"><a href="#什么是FutureBuilder？" class="headerlink" title="什么是FutureBuilder？"></a>什么是FutureBuilder？</h2><p><code>FutureBuilder</code>是一个将异步操作和异步UI更新结合在一起的类，通过它我们可以将网络请求，数据库读取等的结果更新的页面上。</p><p><strong>FutureBuilder的构造方法</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FutureBuilder(&#123;Key key, Future&lt;T&gt; future, T initialData, @required AsyncWidgetBuilder&lt;T&gt; builder &#125;)</span><br></pre></td></tr></table></figure><ul><li>future： Future对象表示此构建器当前连接的异步计算；</li><li>initialData： 表示一个非空的Future完成前的初始化数据；</li><li>builder： AsyncWidgetBuilder类型的回到函数，是一个基于异步交互构建widget的函数；</li></ul><p>这个builder函数接受两个参数BuildContext context 与 AsyncSnapshot<T> snapshot，它返回一个widget。AsyncSnapshot包含异步计算的信息，它具有以下属性：</p><ul><li>connectionState - 枚举ConnectionState的值，表示与异步计算的连接状态，ConnectionState有四个值：none，waiting，active和done；</li><li>data - 异步计算接收的最新数据；</li><li>error - 异步计算接收的最新错误对象；</li></ul><p>AsyncSnapshot还具有hasData和hasError属性，以分别检查它是否包含非空数据值或错误值。</p><p>现在我们可以看到使用FutureBuilder的基本模式。 在创建新的FutureBuilder对象时，我们将Future对象作为要处理的异步计算传递。 在构建器函数中，我们检查connectionState的值，并使用AsyncSnapshot中的数据或错误返回不同的窗口小部件。</p><p><a href="https://flutter-academy.com/async-in-flutter-futurebuilder/">https://flutter-academy.com/async-in-flutter-futurebuilder/</a><br>FutureBuilder的使用？</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:http/http.dart&#x27;</span> <span class="keyword">as</span> http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> showResult = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  Future&lt;CommonModel&gt; fetchPost() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> response = <span class="keyword">await</span> http</span><br><span class="line">        .<span class="keyword">get</span>(<span class="string">&#x27;http://www.devio.org/io/flutter_app/json/test_common_model.json&#x27;</span>);</span><br><span class="line">    Utf8Decoder utf8decoder = Utf8Decoder(); <span class="comment">//fix 中文乱码</span></span><br><span class="line">    <span class="keyword">var</span> result = json.decode(utf8decoder.convert(response.bodyBytes));</span><br><span class="line">    <span class="keyword">return</span> CommonModel.fromJson(result);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(<span class="string">&#x27;Future与FutureBuilder实用技巧&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: FutureBuilder&lt;CommonModel&gt;(</span><br><span class="line">            future: fetchPost(),</span><br><span class="line">            builder:</span><br><span class="line">                (BuildContext context, AsyncSnapshot&lt;CommonModel&gt; snapshot) &#123;</span><br><span class="line">              <span class="keyword">switch</span> (snapshot.connectionState) &#123;</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.none:</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">new</span> Text(<span class="string">&#x27;Input a URL to start&#x27;</span>);</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.waiting:</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">new</span> Center(child: <span class="keyword">new</span> CircularProgressIndicator());</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.active:</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">new</span> Text(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.done:</span><br><span class="line">                  <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Text(</span><br><span class="line">                      <span class="string">&#x27;<span class="subst">$&#123;snapshot.error&#125;</span>&#x27;</span>,</span><br><span class="line">                      style: TextStyle(color: Colors.red),</span><br><span class="line">                    );</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Column(children: &lt;Widget&gt;[</span><br><span class="line">                      Text(<span class="string">&#x27;icon:<span class="subst">$&#123;snapshot.data.icon&#125;</span>&#x27;</span>),</span><br><span class="line">                      Text(<span class="string">&#x27;statusBarColor:<span class="subst">$&#123;snapshot.data.statusBarColor&#125;</span>&#x27;</span>),</span><br><span class="line">                      Text(<span class="string">&#x27;title:<span class="subst">$&#123;snapshot.data.title&#125;</span>&#x27;</span>),</span><br><span class="line">                      Text(<span class="string">&#x27;url:<span class="subst">$&#123;snapshot.data.url&#125;</span>&#x27;</span>)</span><br><span class="line">                    ]);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> icon;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> url;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> statusBarColor;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> hideAppBar;</span><br><span class="line"></span><br><span class="line">  CommonModel(</span><br><span class="line">      &#123;<span class="keyword">this</span>.icon, <span class="keyword">this</span>.title, <span class="keyword">this</span>.url, <span class="keyword">this</span>.statusBarColor, <span class="keyword">this</span>.hideAppBar&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> CommonModel.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> CommonModel(</span><br><span class="line">      icon: json[<span class="string">&#x27;icon&#x27;</span>],</span><br><span class="line">      title: json[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">      url: json[<span class="string">&#x27;url&#x27;</span>],</span><br><span class="line">      statusBarColor: json[<span class="string">&#x27;statusBarColor&#x27;</span>],</span><br><span class="line">      hideAppBar: json[<span class="string">&#x27;hideAppBar&#x27;</span>],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://flutter-academy.com/async-in-flutter-futurebuilder/">https://flutter-academy.com/async-in-flutter-futurebuilder/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;我们知道Dart语言的执行环境是”单线程”。也就是指一次只能完成一件任务。如果有多个任务，就必须排队，前面一个任务完成，再执行后面一个任务。&lt;/p&gt;
&lt;p&gt;为了解决这个问题，Dart语言将任务的执行模式分成两种：同步和异步。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - Http库</title>
    <link href="https://rencheng.cc/2020/02/20/flutter/Flutter%E8%AF%B7%E6%B1%82%E5%BA%93Http/"/>
    <id>https://rencheng.cc/2020/02/20/flutter/Flutter%E8%AF%B7%E6%B1%82%E5%BA%93Http/</id>
    <published>2020-02-20T12:23:12.000Z</published>
    <updated>2020-02-20T12:23:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>网络请求是开发APP必不可少的一部分，比如获取用户订单数据，获取商品列表，提交表单等等都离不了网络请求，那么在Flutter中如何进行网络请求呢？</p><span id="more"></span>        <h1 id="基于Http实现网络操作"><a href="#基于Http实现网络操作" class="headerlink" title="基于Http实现网络操作"></a>基于Http实现网络操作</h1><ul><li>如何用Http库做get请求？</li><li>如何用Http库做post请求？</li><li>如何将Response转换成Dart object？</li><li>如何将请求结果展示在界面上？</li></ul><blockquote><p>Flutter官方推荐我们在Flutter中用Http进行网络请求。</p></blockquote><h2 id="什么是Http？"><a href="#什么是Http？" class="headerlink" title="什么是Http？"></a>什么是Http？</h2><p><code>Http</code>是Flutter社区开发的一个可组合的、跨平台的用于Flutter的网络请求插件。</p><h3 id="如何用http库做get请求？"><a href="#如何用http库做get请求？" class="headerlink" title="如何用http库做get请求？"></a>如何用http库做get请求？</h3><ul><li>在<code>pubspec.yaml</code>中引入<a href="https://pub.dartlang.org/packages/http">http</a>插件；</li><li>调用<code>http.get</code>发送请求；</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  http: &lt;latest_version&gt;</span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;http.Response&gt; fetchPost() &#123;</span><br><span class="line">  <span class="keyword">return</span> http.<span class="keyword">get</span>(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/1&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>http.get()</code>返回一个包含<code>http.Response</code>的<code>Future</code>：</p><ul><li><a href="https://docs.flutter.io/flutter/dart-async/Future-class.html">Future</a>：是与异步操作一起工作的核心Dart类。它用于表示未来某个时间可能会出现的可用值或错误；</li><li><code>http.Response</code>：类包含一个成功的HTTP请求接收到的数据；</li></ul><h2 id="如何将Response转换成Dart-object？"><a href="#如何将Response转换成Dart-object？" class="headerlink" title="如何将Response转换成Dart object？"></a>如何将Response转换成Dart object？</h2><p>虽然发出网络请求很简单，但如果要使用原始的<code>Future&lt;http.Response&gt;</code>并不简单。为了让我们可以开开心心的写代码，我们可以将<code>http.Response</code>转换成我们自己的Dart对象。</p><p><strong>创建一个CommonModel类</strong><br>首先，我们需要创建一个CommonModel类，它包含我们网络请求的数据。它还将包括一个工厂构造函数，它允许我们可以通过json创建一个CommonModel对象。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> icon;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> url;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> statusBarColor;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> hideAppBar;</span><br><span class="line"></span><br><span class="line">  CommonModel(&#123;<span class="keyword">this</span>.icon, <span class="keyword">this</span>.title, <span class="keyword">this</span>.url, <span class="keyword">this</span>.statusBarColor, <span class="keyword">this</span>.hideAppBar&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> CommonModel.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> CommonModel(</span><br><span class="line">      icon: json[<span class="string">&#x27;icon&#x27;</span>],</span><br><span class="line">      title: json[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">      url: json[<span class="string">&#x27;url&#x27;</span>],</span><br><span class="line">      statusBarColor: json[<span class="string">&#x27;statusBarColor&#x27;</span>],</span><br><span class="line">      hideAppBar: json[<span class="string">&#x27;hideAppBar&#x27;</span>],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将<code>http.Response</code>转换成一个<code>CommonModel</code>对象<br>现在，我们将更新fetchPost函数以返回一个Future<Post>。为此，我们需要：</p><ol><li>使用dart:convert package将响应内容转化为一个json Map；</li><li>使用fromJson工厂函数，将json Map 转化为一个CommonModel对象；</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;CommonModel&gt; fetchPost() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> response = <span class="keyword">await</span> http.<span class="keyword">get</span>(<span class="string">&#x27;http://www.devio.org/io/flutter_app/json/test_common_model.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">final</span> result = json.decode(response.body);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonModel.fromJson(result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="如何将请求结果展示在界面上？"><a href="#如何将请求结果展示在界面上？" class="headerlink" title="如何将请求结果展示在界面上？"></a>如何将请求结果展示在界面上？</h2><p><img src="http://www.devio.org/io/flutter_app/img/blog/http_get_test.gif"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:http/http.dart&#x27;</span> <span class="keyword">as</span> http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> showResult = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  Future&lt;CommonModel&gt; fetchPost() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> response = <span class="keyword">await</span> http</span><br><span class="line">        .<span class="keyword">get</span>(<span class="string">&#x27;http://www.devio.org/io/flutter_app/json/test_common_model.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">final</span> result = json.decode(response.body);</span><br><span class="line">    <span class="keyword">return</span> CommonModel.fromJson(result);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(<span class="string">&#x27;Http&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            InkWell(</span><br><span class="line">              onTap: () &#123;</span><br><span class="line">                fetchPost().then((CommonModel value) &#123;</span><br><span class="line">                  setState(() &#123;</span><br><span class="line">                    showResult =</span><br><span class="line">                        <span class="string">&#x27;请求结果：\nhideAppBar：<span class="subst">$&#123;value.hideAppBar&#125;</span>\nicon：<span class="subst">$&#123;value.icon&#125;</span>&#x27;</span>;</span><br><span class="line">                  &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;,</span><br><span class="line">              child: Text(</span><br><span class="line">                <span class="string">&#x27;点我&#x27;</span>,</span><br><span class="line">                style: TextStyle(fontSize: <span class="number">26</span>),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Text(showResult)</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> icon;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> url;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> statusBarColor;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> hideAppBar;</span><br><span class="line"></span><br><span class="line">  CommonModel(</span><br><span class="line">      &#123;<span class="keyword">this</span>.icon, <span class="keyword">this</span>.title, <span class="keyword">this</span>.url, <span class="keyword">this</span>.statusBarColor, <span class="keyword">this</span>.hideAppBar&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> CommonModel.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> CommonModel(</span><br><span class="line">      icon: json[<span class="string">&#x27;icon&#x27;</span>],</span><br><span class="line">      title: json[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">      url: json[<span class="string">&#x27;url&#x27;</span>],</span><br><span class="line">      statusBarColor: json[<span class="string">&#x27;statusBarColor&#x27;</span>],</span><br><span class="line">      hideAppBar: json[<span class="string">&#x27;hideAppBar&#x27;</span>],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在上述代码中我们通过<code>fetchPost().then</code>获取Fluter的返回结果，其实<code>Future</code>可以理解为ES5中的Promise。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;网络请求是开发APP必不可少的一部分，比如获取用户订单数据，获取商品列表，提交表单等等都离不了网络请求，那么在Flutter中如何进行网络请求呢？&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Connect问题汇总</title>
    <link href="https://rencheng.cc/2020/02/14/ios/general/Connect%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>https://rencheng.cc/2020/02/14/ios/general/Connect%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</id>
    <published>2020-02-14T10:03:49.000Z</published>
    <updated>2020-02-14T10:03:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>Connect问题汇总</p><span id="more"></span><h2 id="App已经上线，解决方案中心没有入口"><a href="#App已经上线，解决方案中心没有入口" class="headerlink" title="App已经上线，解决方案中心没有入口"></a>App已经上线，解决方案中心没有入口</h2><p>可直接访问站点页面。<code>appid</code><strong>必须</strong>替换！！！</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://itunesconnect.apple.com/apps/appid/appstore/platform/ios/resolutioncenter</span><br></pre></td></tr></table></figure><blockquote></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Connect问题汇总&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="提审" scheme="https://rencheng.cc/tags/%E6%8F%90%E5%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>提审被拒解决方案</title>
    <link href="https://rencheng.cc/2020/02/14/ios/general/%E6%8F%90%E5%AE%A1%E8%A2%AB%E6%8B%92%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://rencheng.cc/2020/02/14/ios/general/%E6%8F%90%E5%AE%A1%E8%A2%AB%E6%8B%92%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2020-02-14T04:03:49.000Z</published>
    <updated>2020-02-14T04:03:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>汇总提审被拒解决方案</p><span id="more"></span><h2 id="支付"><a href="#支付" class="headerlink" title="支付"></a>支付</h2><h3 id="商品定价"><a href="#商品定价" class="headerlink" title="商品定价"></a>商品定价</h3><ol><li>苹果反馈</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Guideline 3.0 - Business</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your game app includes in-app purchase products for consumable credits priced over $99.99, Tier 60.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">To resolve this issue, please revise your app to ensure that a single in-app purchase product for consumable credits is priced at nothing more than $99.99, Tier 60.</span><br><span class="line"></span><br><span class="line">To edit in-app purchases:</span><br><span class="line"></span><br><span class="line">- Log in to App Store Connect</span><br><span class="line">- Click on &quot;My Apps&quot;</span><br><span class="line">- Select your app</span><br><span class="line">- Click on &quot;Features&quot; to view your in-app purchases</span><br><span class="line">- Click &quot;Edit In-App Purchase Details&quot;</span><br><span class="line">- Make the desired changes</span><br><span class="line">- Click Save</span><br><span class="line">- Once you&#x27;ve completed all changes, click the &quot;Submit for Review&quot; button at the top of the App Version Information page.</span><br><span class="line"></span><br><span class="line">Note: When an in-app purchase is in the &quot;Developer Action Needed&quot; state, you must make some change to it before it can move to Waiting for Review.</span><br></pre></td></tr></table></figure><ol start="2"><li>排查问题</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App内是否有大约$99美元的商品</span><br></pre></td></tr></table></figure><ol start="3"><li>解决方案</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除定价过高的商品，重新配置</span><br></pre></td></tr></table></figure><h3 id="有混淆，有三方支付"><a href="#有混淆，有三方支付" class="headerlink" title="有混淆，有三方支付"></a>有混淆，有三方支付</h3><ol><li>苹果反馈</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Guideline 2.3.1 - Performance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">We discovered that your app contains obfuscated code, selector mangling, or features meant to subvert the App Review process by changing this app&#x27;s concept after approval to the App Store.</span><br><span class="line"></span><br><span class="line">The next submission of this app may require a longer review time, and this app will not be eligible for an expedited review until this issue is resolved.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">- Review the Performance section of the App Store Review Guidelines.</span><br><span class="line">- Ensure your app is compliant with all sections of the App Store Review Guidelines and the Terms &amp; Conditions of the Apple Developer Program.</span><br><span class="line">- Once your app is fully compliant, resubmit your app for review.</span><br><span class="line"></span><br><span class="line">Submitting apps designed to mislead or harm customers or evade the review process may result in the termination of your Apple Developer Program account. Review the Terms &amp; Conditions of the Apple Developer Program to learn more about our policies regarding termination.</span><br><span class="line"></span><br><span class="line">Guideline 3.1.1 - Business - Payments - In-App Purchase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">We still noticed that your app provides access to external payment mechanisms for purchases or subscriptions to be used in the app, which is not appropriate for the App Store.</span><br><span class="line"></span><br><span class="line">Specifically, we found that your app includes code for alternative payment mechanisms.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">To resolve this issue, please remove any external payment mechanisms from this app. If you feel that we have misunderstood how your app uses this payment mechanism, please respond to this message and explain what users are able to purchase via this payment mechanism and how we can locate the purchases in your app.</span><br></pre></td></tr></table></figure><ol><li>排查问题</li></ol><p><strong>2.3.1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.App本身是否使用混淆技术</span><br><span class="line">2.检查集成的SDK是否使用混淆技术</span><br><span class="line">3.是否有一些代码是需要保护的，不希望别人看到的话，需要在Connect备注中说明。</span><br><span class="line">3.给苹果提交反馈，让其提供相关混淆变量或方法名</span><br></pre></td></tr></table></figure><p><strong>3.1.1</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.可能是接入了支付宝或其它支付sdk</span><br><span class="line">2.可能检查到App跳转网站进行外部支付的入口</span><br><span class="line">3.可能是plist里面有alipay或wechat相关选项残留</span><br><span class="line">4.代码中或文件中有`支付宝，alipay，wechatPay`字样的文本</span><br><span class="line">5.有发送针对支付宝或者淘宝域名的HTTP请求</span><br><span class="line">6.用到的第三方sdk或者软件曾经因为类似原因被拉入了“宁杀错不放过”的名单，比如anysdk</span><br><span class="line">7.该账号曾经因为接入微信或者支付宝请求被拒绝过</span><br><span class="line">8.打包的苹果设备曾经因为接入微信或者支付宝请求被拒绝过</span><br><span class="line">9.创建苹果开发者账号支付所采用的信用卡曾经用于创建另一个因为接入微信或者支付宝请求被拒绝过开发者账号</span><br><span class="line">10.运气不好，被苹果误判；这个概率极小，要验证很简单，再提审一次就知道了</span><br></pre></td></tr></table></figure><p><strong>软文</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">通过跟审核人员的电话沟通，我方已经了解App存在的问题。</span><br><span class="line">承诺：</span><br><span class="line">1. XXXX非常希望与苹果公司合作，共同盈利。所以我们不会在iOS平台为用户提供任何第三方以及外部支付的环境和入口。</span><br><span class="line">2. XXXX在审核期间，没有任何功能是隐瞒的，更不会刻意的混淆代码以通过审核。</span><br><span class="line"></span><br><span class="line">通过问题排查</span><br><span class="line">1. XXXX项目代码中有关于“charge”关键字的接口和变量名称。为了避免误解，我们将iap功能剥离成独立的支付系统，以及关闭跳转外部浏览器的业务。</span><br><span class="line">2. XXXX在初始化的时候获取了一些动态配置，我们已经删除了所有产品业务显隐开关。（注：之前版本的开关，并没有在审核过程中隐藏任何功能）</span><br><span class="line">3. XXXX是采用U3D游戏引擎开发，导出的资源名称基本都是md5，会不会因为这些文件让审核人员误认为是混淆了？亦或者是我们的变量名称不规范的问题呢？如果审核人员仍认为我们代码存在混淆，请一定帮忙指出具体的混淆代码给我们做出提示。</span><br></pre></td></tr></table></figure><p><strong>电话预留</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Dear Reviewer，</span><br><span class="line">We need your help. In order to determine the problem as soon as possible, please contact us by telephone.</span><br><span class="line">Technician: Ren Cheng</span><br><span class="line">Contact information: +86 13681105571</span><br><span class="line">Communication language: Chinese</span><br><span class="line">Thank you and Regards,</span><br><span class="line"></span><br><span class="line">亲爱的审核:</span><br><span class="line">我们需要你们的帮助，为尽快确定问题，可否麻烦电话沟通。</span><br><span class="line">技术人员：任成</span><br><span class="line">联系方式：+8613681105571</span><br><span class="line">沟通语言：中文</span><br><span class="line">谢谢！</span><br></pre></td></tr></table></figure><h3 id="提示有AliPaySDK"><a href="#提示有AliPaySDK" class="headerlink" title="提示有AliPaySDK"></a>提示有AliPaySDK</h3><ol><li>苹果反馈</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Guideline 2.3.1 - Performance</span><br><span class="line"></span><br><span class="line">We discovered that your app contains hidden features. Attempting to hide features, functionality or content in your app is considered egregious behavior and can lead to removal from the Apple Developer Program.</span><br><span class="line"></span><br><span class="line">Specifically, we found that your app includes AliPay (支付寶), which provides access to external payment mechanisms and enables the purchase of content, services, or functionality by means other than the in-app purchase API.</span><br></pre></td></tr></table></figure><ol start="2"><li>排查问题</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.可能是接入了支付宝SDK</span><br><span class="line">2.可能是plist里面有alipay相关选项残留</span><br><span class="line">3.代码中或文件中有支付宝，alipay字样的文本</span><br><span class="line">4.有发送针对支付宝或者淘宝域名的HTTP请求</span><br><span class="line">5.用到的第三方sdk或者软件曾经因为类似原因被拉入了“宁杀错不放过”的名单，比如anysdk</span><br><span class="line">6.该账号曾经因为接入微信或者支付宝请求被拒绝过</span><br><span class="line">7.打包的苹果设备曾经因为接入微信或者支付宝请求被拒绝过</span><br><span class="line">8.创建苹果开发者账号支付所采用的信用卡曾经用于创建另一个因为接入微信或者支付宝请求被拒绝过开发者账号</span><br><span class="line">9.运气不好，被苹果误判；这个概率极小，要验证很简单，再提审一次就知道了</span><br></pre></td></tr></table></figure><h2 id="UI设计不规范"><a href="#UI设计不规范" class="headerlink" title="UI设计不规范"></a>UI设计不规范</h2><ol><li>苹果反馈</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">10.6 – Apple and our customers place a high value on simple, refined, creative, well thought through interfaces. They take more work but are worth it. Apple sets a high bar. If your user interface is complex or less than very good, it may be rejected</span><br><span class="line"></span><br><span class="line">10.6 Details  </span><br><span class="line"></span><br><span class="line">Your app includes an update button or alerts the user to update the app. To avoid user confusion, app version updates must utilize the iOS built-in update mechanism. </span><br></pre></td></tr></table></figure><ol start="2"><li>排查问题</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. 移除检测App更新的按钮和提示</span><br></pre></td></tr></table></figure><h2 id="审核预计耗时很久"><a href="#审核预计耗时很久" class="headerlink" title="审核预计耗时很久"></a>审核预计耗时很久</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Other - Other</span><br><span class="line"></span><br><span class="line">Hello,</span><br><span class="line"></span><br><span class="line">The review of your app is taking longer than expected. Once we have completed our review, we will notify you via Resolution Center.</span><br><span class="line"></span><br><span class="line">If you would like to inquire about the status of this review, you may file a request via the Apple Developer Contact Us page.</span><br><span class="line"></span><br><span class="line">Best regards,</span><br><span class="line"></span><br><span class="line">App Store Review</span><br></pre></td></tr></table></figure><ol start="2"><li>问题排查</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. App第一个版本审核就会很慢</span><br><span class="line">2. App内有一些业务是否违反规则，审核人员暂时断定不了。</span><br><span class="line">3. 之前提交的版本跟目前提交的版本有很大差异（包大小，应用名，logo等关键信息）</span><br><span class="line">4. 账号出现问题，账号下其他App出现违规行为等</span><br><span class="line">5. 苹果太忙了，先给一个 reject，等有空再说。</span><br><span class="line">6. 审核机制有变化</span><br></pre></td></tr></table></figure><ol start="3"><li>解决方案</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 耐心等待就好了</span><br><span class="line">2. 如果3天没有回复，那就`Apple Developer Contact Us`联系苹果</span><br><span class="line">3. 等待回复就好，别病急乱投医。</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;汇总提审被拒解决方案&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="提审" scheme="https://rencheng.cc/tags/%E6%8F%90%E5%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>获取文件后缀</title>
    <link href="https://rencheng.cc/2020/02/12/ios/general/%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80/"/>
    <id>https://rencheng.cc/2020/02/12/ios/general/%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80/</id>
    <published>2020-02-12T11:18:49.000Z</published>
    <updated>2020-02-12T11:18:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>项目中有一个需求：<br>给定一个<code>NSData *</code>类型的数据，从中解析出文件类型。</p><span id="more"></span><h2 id="图片后缀判断"><a href="#图片后缀判断" class="headerlink" title="图片后缀判断"></a>图片后缀判断</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NSInteger</span> ImageFormat <span class="built_in">NS_TYPED_EXTENSIBLE_ENUM</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatUndefined = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatJPEG      = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatPNG       = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatGIF       = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatTIFF      = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatWebP      = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatHEIC      = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> ImageFormat ImageFormatHEIF      = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">+ (ImageFormat)imageFormatForImageData:(<span class="keyword">nullable</span> <span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">        <span class="keyword">return</span> ImageFormatUndefined;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// File signatures table: http://www.garykessler.net/library/file_sigs.html</span></span><br><span class="line">    uint8_t c;</span><br><span class="line">    [data getBytes:&amp;c length:<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xFF</span>:</span><br><span class="line">            <span class="keyword">return</span> ImageFormatJPEG;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x89</span>:</span><br><span class="line">            <span class="keyword">return</span> ImageFormatPNG;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x47</span>:</span><br><span class="line">            <span class="keyword">return</span> ImageFormatGIF;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x49</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x4D</span>:</span><br><span class="line">            <span class="keyword">return</span> ImageFormatTIFF;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x52</span>: &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.length &gt;= <span class="number">12</span>) &#123;</span><br><span class="line">                <span class="comment">//RIFF....WEBP</span></span><br><span class="line">                <span class="built_in">NSString</span> *testString = [[<span class="built_in">NSString</span> alloc] initWithData:[data subdataWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">12</span>)] encoding:<span class="built_in">NSASCIIStringEncoding</span>];</span><br><span class="line">                <span class="keyword">if</span> ([testString hasPrefix:<span class="string">@&quot;RIFF&quot;</span>] &amp;&amp; [testString hasSuffix:<span class="string">@&quot;WEBP&quot;</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ImageFormatWebP;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x00</span>: &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.length &gt;= <span class="number">12</span>) &#123;</span><br><span class="line">                <span class="comment">//....ftypheic ....ftypheix ....ftyphevc ....ftyphevx</span></span><br><span class="line">                <span class="built_in">NSString</span> *testString = [[<span class="built_in">NSString</span> alloc] initWithData:[data subdataWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">8</span>)] encoding:<span class="built_in">NSASCIIStringEncoding</span>];</span><br><span class="line">                <span class="keyword">if</span> ([testString isEqualToString:<span class="string">@&quot;ftypheic&quot;</span>]</span><br><span class="line">                    || [testString isEqualToString:<span class="string">@&quot;ftypheix&quot;</span>]</span><br><span class="line">                    || [testString isEqualToString:<span class="string">@&quot;ftyphevc&quot;</span>]</span><br><span class="line">                    || [testString isEqualToString:<span class="string">@&quot;ftyphevx&quot;</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ImageFormatHEIC;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//....ftypmif1 ....ftypmsf1</span></span><br><span class="line">                <span class="keyword">if</span> ([testString isEqualToString:<span class="string">@&quot;ftypmif1&quot;</span>] || [testString isEqualToString:<span class="string">@&quot;ftypmsf1&quot;</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ImageFormatHEIF;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ImageFormatUndefined;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="文件后缀判断"><a href="#文件后缀判断" class="headerlink" title="文件后缀判断"></a>文件后缀判断</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="type">void</span>)getFileExtension &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@&quot;2019工资单 (1)&quot;</span> ofType:<span class="string">@&quot;docx&quot;</span>];</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:path];</span><br><span class="line">    <span class="built_in">NSString</span> *extension = [<span class="keyword">self</span> contentTypeForImageData:data];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, extension);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)contentTypeForImageData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">NSInteger</span> maxLength = <span class="number">28</span>;</span><br><span class="line">    Byte headBytes[maxLength];</span><br><span class="line">    [data getBytes:headBytes length:maxLength];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *headStr = [<span class="keyword">self</span> hexStringFromByte:headBytes];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSDictionary</span> *dict = [<span class="keyword">self</span> dict];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> dict) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([headStr hasPrefix:[key uppercaseString]]) &#123;</span><br><span class="line">            <span class="keyword">return</span> dict[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">@&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)hexStringFromByte:(Byte *)byta &#123;</span><br><span class="line">    <span class="comment">// 转16进制</span></span><br><span class="line">    <span class="built_in">NSString</span> *hexStr = <span class="string">@&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">28</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *newHexStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%x&quot;</span>,byta[i]&amp;<span class="number">0xff</span>];<span class="comment">///16进制数</span></span><br><span class="line">        <span class="keyword">if</span>([newHexStr length]==<span class="number">1</span>)</span><br><span class="line">            hexStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%@0%@&quot;</span>,hexStr,newHexStr];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hexStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%@%@&quot;</span>,hexStr,newHexStr];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [hexStr uppercaseString];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)dict &#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">        <span class="string">@&quot;FFD8FF&quot;</span> : <span class="string">@&quot;JPEG&quot;</span> ,</span><br><span class="line">        <span class="string">@&quot;89504E47&quot;</span> : <span class="string">@&quot;PNG&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;47494638&quot;</span> : <span class="string">@&quot;GIF&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;49492A00&quot;</span> : <span class="string">@&quot;TIFF&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;424D&quot;</span> : <span class="string">@&quot;BMP&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;41433130&quot;</span> : <span class="string">@&quot;DWG&quot;</span>, <span class="comment">// CAD</span></span><br><span class="line">        <span class="string">@&quot;38425053&quot;</span> : <span class="string">@&quot;PSD&quot;</span>, <span class="comment">// Adobe Photoshop</span></span><br><span class="line">        <span class="string">@&quot;7B5C727466&quot;</span> : <span class="string">@&quot;RTF&quot;</span>, <span class="comment">// Rich Text Format</span></span><br><span class="line">        <span class="string">@&quot;3C3F786D6C&quot;</span> : <span class="string">@&quot;XML&quot;</span>, <span class="comment">// XML</span></span><br><span class="line">        <span class="string">@&quot;68746D6C3E&quot;</span> : <span class="string">@&quot;HTML&quot;</span>, <span class="comment">// HTML</span></span><br><span class="line">        <span class="string">@&quot;48544D4C207B0D0A0942&quot;</span> : <span class="string">@&quot;CSS&quot;</span>, <span class="comment">// CSS</span></span><br><span class="line">        <span class="string">@&quot;696B2E71623D696B2E71&quot;</span> : <span class="string">@&quot;JS&quot;</span>, <span class="comment">// JS</span></span><br><span class="line">        <span class="string">@&quot;44656C69766572792D646174653A&quot;</span> : <span class="string">@&quot;EML&quot;</span>, <span class="comment">//Email [thorough only].</span></span><br><span class="line">        <span class="string">@&quot;CFAD12FEC5FD746F&quot;</span> : <span class="string">@&quot;DBX&quot;</span>, <span class="comment">// Outlook Express.</span></span><br><span class="line">        <span class="string">@&quot;2142444E&quot;</span> : <span class="string">@&quot;PST&quot;</span>, <span class="comment">// Outlook (pst).</span></span><br><span class="line">        <span class="string">@&quot;D0CF11E0&quot;</span> : <span class="string">@&quot;XLS_DOC&quot;</span>, <span class="comment">// MS Word/Excel</span></span><br><span class="line">        <span class="string">@&quot;504B0304&quot;</span> : <span class="string">@&quot;XLSX_DOCX&quot;</span>, <span class="comment">// MS Word/Excel</span></span><br><span class="line">        <span class="string">@&quot;255044462D&quot;</span> : <span class="string">@&quot;PDF&quot;</span>, <span class="comment">// PDF</span></span><br><span class="line">        <span class="string">@&quot;5374616E64617264204A&quot;</span> : <span class="string">@&quot;MDB&quot;</span>, <span class="comment">// MS Access.</span></span><br><span class="line">        <span class="string">@&quot;d0cf11e0a1b11ae10000&quot;</span> : <span class="string">@&quot;WPS&quot;</span>, <span class="comment">// WPS文字wps、表格et、演示dps都是一样的</span></span><br><span class="line">        <span class="string">@&quot;504B0304&quot;</span> : <span class="string">@&quot;ZIP&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;52617221&quot;</span> : <span class="string">@&quot;RAR&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;4D5A9000030000000400&quot;</span> : <span class="string">@&quot;EXE&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;57415645&quot;</span> : <span class="string">@&quot;WAV&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;41564920&quot;</span> : <span class="string">@&quot;AVI&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;000001BA&quot;</span> : <span class="string">@&quot;MPG&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;6D6F6F76&quot;</span> : <span class="string">@&quot;MOV&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;00000020667479706d70&quot;</span> : <span class="string">@&quot;MP4&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;49443303000000002176&quot;</span> : <span class="string">@&quot;MP3&quot;</span>,</span><br><span class="line">        <span class="string">@&quot;464C5601050000000900&quot;</span> : <span class="string">@&quot;FLV&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;项目中有一个需求：&lt;br&gt;给定一个&lt;code&gt;NSData *&lt;/code&gt;类型的数据，从中解析出文件类型。&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 动画Animation开发指南</title>
    <link href="https://rencheng.cc/2020/02/11/flutter/Flutter%E5%8A%A8%E7%94%BB/"/>
    <id>https://rencheng.cc/2020/02/11/flutter/Flutter%E5%8A%A8%E7%94%BB/</id>
    <published>2020-02-11T06:59:02.000Z</published>
    <updated>2020-02-11T06:59:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>精心设计的动画会让用户界面感觉更直观、流畅，能改善用户体验。 Flutter的动画支持可以轻松实现各种动画类型。许多widget，特别是Material Design widgets， 都带有在其设计规范中定义的标准动画效果，但也可以自定义这些效果。</p><span id="more"></span><h2 id="动画Animation开发指南"><a href="#动画Animation开发指南" class="headerlink" title="动画Animation开发指南"></a>动画Animation开发指南</h2><ul><li>在Flutter中有哪些类型的动画？</li><li>如何使用动画库中的基础类给widget添加动画？</li><li>如何为动画添加监听器？</li><li>该什么时候使用AnimatedWidget与AnimatedBuilder?</li><li>如何使用Hero动画？</li></ul><h3 id="在Flutter中有哪些类型的动画？"><a href="#在Flutter中有哪些类型的动画？" class="headerlink" title="在Flutter中有哪些类型的动画？"></a>在Flutter中有哪些类型的动画？</h3><p>在Flutter中动画分为两类：基于tween或基于物理的。</p><ul><li>补间(Tween)动画：在补间动画中，定义了开始点和结束点、时间线以及定义转换时间和速度的曲线。然后由框架计算如何从开始点过渡到结束点。</li><li>基于物理的动画：在基于物理的动画中，运动被模拟为与真实世界的行为相似。例如，当你掷球时，它在何处落地，取决于抛球速度有多快、球有多重、距离地面有多远。 类似地，将连接在弹簧上的球落下（并弹起）与连接到绳子上的球放下的方式也是不同。</li></ul><h3 id="如何使用动画库中的基础类给widget添加动画？"><a href="#如何使用动画库中的基础类给widget添加动画？" class="headerlink" title="如何使用动画库中的基础类给widget添加动画？"></a>如何使用动画库中的基础类给widget添加动画？</h3><p>在为widget添加动画之前，先让我们认识下动画的几个朋友：</p><ul><li><a href="https://docs.flutter.io/flutter/animation/Animation-class.html">Animation</a>：是Flutter动画库中的一个核心类，它生成指导动画的值；</li><li><a href="https://docs.flutter.io/flutter/animation/CurvedAnimation-class.html">CurvedAnimation</a>：Animation的一个子类，将过程抽象为一个非线性曲线；</li><li><a href="https://docs.flutter.io/flutter/animation/AnimationController-class.html">AnimationController</a>：Animation的一个子类，用来管理Animation；</li><li><a href="https://docs.flutter.io/flutter/animation/Tween-class.html">Tween</a>：在正在执行动画的对象所使用的数据范围之间生成值。例如，Tween可生成从红到蓝之间的色值，或者从0到255；</li></ul><h4 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h4><p>在Flutter中，<code>Animation</code>对象本身和UI渲染没有任何关系。<code>Animation</code>是一个抽象类，它拥有其当前值和状态（完成或停止）。其中一个比较常用的<code>Animation</code>类是<code>Animation&lt;double&gt;</code>。<br>Flutter中的Animation对象是一个在一段时间内依次生成一个区间之间值的类。Animation对象的输出可以是线性的、曲线的、一个步进函数或者任何其他可以设计的映射。 根据<code>Animation</code>对象的控制方式，动画可以反向运行，甚至可以在中间切换方向。</p><ul><li><code>Animation</code>还可以生成除<code>double</code>之外的其他类型值，如：<code>Animation&lt;Color&gt;</code> 或 <code>Animation&lt;Size&gt;</code>；</li><li><code>Animation</code>对象有状态。可以通过访问其value属性获取动画的当前值；</li><li><code>Animation</code>对象本身和UI渲染没有任何关系；</li></ul><h4 id="CurvedAnimation"><a href="#CurvedAnimation" class="headerlink" title="CurvedAnimation"></a>CurvedAnimation</h4><p><code>CurvedAnimation</code>将动画过程定义为一个非线性曲线。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> CurvedAnimation curve =</span><br><span class="line">    <span class="keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.easeIn);</span><br></pre></td></tr></table></figure><blockquote><p>注: <a href="https://docs.flutter.io/flutter/animation/Curves-class.html">Curves</a> 类定义了许多常用的曲线，也可以创建自己的，例如：</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShakeCurve</span> <span class="keyword">extends</span> <span class="title">Curve</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">double</span> transform(<span class="built_in">double</span> t) &#123;</span><br><span class="line">    <span class="keyword">return</span> math.sin(t * math.PI * <span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AnimationController"><a href="#AnimationController" class="headerlink" title="AnimationController"></a>AnimationController</h4><p><code>AnimationController</code>是一个特殊的<code>Animation</code>对象，在屏幕刷新的每一帧，就会生成一个新的值。默认情况下，AnimationController在给定的时间段内会线性的生成从0.0到1.0的数字。 例如，下面代码创建一个Animation对象：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> AnimationController controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">    duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">2000</span>), vsync: <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><p><code>AnimationController</code>派生自<code>Animation&lt;double&gt;</code>，因此可以在需要<code>Animation</code>对象的任何地方使用。 但是，<code>AnimationController</code>具有控制动画的其他方法：</p><ul><li><code>forward()</code>：启动动画；</li><li><code>reverse(&#123;double from&#125;)</code>：倒放动画；</li><li><code>reset()</code>：重置动画，将其设置到动画的开始位置；</li><li><code>stop(&#123; bool canceled = true &#125;)</code>：停止动画；</li></ul><p>当创建一个AnimationController时，需要传递一个vsync参数，存在vsync时会防止屏幕外动画消耗不必要的资源，可以将stateful对象作为vsync的值。</p><blockquote><p>注意： 在某些情况下，值(position，值动画的当前值)可能会超出AnimationController的0.0-1.0的范围。例如，fling()函数允许您提供速度(velocity)、力量(force)、position(通过Force对象)。位置(position)可以是任何东西，因此可以在0.0到1.0范围之外。 CurvedAnimation生成的值也可以超出0.0到1.0的范围。根据选择的曲线，CurvedAnimation的输出可以具有比输入更大的范围。例如，Curves.elasticIn等弹性曲线会生成大于或小于默认范围的值。</p></blockquote><h4 id="Tween"><a href="#Tween" class="headerlink" title="Tween"></a>Tween</h4><p>默认情况下，AnimationController对象的范围从0.0到1.0。如果您需要不同的范围或不同的数据类型，则可以使用Tween来配置动画以生成不同的范围或数据类型的值。例如，以下示例，Tween生成从-200.0到0.0的值：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Tween doubleTween = <span class="keyword">new</span> Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">-200.0</span>, end: <span class="number">0.0</span>);</span><br></pre></td></tr></table></figure><p>Tween是一个无状态(stateless)对象，需要begin和end值。Tween的唯一职责就是定义从输入范围到输出范围的映射。输入范围通常为0.0到1.0，但这不是必须的。<br>Tween继承自<code>Animatable&lt;T&gt;</code>，而不是继承自<code>Animation&lt;T&gt;</code>。Animatable与Animation相似，不是必须输出double值。例如，ColorTween指定两种颜色之间的过渡。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Tween colorTween =</span><br><span class="line">    <span class="keyword">new</span> ColorTween(begin: Colors.transparent, end: Colors.black54);</span><br></pre></td></tr></table></figure><p>Tween对象不存储任何状态。相反，它提供了<code>evaluate(Animation&lt;double&gt; animation)</code>方法将映射函数应用于动画当前值。 Animation对象的当前值可以通过<code>value()</code>方法取到。evaluate函数还执行一些其它处理，例如分别确保在动画值为0.0和1.0时返回开始和结束状态。</p><p><strong>Tween.animate</strong><br>要使用Tween对象，可调用它的animate()方法，传入一个控制器对象。例如，以下代码在500毫秒内生成从0到255的整数值。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> AnimationController controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">    duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">500</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line">Animation&lt;<span class="built_in">int</span>&gt; alpha = <span class="keyword">new</span> IntTween(begin: <span class="number">0</span>, end: <span class="number">255</span>).animate(controller);</span><br></pre></td></tr></table></figure><p>注意<code>animate()</code>返回的是一个Animation，而不是一个Animatable。<br>以下示例构建了一个控制器、一条曲线和一个Tween：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> AnimationController controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">    duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">500</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">final</span> Animation curve =</span><br><span class="line">    <span class="keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.easeOut);</span><br><span class="line">Animation&lt;<span class="built_in">int</span>&gt; alpha = <span class="keyword">new</span> IntTween(begin: <span class="number">0</span>, end: <span class="number">255</span>).animate(curve);</span><br></pre></td></tr></table></figure><h3 id="为widget添加动画"><a href="#为widget添加动画" class="headerlink" title="为widget添加动画"></a>为widget添加动画</h3><p>在下面的实例中我们为一个logo添加了一个从小放大的动画：<br><img src="http://www.devio.org/io/flutter_app/img/blog/zoom.gif"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(LogoApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogoApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  _LogoAppState createState() =&gt; _LogoAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LogoAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LogoApp</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; animation;</span><br><span class="line">  AnimationController controller;</span><br><span class="line">  AnimationStatus animationState;</span><br><span class="line">  <span class="built_in">double</span> animationValue;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    controller =</span><br><span class="line">        AnimationController(duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// #docregion addListener</span></span><br><span class="line">    animation = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0</span>, end: <span class="number">300</span>).animate(controller)</span><br><span class="line">      ..addListener(() &#123;</span><br><span class="line">        <span class="comment">// #enddocregion addListener</span></span><br><span class="line">        setState(() &#123;</span><br><span class="line">          animationValue = animation.value;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// #docregion addListener</span></span><br><span class="line">      &#125;)</span><br><span class="line">      ..addStatusListener((AnimationStatus state) &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          animationState = state;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">// #enddocregion addListener</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      margin: EdgeInsets.only(top: <span class="number">50</span>),</span><br><span class="line">      child: Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          GestureDetector(</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              controller.reset();</span><br><span class="line">              controller.forward();</span><br><span class="line">            &#125;,</span><br><span class="line">            child: Text(<span class="string">&#x27;Start&#x27;</span>, textDirection: TextDirection.ltr),</span><br><span class="line">          ),</span><br><span class="line">          Text(<span class="string">&#x27;State:&#x27;</span> + animationState.toString(),</span><br><span class="line">              textDirection: TextDirection.ltr),</span><br><span class="line">          Text(<span class="string">&#x27;Value:&#x27;</span> + animationValue.toString(),</span><br><span class="line">              textDirection: TextDirection.ltr),</span><br><span class="line">          Container(</span><br><span class="line">            height: animation.value,</span><br><span class="line">            width: animation.value,</span><br><span class="line">            child: FlutterLogo(),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，在上述代码中要实现这个动画的关键一步是在addListener()的回调中添加setState的调用这样才能触发页面重新渲染，动画才能有效，另外也可以通过AnimatedWidget来实现，在下文中会讲到。</p><h3 id="如何为动画添加监听器？"><a href="#如何为动画添加监听器？" class="headerlink" title="如何为动画添加监听器？"></a>如何为动画添加监听器？</h3><p>有时我们需要知道动画执行的进度和状态，在Flutter中我们可以通过<code>Animation的addListener</code>与<code>addStatusListener</code>方法为动画添加监听器：</p><ul><li>addListener：动画的值发生变化时被调用；</li><li>addStatusListener：动画状态发生变化时被调用；</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"> <span class="keyword">void</span> initState() &#123;</span><br><span class="line">   <span class="keyword">super</span>.initState();</span><br><span class="line">   controller =</span><br><span class="line">       AnimationController(duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line">   animation = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0</span>, end: <span class="number">300</span>).animate(controller)</span><br><span class="line">     <span class="comment">// #enddocregion print-state</span></span><br><span class="line">     ..addStatusListener((status) &#123;</span><br><span class="line">       <span class="keyword">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class="line">         controller.reverse();</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status == AnimationStatus.dismissed) &#123;</span><br><span class="line">         controller.forward();</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     <span class="comment">// #docregion print-state</span></span><br><span class="line">     ..addStatusListener((state) =&gt; <span class="built_in">print</span>(<span class="string">&#x27;<span class="subst">$state</span>&#x27;</span>));</span><br><span class="line">     ..addListener(() &#123;</span><br><span class="line">       <span class="comment">// #enddocregion addListener</span></span><br><span class="line">       setState(() &#123;</span><br><span class="line">         <span class="comment">// The state that has changed here is the animation object’s value.</span></span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// #docregion addListener</span></span><br><span class="line">     &#125;);</span><br><span class="line">   controller.forward();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>可对照学习<a href="https://coding.imooc.com/lesson/321.html#%E4%B8%BAwidget%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB">为widget添加动画</a>的例子；</p></blockquote><h3 id="用AnimatedWidget与AnimatedBuilder简化和重构我们对动画的使用"><a href="#用AnimatedWidget与AnimatedBuilder简化和重构我们对动画的使用" class="headerlink" title="用AnimatedWidget与AnimatedBuilder简化和重构我们对动画的使用"></a>用AnimatedWidget与AnimatedBuilder简化和重构我们对动画的使用</h3><h4 id="什么是AnimatedWidget？"><a href="#什么是AnimatedWidget？" class="headerlink" title="什么是AnimatedWidget？"></a>什么是AnimatedWidget？</h4><p>我们可以将AnimatedWidget理解为Animation的助手，使用它可以简化我们对动画的使用，在为widget添加动画的学习中我们不难发现，在不使用AnimatedWidget的情况下需要手动调用动画的addListener()并在回调中添加setState才能看到动画效果，AnimatedWidget将为我们简化这一操作。<br>在下面的重构示例中，LogoApp现在继承自AnimatedWidget而不是StatefulWidget。AnimatedWidget在绘制时使用动画的当前值。LogoApp仍然管理着AnimationController和Tween。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Demonstrate a simple animation with AnimatedWidget</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/animation.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimatedLogo</span> <span class="keyword">extends</span> <span class="title">AnimatedWidget</span> </span>&#123;</span><br><span class="line">  AnimatedLogo(&#123;Key key, Animation&lt;<span class="built_in">double</span>&gt; animation&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key, listenable: animation);</span><br><span class="line"></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> Animation&lt;<span class="built_in">double</span>&gt; animation = listenable;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Center(</span><br><span class="line">      child: <span class="keyword">new</span> Container(</span><br><span class="line">        margin: <span class="keyword">new</span> EdgeInsets.symmetric(vertical: <span class="number">10.0</span>),</span><br><span class="line">        height: animation.value,</span><br><span class="line">        width: animation.value,</span><br><span class="line">        child: <span class="keyword">new</span> FlutterLogo(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogoApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  _LogoAppState createState() =&gt; <span class="keyword">new</span> _LogoAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LogoAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LogoApp</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController controller;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; animation;</span><br><span class="line"></span><br><span class="line">  initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    controller = <span class="keyword">new</span> AnimationController(</span><br><span class="line">        duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">2000</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line">    animation = <span class="keyword">new</span> Tween(begin: <span class="number">0.0</span>, end: <span class="number">300.0</span>).animate(controller);</span><br><span class="line">    controller.forward();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AnimatedLogo(animation: animation);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dispose() &#123;</span><br><span class="line">    controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(<span class="keyword">new</span> LogoApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>什么是AnimatedBuilder？<br>AnimatedBuilder是用于构建动画的通用widget，AnimatedBuilder对于希望将动画作为更大构建函数的一部分包含在内的更复杂的widget时非常有用，其实你可以这样理解：AnimatedBuilder是拆分动画的一个工具类，借助它我们可以将动画和widget进行分离：<br>在上面的实例中我们的代码存在的一个问题： 更改动画需要更改显示logo的widget。更好的解决方案是将职责分离：</p><ul><li>显示logo</li><li>定义Animation对象</li><li>渲染过渡效果</li></ul><p>接下来我们就借助<code>AnimatedBuilder</code>类来完成此分离。<code>AnimatedBuilder</code>是渲染树中的一个独立的类， 与AnimatedWidget类似，<code>AnimatedBuilder</code>自动监听来自Animation对象的通知，不需要手动调用<code>addListener()</code>。<br>我们根据下图的 widget 树来创建我们的代码：</p><p><img src="http://www.devio.org/io/flutter_app/img/blog/AnimatedBuilder-WidgetTree.png"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/animation.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(LogoApp());</span><br><span class="line"></span><br><span class="line"><span class="comment">// #docregion LogoWidget</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogoWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Leave out the height and width so it fills the animating parent</span></span><br><span class="line">  Widget build(BuildContext context) =&gt; Container(</span><br><span class="line">        margin: EdgeInsets.symmetric(vertical: <span class="number">10</span>),</span><br><span class="line">        child: FlutterLogo(),</span><br><span class="line">      );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #enddocregion LogoWidget</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #docregion GrowTransition</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GrowTransition</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  GrowTransition(&#123;<span class="keyword">this</span>.child, <span class="keyword">this</span>.animation&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line">  <span class="keyword">final</span> Animation&lt;<span class="built_in">double</span>&gt; animation;</span><br><span class="line"></span><br><span class="line">  Widget build(BuildContext context) =&gt; Center(</span><br><span class="line">        child: AnimatedBuilder(</span><br><span class="line">            animation: animation,</span><br><span class="line">            builder: (context, child) =&gt; Container(</span><br><span class="line">                  height: animation.value,</span><br><span class="line">                  width: animation.value,</span><br><span class="line">                  child: child,</span><br><span class="line">                ),</span><br><span class="line">            child: child),</span><br><span class="line">      );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #enddocregion GrowTransition</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogoApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  _LogoAppState createState() =&gt; _LogoAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #docregion print-state</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LogoAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LogoApp</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; animation;</span><br><span class="line">  AnimationController controller;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    controller =</span><br><span class="line">        AnimationController(duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">2</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line">    animation = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0</span>, end: <span class="number">300</span>).animate(controller);</span><br><span class="line">    controller.forward();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// #enddocregion print-state</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) =&gt; GrowTransition(</span><br><span class="line">        child: LogoWidget(),</span><br><span class="line">        animation: animation,</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// #docregion print-state</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如何使用Hero动画？<br>什么是Hero动画？<br><img src="http://www.devio.org/io/flutter_app/img/blog/Standard-Hero-Animation.gif"><br><img src="http://www.devio.org/io/flutter_app/img/blog/Radial-Hero-Animation.gif"></p><p>在 Flutter中可以用 Hero widget创建这个动画。当 hero 通过动画从源页面飞到目标页面时，目标页面逐渐淡入视野。通常， hero 是用户界面的一小部分，如图片，它通常在两个页面都有。从用户的角度来看， hero 在页面之间“飞翔”。接下来我们一起来学习如何创建Hero动画：<br>实现标准hero动画</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/scheduler.dart&#x27;</span> <span class="keyword">show</span> timeDilation;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhotoHero</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> PhotoHero(&#123; Key key, <span class="keyword">this</span>.photo, <span class="keyword">this</span>.onTap, <span class="keyword">this</span>.width &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> photo;</span><br><span class="line">  <span class="keyword">final</span> VoidCallback onTap;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> width;</span><br><span class="line"></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> SizedBox(</span><br><span class="line">      width: width,</span><br><span class="line">      child: Hero(</span><br><span class="line">        tag: photo,</span><br><span class="line">        child: Material(</span><br><span class="line">          color: Colors.transparent,</span><br><span class="line">          child: InkWell(</span><br><span class="line">            onTap: onTap,</span><br><span class="line">            child: Image.network(</span><br><span class="line">              photo,</span><br><span class="line">              fit: BoxFit.contain,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroAnimation</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    timeDilation = <span class="number">10.0</span>; <span class="comment">// 1.0 means normal animation speed.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: <span class="keyword">const</span> Text(<span class="string">&#x27;Basic Hero Animation&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: PhotoHero(</span><br><span class="line">          photo: <span class="string">&#x27;https://raw.githubusercontent.com/flutter/website/master/examples/_animation/hero_animation/images/flippers-alpha.png&#x27;</span>,</span><br><span class="line">          width: <span class="number">300.0</span>,</span><br><span class="line">          onTap: () &#123;</span><br><span class="line">            Navigator.of(context).push(MaterialPageRoute&lt;<span class="keyword">void</span>&gt;(</span><br><span class="line">                builder: (BuildContext context) &#123;</span><br><span class="line">                  <span class="keyword">return</span> Scaffold(</span><br><span class="line">                    appBar: AppBar(</span><br><span class="line">                      title: <span class="keyword">const</span> Text(<span class="string">&#x27;Flippers Page&#x27;</span>),</span><br><span class="line">                    ),</span><br><span class="line">                    body: Container(</span><br><span class="line">                      <span class="comment">// Set background to blue to emphasize that it&#x27;s a new route.</span></span><br><span class="line">                      color: Colors.lightBlueAccent,</span><br><span class="line">                      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">16.0</span>),</span><br><span class="line">                      alignment: Alignment.topLeft,</span><br><span class="line">                      child: PhotoHero(</span><br><span class="line">                        photo: <span class="string">&#x27;https://raw.githubusercontent.com/flutter/website/master/examples/_animation/hero_animation/images/flippers-alpha.png&#x27;</span>,</span><br><span class="line">                        width: <span class="number">100.0</span>,</span><br><span class="line">                        onTap: () &#123;</span><br><span class="line">                          Navigator.of(context).pop();</span><br><span class="line">                        &#125;,</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  );</span><br><span class="line">                &#125;</span><br><span class="line">            ));</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MaterialApp(home: HeroAnimation()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hero的函数原型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Hero(&#123;</span><br><span class="line">   Key key,</span><br><span class="line">   @required this.tag,</span><br><span class="line">   this.createRectTween,</span><br><span class="line">   this.flightShuttleBuilder,</span><br><span class="line">   this.placeholderBuilder,</span><br><span class="line">   this.transitionOnUserGestures = false,</span><br><span class="line">   @required this.child,</span><br><span class="line"> &#125;) : assert(tag != null),</span><br><span class="line">      assert(transitionOnUserGestures != null),</span><br><span class="line">      assert(child != null),</span><br><span class="line">      super(key: key);</span><br></pre></td></tr></table></figure><ul><li>tag：[必须]用于关联两个Hero动画的标识；</li><li>createRectTween：[可选]定义目标Hero的边界，在从起始位置到目的位置的“飞行”过程中该如何变化；</li><li>child：[必须]定义动画所呈现的widget；</li></ul><p>实现径向hero动画</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span> <span class="keyword">as</span> math;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/scheduler.dart&#x27;</span> <span class="keyword">show</span> timeDilation;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Photo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  Photo(&#123; Key key, <span class="keyword">this</span>.photo, <span class="keyword">this</span>.color, <span class="keyword">this</span>.onTap &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> photo;</span><br><span class="line">  <span class="keyword">final</span> Color color;</span><br><span class="line">  <span class="keyword">final</span> VoidCallback onTap;</span><br><span class="line"></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Material(</span><br><span class="line">      <span class="comment">// Slightly opaque color appears where the image has transparency.</span></span><br><span class="line">      color: Theme.of(context).primaryColor.withOpacity(<span class="number">0.25</span>),</span><br><span class="line">      child: InkWell(</span><br><span class="line">        onTap: onTap,</span><br><span class="line">        child: LayoutBuilder(</span><br><span class="line">          builder: (BuildContext context, BoxConstraints size) &#123;</span><br><span class="line">            <span class="keyword">return</span> Image.network(</span><br><span class="line">              photo,</span><br><span class="line">              fit: BoxFit.contain,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RadialExpansion</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  RadialExpansion(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="keyword">this</span>.maxRadius,</span><br><span class="line">    <span class="keyword">this</span>.child,</span><br><span class="line">  &#125;) : clipRectSize = <span class="number">2.0</span> * (maxRadius / math.sqrt2),</span><br><span class="line">        <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> maxRadius;</span><br><span class="line">  <span class="keyword">final</span> clipRectSize;</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ClipOval(</span><br><span class="line">      child: Center(</span><br><span class="line">        child: SizedBox(</span><br><span class="line">          width: clipRectSize,</span><br><span class="line">          height: clipRectSize,</span><br><span class="line">          child: ClipRect(</span><br><span class="line">            child: child,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RadialExpansionDemo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">double</span> kMinRadius = <span class="number">32.0</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">double</span> kMaxRadius = <span class="number">128.0</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> opacityCurve = <span class="keyword">const</span> Interval(<span class="number">0.0</span>, <span class="number">0.75</span>, curve: Curves.fastOutSlowIn);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> RectTween _createRectTween(Rect begin, Rect end) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialRectCenterArcTween(begin: begin, end: end);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Widget _buildPage(BuildContext context, <span class="built_in">String</span> imageName, <span class="built_in">String</span> description) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      color: Theme.of(context).canvasColor,</span><br><span class="line">      child: Center(</span><br><span class="line">        child: Card(</span><br><span class="line">          elevation: <span class="number">8.0</span>,</span><br><span class="line">          child: Column(</span><br><span class="line">            mainAxisSize: MainAxisSize.min,</span><br><span class="line">            children: [</span><br><span class="line">              SizedBox(</span><br><span class="line">                width: kMaxRadius * <span class="number">2.0</span>,</span><br><span class="line">                height: kMaxRadius * <span class="number">2.0</span>,</span><br><span class="line">                child: Hero(</span><br><span class="line">                  createRectTween: _createRectTween,</span><br><span class="line">                  tag: imageName,</span><br><span class="line">                  child: RadialExpansion(</span><br><span class="line">                    maxRadius: kMaxRadius,</span><br><span class="line">                    child: Photo(</span><br><span class="line">                      photo: imageName,</span><br><span class="line">                      onTap: () &#123;</span><br><span class="line">                        Navigator.of(context).pop();</span><br><span class="line">                      &#125;,</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              Text(</span><br><span class="line">                description,</span><br><span class="line">                style: TextStyle(fontWeight: FontWeight.bold),</span><br><span class="line">                textScaleFactor: <span class="number">3.0</span>,</span><br><span class="line">              ),</span><br><span class="line">              <span class="keyword">const</span> SizedBox(height: <span class="number">16.0</span>),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _buildHero(BuildContext context, <span class="built_in">String</span> imageName, <span class="built_in">String</span> description) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      width: kMinRadius * <span class="number">2.0</span>,</span><br><span class="line">      height: kMinRadius * <span class="number">2.0</span>,</span><br><span class="line">      child: Hero(</span><br><span class="line">        createRectTween: _createRectTween,</span><br><span class="line">        tag: imageName,</span><br><span class="line">        child: RadialExpansion(</span><br><span class="line">          maxRadius: kMaxRadius,</span><br><span class="line">          child: Photo(</span><br><span class="line">            photo: imageName,</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              Navigator.of(context).push(</span><br><span class="line">                PageRouteBuilder&lt;<span class="keyword">void</span>&gt;(</span><br><span class="line">                  pageBuilder: (BuildContext context, Animation&lt;<span class="built_in">double</span>&gt; animation, Animation&lt;<span class="built_in">double</span>&gt; secondaryAnimation) &#123;</span><br><span class="line">                    <span class="keyword">return</span> AnimatedBuilder(</span><br><span class="line">                        animation: animation,</span><br><span class="line">                        builder: (BuildContext context, Widget child) &#123;</span><br><span class="line">                          <span class="keyword">return</span> Opacity(</span><br><span class="line">                            opacity: opacityCurve.transform(animation.value),</span><br><span class="line">                            child: _buildPage(context, imageName, description),</span><br><span class="line">                          );</span><br><span class="line">                        &#125;</span><br><span class="line">                    );</span><br><span class="line">                  &#125;,</span><br><span class="line">                ),</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    timeDilation = <span class="number">5.0</span>; <span class="comment">// 1.0 is normal animation speed.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: <span class="keyword">const</span> Text(<span class="string">&#x27;Radial Transition Demo&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">32.0</span>),</span><br><span class="line">        alignment: FractionalOffset.bottomLeft,</span><br><span class="line">        child: Row(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">          children: [</span><br><span class="line">            _buildHero(context, <span class="string">&#x27;https://raw.githubusercontent.com/flutter/website/master/examples/_animation/radial_hero_animation/images/chair-alpha.png&#x27;</span>, <span class="string">&#x27;Chair&#x27;</span>),</span><br><span class="line">            _buildHero(context, <span class="string">&#x27;https://raw.githubusercontent.com/flutter/website/master/examples/_animation/radial_hero_animation/images/binoculars-alpha.png&#x27;</span>, <span class="string">&#x27;Binoculars&#x27;</span>),</span><br><span class="line">            _buildHero(context, <span class="string">&#x27;https://raw.githubusercontent.com/flutter/website/master/examples/_animation/radial_hero_animation/images/beachball-alpha.png&#x27;</span>, <span class="string">&#x27;Beach ball&#x27;</span>),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MaterialApp(home: RadialExpansionDemo()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;精心设计的动画会让用户界面感觉更直观、流畅，能改善用户体验。 Flutter的动画支持可以轻松实现各种动画类型。许多widget，特别是Material Design widgets， 都带有在其设计规范中定义的标准动画效果，但也可以自定义这些效果。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 图片控件开发详解</title>
    <link href="https://rencheng.cc/2020/02/10/flutter/Flutter%E5%9B%BE%E7%89%87/"/>
    <id>https://rencheng.cc/2020/02/10/flutter/Flutter%E5%9B%BE%E7%89%87/</id>
    <published>2020-02-10T03:36:36.000Z</published>
    <updated>2020-02-10T03:36:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter 图片组件开发详解</p><span id="more"></span><h2 id="图片控件开发详解"><a href="#图片控件开发详解" class="headerlink" title="图片控件开发详解"></a>图片控件开发详解</h2><ul><li>Image widget</li><li>如何加载网络图片？</li><li>如何加载静态图片？</li><li>如何加载本地图片？</li><li>如何设置Placeholder?</li><li>如何配置图片缓存？</li><li>如何加载Icon？</li></ul><h3 id="Image-widget"><a href="#Image-widget" class="headerlink" title="Image widget"></a>Image widget</h3><p>Flutter中一个用来展示图片的widget。</p><h4 id="Image支持如下几种类型的构造函数："><a href="#Image支持如下几种类型的构造函数：" class="headerlink" title="Image支持如下几种类型的构造函数："></a><strong>Image</strong>支持如下几种类型的构造函数：</h4><ul><li><a href="https://docs.flutter.io/flutter/widgets/Image/Image.html">new Image</a> - 用于从ImageProvider获取图像；</li><li><a href="https://docs.flutter.io/flutter/widgets/Image/Image.asset.html">new Image.asset</a> - 使用key 从AssetBundle获得的图像；</li><li><a href="https://docs.flutter.io/flutter/widgets/Image/Image.network.html">new Image.network</a> -  从网络URL中获取图片；</li><li><a href="https://docs.flutter.io/flutter/widgets/Image/Image.file.html">new Image.file</a> -  从本地文件中获取图片；</li><li><a href="https://docs.flutter.io/flutter/widgets/Image/Image.memory.html">new Image.memory</a> - 用于从Uint8List获取图像；</li></ul><blockquote><p>在加载项目中的图片资源时，为了让Image能够根据像素密度自动适配不同分辨率的图片，请使用<code>AssetImage</code>指定图像，并确保在widget树中的“Image” widget上方存在<code>MaterialApp</code>，<code>WidgetsApp</code>或<code>MediaQuery</code>窗口widget。</p></blockquote><h4 id="Image支持的图片格式"><a href="#Image支持的图片格式" class="headerlink" title="Image支持的图片格式"></a>Image支持的图片格式</h4><p>Image 支持以下类型的图片：<code>JPEG</code>, <code>PNG</code>, <code>GIF</code>, <code>Animated GIF</code>, <code>WebP</code>, <code>Animated WebP</code>, <code>BMP</code>, 和 <code>WBMP</code>。</p><h3 id="如何加载网络图片？"><a href="#如何加载网络图片？" class="headerlink" title="如何加载网络图片？"></a>如何加载网络图片？</h3><p>要加载网络图片，我们需要使用<code>Image.network</code>构造方法：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Image.network(</span><br><span class="line">  <span class="string">&#x27;http://www.devio.org/img/avatar.png&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>demo:</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter bottomNavigationBar&#x27;</span>,</span><br><span class="line">      theme: <span class="keyword">new</span> ThemeData.fallback(),</span><br><span class="line">      home: Image.network(</span><br><span class="line">        <span class="string">&#x27;http://www.devio.org/img/avatar.png&#x27;</span>,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="如何加载静态图片，以及处理不同分辨率的图片？"><a href="#如何加载静态图片，以及处理不同分辨率的图片？" class="headerlink" title="如何加载静态图片，以及处理不同分辨率的图片？"></a>如何加载静态图片，以及处理不同分辨率的图片？</h3><p>要加载项目中的静态图片，需要一些两步：</p><ul><li>在 <code>pubspec.yaml</code> 文件中声明图片资源的路径；</li><li>使用 <code>AssetImage</code> 访问图片；</li></ul><p><code>pubspec.yaml</code> 声明图片路径：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assets:</span><br><span class="line"> - images/my_icon.png</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 代表images文件夹下所有资源</span><br><span class="line">assets:</span><br><span class="line"> - images/</span><br></pre></td></tr></table></figure><p>使用<code>AssetImage</code>访问图片图片：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Image(</span><br><span class="line">  height: <span class="number">26</span>,</span><br><span class="line">  width: <span class="number">26</span>,</span><br><span class="line">  image: AssetImage(my_icon.png),</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>除了我们使用<code>Image</code>的构造方法手动指定<code>AssetImage</code>之外，还可通过<code>Image.asset</code>来加载静态图片：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Image.asset(my_icon.png,</span><br><span class="line">width: 26,</span><br><span class="line">height: 26,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>两者是等效的。</p><h3 id="如何加载本地图片？"><a href="#如何加载本地图片？" class="headerlink" title="如何加载本地图片？"></a>如何加载本地图片？</h3><h4 id="加载完整路径的本地图片"><a href="#加载完整路径的本地图片" class="headerlink" title="加载完整路径的本地图片"></a>加载完整路径的本地图片</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line">Image.file(File(<span class="string">&#x27;/sdcard/Download/Stack.png&#x27;</span>)),</span><br></pre></td></tr></table></figure><h4 id="加载相对路径的本地图片"><a href="#加载相对路径的本地图片" class="headerlink" title="加载相对路径的本地图片"></a>加载相对路径的本地图片</h4><p><strong>第一步：</strong><br>在pubspec.yaml中添加<a href="https://pub.dartlang.org/packages/path_provider">path_provider</a>插件；</p><p><strong>第二步：导入头文件</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:path_provider/path_provider.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Image.file(File(&#x27;/sdcard/Download/Stack.png&#x27;)),</span></span><br><span class="line">FutureBuilder(future: _getLocalFile(<span class="string">&quot;Download/Stack.png&quot;</span>),</span><br><span class="line">  builder:  (BuildContext context, AsyncSnapshot&lt;File&gt; snapshot) &#123;</span><br><span class="line">    <span class="keyword">return</span> snapshot.data != <span class="keyword">null</span> ? Image.file(snapshot.data) : Container();</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"><span class="comment">//获取SDCard的路径：</span></span><br><span class="line">Future&lt;File&gt; _getLocalFile(<span class="built_in">String</span> filename) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">String</span> dir = (<span class="keyword">await</span> getExternalStorageDirectory()).path;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&#x27;<span class="subst">$dir</span>/<span class="subst">$filename</span>&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="如何设置placeholder"><a href="#如何设置placeholder" class="headerlink" title="如何设置placeholder?"></a>如何设置placeholder?</h3><p>为了设置Placeholder我们需要借助<a href="https://docs.flutter.io/flutter/widgets/FadeInImage-class.html">FadeInImage</a>，它能够从内存，本地资源中加载placeholder。</p><h4 id="从内存中加载placeholder"><a href="#从内存中加载placeholder" class="headerlink" title="从内存中加载placeholder"></a>从内存中加载placeholder</h4><p><strong>第一步：</strong></p><p>安装<a href="https://pub.dartlang.org/packages/transparent_image">transparent_image</a>插件。</p><p><strong>第二步：</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:transparent_image/transparent_image.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;Fade in images&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: Stack(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Center(child: CircularProgressIndicator()),</span><br><span class="line">            Center(</span><br><span class="line">              child: FadeInImage.memoryNetwork(</span><br><span class="line">                placeholder: kTransparentImage,</span><br><span class="line">                image: <span class="string">&#x27;http://www.devio.org/img/avatar.png&#x27;</span>,</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="从本地资源中加载placeholder"><a href="#从本地资源中加载placeholder" class="headerlink" title="从本地资源中加载placeholder"></a>从本地资源中加载placeholder</h4><p><strong>第一步</strong></p><p>配置本地资源图片：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter:</span><br><span class="line">  assets:</span><br><span class="line">    - assets/loading.gif</span><br></pre></td></tr></table></figure><p><strong>第二步</strong></p><p>加载本地资源图片作为placeholder：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FadeInImage.assetNetwork(</span><br><span class="line">  placeholder: <span class="string">&#x27;assets/loading.gif&#x27;</span>,</span><br><span class="line">  image: <span class="string">&#x27;http://www.devio.org/img/avatar.png&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="如何配置图片缓存？"><a href="#如何配置图片缓存？" class="headerlink" title="如何配置图片缓存？"></a>如何配置图片缓存？</h3><p>在Flutter中我们可以借助<a href="https://pub.dartlang.org/packages/cached_network_image">cached_network_image</a>插件，来从网络上加载图片，并且将其缓存到本地，以供下次使用。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:cached_network_image/cached_network_image.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> title = <span class="string">&#x27;Cached Images&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(title),</span><br><span class="line">        ),</span><br><span class="line">        body: Center(</span><br><span class="line">          child: CachedNetworkImage(</span><br><span class="line">            placeholder: (context, url) =&gt; <span class="keyword">new</span> CircularProgressIndicator(),</span><br><span class="line">            imageUrl:</span><br><span class="line">                <span class="string">&#x27;https://picsum.photos/250?image=9&#x27;</span>,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="如何加载Icon？"><a href="#如何加载Icon？" class="headerlink" title="如何加载Icon？"></a>如何加载Icon？</h3><p>在Flutter中我们可以借助<a href="https://docs.flutter.io/flutter/widgets/Icon-class.html">Icon</a>来加载icon：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Icon(<span class="keyword">this</span>.icon<span class="comment">//IconDate, &#123;</span></span><br><span class="line">   Key key,</span><br><span class="line">   <span class="keyword">this</span>.size,<span class="comment">//大小</span></span><br><span class="line">   <span class="keyword">this</span>.color,<span class="comment">//颜色</span></span><br><span class="line">   <span class="keyword">this</span>.semanticLabel,<span class="comment">//标志位</span></span><br><span class="line">   <span class="keyword">this</span>.textDirection,<span class="comment">//绘制方向，一般使用不到</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure><p>从Icon的构造方法可以很清楚的看出Icon构造方法需要一个默认的类型为IconData类型的参数，我们可以构造一个自己的IconData，也可以使用Flutter提供的<a href="https://design.google.com/icons/">material_fonts</a>。</p><h4 id="使用Icons"><a href="#使用Icons" class="headerlink" title="使用Icons"></a>使用Icons</h4><p>通过如下代码我们可以使用Flutter内置的material_fonts：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(<span class="keyword">new</span> MaterialApp(home: <span class="keyword">new</span> MyApp()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> AppBar(</span><br><span class="line">        title: <span class="keyword">new</span> Text(<span class="string">&quot;Icons&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="keyword">new</span> Center(</span><br><span class="line">        child: <span class="keyword">new</span> Icon(Icons.android,size: <span class="number">100.0</span>),</span><br><span class="line">      ),</span><br><span class="line">        );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用自定义的Icon"><a href="#使用自定义的Icon" class="headerlink" title="使用自定义的Icon"></a>使用自定义的Icon</h4><p>使用自定义的我们需要构造一个：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> IconData(</span><br><span class="line">  <span class="keyword">this</span>.codePoint,<span class="comment">//必填参数，fonticon对应的16进制Unicode &#123;</span></span><br><span class="line">  <span class="keyword">this</span>.fontFamily,<span class="comment">//字体库系列</span></span><br><span class="line">  <span class="keyword">this</span>.fontPackage,<span class="comment">//字体在那个包中，不填仅在自己程序包中查找</span></span><br><span class="line">  <span class="keyword">this</span>.matchTextDirection: <span class="keyword">false</span>,图标是否按照图标绘制方向显示</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>首先我我们需要向使用字体一样，在pubspec.yaml中配置我们的icon：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fonts:</span><br><span class="line">- family: devio</span><br><span class="line">  fonts:</span><br><span class="line">    - asset: fonts/devio.ttf</span><br></pre></td></tr></table></figure><p>接下来就可以使用了：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child: <span class="keyword">new</span> Icon(<span class="keyword">new</span> IconData(<span class="number">0xf5566</span>,fontFamily: <span class="string">&quot;devio&quot;</span>),size: <span class="number">100.0</span>,color: Colors.blueAccent,)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Flutter 图片组件开发详解&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 常用组件</title>
    <link href="https://rencheng.cc/2020/02/05/flutter/Flutter%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/"/>
    <id>https://rencheng.cc/2020/02/05/flutter/Flutter%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/</id>
    <published>2020-02-05T06:12:08.000Z</published>
    <updated>2020-02-05T06:12:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>一切皆组件。Flutter所有的元素都是由组件组成。比如一个布局元素、一个动画、一个装饰效果等。</p><span id="more"></span><h2 id="Container-容器组件"><a href="#Container-容器组件" class="headerlink" title="Container(容器组件)"></a>Container(容器组件)</h2><p><strong><code>Container</code><strong>包含</strong><em>一个</em></strong><code>子widget</code>，自身具备<code>alignment</code>、<code>padding</code>等属性，方便布局过程中摆放<code>child</code></p><h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h3><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">key</td><td align="left">key</td><td align="left">Container唯一标识符，用于查找更新</td></tr><tr><td align="left">alignment</td><td align="left">AlignmentGeometry</td><td align="left">控制child的对齐方式，如果Container或者Container的父节点尺寸大于child的尺寸，该属性设置会起作用，有很多种对齐方式</td></tr><tr><td align="left">padding</td><td align="left">EdgeInsetsGeometry</td><td align="left">Decoration内部的空白区，如果有child，child位于padding内部</td></tr><tr><td align="left">color</td><td align="left">Color</td><td align="left">用来设置Container背景色，如果foregroudDecoration设置的话，可能会覆盖color效果</td></tr><tr><td align="left">decoration</td><td align="left">Decoration</td><td align="left">绘制在child后面的修饰，设置了Decoration的话，就不能设置color属性，否则会报错，此时应该在Decoration中进行颜色的设置</td></tr><tr><td align="left">foregroundDecoration</td><td align="left">Decoration</td><td align="left">绘制在child前面的装饰</td></tr><tr><td align="left">width</td><td align="left">double</td><td align="left">Container的宽度，设置为double.infinity可以强制在宽度上撑满，不设置，则根据child和父节点两者一起布局</td></tr><tr><td align="left">height</td><td align="left">double</td><td align="left">Container的高度，设置为double.infinity可以强制在高度上撑满</td></tr><tr><td align="left">constraints</td><td align="left">BoxConstraints</td><td align="left">添加到child上额外的约束条件</td></tr><tr><td align="left">margin</td><td align="left">EdgeInsetsGeometry</td><td align="left">围绕在Decoration和child之外的空白区域，不属于内容区域</td></tr><tr><td align="left">transform</td><td align="left">Matrix4</td><td align="left">设置Container的变换矩阵，类型为Matrix4</td></tr><tr><td align="left">child</td><td align="left">Widget</td><td align="left">Container中的内容Widget</td></tr></tbody></table><blockquote><p>padding与margin的不同之处：padding是包含在Content内，而margin是外部边界。设置点击事件的话，padding区域会响应，而margin区域不会响应。</p></blockquote><h2 id="Text-文本"><a href="#Text-文本" class="headerlink" title="Text(文本)"></a>Text(文本)</h2><p>文本组件Text负责显示文本和定义显示样式。</p><h3 id="常用属性-1"><a href="#常用属性-1" class="headerlink" title="常用属性"></a>常用属性</h3><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">data</td><td align="left">String</td><td align="left"></td><td align="left">数据为要显示的文本</td></tr><tr><td align="left">maxLines</td><td align="left">int</td><td align="left">0</td><td align="left">文本显示的最大行数</td></tr><tr><td align="left">style</td><td align="left">TextStyle</td><td align="left">null</td><td align="left">文本样式，可定义文本的字体大小、颜色、粗细等</td></tr><tr><td align="left">textAlign</td><td align="left">TextAlign</td><td align="left">TextAlign.center</td><td align="left">文本水平方向对齐方式，取值右center、end、justify、left、right、start、values</td></tr><tr><td align="left">textDirection</td><td align="left">TextDirection</td><td align="left">TextDirection.ltr</td><td align="left">有些文本书写方向从左到右，如英语、中文，有些则是从右到左，比如乌尔都语。</br>从左到右使用TextDirection.ltr</br>从右到左使用TextDirection.rtl</td></tr><tr><td align="left">textScaleFactor</td><td align="left">double</td><td align="left">1.0</td><td align="left">字体缩放系数，比如设置为1.5，那么字体会放大1.5倍</td></tr><tr><td align="left">textSpan</td><td align="left">TextSpan</td><td align="left">null</td><td align="left">文本块，TextSpan里可以包含文本内容及样式</td></tr></tbody></table><h2 id="RichText-富文本"><a href="#RichText-富文本" class="headerlink" title="RichText(富文本)"></a>RichText(富文本)</h2><p>富文本组件RichText使用多个不同风格的widget显示文本，要显示的文本使用TextSpan对象树来描述，每个对象都有一个用于该子树的关联样式。文本可能多行，也可能显示在同一行，取决于布局约束。</p><h3 id="常用属性-2"><a href="#常用属性-2" class="headerlink" title="常用属性"></a>常用属性</h3><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">text</td><td align="left">TextSpan</td><td align="left">-</td><td align="left">要显示的的文本</td></tr><tr><td align="left">textAlign</td><td align="left">TextAlign</td><td align="left">TextAlign.start</td><td align="left">文本水平方向对齐方式，取值右center、end、justify、left、right、start、values</td></tr><tr><td align="left">textDirection</td><td align="left">TextDirection</td><td align="left">TextDirection.ltr</td><td align="left">有些文本书写方向从左到右，如英语、中文，有些则是从右到左，比如乌尔都语。</br>从左到右使用TextDirection.ltr</br>从右到左使用TextDirection.rtl</td></tr><tr><td align="left">softWrap</td><td align="left">bool</td><td align="left">true</td><td align="left">是否自动换行</td></tr><tr><td align="left">overflow</td><td align="left">TextOverflow</td><td align="left">TextOverflow.clip</td><td align="left">内容超出文本范围处理方式，默认截断处理</td></tr><tr><td align="left">textScaleFactor</td><td align="left">double</td><td align="left">1.0</td><td align="left">文本缩放比例，默认100%比例显示</td></tr><tr><td align="left">maxLines</td><td align="left">int</td><td align="left">-</td><td align="left">最大显示行数</td></tr></tbody></table><h2 id="Image-图片组件"><a href="#Image-图片组件" class="headerlink" title="Image(图片组件)"></a>Image(图片组件)</h2><p><a href="https://rencheng.cc/2020/02/10/flutter/Flutter%E5%9B%BE%E7%89%87/">详细介绍</a><br>图片组件Image显示图像的组件，有多种构造函数：</p><ul><li><code>new Image</code>：从ImageProvider获取图像</li><li><code>new Image.asset</code>：加载资源图片</li><li><code>new Image.file</code>：加载本地图片文件</li><li><code>new Image.network</code>：加载网络图片</li><li><code>new Image.memory</code>：加载Uint8List资源图片</li></ul><h3 id="常用属性-3"><a href="#常用属性-3" class="headerlink" title="常用属性"></a>常用属性</h3><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">image</td><td align="left">ImageProvider</td><td align="left">抽象类，需要自己实现获取图片数据的操作</td></tr><tr><td align="left">width/height</td><td align="left">double</td><td align="left">Image显示区域的宽度和高度设置，这里需要把Image和图片两个区分开。图片本身有大小，Image Widget是图片的容器，本身也有大小。宽度和高度的配置经常和fit属性搭配</td></tr><tr><td align="left">fit</td><td align="left">BoxFit</td><td align="left">图片填充模式，具体取值见 BoxFit取值表</td></tr><tr><td align="left">color</td><td align="left">Color</td><td align="left">图片颜色</td></tr><tr><td align="left">colorBlendMode</td><td align="left">BlendMode</td><td align="left">在对图片进行手动处理的时候，可能用到图层混合，如改变图片颜色，此属性可以对颜色进行混合处理，有多种模式</td></tr><tr><td align="left">alignment</td><td align="left">Alignment</td><td align="left">控制图片的摆放位置，比如图片放置在右下角则为Alignment.bottomRight</td></tr><tr><td align="left">repeat</td><td align="left">ImageRepeat</td><td align="left">此属性可以设置图片的重复模式。moRepeat为不重复，Repeat为x和y方向重复，repeatX为x方向重复，repeatY为y方向重复</td></tr><tr><td align="left">centerSlice</td><td align="left">Rect</td><td align="left">当图片需要被拉伸显示时，centerSlice定义的矩形区域会被拉伸，可以理解为我们在图片内部定义9个点用作拉伸，9个点为”上”,”下”,”左”,”右”,”上中”,”下中”,”左中”,”右中”,”正中”</td></tr><tr><td align="left">matchTextDirection</td><td align="left">bool</td><td align="left">matchTextDirection与Derection配合使用。TextDirectio有两个值分别为：TextDirection.ltr从左到右展示图片，TextDirection.rtl为从右到左展示图片</td></tr><tr><td align="left">gaplessPlayback</td><td align="left">bool</td><td align="left">当ImageProvider发生变化后，重新加载图片的过程中，原图片的展示是否保留。值为true则保留，值为false则不保留，直接等待下一张图片加载</td></tr></tbody></table><h3 id="BoxFit取值及描述"><a href="#BoxFit取值及描述" class="headerlink" title="BoxFit取值及描述"></a>BoxFit取值及描述</h3><table><thead><tr><th align="left">值</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">BoxFit.fill</td><td align="left">全图显示，显示可能拉伸，充满</td></tr><tr><td align="left">BoxFit.contain</td><td align="left">全图显示，显示原比例，不需充满</td></tr><tr><td align="left">BoxFit.cover</td><td align="left">显示可能拉伸，可能裁剪，充满</td></tr><tr><td align="left">BoxFit.fitWidth</td><td align="left">显示可能拉伸，可能裁剪，宽度充满</td></tr><tr><td align="left">BoxFit.fitHeight</td><td align="left">显示可能拉伸，可能裁剪，高度充满</td></tr><tr><td align="left">BoxFit.none</td><td align="left">原始大小</td></tr><tr><td align="left">BoxFit.scaleDown</td><td align="left">效果和BoxFit.contain差不多，但是该属性不允许显示超过原图大小(可小不可大)</td></tr></tbody></table><h2 id="Icon-图标"><a href="#Icon-图标" class="headerlink" title="Icon(图标)"></a>Icon(图标)</h2><p>Flutter中，可以像web开发一样使用iconfont，iconfont即<code>字体图标</code>，它是将图标做成字体文件，然后通过指定不同的字符而显示不同的图片。</p><p><strong>在Flutter开发中，iconfont和图片相比有如下优势：</strong></p><ol><li>体积小：可以减小安装包大小。</li><li>矢量的：iconfont 都是矢量图标，放大不会影响其清晰度。</li><li>可以应用文本样式：可以像文本一样改变字体图标的颜色、大小对齐等。</li><li>可以通过 TextSpan 和文本混用。</li></ol><h3 id="常用属性-4"><a href="#常用属性-4" class="headerlink" title="常用属性"></a>常用属性</h3><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">icon</td><td align="left">IconData</td><td align="left">null</td><td align="left">展示的具体图标，可使用Icons图标列表中的任意一个图标即可，如Icons.phone表示一个电话的图标</td></tr><tr><td align="left">color</td><td align="left">Color</td><td align="left">null</td><td align="left">图标的颜色</td></tr><tr><td align="left">style</td><td align="left">TextStyle</td><td align="left">null</td><td align="left">文本样式，可定义文本的字体大小、颜色、粗细等</td></tr><tr><td align="left">size</td><td align="left">Double</td><td align="left">24.0</td><td align="left">图标的大小，注意需要带上小数位</td></tr><tr><td align="left">textDirection</td><td align="left">TextDirection</td><td align="left">TextDirection.ltr</td><td align="left">Icon组件里也可以添加文本内容。有些文本书写的方向是从左到右，有些则是从右到左。</br>从左到右使用TextDirection.ltr</br>从右到左使用TextDirection.rtl</td></tr></tbody></table><h2 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h2><h3 id="IconButton（图标按钮）"><a href="#IconButton（图标按钮）" class="headerlink" title="IconButton（图标按钮）"></a>IconButton（图标按钮）</h3><p>图标按钮组件IconButton是基于<code>Meterial Design</code>风格的组件，可以响应按下的事件，并且按下时带水波纹效果。如果它的<code>onPressed</code>回调函数为<code>null</code>，那么这个按钮处于禁用状态，并且不可按下。</p><h4 id="常用属性-5"><a href="#常用属性-5" class="headerlink" title="常用属性"></a>常用属性</h4><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">alignment</td><td align="left">AlignmentGeometry</td><td align="left">Alignment.center</td><td align="left">定义IconButton的Icon对齐方式，默认为居中。Alignment可以设置x，y的偏移量</td></tr><tr><td align="left">icon</td><td align="left">Widget</td><td align="left">null</td><td align="left">展示的具体图标，可以使用Icons图标列表中任意一个图标即可，如Icons.phone表示一个电话图标</td></tr><tr><td align="left">color</td><td align="left">Color</td><td align="left">null</td><td align="left">图标组件的颜色</td></tr><tr><td align="left">disabledColor</td><td align="left">Color</td><td align="left">ThemeData.disabledColor</td><td align="left">图标组件禁用状态的颜色，默认为主题里的禁用颜色，也可以设置为其他颜色</td></tr><tr><td align="left">iconSize</td><td align="left">double</td><td align="left">24.0</td><td align="left">图标的大小，注意需要带上小数点</td></tr><tr><td align="left">onPressed</td><td align="left">VoidCallback</td><td align="left">null</td><td align="left">当按钮按下时会触发此回调事件</td></tr><tr><td align="left">tooltip</td><td align="left">String</td><td align="left">“”</td><td align="left">当按钮长按下时的提示语句</td></tr></tbody></table><h3 id="RaisedButton-凸起按钮"><a href="#RaisedButton-凸起按钮" class="headerlink" title="RaisedButton(凸起按钮)"></a>RaisedButton(凸起按钮)</h3><p>RaisedButton是<code>Material Design</code>中的button，一个凸起的材质矩形按钮，它可以响应按下事件，并且按下时会带一个触摸效果。</p><h3 id="FlatButton-扁平化的按钮"><a href="#FlatButton-扁平化的按钮" class="headerlink" title="FlatButton(扁平化的按钮)"></a>FlatButton(扁平化的按钮)</h3><h3 id="OutlineButton-外边框的按钮"><a href="#OutlineButton-外边框的按钮" class="headerlink" title="OutlineButton(外边框的按钮)"></a>OutlineButton(外边框的按钮)</h3><h4 id="常用属性-6"><a href="#常用属性-6" class="headerlink" title="常用属性"></a>常用属性</h4><table><thead><tr><th align="left">属性名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">color</td><td align="left">Color</td><td align="left">null</td><td align="left">组件的颜色</td></tr><tr><td align="left">disabledColor</td><td align="left">Color</td><td align="left">ThemeData.disabledColor</td><td align="left">组件禁用状态的颜色，默认为主题里的禁用颜色，也可以设置为其他颜色</td></tr><tr><td align="left">onPressed</td><td align="left">VoidCallback</td><td align="left">null</td><td align="left">当按钮按下时会触发此回调事件</td></tr><tr><td align="left">child</td><td align="left">Widget</td><td align="left">-</td><td align="left">按钮的child通常为一个Text文本组件，用来显示按钮的文本</td></tr><tr><td align="left">enable</td><td align="left">bool</td><td align="left">true</td><td align="left">按钮是否为禁用状态</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;一切皆组件。Flutter所有的元素都是由组件组成。比如一个布局元素、一个动画、一个装饰效果等。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 环境配置</title>
    <link href="https://rencheng.cc/2020/02/01/flutter/Flutter%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>https://rencheng.cc/2020/02/01/flutter/Flutter%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2020-02-01T02:19:54.000Z</published>
    <updated>2020-02-01T02:19:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>主要记录一下Mac上安装的步骤<br>这里的步骤和官方的差不多，直接参考<a href="https://flutter.dev/">官网</a></p><span id="more"></span><h2 id="安装Flutter"><a href="#安装Flutter" class="headerlink" title="安装Flutter"></a>安装Flutter</h2><h3 id="下载FlutterSDK"><a href="#下载FlutterSDK" class="headerlink" title="下载FlutterSDK"></a>下载FlutterSDK</h3><ol><li>进入<a href="https://flutter.dev/docs/get-started/install">官网下载页面</a></li><li>选择操作系统</li><li>下载最新版本压缩包</li><li>解压压缩包</li><li>拷贝到家目录下Library文件夹下，文件夹名称更改为Flutter（仅供参考）</li></ol><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><ol><li><p>配置镜像</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Flutter</span></span><br><span class="line"><span class="built_in">export</span> PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line"><span class="built_in">export</span> FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure><blockquote><p>来到你对应Shell的配置文件进行配置。<br> 如果你使用默认的bash那么配置<code>~/.bash_profile</code><br> 如果你使用zsh (Mac新 系统默认是zsh)那么配置<code>~/.zshrc</code></p></blockquote></li><li><p>配置Flutter环境变量（将Flutter命令行工具的路径配置到Shell的配置文件中）</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Flutter</span></span><br><span class="line"><span class="built_in">export</span> FLUTTER=~/Library/Flutter/bin $ <span class="built_in">export</span> PATH=<span class="variable">$FLUTTER</span>:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#􏲒 重载配置文件</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure></li><li><p>检查Flutter环境</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter doctor</span><br></pre></td></tr></table></figure><p> 出现如下结果就完成了环境配置<br> <img src="https://cdn.rencheng.cc/blog/3ta0l.jpg-thumb100"><br> 如果出现错误，请把下面Android环境安装完成</p></li></ol><h2 id="配置安卓环境"><a href="#配置安卓环境" class="headerlink" title="配置安卓环境"></a>配置安卓环境</h2><h3 id="安装Android-Studio"><a href="#安装Android-Studio" class="headerlink" title="安装Android Studio"></a>安装Android Studio</h3><p><a href="https://developer.android.google.cn/studio">下载安装</a><br><img src="https://cdn.rencheng.cc/blog/sg06f.jpg-thumb100"></p><h3 id="配置SDK"><a href="#配置SDK" class="headerlink" title="配置SDK"></a>配置SDK</h3><p>网上搜索吧</p><h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p><code>Flutter</code><br>安装后重启</p><h3 id="修改项目下的-build-gradle文件"><a href="#修改项目下的-build-gradle文件" class="headerlink" title="修改项目下的 build.gradle文件"></a>修改项目下的 build.gradle文件</h3><ul><li>文件路径：项目 –&gt; Android –&gt;build.gradle 文件</li><li>修改内容：找到buildscript 和allprojects 将里面的：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">google()</span><br><span class="line">jcenter()</span><br></pre></td></tr></table></figure>修改为阿里云镜像<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url &#x27;https://maven.aliyun.com/repository/google&#x27; &#125;</span><br><span class="line">maven &#123; url &#x27;https://maven.aliyun.com/repository/jcenter&#x27; &#125;</span><br><span class="line">maven &#123; url &#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27; &#125;</span><br></pre></td></tr></table></figure><img src="https://cdn.rencheng.cc/blog/imkyg.png"></li></ul><h3 id="修改Flutter安装目录中的flutter-gradle文件"><a href="#修改Flutter安装目录中的flutter-gradle文件" class="headerlink" title="修改Flutter安装目录中的flutter.gradle文件"></a>修改Flutter安装目录中的flutter.gradle文件</h3><ul><li>文件路径：flutter/packages/flutter_tools/gradle/flutter.gradle</li><li>修改内容（加入阿里镜像）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        // google()</span><br><span class="line">        // jcenter()</span><br><span class="line">        maven &#123; url &#x27;https://maven.aliyun.com/repository/google&#x27; &#125;</span><br><span class="line">    maven &#123; url &#x27;https://maven.aliyun.com/repository/jcenter&#x27; &#125;</span><br><span class="line">    maven &#123; url &#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &#x27;com.android.tools.build:gradle:3.5.0&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><table><thead><tr><th align="left">快捷键</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">Ctrl + option + O</td><td align="left">删除未使用的import</td></tr><tr><td align="left">option + Enter</td><td align="left">自动import未导入的文件</td></tr><tr><td align="left">Shift + F6</td><td align="left">重命名（如果是Touch Bar就是Shift + Rename…）</td></tr><tr><td align="left">CMD + -/+</td><td align="left">折起/展开代码块</td></tr><tr><td align="left">CMD + .</td><td align="left">折起/展开选中代码</td></tr><tr><td align="left">CMD + ,</td><td align="left">进入设置页面</td></tr><tr><td align="left">CMD + [</td><td align="left">光标回到上一次编辑的位置</td></tr><tr><td align="left">CMD + ]</td><td align="left">光标回到下一次编辑的位置</td></tr><tr><td align="left">CMD + L</td><td align="left">定位某一行，甚至某一个字符</td></tr><tr><td align="left">CMD + /</td><td align="left">注释</td></tr><tr><td align="left">CMD + Y</td><td align="left">查看选中类的属性</td></tr><tr><td align="left">CMD + O</td><td align="left">快速打开（一般用于快速打开某个文件）</td></tr><tr><td align="left">option + Enter</td><td align="left">扩展功能(很重要！)</td></tr><tr><td align="left">Option + up(↑)</td><td align="left">选中上一层代码（比如选中当前光标的单词，选中当前小部件的所有代码，自己试~）</td></tr><tr><td align="left">CMD + option + M</td><td align="left">将选中代码提取到某个方法中</td></tr><tr><td align="left">CMD + option + L</td><td align="left">格式化代码</td></tr><tr><td align="left">CMD + Shift + -/+</td><td align="left">折起/展开所有代码块</td></tr><tr><td align="left">Option + Shift + Up/Down</td><td align="left">上下移动行</td></tr><tr><td align="left">Command + Shift + Up/Down</td><td align="left">上下移动方法</td></tr></tbody></table><p><strong>查看小部件源码</strong></p><ul><li>CMD + Click(鼠标左键)</li><li>CMD + B</li><li>CMD + Down（小键盘↓）</li><li>F4（非Touch Bar键盘）</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;主要记录一下Mac上安装的步骤&lt;br&gt;这里的步骤和官方的差不多，直接参考&lt;a href=&quot;https://flutter.dev/&quot;&gt;官网&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 从入门到放弃</title>
    <link href="https://rencheng.cc/2020/01/20/flutter/Flutter%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE/"/>
    <id>https://rencheng.cc/2020/01/20/flutter/Flutter%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-01-20T03:22:27.000Z</published>
    <updated>2020-01-20T03:22:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>列出一些Flutter项目的案例，在你考虑学习之前，先看看里面博主对Flutter的理解；<br>😌。。。，还不是最终的解决方案，但它是目前最优的解决方案；当然也要结合各团队的情况</p><span id="more"></span><h2 id="尝试Flutter的理由"><a href="#尝试Flutter的理由" class="headerlink" title="尝试Flutter的理由"></a>尝试Flutter的理由</h2><ul><li><strong>Dart 语言</strong><br>Flutter 是基于 Dart 设计的，Dart 语言从一开始就被设计为构建客户端应用程序的绝佳工具，并针对 UI 开发工作做了调整和优化。<br>Dart 有着干净且极为强大的语法，加之易于维护的特性，促进了强大的应用程序架构和设计。它与其他流行语言（例如 C#、Java 和 TypeScript）相似，这意味着有相关经验的开发人员很容易快速上手并开始使用 Dart。</li></ul><ol start="2"><li><strong>开发人员的广泛采用</strong><br>在短短的一年时间里，Flutter 在 GitHub 和 StackOverflow 上都取得了比 React Native（之前最流行的框架）更高的流行度。对你的应用程序来说，这意味着有更多的资源可供学习，可以找到更多熟练的开发人员来开发你的应用。此外，Flutter 技术本身的迭代速度更快。</li><li><strong>它特别快</strong><br>Flutter 应用程序可编译为原生二进制文件，这些文件依赖于 C/C++ 内置的图形和渲染引擎，因此可生成非常快速且性能出众的应用程序。Flutter 应用程序能够在大多数设备上实现稳定的 60fps 输出，并在支持高刷新率的设备上实现令人难以置信的 120fps 帧率。<br>许多开发人员已经注意到，Flutter 的性能表现与其他跨平台框架相比有了极大的提升，这也是移动应用开发人员迅速而广泛地采用这一技术的驱动力。确实，在性能表现和流畅的渲染方面，真正的原生构建应用是很难被击败的，但在跨平台框架领域，Flutter 在这些指标的竞争中具有明显的优势。</li><li><strong>它相对易学</strong><br>除了性能表现之外，Flutter 之所以获得如此广泛的使用率，另一大因素就是它提供的出色文档和可供参考的大批高质量示例。对于有兴趣学习新的框架、工具包或语言的开发人员来说，这一切都让 Flutter 与众不同。对于经验丰富的程序员而言这一点尤其重要，因为他们更有可能发现语言或工具包本身的设计问题。<br>Flutter 因其清晰的文档资料以及由新手和专家组成的支持社区而倍受赞誉，社区成员经常渴望分享他们的经验，并提供设计出色、开发模式出众的可靠实践示例，为他人带去福音。一般来说，易学易用，面向大众的技术往往没有那么重的精英主义氛围，所以对新人也更加友好。</li><li><strong>它的设计精良</strong><br>Flutter 是基于出色的语言 Dart 和快速的高性能渲染引擎 Skia 从头开始设计出来的。这样的路线诞生了一个高水平的框架，能鼓励不同技能水平的开发人员基于良好的设计模式和最佳实践来构建应用，而不会因为标准冲突或糟糕的语言实践导致内部技术债。拥有多年经验，能熟练跨各种设备构建应用程序的开发人员开始上手 Flutter 几分钟时间，就能意识到 Flutter 带来的明显优势，新手也不太容易陷入困境，因为互联网上有很多很棒的示例可以用来学习最佳实践。</li></ol><h2 id="学习项目"><a href="#学习项目" class="headerlink" title="学习项目"></a>学习项目</h2><p><a href="https://github.com/flutter/flutter/tree/master/examples">官方示例</a><br><a href="https://github.com/flutter/samples">官方示例</a></p><p><a href="https://github.com/nisrulz/flutter-examples">基础教程</a></p><blockquote><p>项目都是独立的，可单独运行</p></blockquote><p><a href="https://github.com/iampawan/FlutterExampleApps">收集Flutter实例的App</a></p><h2 id="快速开发"><a href="#快速开发" class="headerlink" title="快速开发"></a>快速开发</h2><p><a href="https://app.quicktype.io/">jsontomodel</a></p><h2 id="Flutter-的技术栈"><a href="#Flutter-的技术栈" class="headerlink" title="Flutter 的技术栈"></a>Flutter 的技术栈</h2><p><img src="https://cdn.rencheng.cc/blog/hve50.png"></p><h2 id="Flutter-优势"><a href="#Flutter-优势" class="headerlink" title="Flutter 优势"></a>Flutter 优势</h2><ul><li>跨平台，性能强大</li><li>热重载功能</li><li>免费，开源</li><li>高度可定制</li></ul><h2 id="Flutter-缺点"><a href="#Flutter-缺点" class="headerlink" title="Flutter 缺点"></a>Flutter 缺点</h2><ul><li>双端熟悉</li><li>Dart编程；声明式语法上会发生嵌套地狱</li><li>包体积增大</li></ul><h2 id="Flutter-感受"><a href="#Flutter-感受" class="headerlink" title="Flutter 感受"></a>Flutter 感受</h2><p>作为iOS开发工程师，在学习Flutter过程中，要对Android系统开发也要有些了解，要不然处处是坑；如果想开发一个项目，至少需要iOS和Android两个高级工程师来做，因为Flutter毕竟是跨平台UI的解决方案，它不是原生，在处理底层事件和高性能需求的时候离不开原生，需要制定通讯协议和解决方案；</p><h2 id="对Flutter未来的看法"><a href="#对Flutter未来的看法" class="headerlink" title="对Flutter未来的看法"></a>对Flutter未来的看法</h2><p>个人觉得全量开发的可能性非常非常小，苹果也不允许的，而且目前很多公司的产品改造成Flutter的成本太大，ROI不高，不过flutter确实越来越完善了，如果swiftUI没发力，原生开发肯定会被严重蚕食</p><blockquote><p>你愿意在下一个项目中尝试 Flutter 吗？</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;列出一些Flutter项目的案例，在你考虑学习之前，先看看里面博主对Flutter的理解；&lt;br&gt;😌。。。，还不是最终的解决方案，但它是目前最优的解决方案；当然也要结合各团队的情况&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter - 架构</title>
    <link href="https://rencheng.cc/2020/01/16/flutter/Flutter%E6%9E%B6%E6%9E%84/"/>
    <id>https://rencheng.cc/2020/01/16/flutter/Flutter%E6%9E%B6%E6%9E%84/</id>
    <published>2020-01-16T06:20:09.000Z</published>
    <updated>2020-01-16T06:20:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter 架构图<br><img src="https://cdn.rencheng.cc/blog/whz3d.png"></p><span id="more"></span><h2 id="分层架构"><a href="#分层架构" class="headerlink" title="分层架构"></a>分层架构</h2><p><img src="https://cdn.rencheng.cc/blog/oz4iy.png"></p><ul><li>高性能渲染引擎（Engine 层）是最核心的部分。Flutter不使用浏览器技术，也不使用Native的原生控件，它使用自己的渲染引擎来绘制widget。<ul><li>在Android平台，Flutter引擎的C/C++代码是由NDK编译</li><li>在iOS平台，则是由LLVM编译</li><li>两个平台的Dart代码都是AOT编译为本地代码</li><li>Flutter应用程序使用本机指令集运行。</li><li>Flutter正是是通过使用相同的渲染器、框架和一组widget，来同时构建iOS和Android应用，而无需维护两套独立的代码库。</li></ul></li><li><code>Foundation</code>层由<code>dart:ui</code>实现。 <code>dart:ui</code>提供了<code>Framework</code>能够运行的最基础功能，比如绘图，界面刷新，触屏，鼠标等事件的原始信息等。</li><li><code>Rendering</code>层由几个子模块组成：<code>Animation</code>, <code>Painting</code>, <code>Gestures</code>. 在这一层，Flutter提供<code>RenderObject</code>，实现完整的布局，绘制功能。</li><li><code>Widgets</code>层是开发者最常接触到的一层。 <code>Widget</code>是对<code>RenderObject</code>的封装。在<code>Widget</code>层，Flutter实现了响应式开发框架。</li><li><code>Material</code>,<code>Cupertino</code>层: 在这一层，Flutter提供了一系列的<code>Widget</code>，其中<code>Material Widget</code>实现了<code>Material Design</code>。<code>Cupertino</code>提供了一系列的<code>iOS-Style</code>的控件。</li></ul><h2 id="图形管道"><a href="#图形管道" class="headerlink" title="图形管道"></a>图形管道</h2><p><img src="https://cdn.rencheng.cc/blog/f3cdp.png"></p><ol><li>GPU的Vsync信号同步到UI线程</li><li>UI线程使用Dart来构建抽象的视图结构</li><li>视图结构在GPU线程中进行图层合成</li><li>合成后的视图数据提供给Skia图形引擎处理成GPU数据</li><li>数据再通过OpenGL或Vulkan提供给GPU进行渲染</li></ol><h2 id="Widget生命周期"><a href="#Widget生命周期" class="headerlink" title="Widget生命周期"></a>Widget生命周期</h2><p><img src="https://cdn.rencheng.cc/blog/tc801.png"></p><h2 id="State生命周期"><a href="#State生命周期" class="headerlink" title="State生命周期"></a>State<T>生命周期</h2><p><img src="https://cdn.rencheng.cc/blog/z68lu.png"></p><blockquote><p>转载自<a href="https://docs.google.com/presentation/d/1cw7A4HbvM_Abv320rVgPVGiUP2msVs7tfGbkgdrTy0I/edit#slide=id.gbb3c3233b_0_187">Google官方文档</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Flutter 架构图&lt;br&gt;&lt;img src=&quot;https://cdn.rencheng.cc/blog/whz3d.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://rencheng.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>特殊的集合结构</title>
    <link href="https://rencheng.cc/2020/01/15/ios/objc/%E7%89%B9%E6%AE%8A%E7%9A%84%E9%9B%86%E5%90%88%E7%BB%93%E6%9E%84/"/>
    <id>https://rencheng.cc/2020/01/15/ios/objc/%E7%89%B9%E6%AE%8A%E7%9A%84%E9%9B%86%E5%90%88%E7%BB%93%E6%9E%84/</id>
    <published>2020-01-15T07:47:58.000Z</published>
    <updated>2020-01-15T07:47:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>平时开发中，大部分使用<code>NSSet</code>和<code>NSMutableSet</code>。下面介绍个特殊的。</p><ul><li>NSHashTable</li><li>NXHashTable（objc源码）</li></ul><span id="more"></span><h2 id="NSHashTable"><a href="#NSHashTable" class="headerlink" title="NSHashTable"></a>NSHashTable</h2><p><code>NSHashTable</code>是更广泛意义的<code>NSSet</code>，区别于<code>NSSet/NSMutableSet</code>，<code>NSHashTable</code>有如下特性：</p><ul><li>NSHashTable 是可变的；</li><li><strong>NSHashTable 可以持有 weak 类型的成员变量；</strong></li><li>NSHashTable 可以在添加成员变量的时候复制成员；</li><li>NSHashTable 可以随意的存储指针并且利用指针的唯一性来进行 hash 同一性检查（检查成员变量是否有重复）和对比操作（equal）；</li></ul><blockquote><p>参考： <a href="https://nshipster.com/nshashtable-and-nsmaptable/">https://nshipster.com/nshashtable-and-nsmaptable/</a></p></blockquote><blockquote><p>Hash冲突解决方案：拉链法</p></blockquote><p>使用方法</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = <span class="string">@&quot;10&quot;</span>;</span><br><span class="line"><span class="built_in">NSHashTable</span> *table = [[<span class="built_in">NSHashTable</span> alloc] initWithOptions:<span class="built_in">NSHashTableCopyIn</span> capacity:<span class="number">0</span>];</span><br><span class="line">[table addObject:str];</span><br><span class="line">[table removeObject:str];</span><br></pre></td></tr></table></figure><p>NSHashTableOptions介绍（源码中是使用静态常量做关联）</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    <span class="comment">// 默认行为，强引用集合中的对象，等同于NSMutableSet</span></span><br><span class="line">    <span class="built_in">NSHashTableStrongMemory</span>             = <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// 在将对象添加到集合之前，会拷贝对象</span></span><br><span class="line">    <span class="built_in">NSHashTableCopyIn</span>                   = <span class="built_in">NSPointerFunctionsCopyIn</span>,</span><br><span class="line">    <span class="comment">// 使用移位指针(shifted pointer)来做hash检测和确定两个对象是否相等；</span></span><br><span class="line">    <span class="comment">// 同时使用description方法来做描述字符串</span></span><br><span class="line">    <span class="built_in">NSHashTableObjectPointerPersonality</span> = <span class="built_in">NSPointerFunctionsObjectPointerPersonality</span>,</span><br><span class="line">    <span class="comment">// 弱引用集合中的对象，且在对象被释放后，会被正确的移除。</span></span><br><span class="line">    <span class="built_in">NSHashTableWeakMemory</span>               = <span class="built_in">NSPointerFunctionsWeakMemory</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NSUInteger</span> <span class="built_in">NSHashTableOptions</span>;</span><br></pre></td></tr></table></figure><h2 id="NXHashTable"><a href="#NXHashTable" class="headerlink" title="NXHashTable"></a>NXHashTable</h2><p>在objc源码中，找到了关于NSHashTable的类似实现。可以参考下</p><p>NXHashTable存储结构（精简过）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="comment">// 附属实体</span></span><br><span class="line">    <span class="type">const</span> NXHashTablePrototype*prototype;</span><br><span class="line">    <span class="comment">// 真实的长度（存储了多少有效数据）</span></span><br><span class="line">    <span class="type">unsigned</span>  count;</span><br><span class="line">    <span class="comment">// buckets实际所占用的空间大小（比理论高，2^n，不够会扩容）</span></span><br><span class="line">    <span class="type">unsigned</span>  nbBuckets;</span><br><span class="line">    <span class="comment">// 数据[HashBucket?]</span></span><br><span class="line">    <span class="type">void</span> *buckets;</span><br><span class="line">    <span class="comment">// 信息</span></span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>     *info;</span><br><span class="line">&#125; NXHashTable;</span><br></pre></td></tr></table></figure><p>NXHashTablePrototype存储结构（精简过）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="comment">// hash方法的函数指针</span></span><br><span class="line">    <span class="type">uintptr_t</span>(* hash)(<span class="type">const</span> <span class="type">void</span> * info,</span><br><span class="line">                                  <span class="type">const</span> <span class="type">void</span> * data);</span><br><span class="line">    <span class="comment">// isEqual方法的函数指针</span></span><br><span class="line">    <span class="type">int</span>(* isEqual)(<span class="type">const</span> <span class="type">void</span> * info, <span class="type">const</span> <span class="type">void</span> * data1, <span class="type">const</span> <span class="type">void</span> * data2);</span><br><span class="line">    <span class="comment">// free方法的函数指针</span></span><br><span class="line">    <span class="type">void</span>(* <span class="built_in">free</span>)(<span class="type">const</span> <span class="type">void</span> * info, <span class="type">void</span> * data);</span><br><span class="line">    <span class="comment">// 保留字段</span></span><br><span class="line">    <span class="type">int</span>style;</span><br><span class="line">&#125; NXHashTablePrototype;</span><br></pre></td></tr></table></figure><p>HashBucket存储结构</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="comment">// 存储的数据</span></span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*one;</span><br><span class="line">    <span class="comment">// 存储数据的集合[x, x]，新数据在前面</span></span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**many;</span><br><span class="line">&#125; oneOrMany;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">unsigned</span> count; </span><br><span class="line">    <span class="comment">// 如果count == 1，则取elements.one</span></span><br><span class="line">    <span class="comment">// 如果count &gt;  1，则取elements.many</span></span><br><span class="line">    oneOrManyelements;</span><br><span class="line">&#125; HashBucket;</span><br></pre></td></tr></table></figure><p>NXHashTable的构造器<code>NXCreateHashTable</code>和<code>NXCreateHashTableFromZone</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">NXHashTable *NXCreateHashTable (NXHashTablePrototype prototype, <span class="type">unsigned</span> capacity, <span class="keyword">const</span> <span class="type">void</span> *info) &#123;</span><br><span class="line">    <span class="keyword">return</span> NXCreateHashTableFromZone(prototype, capacity, info, DEFAULT_ZONE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NXHashTable *NXCreateHashTableFromZone (NXHashTablePrototype prototype, <span class="type">unsigned</span> capacity, <span class="keyword">const</span> <span class="type">void</span> *info, <span class="type">void</span> *z) &#123;</span><br><span class="line">    NXHashTable*table;</span><br><span class="line">    NXHashTablePrototype*proto;</span><br><span class="line">    </span><br><span class="line">    table = ALLOCTABLE(z);</span><br><span class="line">    <span class="keyword">if</span> (! prototypes) bootstrap ();</span><br><span class="line">    <span class="keyword">if</span> (! prototype.hash) prototype.hash = NXPtrHash;</span><br><span class="line">    <span class="keyword">if</span> (! prototype.isEqual) prototype.isEqual = NXPtrIsEqual;</span><br><span class="line">    <span class="keyword">if</span> (! prototype.free) prototype.free = NXNoEffectFree;</span><br><span class="line">    <span class="keyword">if</span> (prototype.style) &#123;</span><br><span class="line">_objc_inform (<span class="string">&quot;*** NXCreateHashTable: invalid style\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;;</span><br><span class="line">    proto = (NXHashTablePrototype *)NXHashGet (prototypes, &amp;prototype); </span><br><span class="line">    <span class="keyword">if</span> (! proto) &#123;</span><br><span class="line">proto</span><br><span class="line">            = (NXHashTablePrototype *) malloc(<span class="keyword">sizeof</span> (NXHashTablePrototype));</span><br><span class="line">bcopy ((<span class="keyword">const</span> <span class="type">char</span>*)&amp;prototype, (<span class="type">char</span>*)proto, <span class="keyword">sizeof</span> (NXHashTablePrototype));</span><br><span class="line">    (<span class="type">void</span>) NXHashInsert (prototypes, proto);</span><br><span class="line">proto = (NXHashTablePrototype *)NXHashGet (prototypes, &amp;prototype);</span><br><span class="line"><span class="keyword">if</span> (! proto) &#123;</span><br><span class="line">    _objc_inform (<span class="string">&quot;*** NXCreateHashTable: bug\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">    table-&gt;prototype = proto; table-&gt;count = <span class="number">0</span>; table-&gt;info = info;</span><br><span class="line">    table-&gt;nbBuckets = GOOD_CAPACITY(capacity);</span><br><span class="line">    table-&gt;buckets = ALLOCBUCKETS(z, table-&gt;nbBuckets);</span><br><span class="line">    <span class="keyword">return</span> table;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>取数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过hash函数（data指针位运算得到的散列数）-&gt;取模（得到下标）-&gt; 加上头指针（得到数据的具体地址）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>BUCKETOF(table, data) (((HashBucket *)table-&gt;buckets)+((*table-&gt;prototype-&gt;hash)(table-&gt;info, data) % table-&gt;nbBuckets))</span></span><br><span class="line"><span class="comment">// 判断数据指针是否一致</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ISEQUAL(table, data1, data2) ((data1 == data2) || (*table-&gt;prototype-&gt;isEqual)(table-&gt;info, data1, data2))</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">NXHashGet</span> <span class="params">(NXHashTable *table, <span class="type">const</span> <span class="type">void</span> *data)</span> &#123;</span><br><span class="line">    HashBucket*bucket = BUCKETOF(table, data);</span><br><span class="line">    <span class="type">unsigned</span>j = bucket-&gt;count;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**pairs;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (! j) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> ISEQUAL(table, data, bucket-&gt;elements.one)</span><br><span class="line">    ? (<span class="type">void</span> *) bucket-&gt;elements.one : <span class="literal">NULL</span>; </span><br><span class="line">&#125;;</span><br><span class="line">    pairs = bucket-&gt;elements.many;</span><br><span class="line">    <span class="comment">// 从列表中遍历寻找元素</span></span><br><span class="line">    <span class="keyword">while</span> (j--) &#123;</span><br><span class="line"><span class="comment">/* we don&#x27;t cache isEqual because lists are short */</span></span><br><span class="line">    <span class="keyword">if</span> (ISEQUAL(table, data, *pairs)) <span class="keyword">return</span> (<span class="type">void</span> *) *pairs; </span><br><span class="line">pairs ++;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>插入数据</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">NXHashInsert</span> <span class="params">(NXHashTable *table, <span class="type">const</span> <span class="type">void</span> *data)</span> &#123;</span><br><span class="line">    HashBucket*bucket = BUCKETOF(table, data);</span><br><span class="line">    <span class="type">unsigned</span>j = bucket-&gt;count;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**pairs;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**newt;</span><br><span class="line">    __unused <span class="type">void</span> *z = ZONE_FROM_PTR(table);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (! j) &#123;</span><br><span class="line">bucket-&gt;count++; bucket-&gt;elements.one = data; </span><br><span class="line">table-&gt;count++; </span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ISEQUAL(table, data, bucket-&gt;elements.one)) &#123;</span><br><span class="line">       <span class="type">const</span> <span class="type">void</span>*old = bucket-&gt;elements.one;</span><br><span class="line">       bucket-&gt;elements.one = data;</span><br><span class="line">       <span class="keyword">return</span> (<span class="type">void</span> *) old;</span><br><span class="line">   &#125;;</span><br><span class="line">        <span class="comment">// 数据迁移one-&gt;many</span></span><br><span class="line">   newt = ALLOCPAIRS(z, <span class="number">2</span>);</span><br><span class="line">   newt[<span class="number">1</span>] = bucket-&gt;elements.one;</span><br><span class="line">   *newt = data;</span><br><span class="line">   bucket-&gt;count++; bucket-&gt;elements.many = newt; </span><br><span class="line">   table-&gt;count++; </span><br><span class="line">   <span class="comment">// 如果列表的实际长度大于物理长度，就扩容buckets</span></span><br><span class="line">   <span class="keyword">if</span> (table-&gt;count &gt; table-&gt;nbBuckets) _NXHashRehash (table);</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;;</span><br><span class="line">    pairs = bucket-&gt;elements.many;</span><br><span class="line">    <span class="comment">// 遍历先有的列表，如果数据已经存在，就返回</span></span><br><span class="line">    <span class="keyword">while</span> (j--) &#123;</span><br><span class="line"><span class="comment">/* we don&#x27;t cache isEqual because lists are short */</span></span><br><span class="line">    <span class="keyword">if</span> (ISEQUAL(table, data, *pairs)) &#123;</span><br><span class="line">       <span class="type">const</span> <span class="type">void</span>*old = *pairs;</span><br><span class="line">       *pairs = data;</span><br><span class="line">       <span class="keyword">return</span> (<span class="type">void</span> *) old;</span><br><span class="line">    &#125;;</span><br><span class="line">   pairs ++;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="comment">/* 我们扩大这个buckets里面的many；并将新数据放在前面 */</span></span><br><span class="line">    newt = ALLOCPAIRS(z, bucket-&gt;count+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (bucket-&gt;count) bcopy ((<span class="type">const</span> <span class="type">char</span>*)bucket-&gt;elements.many, (<span class="type">char</span>*)(newt+<span class="number">1</span>), bucket-&gt;count * PTRSIZE);</span><br><span class="line">    *newt = data;</span><br><span class="line">    FREEPAIRS (bucket-&gt;elements.many);</span><br><span class="line">    bucket-&gt;count++; bucket-&gt;elements.many = newt; </span><br><span class="line">    table-&gt;count++; </span><br><span class="line">    <span class="keyword">if</span> (table-&gt;count &gt; table-&gt;nbBuckets) _NXHashRehash (table);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>扩容</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 思路：</span></span><br><span class="line"><span class="comment">// 将table的信息缓存到一个临时的table中</span></span><br><span class="line"><span class="comment">// 将table内的信息更新成最新</span></span><br><span class="line"><span class="comment">// 将table内的buckets数据仓重新分配大的内存</span></span><br><span class="line"><span class="comment">// 遍历将临时table中的数据依次再插入到新的buckets中</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MORE_CAPACITY(b) (b*2+1)</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> _NXHashRehash (NXHashTable *table) &#123;</span><br><span class="line">    _NXHashRehashToCapacity (table, MORE_CAPACITY(table-&gt;nbBuckets));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> _NXHashRehashToCapacity (NXHashTable *table, <span class="type">unsigned</span> newCapacity) &#123;</span><br><span class="line">    <span class="comment">/* Rehash: we create a pseudo table pointing really to the old guys,</span></span><br><span class="line"><span class="comment">    extend self, copy the old pairs, and free the pseudo table */</span></span><br><span class="line">    NXHashTable*old;</span><br><span class="line">    NXHashStatestate;</span><br><span class="line">    <span class="type">void</span>*aux;</span><br><span class="line">    __unused <span class="type">void</span> *z = ZONE_FROM_PTR(table);</span><br><span class="line">    </span><br><span class="line">    old = ALLOCTABLE(z);</span><br><span class="line">    old-&gt;prototype = table-&gt;prototype; old-&gt;count = table-&gt;count; </span><br><span class="line">    old-&gt;nbBuckets = table-&gt;nbBuckets; old-&gt;buckets = table-&gt;buckets;</span><br><span class="line">    table-&gt;nbBuckets = newCapacity;</span><br><span class="line">    table-&gt;count = <span class="number">0</span>; table-&gt;buckets = ALLOCBUCKETS(z, table-&gt;nbBuckets);</span><br><span class="line">    state = NXInitHashState (old);</span><br><span class="line">    <span class="keyword">while</span> (NXNextHashState (old, &amp;state, &amp;aux))</span><br><span class="line">(<span class="type">void</span>) NXHashInsert (table, aux);</span><br><span class="line">    freeBuckets (old, NO);</span><br><span class="line">    <span class="keyword">if</span> (old-&gt;count != table-&gt;count)</span><br><span class="line">_objc_inform(<span class="string">&quot;*** hashtable: count differs after rehashing; probably indicates a broken invariant: there are x and y such as isEqual(x, y) is TRUE but hash(x) != hash (y)\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span> (old-&gt;buckets); </span><br><span class="line">    <span class="built_in">free</span> (old);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除某个元素</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">NXHashRemove</span> <span class="params">(NXHashTable *table, <span class="type">const</span> <span class="type">void</span> *data)</span> &#123;</span><br><span class="line">    HashBucket*bucket = BUCKETOF(table, data);</span><br><span class="line">    <span class="type">unsigned</span>j = bucket-&gt;count;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**pairs;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>**newt;</span><br><span class="line">    __unused <span class="type">void</span> *z = ZONE_FROM_PTR(table);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (! j) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (! ISEQUAL(table, data, bucket-&gt;elements.one)) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">data = bucket-&gt;elements.one;</span><br><span class="line">table-&gt;count--; bucket-&gt;count--; bucket-&gt;elements.one = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *) data;</span><br><span class="line">&#125;;</span><br><span class="line">    pairs = bucket-&gt;elements.many;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ISEQUAL(table, data, pairs[<span class="number">0</span>])) &#123;</span><br><span class="line">    bucket-&gt;elements.one = pairs[<span class="number">1</span>]; data = pairs[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ISEQUAL(table, data, pairs[<span class="number">1</span>])) &#123;</span><br><span class="line">    bucket-&gt;elements.one = pairs[<span class="number">0</span>]; data = pairs[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">FREEPAIRS (pairs);</span><br><span class="line">table-&gt;count--; bucket-&gt;count--;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span> *) data;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">while</span> (j--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ISEQUAL(table, data, *pairs)) &#123;</span><br><span class="line">    data = *pairs;</span><br><span class="line">    <span class="comment">/* we shrink this bucket */</span></span><br><span class="line">    newt = (bucket-&gt;count<span class="number">-1</span>) </span><br><span class="line">? ALLOCPAIRS(z, bucket-&gt;count<span class="number">-1</span>) : <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (bucket-&gt;count<span class="number">-1</span> != j)</span><br><span class="line">    bcopy ((<span class="type">const</span> <span class="type">char</span>*)bucket-&gt;elements.many, (<span class="type">char</span>*)newt, PTRSIZE*(bucket-&gt;count-j<span class="number">-1</span>));</span><br><span class="line">    <span class="keyword">if</span> (j)</span><br><span class="line">    bcopy ((<span class="type">const</span> <span class="type">char</span>*)(bucket-&gt;elements.many + bucket-&gt;count-j), (<span class="type">char</span>*)(newt+bucket-&gt;count-j<span class="number">-1</span>), PTRSIZE*j);</span><br><span class="line">    FREEPAIRS (bucket-&gt;elements.many);</span><br><span class="line">    table-&gt;count--; bucket-&gt;count--; bucket-&gt;elements.many = newt;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *) data;</span><br><span class="line">    &#125;;</span><br><span class="line">pairs ++;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;平时开发中，大部分使用&lt;code&gt;NSSet&lt;/code&gt;和&lt;code&gt;NSMutableSet&lt;/code&gt;。下面介绍个特殊的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSHashTable&lt;/li&gt;
&lt;li&gt;NXHashTable（objc源码）&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>神策SDK调研</title>
    <link href="https://rencheng.cc/2020/01/13/search/%E7%A5%9E%E7%AD%96SDK%E8%B0%83%E7%A0%94/"/>
    <id>https://rencheng.cc/2020/01/13/search/%E7%A5%9E%E7%AD%96SDK%E8%B0%83%E7%A0%94/</id>
    <published>2020-01-13T12:19:34.000Z</published>
    <updated>2020-01-13T12:19:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="神策"><a href="#神策" class="headerlink" title="神策"></a>神策</h2><p><a href="https://manual.sensorsdata.cn/sa/latest/page-4751623.html">神策文档</a></p><p><a href="https://github.com/sensorsdata/sa-sdk-ios">开源代码</a></p><h2 id="基础参数"><a href="#基础参数" class="headerlink" title="基础参数"></a>基础参数</h2><p><a href="https://manual.sensorsdata.cn/sa/latest/page-1573610.html">神策文档</a></p><h2 id="标识用户"><a href="#标识用户" class="headerlink" title="标识用户"></a>标识用户</h2><p><a href="https://manual.sensorsdata.cn/sa/latest/page-1573777.html">神策文档</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;神策&quot;&gt;&lt;a href=&quot;#神策&quot; class=&quot;headerlink&quot; title=&quot;神策&quot;&gt;&lt;/a&gt;神策&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://manual.sensorsdata.cn/sa/latest/page-4751623.html&quot;&gt;神策</summary>
      
    
    
    
    
    <category term="技术调研" scheme="https://rencheng.cc/tags/%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/"/>
    
  </entry>
  
  <entry>
    <title>创建MacOS的U盘安装器</title>
    <link href="https://rencheng.cc/2020/01/04/tools/macos/%E5%88%9B%E5%BB%BAMacOS%E7%9A%84U%E7%9B%98%E5%AE%89%E8%A3%85%E5%99%A8/"/>
    <id>https://rencheng.cc/2020/01/04/tools/macos/%E5%88%9B%E5%BB%BAMacOS%E7%9A%84U%E7%9B%98%E5%AE%89%E8%A3%85%E5%99%A8/</id>
    <published>2020-01-04T02:22:08.000Z</published>
    <updated>2020-01-04T02:22:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>MacOS的OTA更新和恢复做的非常完善了，但是有洁癖的我，总想彻底的重装<br>如果想把MacOS恢复到指定版本，那么就一定需要安装U盘启动器。因为OTA只支持恢复最新版本的系统和恢复出厂的系统。</p><span id="more"></span><h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><p><strong><a href="https://support.apple.com/zh-cn/HT201475">macOS Catalina</a>、<a href="https://support.apple.com/zh-cn/HT210190">macOS Mojave</a> 或 <a href="https://support.apple.com/zh-cn/HT208969">macOS High Sierra</a></strong><br>这些 macOS 版本的安装器都会以名为<code>Install macOS Catalina</code>、<code>Install macOS Mojave</code>或<code>Install macOS High Sierra</code>的 <code>App</code> 的形式直接下载到您的“应用程序”文件夹。如果安装器在下载后打开，请退出而不要继续安装。</p><blockquote><p>要获取正确的安装器，请从运行<code>macOS Sierra 10.12.5</code>或更高版本或者<code>El Capitan 10.11.6</code>的 Mac 中进行下载。</p></blockquote><p><strong><a href="https://support.apple.com/zh-cn/HT206886">OS X El Capitan</a></strong><br><code>El Capitan</code> 会以磁盘映像形式下载。在与<code>El Capitan</code>兼容的 Mac 上，打开磁盘映像，并运行其中名为<code>InstallMacOSX.pkg</code>的安装器。随即会在您的“应用程序”文件夹中安装一个名为<code>Install OS X El Capitan</code>的<code> App</code>。您将通过这个 App（而不是磁盘映像或 .pkg 安装器）创建可引导安装器。</p><blockquote><p>如果需要恢复<code>macOS Sierra</code>(10.12)版本，需要先恢复到<code>OS X El Capitan</code>(10.11)，然后在AppStore中找到<code>macOS Sierra</code>(10.12)的镜像进行升级。</p></blockquote><h2 id="制作启动盘"><a href="#制作启动盘" class="headerlink" title="制作启动盘"></a>制作启动盘</h2><ol><li><p>连接要用于可引导安装器的 USB 闪存驱动器或其他宗卷。确保这个驱动器或宗卷至少有 12GB 可用储存空间，并<a href="https://support.apple.com/zh-cn/HT208496">已格式化为 Mac OS 扩展格式</a>。</p></li><li><p>打开<code>应用程序</code>文件夹内<code>实用工具</code>文件夹中的<code>终端</code>。</p></li><li><p>在<code>终端</code>中键入或粘贴以下命令之一。这些命令假设安装器仍位于您的<code>“应用程序</code>文件夹中，并且 <code>MyVolume</code> 是 <code>USB 闪存驱动器</code>或您正在使用的其他<code>宗卷的名称</code>。如果不是这个名称，请将命令中的 <code>MyVolume</code> 相应地替换为您的<code>宗卷名称</code>。</p><p> <strong>Catalina：</strong></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br></pre></td></tr></table></figure><p> <strong>Mojave：</strong></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br></pre></td></tr></table></figure><p> <strong>High Sierra：</strong></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br></pre></td></tr></table></figure><p> <strong>El Capitan：</strong></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ OS\ X\ El\ Capitan.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ El\ Capitan.app</span><br></pre></td></tr></table></figure></li><li><p>键入相应的命令后，请按下 <code>Return</code> 键。</p></li><li><p>出现提示时，请键入您的管理员密码，然后再次按下 <code>Return</code> 键。在您键入密码时，<code>终端</code>不会显示任何字符。</p></li><li><p>出现提示时，请键入<code>Y</code>以确认您要抹掉宗卷，然后按下 <code>Return</code> 键。创建可引导安装器过程中，<code>终端</code>将显示进度。 </p></li><li><p>当<code>终端</code>提示操作已完成时，宗卷的名称将与您下载的安装器名称相同，例如<code>Install macOS Catalina</code>。您现在可以退出<code>终端</code>并弹出宗卷。<br> <img src="https://cdn.rencheng.cc/blog/qbecy.png-thumb100"></p></li></ol><blockquote><p>如果您的 Mac 运行的是 <code>macOS Sierra</code> 或<code>更低版本</code>，请使用 <code>--applicationpath </code>参数，具体方法与在适用于 El Capitan 的命令中使用这个参数的方法类似。</p></blockquote><h2 id="使用可引导安装器"><a href="#使用可引导安装器" class="headerlink" title="使用可引导安装器"></a>使用可引导安装器</h2><ol><li>将<code>U盘</code>插入兼容的 Mac。</li><li>开机按住<code>option</code>键</li><li>选择<code>U盘</code>，进入等待</li><li>选择<code>磁盘工具``抹掉</code>硬盘，完成后退出该工具</li><li>进入<code>重新安装MacOS</code>, 一路Next</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;MacOS的OTA更新和恢复做的非常完善了，但是有洁癖的我，总想彻底的重装&lt;br&gt;如果想把MacOS恢复到指定版本，那么就一定需要安装U盘启动器。因为OTA只支持恢复最新版本的系统和恢复出厂的系统。&lt;/p&gt;</summary>
    
    
    
    
    <category term="工具" scheme="https://rencheng.cc/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>2019年终总结</title>
    <link href="https://rencheng.cc/2019/12/31/summary/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>https://rencheng.cc/2019/12/31/summary/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-31T14:58:49.000Z</published>
    <updated>2019-12-31T14:58:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>经过了一年AI的学习，这门技术带给我无限的惊叹和崇拜。最近我也逐渐看清了这门技术与我而言在职业发展上的定位。对于我个人来讲，特别渴望吸取新技术。这也是我的缺点，这一年我盲目的拓展自己，忽略了自己的专业。<br>今年总结主要关键词：<strong>认清形势</strong></p><span id="more"></span><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>经过了一年AI的学习，这门技术带给我无限的惊叹和崇拜。最近我也逐渐看清了这门技术与我而言在职业发展上的定位。<br>经过了这一年，我真的特别累，自己学新知识，自己学算法，因为我身边的朋友给不了我任何的帮助，孤独注定是痛苦的。</p><h2 id="反省"><a href="#反省" class="headerlink" title="反省"></a>反省</h2><p>对于我个人来讲，特别渴望吸取新技术。这也是我的缺点，这一年我盲目的扩张自己的技术，忽略了自己的专业。当身边的朋友从工程师爬到了移动架构的层级，而我还停留在工程师，我慕了；这种差距对于我而言，打击挺大的。之前我一直对自己说，你也在不断的学习，只要自己学到了，就不要管其他的，因为专注的方向不一样。<br>最近我开始研究AI工程师在市场上的需求和要求，我发现这个行业对学历要求高，对经验要求也高。而且这个技术现在已经到达了瓶颈期，如果要想玩点儿新潮的，高精尖，要阅读国外的论文，趁论文没有被框架化，找机会实现它，来达到技术高逼格。如果真的想自己去研究算法，说实话，我没那天赋，资金和时间。</p><h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><p>未来我不会花费太多的时间去搞机器学习的东西，吃饭优先吧。</p><p>2020年TODO：</p><ol><li>熟悉<code>Flutter</code>框架</li><li>深化<code>iOS底层</code>知识</li><li>看得懂<code>汇编</code></li><li><code>算法</code>和<code>数据结构</code></li><li>有时间继续了解AI</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;经过了一年AI的学习，这门技术带给我无限的惊叹和崇拜。最近我也逐渐看清了这门技术与我而言在职业发展上的定位。对于我个人来讲，特别渴望吸取新技术。这也是我的缺点，这一年我盲目的拓展自己，忽略了自己的专业。&lt;br&gt;今年总结主要关键词：&lt;strong&gt;认清形势&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="年度总结" scheme="https://rencheng.cc/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>vue快速上手</title>
    <link href="https://rencheng.cc/2019/12/23/web/vue%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"/>
    <id>https://rencheng.cc/2019/12/23/web/vue%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/</id>
    <published>2019-12-23T12:56:23.000Z</published>
    <updated>2019-12-23T12:56:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近由于我们前端老大离职，他所负责的H5需要有人接手，我也不知道为啥会选中我来接手，我对Web只是停留在爬虫的阶段，<code>css</code>和<code>js</code>不能说不懂，能看懂，但是开发起来有些费劲，所以我给他的承诺就是我接口也就能改改Bug，如果指着我开发很困难。</p><span id="more"></span><h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><ul><li>前端框架是<a href="https://vuejs.bootcss.com/">Vue</a>；</li><li>JavaScript（ES6）</li><li>CSS</li><li>HTML</li></ul><blockquote><p>我能简单的看懂Html、css、js，所以我花费几天时间把Vue看一下</p></blockquote><h2 id="了解Vue"><a href="#了解Vue" class="headerlink" title="了解Vue"></a>了解Vue</h2><p><a href="https://vuejs.bootcss.com/">官网教程</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Vue是渐进式框架，只需要花费1到2天的时间就可以开发了，我只要能达到修bug的能力就可以。<br>了解<code>生命周期</code>，<code>引用流程</code>，<code>声明式编程</code>，<code>v-if/v-for语法</code>.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近由于我们前端老大离职，他所负责的H5需要有人接手，我也不知道为啥会选中我来接手，我对Web只是停留在爬虫的阶段，&lt;code&gt;css&lt;/code&gt;和&lt;code&gt;js&lt;/code&gt;不能说不懂，能看懂，但是开发起来有些费劲，所以我给他的承诺就是我接口也就能改改Bug，如果指着我开发很困难。&lt;/p&gt;</summary>
    
    
    
    
    <category term="web" scheme="https://rencheng.cc/tags/web/"/>
    
    <category term="vue" scheme="https://rencheng.cc/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Pandas</title>
    <link href="https://rencheng.cc/2019/11/25/datascience/pandas/"/>
    <id>https://rencheng.cc/2019/11/25/datascience/pandas/</id>
    <published>2019-11-25T11:38:45.000Z</published>
    <updated>2019-11-25T11:38:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>pandas 是基于 NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速便捷地处理数据的函数和方法。你很快就会发现，它是使Python成为强大而高效的数据分析环境的重要因素之一。</p><span id="more"></span><h2 id="pandas基础"><a href="#pandas基础" class="headerlink" title="pandas基础"></a>pandas基础</h2><h3 id="pandas介绍"><a href="#pandas介绍" class="headerlink" title="pandas介绍"></a>pandas介绍</h3><p>Python Data Analysis Library</p><p>pandas是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入 了大量库和一些标准的数据模型，提供了高效地操作大型结构化数据集所需的工具。</p><h3 id="pandas核心数据结构"><a href="#pandas核心数据结构" class="headerlink" title="pandas核心数据结构"></a>pandas核心数据结构</h3><p>数据结构是计算机存储、组织数据的方式。 通常情况下，精心选择的数据结构可以带来更高的运行或者存储效率。数据结构往往同高效的检索算法和索引技术有关。</p><h4 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h4><p>Series可以理解为一个一维的数组，只是index名称可以自己改动。类似于定长的有序字典，有Index和 value。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空的系列</span></span><br><span class="line">s = pd.Series()</span><br><span class="line"><span class="comment"># 从ndarray创建一个系列</span></span><br><span class="line">data = np.array([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">s = pd.Series(data)</span><br><span class="line">s = pd.Series(data,index=[<span class="number">100</span>,<span class="number">101</span>,<span class="number">102</span>,<span class="number">103</span>])</span><br><span class="line"><span class="comment"># 从字典创建一个系列</span></span><br><span class="line">data = &#123;<span class="string">&#x27;a&#x27;</span> : <span class="number">0.</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">1.</span>, <span class="string">&#x27;c&#x27;</span> : <span class="number">2.</span>&#125;</span><br><span class="line">s = pd.Series(data)</span><br><span class="line"><span class="comment"># 从标量创建一个系列</span></span><br><span class="line">s = pd.Series(<span class="number">5</span>, index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure><p>访问Series中的数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用索引检索元素</span></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],index = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>], s[:<span class="number">3</span>], s[-<span class="number">3</span>:])</span><br><span class="line"><span class="comment"># 使用标签检索数据</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="string">&#x27;a&#x27;</span>], s[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]])</span><br></pre></td></tr></table></figure><p><strong>pandas日期处理</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pandas识别的日期字符串格式</span></span><br><span class="line">dates = pd.Series([<span class="string">&#x27;2011&#x27;</span>, <span class="string">&#x27;2011-02&#x27;</span>, <span class="string">&#x27;2011-03-01&#x27;</span>, <span class="string">&#x27;2011/04/01&#x27;</span>, </span><br><span class="line">                   <span class="string">&#x27;2011/05/01 01:01:01&#x27;</span>, <span class="string">&#x27;01 Jun 2011&#x27;</span>])</span><br><span class="line"><span class="comment"># to_datetime() 转换日期数据类型</span></span><br><span class="line">dates = pd.to_datetime(dates)</span><br><span class="line"><span class="built_in">print</span>(dates, dates.dtype, <span class="built_in">type</span>(dates))</span><br><span class="line"><span class="comment"># datetime类型数据支持日期运算</span></span><br><span class="line">delta = dates - pd.to_datetime(<span class="string">&#x27;1970-01-01&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取天数数值</span></span><br><span class="line"><span class="built_in">print</span>(delta.dt.days)</span><br></pre></td></tr></table></figure><p>Series.dt提供了很多日期相关操作，如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Series.dt.yearThe year of the datetime.</span><br><span class="line">Series.dt.monthThe month <span class="keyword">as</span> January=<span class="number">1</span>, December=<span class="number">12.</span></span><br><span class="line">Series.dt.dayThe days of the datetime.</span><br><span class="line">Series.dt.hourThe hours of the datetime.</span><br><span class="line">Series.dt.minuteThe minutes of the datetime.</span><br><span class="line">Series.dt.secondThe seconds of the datetime.</span><br><span class="line">Series.dt.microsecondThe microseconds of the datetime.</span><br><span class="line">Series.dt.weekThe week ordinal of the year.</span><br><span class="line">Series.dt.weekofyearThe week ordinal of the year.</span><br><span class="line">Series.dt.dayofweekThe day of the week <span class="keyword">with</span> Monday=<span class="number">0</span>, Sunday=<span class="number">6.</span></span><br><span class="line">Series.dt.weekdayThe day of the week <span class="keyword">with</span> Monday=<span class="number">0</span>, Sunday=<span class="number">6.</span></span><br><span class="line">Series.dt.dayofyearThe ordinal day of the year.</span><br><span class="line">Series.dt.quarterThe quarter of the date.</span><br><span class="line">Series.dt.is_month_startIndicates whether the date <span class="keyword">is</span> the first day of the month.</span><br><span class="line">Series.dt.is_month_endIndicates whether the date <span class="keyword">is</span> the last day of the month.</span><br><span class="line">Series.dt.is_quarter_startIndicator <span class="keyword">for</span> whether the date <span class="keyword">is</span> the first day of a quarter.</span><br><span class="line">Series.dt.is_quarter_endIndicator <span class="keyword">for</span> whether the date <span class="keyword">is</span> the last day of a quarter.</span><br><span class="line">Series.dt.is_year_startIndicate whether the date <span class="keyword">is</span> the first day of a year.</span><br><span class="line">Series.dt.is_year_endIndicate whether the date <span class="keyword">is</span> the last day of the year.</span><br><span class="line">Series.dt.is_leap_yearBoolean indicator <span class="keyword">if</span> the date belongs to a leap year.</span><br><span class="line">Series.dt.days_in_monthThe number of days <span class="keyword">in</span> the month.</span><br></pre></td></tr></table></figure><h4 id="DateTimeIndex"><a href="#DateTimeIndex" class="headerlink" title="DateTimeIndex"></a>DateTimeIndex</h4><p>通过指定周期和频率，使用<code>date.range()</code>函数就可以创建日期序列。 默认情况下，范围的频率是天。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 以日为频率</span></span><br><span class="line">datelist = pd.date_range(<span class="string">&#x27;2019/08/21&#x27;</span>, periods=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(datelist)</span><br><span class="line"><span class="comment"># 以月为频率</span></span><br><span class="line">datelist = pd.date_range(<span class="string">&#x27;2019/08/21&#x27;</span>, periods=<span class="number">5</span>,freq=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(datelist)</span><br><span class="line"><span class="comment"># 构建某个区间的时间序列</span></span><br><span class="line">start = pd.datetime(<span class="number">2017</span>, <span class="number">11</span>, <span class="number">1</span>)</span><br><span class="line">end = pd.datetime(<span class="number">2017</span>, <span class="number">11</span>, <span class="number">5</span>)</span><br><span class="line">dates = pd.date_range(start, end)</span><br><span class="line"><span class="built_in">print</span>(dates)</span><br></pre></td></tr></table></figure><p><code>bdate_range()</code>用来表示商业日期范围，不同于<code>date_range()</code>，它不包括星期六和星期天。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">datelist = pd.bdate_range(<span class="string">&#x27;2011/11/03&#x27;</span>, periods=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(datelist)</span><br></pre></td></tr></table></figure><h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><p>DataFrame是一个类似于表格的数据类型，可以理解为一个二维数组，索引有两个维度，可更改。DataFrame具有以下特点：</p><ul><li>潜在的列是不同的类型</li><li>大小可变</li><li>标记轴(行和列)</li><li>可以对行和列执行算术运算</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空的DataFrame</span></span><br><span class="line">df = pd.DataFrame()</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从列表创建DataFrame</span></span><br><span class="line">data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">data = [[<span class="string">&#x27;Alex&#x27;</span>,<span class="number">10</span>],[<span class="string">&#x27;Bob&#x27;</span>,<span class="number">12</span>],[<span class="string">&#x27;Clarke&#x27;</span>,<span class="number">13</span>]]</span><br><span class="line">df = pd.DataFrame(data,columns=[<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">data = [[<span class="string">&#x27;Alex&#x27;</span>,<span class="number">10</span>],[<span class="string">&#x27;Bob&#x27;</span>,<span class="number">12</span>],[<span class="string">&#x27;Clarke&#x27;</span>,<span class="number">13</span>]]</span><br><span class="line">df = pd.DataFrame(data,columns=[<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>],dtype=<span class="built_in">float</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">data = [&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>&#125;,&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">20</span>&#125;]</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从字典来创建DataFrame</span></span><br><span class="line">data = &#123;<span class="string">&#x27;Name&#x27;</span>:[<span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;Steve&#x27;</span>, <span class="string">&#x27;Ricky&#x27;</span>],<span class="string">&#x27;Age&#x27;</span>:[<span class="number">28</span>,<span class="number">34</span>,<span class="number">29</span>,<span class="number">42</span>]&#125;</span><br><span class="line">df = pd.DataFrame(data, index=[<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;s4&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">data = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">        <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><h4 id="核心数据结构操作"><a href="#核心数据结构操作" class="headerlink" title="核心数据结构操作"></a>核心数据结构操作</h4><p><strong>列访问</strong></p><p>DataFrame的单列数据为一个Series。根据DataFrame的定义可以 知晓DataFrame是一个带有标签的二维数组，每个标签相当每一列的列名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">     <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;one&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df[[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>]])</span><br></pre></td></tr></table></figure><p><strong>列添加</strong></p><p>DataFrame添加一列的方法非常简单，只需要新建一个列索引。并对该索引下的数据进行赋值操作即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;Name&#x27;</span>:[<span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;Steve&#x27;</span>, <span class="string">&#x27;Ricky&#x27;</span>],<span class="string">&#x27;Age&#x27;</span>:[<span class="number">28</span>,<span class="number">34</span>,<span class="number">29</span>,<span class="number">42</span>]&#125;</span><br><span class="line">df = pd.DataFrame(data, index=[<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;s4&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;score&#x27;</span>]=pd.Series([<span class="number">90</span>, <span class="number">80</span>, <span class="number">70</span>, <span class="number">60</span>], index=[<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;s4&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p><strong>列删除</strong> </p><p>删除某列数据需要用到pandas提供的方法pop，pop方法的用法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]), </span><br><span class="line">     <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]), </span><br><span class="line">     <span class="string">&#x27;three&#x27;</span> : pd.Series([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])&#125;</span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;dataframe is:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除一列： one</span></span><br><span class="line"><span class="keyword">del</span>(df[<span class="string">&#x27;one&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用pop方法删除一列</span></span><br><span class="line">df.pop(<span class="string">&#x27;two&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p><strong>行访问</strong></p><p>如果只是需要访问DataFrame某几行数据的实现方式则采用数组的选取方式，使用 “:” 即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]), </span><br><span class="line">    <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df[<span class="number">2</span>:<span class="number">4</span>])</span><br></pre></td></tr></table></figure><p><strong>loc</strong>方法是针对DataFrame索引名称的切片方法。loc方法使用方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]), </span><br><span class="line">     <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df.loc[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df.loc[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]])</span><br></pre></td></tr></table></figure><p><strong>iloc</strong>和loc区别是iloc接收的必须是行索引和列索引的位置。iloc方法的使用方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;one&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]),</span><br><span class="line">     <span class="string">&#x27;two&#x27;</span> : pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df.iloc[<span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(df.iloc[[<span class="number">2</span>, <span class="number">3</span>]])</span><br></pre></td></tr></table></figure><p><strong>行添加</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame([[<span class="string">&#x27;zs&#x27;</span>, <span class="number">12</span>], [<span class="string">&#x27;ls&#x27;</span>, <span class="number">4</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame([[<span class="string">&#x27;ww&#x27;</span>, <span class="number">16</span>], [<span class="string">&#x27;zl&#x27;</span>, <span class="number">8</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line"></span><br><span class="line">df = df.append(df2)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p><strong>行删除</strong></p><p>使用索引标签从DataFrame中删除或删除行。 如果标签重复，则会删除多行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame([[<span class="string">&#x27;zs&#x27;</span>, <span class="number">12</span>], [<span class="string">&#x27;ls&#x27;</span>, <span class="number">4</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame([[<span class="string">&#x27;ww&#x27;</span>, <span class="number">16</span>], [<span class="string">&#x27;zl&#x27;</span>, <span class="number">8</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line">df = df.append(df2)</span><br><span class="line"><span class="comment"># 删除index为0的行</span></span><br><span class="line">df = df.drop(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p><strong>修改DataFrame中的数据</strong></p><p>更改DataFrame中的数据，原理是将这部分数据提取出来，重新赋值为新的数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame([[<span class="string">&#x27;zs&#x27;</span>, <span class="number">12</span>], [<span class="string">&#x27;ls&#x27;</span>, <span class="number">4</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame([[<span class="string">&#x27;ww&#x27;</span>, <span class="number">16</span>], [<span class="string">&#x27;zl&#x27;</span>, <span class="number">8</span>]], columns = [<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line">df = df.append(df2)</span><br><span class="line">df[<span class="string">&#x27;Name&#x27;</span>][<span class="number">0</span>] = <span class="string">&#x27;Tom&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p><strong>DataFrame常用属性</strong></p><table><thead><tr><th>编号</th><th>属性或方法</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td><code>axes</code></td><td>返回 行/列 标签（index）列表。</td></tr><tr><td>2</td><td><code>dtype</code></td><td>返回对象的数据类型(<code>dtype</code>)。</td></tr><tr><td>3</td><td><code>empty</code></td><td>如果系列为空，则返回<code>True</code>。</td></tr><tr><td>4</td><td><code>ndim</code></td><td>返回底层数据的维数，默认定义：<code>1</code>。</td></tr><tr><td>5</td><td><code>size</code></td><td>返回基础数据中的元素数。</td></tr><tr><td>6</td><td><code>values</code></td><td>将系列作为<code>ndarray</code>返回。</td></tr><tr><td>7</td><td><code>head()</code></td><td>返回前<code>n</code>行。</td></tr><tr><td>8</td><td><code>tail()</code></td><td>返回最后<code>n</code>行。</td></tr></tbody></table><p>实例代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;Name&#x27;</span>:[<span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;Steve&#x27;</span>, <span class="string">&#x27;Ricky&#x27;</span>],<span class="string">&#x27;Age&#x27;</span>:[<span class="number">28</span>,<span class="number">34</span>,<span class="number">29</span>,<span class="number">42</span>]&#125;</span><br><span class="line">df = pd.DataFrame(data, index=[<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;s4&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;score&#x27;</span>]=pd.Series([<span class="number">90</span>, <span class="number">80</span>, <span class="number">70</span>, <span class="number">60</span>], index=[<span class="string">&#x27;s1&#x27;</span>,<span class="string">&#x27;s2&#x27;</span>,<span class="string">&#x27;s3&#x27;</span>,<span class="string">&#x27;s4&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="built_in">print</span>(df.axes)</span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;Age&#x27;</span>].dtype)</span><br><span class="line"><span class="built_in">print</span>(df.empty)</span><br><span class="line"><span class="built_in">print</span>(df.ndim)</span><br><span class="line"><span class="built_in">print</span>(df.size)</span><br><span class="line"><span class="built_in">print</span>(df.values)</span><br><span class="line"><span class="built_in">print</span>(df.head(<span class="number">3</span>)) <span class="comment"># df的前三行</span></span><br><span class="line"><span class="built_in">print</span>(df.tail(<span class="number">3</span>)) <span class="comment"># df的后三行</span></span><br></pre></td></tr></table></figure><h2 id="Jupyter-notebook"><a href="#Jupyter-notebook" class="headerlink" title="Jupyter notebook"></a>Jupyter notebook</h2><p>Jupyter Notebook（此前被称为 IPython notebook）是一个交互式笔记本，支持运行 40 多种编程语言。使用浏览器作为界面，向后台的IPython服务器发送请求，并显示结果。 Jupyter Notebook 的本质是一个 Web 应用程序，便于创建和共享文学化程序文档，支持实时代码，数学方程，可视化和 markdown。 </p><p>IPython 是一个 python 的交互式 shell，比默认的python shell 好用得多，支持变量自动补全，自动缩进，支持 bash shell 命令，内置了许多很有用的功能和函数。</p><p><strong>安装ipython</strong></p><p><strong>windows：</strong>     前提是有numpy，matplotlib  pandas </p><p>​            采用pip安装  <code>pip install ipython</code></p><p><strong>OS X：</strong>        AppStore下载安装苹果开发工具Xcode。</p><p>​            使用easy_install或pip安装IPython，或者从源文件安装。</p><p><strong>安装Jupyter notebook</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install jupyter</span><br></pre></td></tr></table></figure><h2 id="pandas核心"><a href="#pandas核心" class="headerlink" title="pandas核心"></a>pandas核心</h2><h3 id="pandas描述性统计"><a href="#pandas描述性统计" class="headerlink" title="pandas描述性统计"></a>pandas描述性统计</h3><p>数值型数据的描述性统计主要包括了计算数值型数据的完整情况、最小值、均值、中位 数、最大值、四分位数、极差、标准差、方差、协方差等。在NumPy库中一些常用的统计学函数也可用于对数据框进行描述性统计。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">np.<span class="built_in">min</span>最小值 </span><br><span class="line">np.<span class="built_in">max</span>最大值 </span><br><span class="line">np.mean均值 </span><br><span class="line">np.ptp极差 </span><br><span class="line">np.median中位数 </span><br><span class="line">np.std标准差 </span><br><span class="line">np.var方差 </span><br><span class="line">np.cov协方差</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建DF</span></span><br><span class="line">d = &#123;<span class="string">&#x27;Name&#x27;</span>:pd.Series([<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;James&#x27;</span>,<span class="string">&#x27;Ricky&#x27;</span>,<span class="string">&#x27;Vin&#x27;</span>,<span class="string">&#x27;Steve&#x27;</span>,<span class="string">&#x27;Minsu&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Lee&#x27;</span>,<span class="string">&#x27;David&#x27;</span>,<span class="string">&#x27;Gasper&#x27;</span>,<span class="string">&#x27;Betina&#x27;</span>,<span class="string">&#x27;Andres&#x27;</span>]),</span><br><span class="line">   <span class="string">&#x27;Age&#x27;</span>:pd.Series([<span class="number">25</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">29</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">40</span>,<span class="number">30</span>,<span class="number">51</span>,<span class="number">46</span>]),</span><br><span class="line">   <span class="string">&#x27;Rating&#x27;</span>:pd.Series([<span class="number">4.23</span>,<span class="number">3.24</span>,<span class="number">3.98</span>,<span class="number">2.56</span>,<span class="number">3.20</span>,<span class="number">4.6</span>,<span class="number">3.8</span>,<span class="number">3.78</span>,<span class="number">2.98</span>,<span class="number">4.80</span>,<span class="number">4.10</span>,<span class="number">3.65</span>])&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># 测试描述性统计函数</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>())</span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>(<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(df.mean())</span><br><span class="line"><span class="built_in">print</span>(df.mean(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>pandas提供了统计相关函数：</p><table><thead><tr><th>1</th><th><code>count()</code></th><th>非空观测数量</th></tr></thead><tbody><tr><td>2</td><td><code>sum()</code></td><td>所有值之和</td></tr><tr><td>3</td><td><code>mean()</code></td><td>所有值的平均值</td></tr><tr><td>4</td><td><code>median()</code></td><td>所有值的中位数</td></tr><tr><td>5</td><td><code>std()</code></td><td>值的标准偏差</td></tr><tr><td>6</td><td><code>min()</code></td><td>所有值中的最小值</td></tr><tr><td>7</td><td><code>max()</code></td><td>所有值中的最大值</td></tr><tr><td>8</td><td><code>abs()</code></td><td>绝对值</td></tr><tr><td>9</td><td><code>prod()</code></td><td>数组元素的乘积</td></tr><tr><td>10</td><td><code>cumsum()</code></td><td>累计总和</td></tr><tr><td>11</td><td><code>cumprod()</code></td><td>累计乘积</td></tr></tbody></table><p>pandas还提供了一个方法叫作describe，能够一次性得出数据框所有数值型特征的非空值数目、均值、标准差等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment">#Create a Dictionary of series</span></span><br><span class="line">d = &#123;<span class="string">&#x27;Name&#x27;</span>:pd.Series([<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;James&#x27;</span>,<span class="string">&#x27;Ricky&#x27;</span>,<span class="string">&#x27;Vin&#x27;</span>,<span class="string">&#x27;Steve&#x27;</span>,<span class="string">&#x27;Minsu&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Lee&#x27;</span>,<span class="string">&#x27;David&#x27;</span>,<span class="string">&#x27;Gasper&#x27;</span>,<span class="string">&#x27;Betina&#x27;</span>,<span class="string">&#x27;Andres&#x27;</span>]),</span><br><span class="line">   <span class="string">&#x27;Age&#x27;</span>:pd.Series([<span class="number">25</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">29</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">40</span>,<span class="number">30</span>,<span class="number">51</span>,<span class="number">46</span>]),</span><br><span class="line">   <span class="string">&#x27;Rating&#x27;</span>:pd.Series([<span class="number">4.23</span>,<span class="number">3.24</span>,<span class="number">3.98</span>,<span class="number">2.56</span>,<span class="number">3.20</span>,<span class="number">4.6</span>,<span class="number">3.8</span>,<span class="number">3.78</span>,<span class="number">2.98</span>,<span class="number">4.80</span>,<span class="number">4.10</span>,<span class="number">3.65</span>])&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Create a DataFrame</span></span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line"><span class="built_in">print</span>(df.describe())</span><br><span class="line"><span class="built_in">print</span>(df.describe(include=[<span class="string">&#x27;object&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(df.describe(include=[<span class="string">&#x27;number&#x27;</span>]))</span><br></pre></td></tr></table></figure><h3 id="pandas排序"><a href="#pandas排序" class="headerlink" title="pandas排序"></a>pandas排序</h3><p><em>Pandas</em>有两种排序方式，它们分别是按标签与按实际值排序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">unsorted_df=pd.DataFrame(np.random.randn(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">                         index=[<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">7</span>],columns=[<span class="string">&#x27;col2&#x27;</span>,<span class="string">&#x27;col1&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(unsorted_df)</span><br></pre></td></tr></table></figure><p><strong>按行标签排序</strong></p><p>使用<code>sort_index()</code>方法，通过传递<code>axis</code>参数和排序顺序，可以对<code>DataFrame</code>进行排序。 默认情况下，按照升序对行标签进行排序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;Name&#x27;</span>:pd.Series([<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;James&#x27;</span>,<span class="string">&#x27;Ricky&#x27;</span>,<span class="string">&#x27;Vin&#x27;</span>,<span class="string">&#x27;Steve&#x27;</span>,<span class="string">&#x27;Minsu&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Lee&#x27;</span>,<span class="string">&#x27;David&#x27;</span>,<span class="string">&#x27;Gasper&#x27;</span>,<span class="string">&#x27;Betina&#x27;</span>,<span class="string">&#x27;Andres&#x27;</span>]),</span><br><span class="line">   <span class="string">&#x27;Age&#x27;</span>:pd.Series([<span class="number">25</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">29</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">40</span>,<span class="number">30</span>,<span class="number">51</span>,<span class="number">46</span>]),</span><br><span class="line">   <span class="string">&#x27;Rating&#x27;</span>:pd.Series([<span class="number">4.23</span>,<span class="number">3.24</span>,<span class="number">3.98</span>,<span class="number">2.56</span>,<span class="number">3.20</span>,<span class="number">4.6</span>,<span class="number">3.8</span>,<span class="number">3.78</span>,<span class="number">2.98</span>,<span class="number">4.80</span>,<span class="number">4.10</span>,<span class="number">3.65</span>])&#125;</span><br><span class="line">unsorted_df = pd.DataFrame(d)</span><br><span class="line"><span class="comment"># 按照行标进行排序</span></span><br><span class="line">sorted_df=unsorted_df.sort_index()</span><br><span class="line"><span class="built_in">print</span> (sorted_df)</span><br><span class="line"><span class="comment"># 控制排序顺序</span></span><br><span class="line">sorted_df = unsorted_df.sort_index(ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span> (sorted_df)</span><br></pre></td></tr></table></figure><p><strong>按列标签排序</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;Name&#x27;</span>:pd.Series([<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;James&#x27;</span>,<span class="string">&#x27;Ricky&#x27;</span>,<span class="string">&#x27;Vin&#x27;</span>,<span class="string">&#x27;Steve&#x27;</span>,<span class="string">&#x27;Minsu&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Lee&#x27;</span>,<span class="string">&#x27;David&#x27;</span>,<span class="string">&#x27;Gasper&#x27;</span>,<span class="string">&#x27;Betina&#x27;</span>,<span class="string">&#x27;Andres&#x27;</span>]),</span><br><span class="line">   <span class="string">&#x27;Age&#x27;</span>:pd.Series([<span class="number">25</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">29</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">40</span>,<span class="number">30</span>,<span class="number">51</span>,<span class="number">46</span>]),</span><br><span class="line">   <span class="string">&#x27;Rating&#x27;</span>:pd.Series([<span class="number">4.23</span>,<span class="number">3.24</span>,<span class="number">3.98</span>,<span class="number">2.56</span>,<span class="number">3.20</span>,<span class="number">4.6</span>,<span class="number">3.8</span>,<span class="number">3.78</span>,<span class="number">2.98</span>,<span class="number">4.80</span>,<span class="number">4.10</span>,<span class="number">3.65</span>])&#125;</span><br><span class="line">unsorted_df = pd.DataFrame(d)</span><br><span class="line"><span class="comment"># 按照列标签进行排序</span></span><br><span class="line">sorted_df=unsorted_df.sort_index(axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span> (sorted_df)</span><br></pre></td></tr></table></figure><p><strong>按某列值排序</strong></p><p>像索引排序一样，<code>sort_values()</code>是按值排序的方法。它接受一个<code>by</code>参数，它将使用要与其排序值的<code>DataFrame</code>的列名称。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;Name&#x27;</span>:pd.Series([<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;James&#x27;</span>,<span class="string">&#x27;Ricky&#x27;</span>,<span class="string">&#x27;Vin&#x27;</span>,<span class="string">&#x27;Steve&#x27;</span>,<span class="string">&#x27;Minsu&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Lee&#x27;</span>,<span class="string">&#x27;David&#x27;</span>,<span class="string">&#x27;Gasper&#x27;</span>,<span class="string">&#x27;Betina&#x27;</span>,<span class="string">&#x27;Andres&#x27;</span>]),</span><br><span class="line">   <span class="string">&#x27;Age&#x27;</span>:pd.Series([<span class="number">25</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">23</span>,<span class="number">30</span>,<span class="number">29</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">40</span>,<span class="number">30</span>,<span class="number">51</span>,<span class="number">46</span>]),</span><br><span class="line">   <span class="string">&#x27;Rating&#x27;</span>:pd.Series([<span class="number">4.23</span>,<span class="number">3.24</span>,<span class="number">3.98</span>,<span class="number">2.56</span>,<span class="number">3.20</span>,<span class="number">4.6</span>,<span class="number">3.8</span>,<span class="number">3.78</span>,<span class="number">2.98</span>,<span class="number">4.80</span>,<span class="number">4.10</span>,<span class="number">3.65</span>])&#125;</span><br><span class="line">unsorted_df = pd.DataFrame(d)</span><br><span class="line"><span class="comment"># 按照年龄进行排序</span></span><br><span class="line">sorted_df = unsorted_df.sort_values(by=<span class="string">&#x27;Age&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> (sorted_df)</span><br><span class="line"><span class="comment"># 先按Age进行升序排序，然后按Rating降序排序</span></span><br><span class="line">sorted_df = unsorted_df.sort_values(by=[<span class="string">&#x27;Age&#x27;</span>, <span class="string">&#x27;Rating&#x27;</span>], ascending=[<span class="literal">True</span>, <span class="literal">False</span>])</span><br><span class="line"><span class="built_in">print</span> (sorted_df)</span><br></pre></td></tr></table></figure><h3 id="pandas分组"><a href="#pandas分组" class="headerlink" title="pandas分组"></a>pandas分组</h3><p>在许多情况下，我们将数据分成多个集合，并在每个子集上应用一些函数。在应用函数中，可以执行以下操作 :</p><ul><li><em>聚合</em> - 计算汇总统计</li><li><em>转换</em> - 执行一些特定于组的操作</li><li><em>过滤</em> - 在某些情况下丢弃数据</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">&#x27;Team&#x27;</span>: [<span class="string">&#x27;Riders&#x27;</span>, <span class="string">&#x27;Riders&#x27;</span>, <span class="string">&#x27;Devils&#x27;</span>, <span class="string">&#x27;Devils&#x27;</span>, <span class="string">&#x27;Kings&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;kings&#x27;</span>, <span class="string">&#x27;Kings&#x27;</span>, <span class="string">&#x27;Kings&#x27;</span>, <span class="string">&#x27;Riders&#x27;</span>, <span class="string">&#x27;Royals&#x27;</span>, <span class="string">&#x27;Royals&#x27;</span>, <span class="string">&#x27;Riders&#x27;</span>],</span><br><span class="line">         <span class="string">&#x27;Rank&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">&#x27;Year&#x27;</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">&#x27;Points&#x27;</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><h4 id="将数据拆分成组"><a href="#将数据拆分成组" class="headerlink" title="将数据拆分成组"></a>将数据拆分成组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照年份Year字段分组</span></span><br><span class="line"><span class="built_in">print</span> (df.groupby(<span class="string">&#x27;Year&#x27;</span>))</span><br><span class="line"><span class="comment"># 查看分组结果</span></span><br><span class="line"><span class="built_in">print</span> (df.groupby(<span class="string">&#x27;Year&#x27;</span>).groups)</span><br></pre></td></tr></table></figure><h4 id="迭代遍历分组"><a href="#迭代遍历分组" class="headerlink" title="迭代遍历分组"></a>迭代遍历分组</h4><p>groupby返回可迭代对象，可以使用for循环遍历：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grouped = df.groupby(<span class="string">&#x27;Year&#x27;</span>)</span><br><span class="line"><span class="comment"># 遍历每个分组</span></span><br><span class="line"><span class="keyword">for</span> year,group <span class="keyword">in</span> grouped:</span><br><span class="line">    <span class="built_in">print</span> (year)</span><br><span class="line">    <span class="built_in">print</span> (group)</span><br></pre></td></tr></table></figure><h4 id="获得一个分组细节"><a href="#获得一个分组细节" class="headerlink" title="获得一个分组细节"></a>获得一个分组细节</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grouped = df.groupby(<span class="string">&#x27;Year&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> (grouped.get_group(<span class="number">2014</span>))</span><br></pre></td></tr></table></figure><h4 id="分组聚合"><a href="#分组聚合" class="headerlink" title="分组聚合"></a>分组聚合</h4><p>聚合函数为每个组返回聚合值。当创建了分组(<em>group by</em>)对象，就可以对每个分组数据执行求和、求标准差等操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合每一年的平均的分</span></span><br><span class="line">grouped = df.groupby(<span class="string">&#x27;Year&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> (grouped[<span class="string">&#x27;Points&#x27;</span>].agg(np.mean))</span><br><span class="line"><span class="comment"># 聚合每一年的分数之和、平均分、标准差</span></span><br><span class="line">grouped = df.groupby(<span class="string">&#x27;Year&#x27;</span>)</span><br><span class="line">agg = grouped[<span class="string">&#x27;Points&#x27;</span>].agg([np.<span class="built_in">sum</span>, np.mean, np.std])</span><br><span class="line"><span class="built_in">print</span> (agg)</span><br></pre></td></tr></table></figure><h3 id="pandas数据表关联操作"><a href="#pandas数据表关联操作" class="headerlink" title="pandas数据表关联操作"></a>pandas数据表关联操作</h3><p>Pandas具有功能全面的高性能内存中连接操作，与SQL等关系数据库非常相似。<br>Pandas提供了一个单独的<code>merge()</code>函数，作为DataFrame对象之间所有标准数据库连接操作的入口。</p><p><strong>合并两个DataFrame：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">&#x27;student_id&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>],</span><br><span class="line">         <span class="string">&#x27;student_name&#x27;</span>: [<span class="string">&#x27;Alex&#x27;</span>, <span class="string">&#x27;Amy&#x27;</span>, <span class="string">&#x27;Allen&#x27;</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Ayoung&#x27;</span>, <span class="string">&#x27;Billy&#x27;</span>, <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;Bran&#x27;</span>, <span class="string">&#x27;Bryce&#x27;</span>, <span class="string">&#x27;Betty&#x27;</span>, <span class="string">&#x27;Emma&#x27;</span>, <span class="string">&#x27;Marry&#x27;</span>, <span class="string">&#x27;Allen&#x27;</span>, <span class="string">&#x27;Jean&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>, <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;Daniel&#x27;</span>, <span class="string">&#x27;Andrew&#x27;</span>],</span><br><span class="line">         <span class="string">&#x27;class_id&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>], </span><br><span class="line">         <span class="string">&#x27;gender&#x27;</span>:[<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>], </span><br><span class="line">         <span class="string">&#x27;age&#x27;</span>:[<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>], </span><br><span class="line">         <span class="string">&#x27;score&#x27;</span>:[<span class="number">98</span>,<span class="number">74</span>,<span class="number">67</span>,<span class="number">38</span>,<span class="number">65</span>,<span class="number">29</span>,<span class="number">32</span>,<span class="number">34</span>,<span class="number">85</span>,<span class="number">64</span>,<span class="number">52</span>,<span class="number">38</span>,<span class="number">26</span>,<span class="number">89</span>,<span class="number">68</span>,<span class="number">46</span>,<span class="number">32</span>,<span class="number">78</span>,<span class="number">79</span>,<span class="number">87</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">&#x27;class_id&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">&#x27;class_name&#x27;</span>: [<span class="string">&#x27;ClassA&#x27;</span>, <span class="string">&#x27;ClassB&#x27;</span>, <span class="string">&#x27;ClassC&#x27;</span>, <span class="string">&#x27;ClassE&#x27;</span>]&#125;)</span><br><span class="line"><span class="comment"># 合并两个DataFrame</span></span><br><span class="line">data = pd.merge(left,right)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p><strong>使用“how”参数合并DataFrame：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合并两个DataFrame (左连接)</span></span><br><span class="line">rs = pd.merge(left, right, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rs)</span><br></pre></td></tr></table></figure><p>其他合并方法同数据库相同：</p><table><thead><tr><th>合并方法</th><th>SQL等效</th><th>描述</th></tr></thead><tbody><tr><td><code>left</code></td><td><code>LEFT OUTER JOIN</code></td><td>使用左侧对象的键</td></tr><tr><td><code>right</code></td><td><code>RIGHT OUTER JOIN</code></td><td>使用右侧对象的键</td></tr><tr><td><code>outer</code></td><td><code>FULL OUTER JOIN</code></td><td>使用键的联合</td></tr><tr><td><code>inner</code></td><td><code>INNER JOIN</code></td><td>使用键的交集</td></tr></tbody></table><p>试验：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合并两个DataFrame (左连接)</span></span><br><span class="line">rs = pd.merge(left,right,on=<span class="string">&#x27;subject_id&#x27;</span>, how=<span class="string">&#x27;right&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rs)</span><br><span class="line"><span class="comment"># 合并两个DataFrame (左连接)</span></span><br><span class="line">rs = pd.merge(left,right,on=<span class="string">&#x27;subject_id&#x27;</span>, how=<span class="string">&#x27;outer&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rs)</span><br><span class="line"><span class="comment"># 合并两个DataFrame (左连接)</span></span><br><span class="line">rs = pd.merge(left,right,on=<span class="string">&#x27;subject_id&#x27;</span>, how=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rs)</span><br></pre></td></tr></table></figure><h3 id="pandas透视表与交叉表"><a href="#pandas透视表与交叉表" class="headerlink" title="pandas透视表与交叉表"></a>pandas透视表与交叉表</h3><p>有如下数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">&#x27;student_id&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>],</span><br><span class="line">         <span class="string">&#x27;student_name&#x27;</span>: [<span class="string">&#x27;Alex&#x27;</span>, <span class="string">&#x27;Amy&#x27;</span>, <span class="string">&#x27;Allen&#x27;</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Ayoung&#x27;</span>, <span class="string">&#x27;Billy&#x27;</span>, <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;Bran&#x27;</span>, <span class="string">&#x27;Bryce&#x27;</span>, <span class="string">&#x27;Betty&#x27;</span>, <span class="string">&#x27;Emma&#x27;</span>, <span class="string">&#x27;Marry&#x27;</span>, <span class="string">&#x27;Allen&#x27;</span>, <span class="string">&#x27;Jean&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>, <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;Daniel&#x27;</span>, <span class="string">&#x27;Andrew&#x27;</span>],</span><br><span class="line">         <span class="string">&#x27;class_id&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>], </span><br><span class="line">         <span class="string">&#x27;gender&#x27;</span>:[<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;F&#x27;</span>], </span><br><span class="line">         <span class="string">&#x27;age&#x27;</span>:[<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>], </span><br><span class="line">         <span class="string">&#x27;score&#x27;</span>:[<span class="number">98</span>,<span class="number">74</span>,<span class="number">67</span>,<span class="number">38</span>,<span class="number">65</span>,<span class="number">29</span>,<span class="number">32</span>,<span class="number">34</span>,<span class="number">85</span>,<span class="number">64</span>,<span class="number">52</span>,<span class="number">38</span>,<span class="number">26</span>,<span class="number">89</span>,<span class="number">68</span>,<span class="number">46</span>,<span class="number">32</span>,<span class="number">78</span>,<span class="number">79</span>,<span class="number">87</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">&#x27;class_id&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">&#x27;class_name&#x27;</span>: [<span class="string">&#x27;ClassA&#x27;</span>, <span class="string">&#x27;ClassB&#x27;</span>, <span class="string">&#x27;ClassC&#x27;</span>, <span class="string">&#x27;ClassE&#x27;</span>]&#125;)</span><br><span class="line"><span class="comment"># 合并两个DataFrame</span></span><br><span class="line">data = pd.merge(left,right)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p><strong>透视表</strong></p><p>透视表(pivot table)是各种电子表格程序和其他数据分析软件中一种常见的数据汇总工具。<strong>它根据一个或多个键对数据进行分组聚合，并根据每个分组进行数据汇总</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以class_id与gender做分组汇总数据，默认聚合统计所有列</span></span><br><span class="line"><span class="built_in">print</span>(data.pivot_table(index=[<span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以class_id与gender做分组汇总数据，聚合统计score列</span></span><br><span class="line"><span class="built_in">print</span>(data.pivot_table(index=[<span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>], values=[<span class="string">&#x27;score&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以class_id与gender做分组汇总数据，聚合统计score列，针对age的每个值列级分组统计</span></span><br><span class="line"><span class="built_in">print</span>(data.pivot_table(index=[<span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>], values=[<span class="string">&#x27;score&#x27;</span>], </span><br><span class="line">                       columns=[<span class="string">&#x27;age&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以class_id与gender做分组汇总数据，聚合统计score列，针对age的每个值列级分组统计，添加行、列小计</span></span><br><span class="line"><span class="built_in">print</span>(data.pivot_table(index=[<span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>], values=[<span class="string">&#x27;score&#x27;</span>], </span><br><span class="line">                       columns=[<span class="string">&#x27;age&#x27;</span>], margins=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以class_id与gender做分组汇总数据，聚合统计score列，针对age的每个值列级分组统计，添加行、列小计</span></span><br><span class="line"><span class="built_in">print</span>(data.pivot_table(index=[<span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>], values=[<span class="string">&#x27;score&#x27;</span>], </span><br><span class="line">                       columns=[<span class="string">&#x27;age&#x27;</span>], margins=<span class="literal">True</span>, aggfunc=<span class="string">&#x27;max&#x27;</span>))</span><br></pre></td></tr></table></figure><p><strong>交叉表</strong></p><p>交叉表(cross-tabulation, 简称crosstab)是一种用于<strong>计算分组频率的特殊透视表</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照class_id分组，针对不同的gender，统计数量</span></span><br><span class="line"><span class="built_in">print</span>(pd.crosstab(data.class_id, data.gender, margins=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure><h3 id="pandas可视化"><a href="#pandas可视化" class="headerlink" title="pandas可视化"></a>pandas可视化</h3><p><strong>基本绘图：绘图</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> mp </span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>,<span class="number">4</span>),index=pd.date_range(<span class="string">&#x27;2018/12/18&#x27;</span>,</span><br><span class="line">   periods=<span class="number">10</span>), columns=<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>))</span><br><span class="line">df.plot()</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><p>plot方法允许除默认线图之外的少数绘图样式。 这些方法可以作为<code>plot()</code>的<code>kind</code>关键字参数。这些包括 ：</p><ul><li><code>bar</code>或<code>barh</code>为条形</li><li><code>hist</code>为直方图</li><li><code>scatter</code>为散点图</li></ul><p><strong>条形图</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>,<span class="number">4</span>),columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df.plot.bar()</span><br><span class="line"><span class="comment"># df.plot.bar(stacked=True)</span></span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><p><strong>直方图</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame()</span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = pd.Series(np.random.normal(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1000</span>)-<span class="number">1</span>)</span><br><span class="line">df[<span class="string">&#x27;b&#x27;</span>] = pd.Series(np.random.normal(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1000</span>))</span><br><span class="line">df[<span class="string">&#x27;c&#x27;</span>] = pd.Series(np.random.normal(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1000</span>)+<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">df.plot.hist(bins=<span class="number">20</span>)</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><p><strong>散点图</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">50</span>, <span class="number">4</span>), columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df.plot.scatter(x=<span class="string">&#x27;a&#x27;</span>, y=<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><p><strong>饼状图</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(<span class="number">3</span> * np.random.rand(<span class="number">4</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], columns=[<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">df.plot.pie(subplots=<span class="literal">True</span>)</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><h4 id="数据读取与存储"><a href="#数据读取与存储" class="headerlink" title="数据读取与存储"></a>数据读取与存储</h4><p><strong>读取与存储csv：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filepath 文件路径。该字符串可以是一个URL。有效的URL方案包括http，ftp和file </span></span><br><span class="line"><span class="comment"># sep 分隔符。read_csv默认为“,”，read_table默认为制表符“[Tab]”。</span></span><br><span class="line"><span class="comment"># header 接收int或sequence。表示将某行数据作为列名。默认为infer，表示自动识别。</span></span><br><span class="line"><span class="comment"># names 接收array。表示列名。</span></span><br><span class="line"><span class="comment"># index_col 表示索引列的位置，取值为sequence则代表多重索引。 </span></span><br><span class="line"><span class="comment"># dtype 代表写入的数据类型（列名为key，数据格式为values）。</span></span><br><span class="line"><span class="comment"># engine 接收c或者python。代表数据解析引擎。默认为c。</span></span><br><span class="line"><span class="comment"># nrows 接收int。表示读取前n行。</span></span><br><span class="line"></span><br><span class="line">pd.read_table(</span><br><span class="line">    filepath_or_buffer, sep=<span class="string">&#x27;\t&#x27;</span>, header=<span class="string">&#x27;infer&#x27;</span>, names=<span class="literal">None</span>, </span><br><span class="line">    index_col=<span class="literal">None</span>, dtype=<span class="literal">None</span>, engine=<span class="literal">None</span>, nrows=<span class="literal">None</span>) </span><br><span class="line">pd.read_csv(</span><br><span class="line">    filepath_or_buffer, sep=<span class="string">&#x27;,&#x27;</span>, header=<span class="string">&#x27;infer&#x27;</span>, names=<span class="literal">None</span>, </span><br><span class="line">    index_col=<span class="literal">None</span>, dtype=<span class="literal">None</span>, engine=<span class="literal">None</span>, nrows=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.to_csv(excel_writer=<span class="literal">None</span>, sheetname=<span class="literal">None</span>, header=<span class="literal">True</span>, index=<span class="literal">True</span>, index_label=<span class="literal">None</span>, mode=’w’, encoding=<span class="literal">None</span>) </span><br></pre></td></tr></table></figure><p><strong>读取与存储excel：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io 表示文件路径。</span></span><br><span class="line"><span class="comment"># sheetname 代表excel表内数据的分表位置。默认为0。 </span></span><br><span class="line"><span class="comment"># header 接收int或sequence。表示将某行数据作为列名。默认为infer，表示自动识别。</span></span><br><span class="line"><span class="comment"># names 表示索引列的位置，取值为sequence则代表多重索引。</span></span><br><span class="line"><span class="comment"># index_col 表示索引列的位置，取值为sequence则代表多重索引。</span></span><br><span class="line"><span class="comment"># dtype 接收dict。数据类型。</span></span><br><span class="line">pandas.read_excel(io, sheetname=<span class="number">0</span>, header=<span class="number">0</span>, index_col=<span class="literal">None</span>, names=<span class="literal">None</span>, dtype=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.to_excel(excel_writer=<span class="literal">None</span>, sheetname=<span class="literal">None</span>, header=<span class="literal">True</span>, index=<span class="literal">True</span>, index_label=<span class="literal">None</span>, mode=’w’, encoding=<span class="literal">None</span>) </span><br></pre></td></tr></table></figure><p><strong>读取与存储JSON：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过json模块转换为字典，再转换为DataFrame</span></span><br><span class="line">pd.read_json(<span class="string">&#x27;../ratings.json&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="movielens电影评分数据分析"><a href="#movielens电影评分数据分析" class="headerlink" title="movielens电影评分数据分析"></a>movielens电影评分数据分析</h2><p>需求如下：</p><ol><li><p>读取数据，从用户表读取用户信息、同样方法，导入电影评分表、电影数据表。</p></li><li><p>合并数据表</p></li><li><p>对数据初步描述分析</p></li><li><p>查看每一部电影不同性别的平均评分并计算分歧差值，之后排序</p></li><li><p>算出每部电影平均得分并对其进行排序</p></li><li><p>查看评分次数多的电影并进行排序 </p></li><li><p>过滤掉评分条目数不足250条的电影</p></li><li><p>评分最高的十部电影</p></li><li><p>查看不同年龄的分布情况并且采用直方图进行可视化</p></li><li><p>在原数据中标记出用户位于的年龄分组</p></li><li><p>可视化显示movies_ratings中不同类型电影的频数</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;pandas 是基于 NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。Pandas 纳入了大量库和一些标准的数据模型，提供了高效地操作大型数据集所需的工具。pandas提供了大量能使我们快速便捷地处理数据的函数和方法。你很快就会发现，它是使Python成为强大而高效的数据分析环境的重要因素之一。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="数据分析" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
    <category term="AI进阶" scheme="https://rencheng.cc/tags/AI%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>深度学习</title>
    <link href="https://rencheng.cc/2019/11/14/ml/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    <id>https://rencheng.cc/2019/11/14/ml/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/</id>
    <published>2019-11-14T02:52:21.000Z</published>
    <updated>2019-11-14T02:52:21.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.rencheng.cc/blog/fb5iw.jpg"><br>这个世界正在发生一些不可思议的事，而且完全超出你的想象</p><span id="more"></span><h2 id="深度学习概述"><a href="#深度学习概述" class="headerlink" title="深度学习概述"></a>深度学习概述</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>早期的深度学习受到了神经科学的启发，它们之间有着非常密切的联系。深度学习方法能够具备提取抽象特征的能力，也可以看作是从生物神经网络中获得了灵感。</p><h3 id="机器学习与深度学习对比"><a href="#机器学习与深度学习对比" class="headerlink" title="机器学习与深度学习对比"></a>机器学习与深度学习对比</h3><p><strong>传统机器学习过程</strong></p><ol><li>特征提取与人工整理</li><li>选择机器学习模型</li><li>针对训练集进行模型训练，得到最优模型参数</li><li>针对测试集进行测试，得到预测结果</li></ol><p><strong>深度学习过程（以图像数据为例）</strong></p><ol><li>输入（原始图片数据）</li><li>提取基础特征（灰度处理，整理基础图片特征数据，图像像素）</li><li>提取复杂特征（可以有多个步骤，每次提取获取不同的图像信息：线条、简单形状、复杂形状）</li><li>模型训练，得到最优模型参数      </li><li>得到预测结果</li></ol><p>传统机器学习算法需要在样本数据输入模型前经历一个人工特征提取的步骤，之后通过算法更新模型的权重参数。经过这样的步骤后，当在有一批符合样本特征的数据输入到模型中时，模型就能得到一个可以接受的预测结果。</p><p>而深度学习算法不需要在样本数据输入模型前经历一个人工特征提取的步骤，将样本数据输入到算法模型中后，模型会从样本中提取基本的特征（图像的像素）。之后，随着模型的逐步深入，从这些基本特征中组合出了更高层的特征，比如线条，简单形状（如汽车轮毂边缘）等。此时的特征还是抽象的，我们无法形象这些特征组合起来会得到什么，简单形状可以被进一步组合，在模型越深入的地方，这些简单的形状也逐步地转化成更加复杂的特征（特征开始具体化，比如看起来更像一个轮毂而不是车身），这就使得不同类别的图像更加可分。这时，将这些提取到的特征再经历类似的机器学习算法中的更新模型权重参数等步骤，也就可以得到一个令人满意的结果。</p><h2 id="神经网络简介"><a href="#神经网络简介" class="headerlink" title="神经网络简介"></a>神经网络简介</h2><h3 id="神经元"><a href="#神经元" class="headerlink" title="神经元"></a>神经元</h3><p>生物学神经元简单介绍</p><p>1904年生物学家就已经知晓了神经元的组成结构。</p><p><img src="https://cdn.rencheng.cc/blog/ewcub.png"></p><ol><li><p>每个神经元都是一个信息处理单元，且具有多输入但输出特性。</p></li><li><p>神经元的输入可分为兴奋性输入和抑制性输入两种类型。</p></li><li><p>神经元阈值特性，当细胞体膜内外电位差（由突触输入信号总和）超过阈值时产生脉冲，神经细胞进入兴奋状态。</p></li><li><p>信息在突触结构间的传递存在延迟，神经元的输入与输出之间也具有一定的延时。</p></li></ol><h3 id="突触"><a href="#突触" class="headerlink" title="突触"></a>突触</h3><p><img src="https://cdn.rencheng.cc/blog/4rsqz.jpg"></p><p>突触是由突触前膜，突触间隙和突触后膜三部分构成，一个神经元的轴突末梢经过多次分支，最后每一小支的末端膨大呈杯状或球状，叫做突触小体。这些突触小体可以与多个神经元的细胞体或树突相接触而形成突触（一个神经元可以与多个突触小体进行连接）。</p><p>化学突触指的是突触前膜借助化学信号（即递质）将信息转送到突触后细胞；而电突触则借助电信号。化学突触和电突触都又相应地被分为兴奋性突触和抑制性突触。使下一个神经元产生兴奋效应的为兴奋性突触，使下一个神经元禅师抑制效应的为抑制性突触。因此看来，突触的主要作用是在神经元细胞传递信息。</p><h3 id="人工神经网络"><a href="#人工神经网络" class="headerlink" title="人工神经网络"></a>人工神经网络</h3><p>接下来我们仿照神经元模型建立一个人工神经网络，简称神经网络或连接模型。这是一种模仿动物神经网络行为特征，进行分布式信息处理的数学算法模型，本质就是按照生物神经圆的结构和工作原理构造出来一个抽象和简化了的数学模型。</p><p>这个模型不必模拟生物神经元的所有属性和行为，但要足以模拟它执行计算的过程。处理简单易表达的目的，我们忽略了不太相关的复杂因素。我们的人工神经网络模型是一个包含输入，输出与计算功能的模型。输入可以类比为神经元的树突，而输出可以类比为神经元的轴突，计算则可以类比为细胞核。</p><p>下图是一个典型的神经元模型：包含有2个输入，1个阈值，1个输出，以及2个计算功能。这些线称为“连接”。每个上有一个“权值”。</p><p><img src="https://cdn.rencheng.cc/blog/bp2sp.png"></p><p> 对于某一个神经元，它可能同时接收了多个输入信号（输入1，2），神经元之间考形成突触的方式构成神经网络，但各个突触的结构的性质与连接强度不尽相同，具体表示时相同的输入可能对不同的神经元有不同的影响。引入权重值的目的就是为了模拟突触的这种表现，其征途代表了生物神经元中突出的兴奋或抑制，其大小则表示突触间的不同连接强度。</p><p>b 表示一个阈值。</p><p>考虑到神经元的累加性，我们对全部的输入信号进行累加整合，相当于生物神经元中膜电位的变化总量，其值可以用下述公式表示：</p><p><img src="https://cdn.rencheng.cc/blog/312r2.png"></p><p>生物神经元的激活与否取决于输入信号与某一阈值电平的比较。在神经元模型中也是类似的，只有当其输入总和超过阈值b是才会被激活，否则神经元不会被激活，当处于激活后，可以计算出y值。</p><p>之后会在进行一个非线性变换，也就是经过非线性激活函数，计算出该节点的输出（激活值）a = g(y)</p><p>其中g(y) 为非线性函数。在深度学习中，常用的激活函数主要有，sigmid, tanh, ReLu。</p><p>比如此时我们选用sigmoid函数，该函数是将取值为负无穷到正无穷的数映射到（0，1）之间。Sigmoid函数的公式及图形如下。</p><p><img src="https://cdn.rencheng.cc/blog/eq2ii.png"></p><p>若神经元的激活a为正值，称改神经元处于激活状态或兴奋状态，若a为负值，则称神经元处于抑制状态。</p><h3 id="神经网络基本结构"><a href="#神经网络基本结构" class="headerlink" title="神经网络基本结构"></a>神经网络基本结构</h3><p>简单神经网络可分为三层，分别是输入层、输出层、以及中间的隐藏层</p><p><img src="https://cdn.rencheng.cc/blog/2omir.png"></p><p>输入层有3个输入单元，隐藏层有4个单元，输出层有2个单元。</p><ol><li><p>设计一个神经网络时，输入层与输出层的节点数往往是固定的，中间层则可以自由指定；</p></li><li><p>神经网络结构图中的拓扑与箭头代表着预测过程时数据的流向，跟训练时的数据流有一定的区别；</p></li><li><p>结构图里的关键不是圆圈（代表“神经元”），而是连接线（代表“神经元”之间的连接）。每个连接线对应一个不同的权重（其值称为权值），这是需要训练得到的。</p></li></ol><h3 id="神经网络训练过程"><a href="#神经网络训练过程" class="headerlink" title="神经网络训练过程"></a>神经网络训练过程</h3><ol><li><p>整理输入与输出</p><p>我们有一组样本数据。每个样本有三个输入特征与一个输出结果。我们需要做的就是通过三个输入特征值预测输出。</p></li><li><p>模型搭建与训练</p><p>依据设计好的神经网络结构，为每一层的输入分配权重，完成神经网络正向结构搭建。基于正向传播计算样本预测输出。根据已知训练样本，设计损失函数，基于反向传播不断迭代更新每一层的权重参数使得损失函数值向最低点快速收敛。</p></li><li><p>预测</p><p>使用训练好的一组权重，对未知输出的输入进行结果预测。 </p></li></ol><h4 id="正向传播（FP-Forward-Propagation）"><a href="#正向传播（FP-Forward-Propagation）" class="headerlink" title="正向传播（FP - Forward Propagation）"></a>正向传播（FP - Forward Propagation）</h4><p><img src="https://cdn.rencheng.cc/blog/zwzod.png"></p><p>正向传播推导过程如下：<br>$$<br>layer_0 = X \<br>$$<br>根据第一层权重计算第一层结果：<br>$$<br>layer_1 = sigmoid(layer_0 \times W_1)<br>$$<br>根据第二层权重计算当前样本的预测输出：<br>$$<br>layer_2(out) = sigmoid(layer_1 \times W_2)) = y’<br>$$</p><h4 id="反向传播（BP-Backward-Propagation）"><a href="#反向传播（BP-Backward-Propagation）" class="headerlink" title="反向传播（BP - Backward Propagation）"></a>反向传播（BP - Backward Propagation）</h4><p>根据预测结果与实际结果的误差设计损失函数，对损失函数求偏导，随着迭代次数的不断增加。从而从后向前更新权重的过程称为反向传播。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><ol><li>设计神经网络结构，按照已定结构训练神经网络实现分类业务。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> mp</span><br><span class="line"><span class="comment"># sigmiod 函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">active</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sigmoid函数导函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单层网路前向传播</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">x, w</span>):</span><br><span class="line">    <span class="keyword">return</span> np.dot(x, w)</span><br><span class="line"></span><br><span class="line">x = np.array([</span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">4</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">    [<span class="number">4</span>, -<span class="number">1</span>]])</span><br><span class="line">y = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机初始化权重[-1 1)</span></span><br><span class="line">w0 = <span class="number">2</span> * np.random.random((<span class="number">2</span>, <span class="number">4</span>)) - <span class="number">1</span></span><br><span class="line">w1 = <span class="number">2</span> * np.random.random((<span class="number">4</span>, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line">lrate = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    l0 = x</span><br><span class="line">    l1 = active(forward(l0, w0))</span><br><span class="line">    l2 = active(forward(l1, w1))</span><br><span class="line">    <span class="comment"># 损失</span></span><br><span class="line">    l2_error = y - l2</span><br><span class="line">    <span class="keyword">if</span> (j % <span class="number">100</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Error:&quot;</span> + <span class="built_in">str</span>(np.mean(np.<span class="built_in">abs</span>(l2_error))))</span><br><span class="line">    l2_delta = l2_error * backward(l2)</span><br><span class="line">    w1 += l1.T.dot(l2_delta * lrate)</span><br><span class="line">    l1_error = l2_delta.dot(w1.T)</span><br><span class="line">    l1_delta = l1_error * backward(l1)</span><br><span class="line">    w0 += l0.T.dot(l1_delta * lrate)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">x</span>):</span><br><span class="line">    l0 = x</span><br><span class="line">    l1 = active(forward(l0, w0))</span><br><span class="line">    l2 = active(forward(l1, w1))</span><br><span class="line">    result = np.zeros_like(l2)</span><br><span class="line">    result[l2&gt;<span class="number">0.5</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">500</span></span><br><span class="line">l, r = x[:, <span class="number">0</span>].<span class="built_in">min</span>() - <span class="number">1</span>, x[:, <span class="number">0</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">b, t = x[:, <span class="number">1</span>].<span class="built_in">min</span>() - <span class="number">1</span>, x[:, <span class="number">1</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">grid_x = np.meshgrid(np.linspace(l, r, n),</span><br><span class="line">                     np.linspace(b, t, n))</span><br><span class="line">flat_x = np.column_stack((grid_x[<span class="number">0</span>].ravel(), grid_x[<span class="number">1</span>].ravel()))   </span><br><span class="line"></span><br><span class="line">flat_y = predict(flat_x)</span><br><span class="line">grid_y = flat_y.reshape(grid_x[<span class="number">0</span>].shape)</span><br><span class="line">mp.figure(<span class="string">&#x27;SVM Linear Classification&#x27;</span>, facecolor=<span class="string">&#x27;lightgray&#x27;</span>)</span><br><span class="line">mp.title(<span class="string">&#x27;SVM Linear Classification&#x27;</span>, fontsize=<span class="number">20</span>)</span><br><span class="line">mp.xlabel(<span class="string">&#x27;x&#x27;</span>, fontsize=<span class="number">14</span>)</span><br><span class="line">mp.ylabel(<span class="string">&#x27;y&#x27;</span>, fontsize=<span class="number">14</span>)</span><br><span class="line">mp.tick_params(labelsize=<span class="number">10</span>)</span><br><span class="line">mp.pcolormesh(grid_x[<span class="number">0</span>], grid_x[<span class="number">1</span>], grid_y, cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">mp.scatter(x[:, <span class="number">0</span>], x[:, <span class="number">1</span>], c=y.ravel(), cmap=<span class="string">&#x27;brg&#x27;</span>, s=<span class="number">80</span>)</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><ol start="2"><li>封装模型</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> mp</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ANNModel</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 随机初始化权重[-1 1)</span></span><br><span class="line">        self.w0 = <span class="number">2</span> * np.random.random((<span class="number">2</span>, <span class="number">4</span>)) - <span class="number">1</span></span><br><span class="line">        self.w1 = <span class="number">2</span> * np.random.random((<span class="number">4</span>, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line">        self.lrate = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># sigmiod 函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">active</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sigmoid函数导函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 单层网路前向传播</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, w</span>):</span><br><span class="line">        <span class="keyword">return</span> np.dot(x, w)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">            l0 = x</span><br><span class="line">            l1 = self.active(self.forward(l0, self.w0))</span><br><span class="line">            l2 = self.active(self.forward(l1, self.w1))</span><br><span class="line">            <span class="comment"># 损失</span></span><br><span class="line">            l2_error = y - l2</span><br><span class="line">            <span class="keyword">if</span> (j % <span class="number">100</span>) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;Error:&quot;</span> + <span class="built_in">str</span>(np.mean(np.<span class="built_in">abs</span>(l2_error))))</span><br><span class="line">            l2_delta = l2_error * self.backward(l2)</span><br><span class="line">            self.w1 += l1.T.dot(l2_delta * self.lrate)</span><br><span class="line">            l1_error = l2_delta.dot(self.w1.T)</span><br><span class="line">            l1_delta = l1_error * self.backward(l1)</span><br><span class="line">            self.w0 += l0.T.dot(l1_delta * self.lrate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, x</span>):</span><br><span class="line">        l0 = x</span><br><span class="line">        l1 = self.active(self.forward(l0, self.w0))</span><br><span class="line">        l2 = self.active(self.forward(l1, self.w1))</span><br><span class="line">        result = np.zeros_like(l2)</span><br><span class="line">        result[l2&gt;<span class="number">0.5</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">x = np.array([</span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">4</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">    [<span class="number">4</span>, -<span class="number">1</span>]])</span><br><span class="line">y = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">500</span></span><br><span class="line">l, r = x[:, <span class="number">0</span>].<span class="built_in">min</span>() - <span class="number">1</span>, x[:, <span class="number">0</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">b, t = x[:, <span class="number">1</span>].<span class="built_in">min</span>() - <span class="number">1</span>, x[:, <span class="number">1</span>].<span class="built_in">max</span>() + <span class="number">1</span></span><br><span class="line">grid_x = np.meshgrid(np.linspace(l, r, n),</span><br><span class="line">                     np.linspace(b, t, n))</span><br><span class="line">flat_x = np.column_stack((grid_x[<span class="number">0</span>].ravel(), grid_x[<span class="number">1</span>].ravel()))   </span><br><span class="line">model = ANNModel()</span><br><span class="line">model.fit(x)</span><br><span class="line">flat_y = model.predict(flat_x)</span><br><span class="line">grid_y = flat_y.reshape(grid_x[<span class="number">0</span>].shape)</span><br><span class="line">mp.figure(<span class="string">&#x27;SVM Linear Classification&#x27;</span>, facecolor=<span class="string">&#x27;lightgray&#x27;</span>)</span><br><span class="line">mp.title(<span class="string">&#x27;SVM Linear Classification&#x27;</span>, fontsize=<span class="number">20</span>)</span><br><span class="line">mp.xlabel(<span class="string">&#x27;x&#x27;</span>, fontsize=<span class="number">14</span>)</span><br><span class="line">mp.ylabel(<span class="string">&#x27;y&#x27;</span>, fontsize=<span class="number">14</span>)</span><br><span class="line">mp.tick_params(labelsize=<span class="number">10</span>)</span><br><span class="line">mp.pcolormesh(grid_x[<span class="number">0</span>], grid_x[<span class="number">1</span>], grid_y, cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">mp.scatter(x[:, <span class="number">0</span>], x[:, <span class="number">1</span>], c=y.ravel(), cmap=<span class="string">&#x27;brg&#x27;</span>, s=<span class="number">80</span>)</span><br><span class="line">mp.show()</span><br></pre></td></tr></table></figure><h2 id="神经网络的实现过程"><a href="#神经网络的实现过程" class="headerlink" title="神经网络的实现过程"></a>神经网络的实现过程</h2><p>1、准备数据集，提取特征，作为输入喂给神经网络（ Neural Network NN)<br>2、搭建 NN 结构，从输入到输出（先搭建计算图，再用会话执行）<br>3、大量特征数据喂给 NN ，迭代优化 NN 参数<br>4、使用训练好的模型预测和分类</p><h3 id="基于tensorflow的前向传播"><a href="#基于tensorflow的前向传播" class="headerlink" title="基于tensorflow的前向传播"></a>基于tensorflow的前向传播</h3><p>变量初始化：在 sess.run 函数中用 tf.global_variables_initializer() 汇总所有待优化变量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">init_op = tf.global_variables_initializer()</span><br><span class="line">sess.run(init_op)</span><br></pre></td></tr></table></figure><p>计算图节点运算：在sess.run函数中写入待运算的节点</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sess.run(y)</span><br></pre></td></tr></table></figure><p>用 tf.placeholder占位，在 sess.run 函数中用函数中用 feed_dict喂数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line"><span class="comment">#喂一组数据：</span></span><br><span class="line">x = tf.placeholder(tf.float32, shape=(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">y = x + x</span><br><span class="line">r = sess.run(y, feed_dict=&#123;x: [[<span class="number">0.5</span>,<span class="number">0.6</span>]]&#125;)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"><span class="comment">#喂多组数据：</span></span><br><span class="line">x = tf.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="number">2</span>))</span><br><span class="line">y = tf.reduce_sum(x, <span class="number">0</span>)</span><br><span class="line">r = sess.run(y, feed_dict=&#123;x: [[<span class="number">0.1</span>,<span class="number">0.2</span>],[<span class="number">0.2</span>,<span class="number">0.3</span>],[<span class="number">0.3</span>,<span class="number">0.4</span>],[<span class="number">0.4</span>,<span class="number">0.5</span>]]&#125;)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><h3 id="反向传播"><a href="#反向传播" class="headerlink" title="反向传播"></a>反向传播</h3><p>反向传播 ：训练模型参数 ，在所有参数上用梯度下降，使神经网络模型在训练数据上的损失函数最小。</p><h3 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h3><p>损失函数的计算有很多方法。</p><h4 id="解决回归问题的损失函数：均方误差MSE"><a href="#解决回归问题的损失函数：均方误差MSE" class="headerlink" title="解决回归问题的损失函数：均方误差MSE"></a>解决回归问题的损失函数：均方误差MSE</h4><p><img src="https://cdn.rencheng.cc/blog/7vl0x.png"></p><p>用tensorflow 函数表示为loss_mse = tf.reduce_mean(tf.square(y_ - y))</p><p>反向传播训练方法： 以减小 loss 值为优化目标 ，有梯度下降 、  adam优化器等优化方法。</p><p>这两种优化方法用tensorflow 的函数可以表示为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train_step=tf.train.GradientDescentOptimizer(learning_rate).minimize(loss)</span><br><span class="line"></span><br><span class="line">train_step=tf.train.AdamOptimizer(learning_rate).minimize(loss)</span><br></pre></td></tr></table></figure><ol><li><p>tf.train.GradientDescentOptimizer 使用随机梯度下降算法，使参数沿着<br>梯度的反方向，即总损失减小的方向移动，实现更新参数。</p><p>其中，𝐽(𝜃)为损失函数， 𝜃为参数， 𝛼为学习率。</p><p> <img src="https://cdn.rencheng.cc/blog/lre1k.png"></p></li><li><p>tf.train.AdamOptimizer() 是利用自适应学习率的优化算法， Adam 算法和随机梯度下降算法不同。随机梯度下降算法保持单一的学习率更新所有的参数，学习率在训练过程中并不会改变。而 Adam 算法通过计算梯度的一阶矩估计和二阶矩估计而为不同的参数设计独立的自适应性学习率。</p></li></ol><p>学习率 learning_rate： 决定每次参数更新的幅度。<br>优化器中都需要一个叫做学习率的参数，使用时如果学习率选择过大会导致待优化的参数在最小值附近波动不收敛的情况，如果学习率选择过小，会出现收敛速度慢的情况。 我们可以选个比较小的值填入， 比如 0.01 、 0.001。</p><h4 id="解决分类问题的损失函数：交叉熵（-cross-entropy-）"><a href="#解决分类问题的损失函数：交叉熵（-cross-entropy-）" class="headerlink" title="解决分类问题的损失函数：交叉熵（ cross entropy ）"></a>解决分类问题的损失函数：交叉熵（ cross entropy ）</h4><p>假设有两个分布p（1, 0, 0）与 q（0.8, 0.1, 0.1），则它们在给定样本集上的交叉熵定义如下：<br>$$<br>CE(p,q)=−\sum_{}p(x)logq(x)<br>$$</p><hr><p>用Tensorflow 函数表示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ce=-tf.reduce_sum(p * tf.log(tf.clip_by_value(q, <span class="number">1e-12</span>, <span class="number">1.0</span>))) </span><br></pre></td></tr></table></figure><p>（1e-12 是为了防止log0出现）</p><p>两个神经网络模型解决二分类问题中，已知标准答案为p = (1, 0)，第一个神经网络模型预测结果为q1=(0.6, 0.4)，第二个神经网络模型预测结果为q2=(0.8, 0.2)，判断哪个神经网络模型预测的结果更接近标准答案。<br>根据交叉熵的计算公式得：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">H1((1,0),(0.6,0.4)) = -(1*log0.6 + 0*log0.4) ≈≈ -(-0.222 + 0) = 0.222</span><br><span class="line">H2((1,0),(0.8,0.2)) = -(1*log0.8 + 0*log0.2) ≈≈ -(-0.097 + 0) = 0.097</span><br></pre></td></tr></table></figure><p>由于0.222&gt;0.097，所以预测结果y2与标准答案与标准答案y_更接近，y2预测更准确。</p><p><strong>总结：</strong></p><p>交叉熵刻画了两个概率分布之间的距离， 它是分类问题中使用比较广的一种损失函数。</p><p>交叉熵越大，两个概率分布距离越远， 两个概率分布越相异 ;</p><p>交叉熵越小，两个概率分布距离越近 ，两个概率分布越相似 。</p><h2 id="神经网络计算过程："><a href="#神经网络计算过程：" class="headerlink" title="神经网络计算过程："></a>神经网络计算过程：</h2><ol><li><p>导入模块，生成模拟数据集；<br>import<br>常量定义<br>生成数据集</p></li><li><p>前向传播：定义输入、参数和输出<br>x=              y_ =<br>w1=           w2=<br>a=              y=</p></li><li><p>反向传播：定义损失函数、反向传播方法<br>loss=<br>train_step=</p></li><li><p>生成会话，训练 STEPS 轮</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.session() <span class="keyword">as</span> sess</span><br><span class="line">    Init_op=tf.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    STEPS=<span class="number">3000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(STEPS):</span><br><span class="line">        start=</span><br><span class="line">        end=</span><br><span class="line">        sess.run(train_step, feed_dict:)</span><br></pre></td></tr></table></figure></li></ol><h3 id="基于tensorflow训练神经网络"><a href="#基于tensorflow训练神经网络" class="headerlink" title="基于tensorflow训练神经网络"></a>基于tensorflow训练神经网络</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding utf-8</span></span><br><span class="line"><span class="comment">#导入模块，生成模拟数据集</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">BATCH_SIZE =<span class="number">8</span></span><br><span class="line">seed =<span class="number">23455</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#基于seed产生随机数</span></span><br><span class="line">rng = np.random.RandomState(seed)</span><br><span class="line"><span class="comment">#随机数返回32行2列的矩阵，表示32组宽度和长度作为输入数据集</span></span><br><span class="line">X = rng.rand(<span class="number">32</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">#从这个32行2列的矩阵中，取出一行，判断如果和小于1，给Y赋值1；</span></span><br><span class="line"><span class="comment"># 如果和不小于1，给Y赋值0，作为输入数据集的标签</span></span><br><span class="line">Y = [[<span class="built_in">int</span>(x0 +x1 &lt; <span class="number">1</span>)] <span class="keyword">for</span> (x0,x1) <span class="keyword">in</span> X]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;X:&quot;</span>,X)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Y:&quot;</span>,Y)</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义神经网络的输入、参数和输出，定义向前传播过程</span></span><br><span class="line">x = tf.placeholder(tf.float32, shape=(<span class="literal">None</span>,<span class="number">2</span>))</span><br><span class="line">y_ = tf.placeholder(tf.float32, shape=(<span class="literal">None</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">w1=tf.Variable(tf.random_normal([<span class="number">2</span>,<span class="number">3</span>],stddev=<span class="number">1</span>,seed=<span class="number">1</span>))</span><br><span class="line">w2=tf.Variable(tf.random_normal([<span class="number">3</span>,<span class="number">1</span>],stddev=<span class="number">1</span>,seed=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">a= tf.matmul(x,w1)</span><br><span class="line">y= tf.matmul(a,w2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义损失函数及反向传播方法</span></span><br><span class="line">loss=tf.reduce_mean(tf.square(y-y_))</span><br><span class="line">train_step = tf.train.GradientDescentOptimizer(<span class="number">0.001</span>).minimize(loss)</span><br><span class="line"><span class="comment">#train_step=tf.train.AdamOptimizer(0.001).minimize(loss)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成会话，训练STEPS轮</span></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    init_op=tf.global_variables_initializer()</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    <span class="comment">#输出目前（未经训练）的参数取值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;w1:&quot;</span>, sess.run(w1))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;w2:&quot;</span>, sess.run(w2))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#训练模型</span></span><br><span class="line">    STEPS= <span class="number">3000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(STEPS):</span><br><span class="line">        start = (i*BATCH_SIZE) % <span class="number">32</span></span><br><span class="line">        end = start + BATCH_SIZE</span><br><span class="line">        sess.run(train_step,feed_dict=&#123;x:X[start:end], y_ :Y[start:end]&#125;)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">500</span> ==<span class="number">0</span>:</span><br><span class="line">            total_loss = sess.run(loss,feed_dict=&#123;x:X,y_:Y&#125;)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;After %d training steps, loss on all data is %g&quot;</span>%(i,total_loss))</span><br><span class="line">    <span class="comment">#输出训练后的参数数值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;w1:&quot;</span>,sess.run(w1))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;w2:&quot;</span>,sess.run(w2))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>由神经网络的实现 结果，我们可以看出，总共 训练 3000 轮。 每轮从 X 的数据集和 Y 的标签中抽取相对应的从 start 开始到 end 结束个特征值 和 标签 喂入神经网络。 用 sess.run 求出 loss， 每 500 轮打印一次 loss 值 。经过 3000 轮后 我们打印出 最终训练好的 参数 w1 、 w2 。</p><h2 id="图像处理与CNN"><a href="#图像处理与CNN" class="headerlink" title="图像处理与CNN"></a>图像处理与CNN</h2><h3 id="计算机眼中的图像"><a href="#计算机眼中的图像" class="headerlink" title="计算机眼中的图像"></a>计算机眼中的图像</h3><p>在计算机中，对于图像存储是通过矩阵来存储的。照片分为黑白和彩色。在图像里我们相应的有灰度图和彩色图。</p><p>对于灰度图像，由于只有明暗的区别，因此只需要一个数字就可以表示出不同的灰度。通常用0表示最暗的黑色，255表示最亮的白色，介于0和255之间的整数则表示不同明暗程度的灰色。</p><p>对于彩色图像，我们用（R,G,B）三个数字来表示一个颜色，他们表示用红（R）、绿（G）、蓝（B）三种基本颜色叠加后的颜色。对于每种基本颜色，我们用0到255之间的整数表示这个颜色分量的明暗程度。</p><p><img src="https://cdn.rencheng.cc/blog/oa89o.png"></p><p>三个数字中对应的某种基本颜色的数字越大，表示该基本颜色的比例越大，例如（255,0,0）表示纯红色，（0,255,0）表示纯绿色，（135,206,255）表示天蓝色。</p><p>一张彩色图片我们可以用一个由整数组成的立方体阵列来表示。我们称这样的立方体排列的数字阵列为三阶张量（tensor）。这个三阶张量的长度与宽度就是图片的分辨率，高度为3.对于数字图像而言，三阶张量的高度也成为通道（channel）数，因此我们说彩色图像有3个通道。矩阵可以看成是高度为1的三阶张量。</p><h3 id="图像特征概述"><a href="#图像特征概述" class="headerlink" title="图像特征概述"></a>图像特征概述</h3><p>在深度学习出现之前，图像特征的设计一直是计算机视觉领域中一个重要的研究课题，在这个领域发展初期，人们手工设计了各种图像特征，这些特征可以描述图像的颜色、边缘、纹理等性质，结合机器学习技术，能解决物体识别和物体检测等实际问题。</p><p>既然图像在计算机中可以表示成三阶张量，那么从图像中提取特征便是对这个三阶张量进行运算的过程。其中非常重要的一种运算就是卷积。</p><h3 id="卷积运算"><a href="#卷积运算" class="headerlink" title="卷积运算"></a>卷积运算</h3><h4 id="卷积定义"><a href="#卷积定义" class="headerlink" title="卷积定义"></a>卷积定义</h4><p>卷积是两个变量在某范围内相乘后求和的结果。</p><h4 id="一维卷积"><a href="#一维卷积" class="headerlink" title="一维卷积"></a>一维卷积</h4><p>卷积运算的物理意义：一个函数（如：单位响应）在另一个函数（如:输入信号）上的加权叠加</p><p>有两个离散信号</p><p>待卷积信号 X=[1,2,3,0,1,0]，</p><p>卷积核 H=[1,2,1]</p><p>卷积运算 Y = X * H</p><p><img src="https://cdn.rencheng.cc/blog/mmyal.jpg"></p><p><strong>valid</strong></p><p>自始至终卷积核都在“信号内”</p><p>最后得到的结果的长度会小于卷积信号的长度</p><p><img src="https://cdn.rencheng.cc/blog/zw5vr.jpg"></p><p><strong>same</strong></p><p>卷积核的中心刚好是从待卷积信号的第一个元素“划”到最后一个元素卷积结果的长度和待卷积信号长度一样</p><p><img src="https://cdn.rencheng.cc/blog/evqc3.jpg"></p><p><strong>full</strong> </p><p>从卷积核的最后一个元素开始，直到第一个元素到与待卷积信号第一个元素对齐卷积结果的长度是n+m-1</p><p><img src="https://cdn.rencheng.cc/blog/o6t3o.jpg"></p><h4 id="二维卷积"><a href="#二维卷积" class="headerlink" title="二维卷积"></a>二维卷积</h4><p>图像数据是5x5的二维矩阵，使用一个3x3的卷积核，从左到右从上到下滑动。滑动的过程称为stride，一个卷积层有两个stride，分别从上到下，从左到右，步长一般设定为1或2。</p><p><img src="https://cdn.rencheng.cc/blog/vj3sh.jpg"></p><h4 id="利用卷积提取图像特征"><a href="#利用卷积提取图像特征" class="headerlink" title="利用卷积提取图像特征"></a>利用卷积提取图像特征</h4><p>卷积运算在图像处理中应用十分广泛，许多图像特征提取方法都会用到卷积。以灰度图为例，，我们知道在计算机中，一个灰度图像被表示为一个整数矩阵，如果我们用一个形状较小的矩阵和这个图像矩阵做卷积运算，就可以得到一个新的矩阵，这个新的矩阵可以看作是一副新的图像，换句话说，通过卷积运算，我们可以将原图像变换为一副新的图像。这幅新图像比原图像更清楚地表示了某些性质，我们就可以把它看做原图像的一个特征。</p><p>这里用到的小矩阵就称为卷积核（convolution kernel），通常，图像矩阵中的元素都是介于0到255的整数，但卷积核中的元素可以是任意实数。</p><p>通过卷积，我们可以从图像中提取边缘特征，在没有边缘的比较平坦的区域，图像的像素值的变化较小，而横向边缘上下两侧的像素值 差异明显，竖向边缘左右两侧的像素也会有较大差别。</p><p><img src="https://cdn.rencheng.cc/blog/6xlfw.jpg"></p><p>如上图，我们用1、0、-1 组成的卷积核与原图像进行卷积运算，可以从图像中提取出竖向边缘。</p><p><img src="https://cdn.rencheng.cc/blog/k5k81.jpg"></p><p>如上图，我们用三行1,0，-1组成的卷积核，从图中提取出了横向边缘。</p><p>事实上，这两个卷积核分别计算了原图像上每个3*3区域内左右像素或者上下像素的差值（为了将运算结果以图像的形式显示出来，我们对运算结果去了绝对值），通过这样的运算，我们就可以从图像上提取不同的边缘特征。</p><h3 id="卷积神经网络基本结构"><a href="#卷积神经网络基本结构" class="headerlink" title="卷积神经网络基本结构"></a>卷积神经网络基本结构</h3><p>Alex Net 神经网络</p><p><img src="https://cdn.rencheng.cc/blog/xzvij.png"></p><p>上图为Alex Net 神经网络的主体部分，主体部分有5个卷积层和3个全连接层组成</p><p>5个卷积层位于网络的最前端，依次<strong>对图像进行变换以提取特征</strong>；</p><p>每个卷积层之后都有一个<strong>ReLU</strong>非线性激活层<strong>完成非线性变换；</strong></p><p>第一、二、五个卷积层之后连接有最大池化 层，用以<strong>降低特征图的分辨率</strong>。</p><p>经过5个卷积层以及相连的非线性激活层与池化层之后，特征图被转换为4096维特征向量，在经过两次全连接层和ReLU层变换之后，成为最终的特征向量，在经过一个全连接层和一个softmax归一化指数层之后，就得到了对图片所属类型的预测。</p><h4 id="卷积层"><a href="#卷积层" class="headerlink" title="卷积层"></a>卷积层</h4><p>神经网络中的卷积层就是用卷积运算对原始图像或者上一层的特征进行变换的层。在前边的学习中，我们学习了边缘特征的提取，知道一种特定的卷积核可以对图像进行一种特定的变换，从而提取出某种特定的特征，如横向边缘或者竖向边缘。</p><p>在一个卷积层中，为了从图像中提取多种形式的特征，我们通常使用多个卷积核对输入的图像进行不同的卷积操作。一个卷积核可以得到一个通道为1的三阶张量，，多个卷积核就可以得到多个通道为1的三阶张量结果。我们把这些结果作为不同的通道组合起来，就可以得到一个新的三阶张量，这个三阶张量的通道数就等于我们使用的卷积核的个数。由于每一个通道都是从原图像中提取的一种特征，我们也将这个三阶张量称为特征图（feature map）。这个特征图就是卷积层的最终输出。</p><p>特征图与彩色图像都是三阶张量，也都有若干个通道。因此卷积层不仅可以作用于图像，也可以作用于其他输出的特征图。通常，一个深度神经网络的第一个卷积层会以图像作为输入，而之后的卷积层会以前面的特征图为输入。</p><h4 id="非线性激活层"><a href="#非线性激活层" class="headerlink" title="非线性激活层"></a>非线性激活层</h4><p>通常我们需要在每个卷积层和全连接层后面都连接一个非线性激活层（non-linear activation layer）。为什么呢？其实不管是卷积运算还是全连接层中的运算，他们都是自变量的一次函数，即所谓的线性函数（linear function）。线性函数有一个性质：若干线性计算的符合仍然是线性的。换句话说，如果我们只是将卷积层和全连接层直接堆叠起来，，那么它们对输入图片产生的效果就可以被一个全连接层替代。这样一来，虽然我们堆叠了很多层，但对每一层的变换效果实际上被合并到了一起。而如果我们在每次线性运算后，再进行一次非线性运算，那么每次变换的效果就可以保留。非线性激活层的形式与很多种，它们的基本形式是先选定某种非线性函数，然后对输入特征图或者特征向量的每一个元素应用这种非线性函数，得到输出。</p><p>常见的非线性函数有：</p><p>l  逻辑函数（logistic function）sigmoid</p><p><img src="https://cdn.rencheng.cc/blog/rmvyd.png"></p><p><img src="https://cdn.rencheng.cc/blog/ockpa.png"></p><p>l  双曲正切函数（hyperbolic tangent function）</p><p><img src="https://cdn.rencheng.cc/blog/k2h3o.png"></p><p><img src="https://cdn.rencheng.cc/blog/ips3q.png"></p><p>l  修正线性函数（rectified linear function）</p><p><img src="https://cdn.rencheng.cc/blog/4v4zl.png"></p><p><img src="https://cdn.rencheng.cc/blog/jv3oz.png"></p><p>前两者sigmoid/tanh比较常见于全连接层，后者ReLU常见于卷积层。</p><p>激活函数是用来加入非线性因素的，使得神经网络可以任意逼近任何非线性函数，提高经网络对模型的表达能力，解决线性模型所不能解决的问题，这样神经网络就可以应用到众多的非线性模型中。</p><p>以ReLU层为例，对于输入的特征向量或特征图，他会将其中小于零的元素变成零，而其他元素的值保持不变，就得到了输出。</p><p><img src="https://cdn.rencheng.cc/blog/zkpow.png"></p><p>因为ReLU的计算非常简单，所以它的计算速度往往比其他非线性激活层快很多，价值其在实际应用中的效果也很好，因此在深度神经网络中被广泛地使用。</p><h4 id="池化层"><a href="#池化层" class="headerlink" title="池化层"></a>池化层</h4><p>在计算卷积时，我们会用卷积核滑过图像或者特征图的每一个像素。如果图像或者特征图的分辨率很多，那么卷积的计算量就会很大。为了解决 这个问题，我们通常在几个卷积层之后插入池化层（pooling layer），已降低特征图的分辨率。</p><p>池化层的基本操作步骤如下。首先，我们将特征图按通道分开，得到若干个矩阵。对于每个矩阵，我们将其切割成若干大小相等的正方形小块。如下图，我们将一个4<em>4的矩阵分割成4个正方形区块，每个区块的大小为2</em>2.接下来，我们对每一个区块取最大值或者平均值，并将结果组成一个新的矩阵。最后，我们将所有通道的结果矩阵按原顺序堆叠起来形成一个三阶张量，这个三阶张量就是池化层的输出。对于每一个区块取最大值的池化层，我们称之为最大池化层（<strong>max pooling</strong>），而取平均值的池化层成为平均池化层（<strong>average pooling layer</strong>）。</p><p><img src="https://cdn.rencheng.cc/blog/se5cf.png"></p><p>在经过池化后，特征图的长和宽都会减小到原来的1/2，特征图中的元素数目减小到原来的1/4。通常我们会在卷积层之后增加池化层。这样，在经过若干卷积、池化层的组合之后，在不考虑通道数的情况下，特征图的分辨率就会远小于输入图像的分辨率，大大减小了对计算量和参数数量的需求。</p><h4 id="全连接层"><a href="#全连接层" class="headerlink" title="全连接层"></a>全连接层</h4><p>全连接层在整个卷积神经网络中起到“分类器”的作用，即通过卷积、激活函数、池化等深度网络后，再经过全连接层对结果进行识别分类。：</p><p><img src="https://cdn.rencheng.cc/blog/ox5o4.png"></p><p>由于神经网络是属于监督学习，在模型训练时，根据训练样本对模型进行训练，从而得到全连接层的权重（如预测字母X的所有连接的权重)</p><p><img src="https://cdn.rencheng.cc/blog/umd4f.png"></p><p>最后计算出来字母X的识别值为0.92，字母O的识别值为0.51，则结果判定为X</p><p><img src="https://cdn.rencheng.cc/blog/m9yjx.png"></p><p>“卷积神经网络”（CNN）结构，如下图所示：</p><p><img src="https://cdn.rencheng.cc/blog/2quzh.png"></p><p><img src="https://cdn.rencheng.cc/blog/rwspj.png"></p><p>softmax实现多分类业务</p><h3 id="设计卷积神经网络实现手写数字识别"><a href="#设计卷积神经网络实现手写数字识别" class="headerlink" title="设计卷积神经网络实现手写数字识别"></a>设计卷积神经网络实现手写数字识别</h3><h4 id="mnist-数据集"><a href="#mnist-数据集" class="headerlink" title="mnist 数据集"></a>mnist 数据集</h4><p>mnist 数据集 ：包含 7 万张 黑底白字手写数字 图片， 其中 55000 张为训练集，5000 张为验证集， 1 0000 张 为测试集 。每张图片大小为 28*28 像素，图片中 纯 黑色像素 值为 0， 纯 白色像素值为 1 。数据集的标签是长度为 10 的一维数组，数组中每个元素索引号表示对应数字出现的概率 。</p><p>tf.cast(x,dtype) 函数表示将参数 x 转换为指定数据类型 。</p><p>tf.reduce_mean( x,axis 函数表示求取矩阵或张量指定维度的平均值。 </p><p>tf argmax(x,axis) 函数表示 返回 指定维度 axis 下，参数 x 中 最大值索引号 。</p><p>os.path.join 函数表示 把 参数 字符串按照路径命名规则拼接。</p><p>字符串 split( 函数表示 按照指定 拆分符 对字符串拆分 返回拆分列表 。</p><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">&#x27;MNIST_data&#x27;</span>, one_hot=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成权重</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weight_variable</span>(<span class="params">shape</span>):</span><br><span class="line">  initial = tf.random_normal(shape, stddev=<span class="number">0.1</span>)</span><br><span class="line">  <span class="keyword">return</span> tf.Variable(initial)</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成b</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bias_variable</span>(<span class="params">shape</span>):</span><br><span class="line">  initial = tf.constant(<span class="number">0.1</span>, shape=shape)</span><br><span class="line">  <span class="keyword">return</span> tf.Variable(initial)</span><br><span class="line"></span><br><span class="line"><span class="comment">#卷积层</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conv2d</span>(<span class="params">x, W</span>):</span><br><span class="line">  <span class="keyword">return</span> tf.nn.conv2d(x, W, strides=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">&#x27;SAME&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">max_pool_2x2</span>(<span class="params">x</span>):</span><br><span class="line">  <span class="keyword">return</span> tf.nn.max_pool(x, ksize=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">                        strides=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], padding=<span class="string">&#x27;SAME&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搭建正向传播的神经网络</span></span><br><span class="line">x = tf.placeholder(<span class="string">&quot;float&quot;</span>, shape=[<span class="literal">None</span>, <span class="number">784</span>])</span><br><span class="line">y_ = tf.placeholder(<span class="string">&quot;float&quot;</span>, shape=[<span class="literal">None</span>, <span class="number">10</span>])</span><br><span class="line"><span class="comment"># 第一层操作   卷积/relu/池化</span></span><br><span class="line">W_conv1 = weight_variable([<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">32</span>])</span><br><span class="line">b_conv1 = bias_variable([<span class="number">32</span>])</span><br><span class="line">x_image = tf.reshape(x, [-<span class="number">1</span>,<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>])</span><br><span class="line">h_conv1 = tf.nn.relu(conv2d(x_image, W_conv1) + b_conv1)</span><br><span class="line">h_pool1 = max_pool_2x2(h_conv1)</span><br><span class="line"><span class="comment"># 第二层操作   卷积/relu/池化</span></span><br><span class="line">W_conv2 = weight_variable([<span class="number">5</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">64</span>])</span><br><span class="line">b_conv2 = bias_variable([<span class="number">64</span>])</span><br><span class="line">h_conv2 = tf.nn.relu(conv2d(h_pool1, W_conv2) + b_conv2)</span><br><span class="line">h_pool2 = max_pool_2x2(h_conv2)</span><br><span class="line"><span class="comment"># 第三层全连接  FC</span></span><br><span class="line">W_fc1 = weight_variable([<span class="number">7</span> * <span class="number">7</span> * <span class="number">64</span>, <span class="number">1024</span>])</span><br><span class="line">b_fc1 = bias_variable([<span class="number">1024</span>])</span><br><span class="line">h_pool2_flat = tf.reshape(h_pool2, [-<span class="number">1</span>, <span class="number">7</span>*<span class="number">7</span>*<span class="number">64</span>])</span><br><span class="line">h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat, W_fc1) + b_fc1)</span><br><span class="line"><span class="comment"># softmax</span></span><br><span class="line">W_fc2 = weight_variable([<span class="number">1024</span>, <span class="number">10</span>])</span><br><span class="line">b_fc2 = bias_variable([<span class="number">10</span>])</span><br><span class="line">y_conv=tf.nn.softmax(tf.matmul(h_fc1, W_fc2) + b_fc2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    cross_entropy = -tf.reduce_sum(y_*tf.log(y_conv))</span><br><span class="line">    train_step = tf.train.AdamOptimizer(<span class="number">1e-4</span>).minimize(cross_entropy)</span><br><span class="line">    correct_prediction = tf.equal(tf.argmax(y_conv,<span class="number">1</span>), tf.argmax(y_,<span class="number">1</span>))</span><br><span class="line">    accuracy = tf.reduce_mean(tf.cast(correct_prediction, <span class="string">&quot;float&quot;</span>))</span><br><span class="line">    sess.run(tf.initialize_all_variables())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20000</span>):</span><br><span class="line">        batch = mnist.train.next_batch(<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">            train_accuracy = accuracy.<span class="built_in">eval</span>(feed_dict=&#123;</span><br><span class="line">                x:batch[<span class="number">0</span>], y_: batch[<span class="number">1</span>]&#125;)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;step %d, training accuracy %g&quot;</span>%(i, train_accuracy))</span><br><span class="line">        train_step.run(feed_dict=&#123;x: batch[<span class="number">0</span>], y_: batch[<span class="number">1</span>]&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test accuracy %g&quot;</span>%accuracy.<span class="built_in">eval</span>(feed_dict=&#123;</span><br><span class="line">        x: mnist.test.images, y_: mnist.test.labels&#125;))</span><br></pre></td></tr></table></figure><p><strong>模型上线：</strong></p><p>MyModel.py</p><p>y = model.predict(x)</p><p>假设模型用于预测股票价格，如果已经得到y，如何交给调用者？</p><p>设计web服务：</p><p>url:  <a href="http://172.10.0.13:8000/moviereco/%7BID%7D">http://172.10.0.13:8000/moviereco/{ID}</a></p><p>method: get</p><p>params: none</p><p>return: {status:200, data:[movie1id, movie2id, …….], msg:’no msg’}</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://cdn.rencheng.cc/blog/fb5iw.jpg&quot;&gt;&lt;br&gt;这个世界正在发生一些不可思议的事，而且完全超出你的想象&lt;/p&gt;</summary>
    
    
    
    
    <category term="AI进阶" scheme="https://rencheng.cc/tags/AI%E8%BF%9B%E9%98%B6/"/>
    
    <category term="机器学习" scheme="https://rencheng.cc/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="深度学习" scheme="https://rencheng.cc/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="TensorFlow" scheme="https://rencheng.cc/tags/TensorFlow/"/>
    
  </entry>
  
  <entry>
    <title>Django教程</title>
    <link href="https://rencheng.cc/2019/11/11/django/Django%E6%95%99%E7%A8%8B/"/>
    <id>https://rencheng.cc/2019/11/11/django/Django%E6%95%99%E7%A8%8B/</id>
    <published>2019-11-11T12:47:15.000Z</published>
    <updated>2019-11-11T12:47:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>Django是一个开放源代码的Web应用框架，由Python写成。</p><span id="more"></span><h2 id="Django框架的介绍"><a href="#Django框架的介绍" class="headerlink" title="Django框架的介绍"></a>Django框架的介绍</h2><ul><li><p>2005年发布, 采用Python语言编写的开源web框架</p></li><li><p>早期的时候Django主做新闻和内容管理的</p></li><li><p>一个重量级的 Python Web框架，Django 配备了常用的大部分组件</p><ol><li>基本配置</li><li>路由系统</li><li>原生HTML模板系统</li><li>视图 view</li><li>Model模型,数据库连接和ORM数据库管理</li><li>中间件</li><li>Cookie &amp; Seesion</li><li>分页</li><li>数据库后台管理系统admin</li></ol></li><li><p>Django的用途</p><ul><li>网站后端开发</li><li>微信公众号、微信小程序等后台开发</li><li>基于HTTP/HTTPS协议的后台服务器开发<ul><li>在线语音/图像识别服务器</li><li>在线第三方身份验证服务器等</li></ul></li></ul></li><li><p>Django的版本</p><ul><li>最新版本:2.2.x</li><li>当前版本:1.11.8</li></ul></li><li><p>Django的官网</p><ul><li>官方网址: <a href="http://www.djangoproject.com/">http://www.djangoproject.com</a></li><li>中文文档(第三方):<ul><li><a href="https://yiyibooks.cn/">https://yiyibooks.cn/</a></li><li><a href="http://djangobook.py3k.cn/">http://djangobook.py3k.cn/</a></li></ul></li><li>Django的离线文档<ol><li>解压缩数据包 <code>django-docs-1.11-en.zip</code></li><li>用浏览器打开 <code>django-docs-1.11-en/index.html</code></li></ol></li></ul></li></ul><h3 id="Django的安装"><a href="#Django的安装" class="headerlink" title="Django的安装"></a>Django的安装</h3><ul><li>查看已安装的版本  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> django</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(django.VERSION)</span><br><span class="line">(<span class="number">1</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="string">&#x27;final&#x27;</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure></li><li>安装<ol><li>在线安装<ul><li><code>$ sudo pip3 install django</code>  安装django的最新版本</li><li>或</li><li><code>$ sudo pip3 install django[==版本]</code> 安装django的指定版本</li><li>如:<ul><li><code>$ sudo pip3 install django==1.11.8</code></li></ul></li></ul></li><li>离线安装<ul><li>下载安装包:</li><li>安装离线包<ul><li><code>$ tar -xvf Django-1.11.8.tar.gz</code></li><li><code>$ cd Django-1.11.8</code></li><li><code>$ sudo python3 setup.py install</code></li></ul></li></ul></li><li>用wheel离线安装<ul><li>下载安装包:<ul><li><code>pip3 download -d /home/weimz/django_packs django==1.11.8</code></li></ul></li><li>安装离线包<ul><li>$ pip3 install Django-1.11.8.whl</li></ul></li></ul></li></ol></li><li>Django的卸载</li><li>$ pip3 uninstall django</li><li>Django 的开发环境<ul><li>Django 1.11.x 支持 Python 2.7, 3.4, 3.5 和 3.6（长期支持版本 LTS)</li><li>注: Django 1.11.x 不支持 Python 3.7</li></ul></li></ul><h2 id="Django框架开发"><a href="#Django框架开发" class="headerlink" title="Django框架开发"></a>Django框架开发</h2><h3 id="创建项目的指令"><a href="#创建项目的指令" class="headerlink" title="创建项目的指令"></a>创建项目的指令</h3><ul><li><p>$ django-admin startproject 项目名称</p></li><li><p>如:</p><ul><li>$ django-admin startproject mysite1</li></ul></li><li><p>运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> mysite1</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py runserver</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py runserver 5000  <span class="comment"># 指定只能本机使用127.0.0.1的5000端口访问本机</span></span></span><br></pre></td></tr></table></figure><h3 id="Django项目的目录结构"><a href="#Django项目的目录结构" class="headerlink" title="Django项目的目录结构"></a>Django项目的目录结构</h3></li><li><p>示例:</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">django-admin startproject mysite1</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree mysite1/</span></span><br><span class="line">mysite1/</span><br><span class="line">├── manage.py</span><br><span class="line">└── mysite1</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br><span class="line"></span><br><span class="line">1 directory, 5 files</span><br></pre></td></tr></table></figure></li><li><p>项目目录结构解析:</p><ul><li>manage.py<ul><li>此文件是项目管理的主程序,在开发阶段用于管理整个项目的开发运行的调式</li><li><code>manage.py</code> 包含项目管理的子命令, 如:<ul><li><code>python3 manage.py runserver</code> 启动服务</li><li><code>python3 manage.py startapp</code> 创建应用</li><li><code>python3 manage.py migrate</code> 数据库迁移</li><li><code>...</code></li></ul></li></ul></li><li>mysite1 项目包文件夹<ul><li>项目包的主文件夹(默认与项目名称一致)</li></ul><ol><li><code>__init__.py</code><ul><li>包初始化文件,当此项目包被导入(import)时此文件会自动运行</li></ul></li><li><code>wsgi.py</code><ul><li>WSGI 即 Web Server Gateway Interface</li><li>WEB服务网关接口的配置文件，仅部署项目时使用</li></ul></li><li><code>urls.py</code><ul><li>项目的基础路由配置文件，所有的动态路径必须先走该文件进行匹配</li></ul></li><li><code>settings.py</code><ul><li>Django项目的配置文件, 此配置文件中的一些全局变量将为Django框架的运行传递一些参数</li><li>setting.py 配置文件,启动服务时自动调用，</li><li>此配置文件中也可以定义一些自定义的变量用于作用全局作用域的数据传递</li></ul></li></ol></li></ul></li><li><p><code>settings.py</code> 文件介绍</p><ol><li><code>BASE_DIR</code><ul><li>用于绑定当前项目的绝对路径(动态计算出来的), 所有文件都可以依懒此路径</li></ul></li><li><code>DEBUG</code><ul><li>用于配置Django项目的启用模式, 取值:<ol><li>True 表示开发环境中使用 <code>调试模式</code>(用于开发中)</li><li>False 表示当前项目运行在<code>生产环境中</code>(不启用调试)</li></ol></li></ul></li><li><code>ALLOWED_HOSTS</code><ul><li>设置允许访问到本项目的网络地址列表,取值:<ol><li>[] 空列表,表示只有<code>127.0.0.1</code>, <code>localhost</code>, ‘[::1]’ 能访问本项目</li><li>[‘*’]，表示任何网络地址都能访问到当前项目</li><li>[‘*.tedu.cn’, ‘weimingze.com’] 表示只有当前两个主机能访问当前项目</li></ol><ul><li>注意:<ul><li>如果要在局域网其它主机也能访问此主机,启动方式应使用如下模式:</li></ul></li><li><code>python3 manage.py runserver 0.0.0.0:5000</code> # 指定网络设备所有主机都可以通过5000端口访问(需加<code>ALLOWED_HOSTS = [&#39;*&#39;]</code>) </li></ul></li></ul></li><li><code>INSTALLED_APPS</code><ul><li>指定当前项目中安装的应用列表</li></ul></li><li><code>MIDDLEWARE</code><ul><li>用于注册中间件</li></ul></li><li><code>TEMPLATES</code><ul><li>用于指定模板的配置信息</li></ul></li><li><code>DATABASES</code><ul><li>用于指定数据库的配置信息</li></ul></li><li><code>LANGUAGE_CODE</code><ul><li>用于指定语言配置</li><li>取值:<ul><li>英文 : <code>&quot;en-us&quot;</code></li><li>中文 : <code>&quot;zh-Hans&quot;</code></li></ul></li></ul></li><li><code>TIME_ZONE</code><ul><li>用于指定当前服务器端时区</li><li>取值:<ul><li>世界标准时间: <code>&quot;UTC&quot;</code></li><li>中国时区 : <code>&quot;Asia/Shanghai&quot;</code></li></ul></li></ul></li><li><code>ROOT_URLCONF</code><ul><li>用于配置根级 url 配置 ‘mysite1.urls’</li><li>如:<ul><li><code>ROOT_URLCONF = &#39;mysite1.urls&#39;</code><blockquote><p>注: 此模块可以通过 <code>from django.conf import settings</code> 导入和使用</p></blockquote></li></ul></li></ul></li></ol></li></ul><h3 id="URL-介绍"><a href="#URL-介绍" class="headerlink" title="URL 介绍"></a>URL 介绍</h3><ul><li><p>url 即统一资源定位符 Uniform Resource Locator</p></li><li><p>作用:</p><ul><li>用来表示互联网上某个资源的地址。</li></ul></li><li><p>说明:</p><ul><li>互联网上的每个文件都有一个唯一的URL，它包含的信息指出文件的位置以及浏览器应该怎么处理它。</li></ul></li><li><p>URL的一般语法格式为：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol :// hostname[:port] / path [?query][#fragment]</span><br></pre></td></tr></table></figure></li><li><p>如:</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://tts.tmooc.cn/video/showVideo?menuId=657421&amp;version=AID201908#subject</span><br></pre></td></tr></table></figure></li><li><p>说明:</p><ul><li><p>protocol（协议）</p><ul><li>http 通过 HTTP 访问该资源。 格式 <code>HTTP://</code></li><li>https 通过安全的 HTTPS 访问该资源。 格式 <code>HTTPS://</code></li><li>file 资源是本地计算机上的文件。格式: <code>file:///</code></li><li>…</li></ul></li><li><p>hostname（主机名）</p><ul><li>是指存放资源的服务器的域名系统(DNS) 主机名、域名 或 IP 地址。</li></ul></li><li><p>port（端口号）</p><ul><li>整数，可选，省略时使用方案的默认端口；</li><li>各种传输协议都有默认的端口号，如http的默认端口为80。</li></ul></li><li><p>path（路由地址）</p><ul><li>由零或多个“/”符号隔开的字符串，一般用来表示主机上的一个目录或文件地址。路由地址决定了服务器端如何处理这个请求</li></ul></li><li><p>query(查询)</p><ul><li>可选，用于给动态网页传递参数，可有多个参数，用“&amp;”符号隔开，每个参数的名和值用“=”符号隔开。</li></ul></li><li><p>fragment（信息片断）</p><ul><li>字符串，用于指定网络资源中的片断。例如一个网页中有多个名词解释，可使用fragment直接定位到某一名词解释。</li></ul></li><li><p>注: [] 代表其中的内容可省略</p></li></ul></li></ul><h3 id="视图函数-view"><a href="#视图函数-view" class="headerlink" title="视图函数(view)"></a>视图函数(view)</h3><ul><li>视图函数是用于接收一个浏览器请求并通过HttpResponse对象返回数据的函数。此函数可以接收浏览器请求并根据业务逻辑返回相应的内容给浏览器</li><li>视图处理的函数的语法格式:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xxx_view</span>(<span class="params">request[, 其它参数...]</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse对象</span><br></pre></td></tr></table></figure></li><li>参数:<ul><li>request用于绑定HttpRequest对象，通过此对象可以获取浏览器的参数和数据</li></ul></li><li>示例:<ul><li>视图处理函数 <code>views.py</code>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : &lt;项目名&gt;/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page1_view</span>(<span class="params">request</span>):</span><br><span class="line">    html = <span class="string">&quot;&lt;h1&gt;这是第1个页面&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Django-中的路由配置"><a href="#Django-中的路由配置" class="headerlink" title="Django 中的路由配置"></a>Django 中的路由配置</h3><ul><li>settings.py 中的<code>ROOT_URLCONF</code> 指定了主路由配置列表urlpatterns的文件位置</li><li>urls.py 主路由配置文件  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : &lt;项目名&gt;/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    ...  <span class="comment"># 此处配置主路由</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>urlpatterns 是一个路由-视图函数映射关的列表,此列表的映射关系由url函数来确定</p></blockquote></li></ul><ol start="3"><li>url() 函数<ul><li>用于描述路由与视图函数的对应关系</li><li>模块<ul><li><code>from django.conf.urls import url</code></li></ul></li><li>语法:<ul><li>url(regex, views, name=None)</li><li>参数：<ol><li>regex: 字符串类型，匹配的请求路径，允许是正则表达式</li><li>views: 指定路径所对应的视图处理函数的名称</li><li>name: 为地址起别名，在模板中地址反向解析时使用</li></ol></li></ul></li></ul><blockquote><p>每个正则表达式前面的r表示<code>&#39;\&#39;</code>不转义的原始字符串</p></blockquote></li></ol><ul><li>练习<ul><li>建立一个小网站:<ul><li>输入网址: <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>, 在网页中输出 : 这是我的首页</li><li>输入网址: <a href="http://127.0.0.1:8000/page1">http://127.0.0.1:8000/page1</a>, 在网页中输出 : 这是编号为1的网页</li><li>输入网址: <a href="http://127.0.0.1:8000/page2">http://127.0.0.1:8000/page2</a>, 在网页中输出 : 这是编号为2的网页<blockquote><p>提示: 主面路由的正则是  <code>r&#39;^$&#39;</code></p></blockquote></li><li>思考<ul><li>建立如上一百个网页该怎么办？</li></ul></li></ul></li></ul></li></ul><h4 id="带有分组的路由和视图函数"><a href="#带有分组的路由和视图函数" class="headerlink" title="带有分组的路由和视图函数"></a>带有分组的路由和视图函数</h4><ul><li><p>在视图函数内，可以用正则表达式分组 <code>()</code> 提取参数后用函数位置传参传递给视图函数</p></li><li><p>一个分组表示一个参数,多个参数需要使用多个分组,并且使用个/隔开</p><ul><li>如:<ul><li><a href="http://127.0.0.1:8000/year/2018">http://127.0.0.1:8000/year/2018</a></li><li><a href="http://127.0.0.1:8000/year/2019">http://127.0.0.1:8000/year/2019</a></li><li><a href="http://127.0.0.1:8000/year/">http://127.0.0.1:8000/year/</a>????  # 四位数字</li></ul></li></ul></li><li><p>练习：</p><ul><li><p>定义一个路由的格式为:</p><ul><li><a href="http://127.0.0.1:8000/%E6%95%B4%E6%95%B0/%E6%93%8D%E4%BD%9C%E5%AD%97%E7%AC%A6%E4%B8%B2/%E6%95%B4%E6%95%B0">http://127.0.0.1:8000/整数/操作字符串/整数</a></li></ul></li><li><p>从路由中提取数据，做相应的操作后返回给浏览器</p></li><li><p>如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入: 127.0.0.1:8000/100/add/200</span><br><span class="line">    页面显示结果：300</span><br><span class="line">输入: 127.0.0.1:8000/100/sub/200</span><br><span class="line">    页面显示结果：-100</span><br><span class="line">输入: 127.0.0.1:8000/100/mul/200</span><br><span class="line">    页面显示结果：20000</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="带有命名分组的路由和视图函数"><a href="#带有命名分组的路由和视图函数" class="headerlink" title="带有命名分组的路由和视图函数"></a>带有命名分组的路由和视图函数</h4><ul><li>在url 的正则表达式中可以使用命名分组(捕获分组)</li><li>说明:<ul><li>在视图函数内，可以用正则表达式分组 <code>(?P&lt;name&gt;pattern)</code> 提取参数后用函数位置传参传递给视图函数</li></ul></li><li>示例:<ul><li>路由配置文件  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : &lt;项目名&gt;/urls.py</span></span><br><span class="line"><span class="comment"># 以下示例匹配</span></span><br><span class="line"><span class="comment"># http://127.0.0.1:8000/person/weimingze/35</span></span><br><span class="line"><span class="comment"># http://127.0.0.1:8000/person/shibowen/29</span></span><br><span class="line"><span class="comment"># http://127.0.0.1:8000/person/xiaowei/9</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^person/(?P&lt;name&gt;\w+)/(?P&lt;age&gt;\d&#123;1,2&#125;)&#x27;</span>,views.person_view),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li><li>练习:<ul><li>访问地址:<a href="http://127.0.0.1:8000/birthday/%E5%9B%9B%E4%BD%8D%E6%95%B0%E5%AD%97/%E4%B8%80%E5%88%B0%E4%B8%A4%E4%BD%8D%E6%95%B0%E5%AD%97/%E4%B8%80%E5%88%B0%E4%B8%A4%E4%BD%8D%E6%95%B0%E5%AD%97">http://127.0.0.1:8000/birthday/四位数字/一到两位数字/一到两位数字</a></li><li>最终输出: 生日为: xxxx年xx月xx日</li><li>如:<br>  输入网址: <a href="http://127.0.0.1:8000/birthday/2015/12/11">http://127.0.0.1:8000/birthday/2015/12/11</a><br>  显示为: 生日为:2015年12月11日<br>  输入网址: <a href="http://127.0.0.1:8000/birthday/2/28/2008">http://127.0.0.1:8000/birthday/2/28/2008</a><br>  显示为: 生日为:2008年2月28日</li></ul></li></ul><ul><li>PyCharm 社区版针对Django项目调试方法<ol><li>添加自己调式配置<ul><li>选择 Add Configuration…</li></ul></li><li>点击 <code>+</code> 号添加一个自己的配置<ul><li>选择运行的项目的主模块位置 manage.py</li><li>添加 runserver 命令行参数</li></ul></li></ol></li></ul><h2 id="HTTP协议的请求和响应"><a href="#HTTP协议的请求和响应" class="headerlink" title="HTTP协议的请求和响应"></a>HTTP协议的请求和响应</h2><ul><li>请求是指浏览器端通过HTTP协议发送给服务器端的数据</li><li>响应是指服务器端接收到请求后做相应的处理后再回复给浏览器端的数据</li></ul><h3 id="HTTP-请求"><a href="#HTTP-请求" class="headerlink" title="HTTP 请求"></a>HTTP 请求</h3><ul><li>根据HTTP标准，HTTP请求可以使用多种请求方法。</li><li>HTTP1.0定义了三种请求方法： GET, POST 和 HEAD方法(最常用)</li><li>HTTP1.1新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。</li><li>HTTP1.1 请求详述<table><thead><tr><th align="center">序号</th><th align="center">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">GET</td><td align="left">请求指定的页面信息，并返回实体主体。</td></tr><tr><td align="center">2</td><td align="center">HEAD</td><td align="left">类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</td></tr><tr><td align="center">3</td><td align="center">POST</td><td align="left">向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。</td></tr><tr><td align="center">4</td><td align="center">PUT</td><td align="left">从客户端向服务器传送的数据取代指定的文档的内容。</td></tr><tr><td align="center">5</td><td align="center">DELETE</td><td align="left">请求服务器删除指定的页面。</td></tr><tr><td align="center">6</td><td align="center">CONNECT</td><td align="left">HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</td></tr><tr><td align="center">7</td><td align="center">OPTIONS</td><td align="left">允许客户端查看服务器的性能。</td></tr><tr><td align="center">8</td><td align="center">TRACE</td><td align="left">回显服务器收到的请求，主要用于测试或诊断。</td></tr></tbody></table></li></ul><ul><li>HttpRequest对象<ul><li>视图函数的第一个参数是HttpRequest对象</li><li>服务器接收到http协议的请求后，会根据请求数据报文创建HttpRequest对象</li><li>HttpRequest属性<ul><li>path：字符串，表示请求的路由信息</li><li>path_info: URL字符串</li><li>method：字符串，表示HTTP请求方法，常用值：’GET’、’POST’</li><li>encoding：字符串，表示提交的数据的编码方式<ul><li>如果为None则表示使用浏览器的默认设置，一般为’utf-8’</li><li>这个属性是可写的，可以通过修改它来修改访问表单数据使用的编码，接下来对属性的任何访问将使用新的encoding值</li></ul></li><li>GET：QueryDict查询字典的对象，包含get请求方式的所有数据</li><li>POST：QueryDict查询字典的对象，包含post请求方式的所有数据</li><li>FILES：类似于字典的对象，包含所有的上传文件信息</li><li>COOKIES：Python字典，包含所有的cookie，键和值都为字符串</li><li>session：似于字典的对象，表示当前的会话，</li><li>body: 字符串，请求体的内容(POST或PUT)</li><li>environ: 字符串,客户端运行的环境变量信息</li><li>scheme : 请求协议(‘http’/‘https’)</li><li>request.get_full_path() : 请求的完整路径</li><li>request.get_host() : 请求的主机</li><li>request.META : 请求中的元数据(消息头)<ul><li>request.META[‘REMOTE_ADDR’]  : 客户端IP地址</li></ul></li></ul></li></ul></li></ul><h3 id="HTTP-响应"><a href="#HTTP-响应" class="headerlink" title="HTTP 响应"></a>HTTP 响应</h3><ul><li><p>当浏览者访问一个网页时，浏览者的浏览器会向网页所在服务器发出请求。当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含HTTP状态码的信息头用以响应浏览器的请求。</p></li><li><p>HTTP状态码的英文为HTTP Status Code。</p></li><li><p>下面是常见的HTTP状态码：</p><ul><li>200 - 请求成功</li><li>301 - 资源（网页等）被永久转移到其它URL</li><li>404 - 请求的资源（网页等）不存在</li><li>500 - 内部服务器错误</li></ul></li><li><p>HTTP状态码分类</p><ul><li><p>HTTP状态码由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用。HTTP状态码共分为5种类型：</p><table><thead><tr><th align="center">分类</th><th>分类描述</th></tr></thead><tbody><tr><td align="center">1**</td><td>信息，服务器收到请求，需要请求者继续执行操作</td></tr><tr><td align="center">2**</td><td>成功，操作被成功接收并处理</td></tr><tr><td align="center">3**</td><td>重定向，需要进一步的操作以完成请求</td></tr><tr><td align="center">4**</td><td>客户端错误，请求包含语法错误或无法完成请求</td></tr><tr><td align="center">5**</td><td>服务器错误，服务器在处理请求的过程中发生了错误</td></tr></tbody></table></li></ul></li><li><p>Django中的响应对象HttpResponse:</p><ul><li>构造函数格式:<ul><li><code>HttpResponse(content=响应体, content_type=响应体数据类型, status=状态码)</code></li></ul></li><li>作用:<ul><li>向客户端浏览器返回响应，同时携带响应体内容</li></ul></li><li>参数:<ul><li>content：表示返回的内容。</li><li>status_code：返回的HTTP响应状态码(默认为200)。</li><li>content_type：指定返回数据的的MIME类型(默认为”text/html”)。浏览器会根据这个属性，来显示数据。如果是text/html，那么就会解析这个字符串，如果text/plain，那么就会显示一个纯文本。<ul><li>常用的Content-Type如下：<ul><li><code>&#39;text/html&#39;</code>（默认的，html文件）</li><li><code>&#39;text/plain&#39;</code>（纯文本）</li><li><code>&#39;text/css&#39;</code>（css文件）</li><li><code>&#39;text/javascript&#39;</code>（js文件）</li><li><code>&#39;multipart/form-data&#39;</code>（文件提交）</li><li><code>&#39;application/json&#39;</code>（json传输）</li><li><code>&#39;application/xml&#39;</code>（xml文件）<blockquote><p>注： 关键字MIME(Multipurpose Internet Mail Extensions)是指多用途互联网邮件扩展类型。</p></blockquote></li></ul></li></ul></li></ul></li></ul></li><li><p>HttpResponse 子类</p><table><thead><tr><th>类型</th><th>作用</th><th>状态码</th></tr></thead><tbody><tr><td>HttpResponseRedirect</td><td>重定响</td><td>301</td></tr><tr><td>HttpResponseNotModified</td><td>未修改</td><td>304</td></tr><tr><td>HttpResponseBadRequest</td><td>错误请求</td><td>400</td></tr><tr><td>HttpResponseNotFound</td><td>没有对应的资源</td><td>404</td></tr><tr><td>HttpResponseForbidden</td><td>请求被禁止</td><td>403</td></tr><tr><td>HttpResponseServerError</td><td>服务器错误</td><td>500</td></tr></tbody></table></li></ul><h3 id="GET方式传参"><a href="#GET方式传参" class="headerlink" title="GET方式传参"></a>GET方式传参</h3><ul><li><p>GET请求方式中可以通过查询字符串(Query String)将数据传递给服务器    </p></li><li><p>URL 格式: <code>xxx?参数名1=值1&amp;参数名2=值2...</code></p><ul><li>如: <code>http://127.0.0.1:8000/page1?a=100&amp;b=200</code></li></ul></li><li><p>服务器端接收参数</p><ol><li>判断 request.method 的值判断请求方式是否是get请求 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">    处理GET请求时的业务逻辑</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    处理其它请求的业务逻辑</span><br></pre></td></tr></table></figure></li><li>获取客户端请求GET请求提交的数据<ol><li>语法 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.GET[<span class="string">&#x27;参数名&#x27;</span>]</span><br><span class="line">request.GET.get(<span class="string">&#x27;参数名&#x27;</span>,<span class="string">&#x27;默认值&#x27;</span>)</span><br><span class="line">request.GET.getlist(<span class="string">&#x27;参数名&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li>能够产生get请求方式的场合<ol><li>地址栏手动输入, 如: <a href="http://www.sina.com.cn/?a=100&amp;b=200">http://www.sina.com.cn/?a=100&amp;b=200</a></li><li><code>&lt;a href=&quot;地址?参数=值&amp;参数=值&quot;&gt;</code></li><li>form表单中的method为get <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&#x27;get&#x27;</span> <span class="attr">action</span>=<span class="string">&quot;/user/login&quot;</span>&gt;</span></span><br><span class="line">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uname&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>一般查询字符串的大小会受到浏览器的的限制(不建议超过2048字节)</p></blockquote></li></ol></li></ol></li></ol></li><li><p>PyCharm社区版调试Django程序配置</p><ol><li>选择 Add Configuration</li><li>选择 左上角 + 号 选择 “Python”<ol><li>script path 里选 manage.py 的路径 </li><li>在 parameters 里填入runserver</li></ol></li><li>设置断点</li><li>点击开始调式按钮开始调式操作</li></ol></li></ul><h3 id="POST传递参数"><a href="#POST传递参数" class="headerlink" title="POST传递参数"></a>POST传递参数</h3><ul><li><p>客户端通过表单等POST请求将数据传递给服务器端,如:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span> <span class="attr">action</span>=<span class="string">&quot;/user/login&quot;</span>&gt;</span></span><br><span class="line">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>服务器端接收参数</p><ul><li>通过 request.method 来判断是否为POST请求,如:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">    处理POST请求的数据并响应</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    处理非POST 请求的响应</span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用post方式接收客户端数据</p><ol><li>方法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.POST[<span class="string">&#x27;参数名&#x27;</span>]</span><br><span class="line">request.POST.get(<span class="string">&#x27;参数名&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">request.POST.getlist(<span class="string">&#x27;参数名&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ol></li><li><p>取消csrf验证,否则Django将会拒绝客户端发来的POST请求</p><ul><li>取消 csrf 验证<ul><li>删除 settings.py 中 MIDDLEWARE 中的 CsrfViewsMiddleWare 的中间件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="form-表单的name属性"><a href="#form-表单的name属性" class="headerlink" title="form 表单的name属性"></a>form 表单的name属性</h3><ul><li>在form表单控件提交数据时，会自动搜索本表单控件内部的子标签的name属性及相应的值，再将这些名字和值以键-值对的形式提交给action指定的服务器相关位置</li><li>在form内能自动搜集到的name属性的标签的控件有  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&#x27;xxx&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&#x27;yyy&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&#x27;zzz&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如:<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/page1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;请输入&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">1</span>&gt;</span>男<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">0</span>&gt;</span>女<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;comment&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;10&quot;</span>&gt;</span>附言...<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="POST传递参数-1"><a href="#POST传递参数-1" class="headerlink" title="POST传递参数"></a>POST传递参数</h3><ul><li><p>客户端通过表单等POST请求将数据传递给服务器端,如:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span> <span class="attr">action</span>=<span class="string">&quot;/user/login&quot;</span>&gt;</span></span><br><span class="line">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>服务器端接收参数</p><ul><li>通过 request.method 来判断是否为POST请求,如:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">    处理POST请求的数据并响应</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    处理非POST 请求的响应</span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用post方式接收客户端数据</p><ol><li>方法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.POST[<span class="string">&#x27;参数名&#x27;</span>]</span><br><span class="line">request.POST.get(<span class="string">&#x27;参数名&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">request.POST.getlist(<span class="string">&#x27;参数名&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ol></li><li><p>取消csrf验证,否则Django将会拒绝客户端发来的POST请求</p><ul><li>取消 csrf 验证<ul><li>删除 settings.py 中 MIDDLEWARE 中的 CsrfViewsMiddleWare 的中间件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="form-表单的name属性-1"><a href="#form-表单的name属性-1" class="headerlink" title="form 表单的name属性"></a>form 表单的name属性</h3><ul><li>在form表单控件提交数据时，会自动搜索本表单控件内部的子标签的name属性及相应的值，再将这些名字和值以键-值对的形式提交给action指定的服务器相关位置</li><li>在form内能自动搜集到的name属性的标签的控件有  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&#x27;xxx&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&#x27;yyy&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&#x27;zzz&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如:<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/page1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;请输入&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">1</span>&gt;</span>男<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">0</span>&gt;</span>女<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;comment&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;10&quot;</span>&gt;</span>附言...<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Django的框架模式"><a href="#Django的框架模式" class="headerlink" title="Django的框架模式"></a>Django的框架模式</h2><ul><li><p>MVC 设计模式</p><ul><li>MVC 代表 Model-View-Controller（模型-视图-控制器） 模式。</li><li>作用: 降低模块间的耦合度(解耦)</li><li>MVC<ul><li>M 模型层(Model), 主要用于对数据库层的封装</li><li>V 视图层(View), 用于向用户展示结果</li><li>C 控制(Controller ，用于处理请求、获取数据、返回结果(重要)</li></ul></li></ul></li><li><p>MTV 模式<br>  MTV 代表 Model-Template-View（模型-模板-视图） 模式。这种模式用于应用程序的分层开发</p><ul><li>作用: <ul><li>降低模块间的耦合度(解耦)</li></ul></li><li>MTV <ul><li>M – 模型层(Model)  负责与数据库交互</li><li>T – 模板层(Template)  负责呈现内容到浏览器</li><li>V – 视图层(View)  是核心，负责接收请求、获取数据、返回结果</li></ul></li></ul></li></ul><h2 id="Django中的应用-app"><a href="#Django中的应用-app" class="headerlink" title="Django中的应用 - app"></a>Django中的应用 - app</h2><ul><li>应用在Django项目中是一个独立的业务模块,可以包含自己的路由,视图,模板,模型</li></ul><h3 id="创建应用app"><a href="#创建应用app" class="headerlink" title="创建应用app"></a>创建应用app</h3><ul><li><p>创建步骤</p><ol><li>用manage.py 中的子命令 startapp 创建应用文件夹</li><li>在settings.py 的 INSTALLED_APPS 列表中配置安装此应用</li></ol></li><li><p>创建应用的子命令</p><ul><li>python3 manage.py startapp 应用名称(必须是标识符命令规则)</li><li>如:<ul><li>python3 manage.py startapp music</li></ul></li></ul></li><li><p>Django应用的结构组成</p><ol><li><code>migrations</code> 文件夹<ul><li>保存数据迁移的中间文件</li></ul></li><li><code>__init__.py</code><ul><li>应用子包的初始化文件</li></ul></li><li><code>admin.py</code><ul><li>应用的后台管理配置文件</li></ul></li><li><code>apps.py</code><ul><li>应用的属性配置文件</li></ul></li><li><code>models.py</code><ul><li>与数据库相关的模型映射类文件</li></ul></li><li><code>tests.py</code><ul><li>应用的单元测试文件</li></ul></li><li><code>views.py</code><ul><li>定义视图处理函数的文件</li></ul></li></ol></li><li><p>配置安装应用</p><ul><li>在 settings.py 中配置应用, 让此应用能和整个项目融为一体  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : settings.py </span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ... ...,</span><br><span class="line">    <span class="string">&#x27;自定义应用名称&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>如:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># ....</span></span><br><span class="line">    <span class="string">&#x27;user&#x27;</span>,  <span class="comment"># 用户信息模块</span></span><br><span class="line">    <span class="string">&#x27;music&#x27;</span>,  <span class="comment"># 收藏模块</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="应用的分布式路由"><a href="#应用的分布式路由" class="headerlink" title="应用的分布式路由"></a>应用的分布式路由</h3><ul><li>Django中，基础路由配置文件(urls.py)可以不处理用户具体路由，基础路由配置文件的可以做请求的分发(分布式请求处理)。具体的请求可以由各自的应用来进行处理</li></ul><h4 id="include-函数"><a href="#include-函数" class="headerlink" title="include 函数"></a>include 函数</h4><ul><li>作用:<ul><li>用于分发将当前路由转到各个应用的路由配置文件的 urlpatterns 进行分布式处理</li></ul></li><li>函数格式<ul><li>include(‘app命字.url模块名’)<blockquote><p>模块<code>app命字/url模块名.py</code> 文件件里必须有urlpatterns 列表<br>使用前需要使用 <code>from django.conf.urls import include</code> 导入此函数</p></blockquote></li></ul></li></ul><h2 id="数据库-和-模型"><a href="#数据库-和-模型" class="headerlink" title="数据库 和 模型"></a>数据库 和 模型</h2><h3 id="Django下配置使用-mysql-数据库"><a href="#Django下配置使用-mysql-数据库" class="headerlink" title="Django下配置使用 mysql 数据库"></a>Django下配置使用 mysql 数据库</h3><ol><li><p>安装 pymysql包</p><ul><li>用作 python 和 mysql 的接口<ul><li><code>$ sudo pip3 install pymysql</code></li></ul></li><li>安装 mysql 客户端(非必须)<br>  <code>$ sudo pip3 install mysqlclient</code></li></ul></li><li><p>创建 和 配置数据库</p><ol><li><p>创建数据库</p><ul><li>创建 <code>create database 数据库名 default charset utf8 collate utf8_general_ci;</code><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database mywebdb <span class="keyword">default</span> charset utf8 <span class="keyword">collate</span> utf8_general_ci;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>数据库的配置</p><ul><li>sqlite 数据库配置  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file: settings.py</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;NAME&#x27;</span>: os.path.join(BASE_DIR, <span class="string">&#x27;db.sqlite3&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>mysql 数据库配置  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> : &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;mywebdb&#x27;</span>,  <span class="comment"># 数据库名称,需要自己定义</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,  <span class="comment"># 管理员密码</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>关于数据为的SETTING设置</p><ol><li><p>ENGINE</p><ul><li>指定数据库的后端引擎<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;django.db.backends.mysql&#x27;</span><br><span class="line">&#x27;django.db.backends.sqlite3&#x27;</span><br><span class="line">&#x27;django.db.backends.oracle&#x27;</span><br><span class="line">&#x27;django.db.backends.postgresql&#x27;</span><br></pre></td></tr></table></figure></li><li>mysql引擎如下:<ul><li>‘django.db.backends.mysql’</li></ul></li></ul></li><li><p>NAME</p><ul><li>指定要连接的数据库的名称</li><li><code>&#39;NAME&#39;: &#39;mywebdb&#39;</code></li></ul></li><li><p>USER</p><ul><li>指定登录到数据库的用户名</li><li><code>&#39;USER&#39;:&#39;root&#39;</code></li></ul></li><li><p>PASSWORD</p><ul><li>接数据库时使用的密码。</li><li><code>&#39;PASSWORD&#39;:&#39;123456&#39;</code></li></ul></li><li><p>HOST</p><ul><li>连接数据库时使用哪个主机。</li><li><code>&#39;HOST&#39;:&#39;127.0.0.1&#39;</code></li></ul></li><li><p>PORT</p><ul><li>连接数据库时使用的端口。</li><li><code>&#39;PORT&#39;:&#39;3306&#39;</code></li></ul></li></ol></li><li><p>添加 mysql 支持</p><ul><li>安装pymysql 模块<ul><li><code>$ sudo pip install pymysql</code></li></ul></li><li>修改项目中__init__.py 加入如下内容来提供pymysql引擎的支持  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ol><h3 id="模型（Models）"><a href="#模型（Models）" class="headerlink" title="模型（Models）"></a>模型（Models）</h3><ul><li>模型是一个Python类，它是由django.db.models.Model派生出的子类。</li><li>一个模型类代表数据库中的一张数据表</li><li>模型类中每一个类属性都代表数据库中的一个字段。</li><li>模型是数据交互的接口，是表示和操作数据库的方法和方式</li></ul><h3 id="Django-的-ORM框架"><a href="#Django-的-ORM框架" class="headerlink" title="Django 的 ORM框架"></a>Django 的 ORM框架</h3><ul><li>ORM（Object Relational Mapping）即对象关系映射，它是一种程序技术，它允许你使用类和对象对数据库进行操作,从而避免通过SQL语句操作数据库</li><li>ORM框架的作用<ol><li>建立模型类和表之间的对应关系，允许我们通过面向对象的方式来操作数据库。</li><li>根据设计的模型类生成数据库中的表格。</li><li>通过简单的配置就可以进行数据库的切换。</li></ol></li><li>ORM 好处:<ol><li>只需要面向对象编程, 不需要面向数据库编写代码.<ul><li>对数据库的操作都转化成对类属性和方法的操作.</li><li>不用编写各种数据库的sql语句.</li></ul></li><li>实现了数据模型与数据库的解耦, 屏蔽了不同数据库操作上的差异.<ul><li>不在关注用的是mysql、oracle…等数据库的内部细节.</li><li>通过简单的配置就可以轻松更换数据库, 而不需要修改代码.</li></ul></li></ol></li><li>ORM 缺点<ol><li>相比较直接使用SQL语句操作数据库,有性能损失.</li><li>根据对象的操作转换成SQL语句,根据查询的结果转化成对象, 在映射过程中有性能损失.</li></ol></li></ul><ol start="2"><li>模型示例:<ul><li>此示例为添加一个 bookstore_book 数据表来存放图书馆中书目信息</li><li>添加一个 bookstore 的 app  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py startapp bookstore</span></span><br></pre></td></tr></table></figure></li><li>添加模型类并注册app  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : bookstore/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = models.CharField(<span class="string">&quot;书名&quot;</span>, max_length=<span class="number">50</span>, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    price = models.DecimalField(<span class="string">&#x27;定价&#x27;</span>, max_digits=<span class="number">7</span>, decimal_places=<span class="number">2</span>, default=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure></li><li>注册app  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : setting.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;bookstore&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li><li>数据库的迁移<ul><li>迁移是Django同步您对模型所做更改（添加字段，删除模型等） 到您的数据库模式的方式</li></ul><ol><li>生成或更新迁移文件<ul><li>将每个应用下的models.py文件生成一个中间文件,并保存在migrations文件夹中</li><li><code>python3 manage.py makemigrations</code></li></ul></li><li>执行迁移脚本程序<ul><li>执行迁移程序实现迁移。将每个应用下的migrations目录中的中间文件同步回数据库</li><li><code>python3 manage.py migrate</code></li></ul></li></ol><ul><li>注:</li></ul></li></ol><ul><li>每次修改完模型类再对服务程序运行之前都需要做以上两步迁移操作。<ul><li>生成迁移脚本文件<code>bookstore/migrations/0001_initial.py</code>并进行迁移  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py makemigrations</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py migrate</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><ol start="2"><li><p>编写模型类Models</p><ul><li>模型类需继承自<code>django.db.models.Model</code><ol><li>Models的语法规范 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class 模型类名(models.Model):</span><br><span class="line">    字段名 = models.字段类型(字段选项)</span><br></pre></td></tr></table></figure><blockquote><p>模型类名是数据表名的一部分，建议类名首字母大写<br>字段名又是当前类的类属性名，此名称将作为数据表的字段名<br>字段类型用来映射到数据表中的字段的类型<br>字段选项为这些字段提供附加的参数信息</p></blockquote></li></ol></li></ul></li><li><p>字段类型</p><ol><li><p>BooleanField()</p><ul><li>数据库类型:tinyint(1)</li><li>编程语言中:使用True或False来表示值</li><li>在数据库中:使用1或0来表示具体的值</li></ul></li><li><p>CharField()</p><ul><li>数据库类型:varchar</li><li>注意:<ul><li>必须要指定max_length参数值</li></ul></li></ul></li><li><p>DateField()</p><ul><li>数据库类型:date</li><li>作用:表示日期</li><li>编程语言中:使用字符串来表示具体值</li><li>参数:<ul><li>DateField.auto_now: 每次保存对象时，自动设置该字段为当前时间(取值:True/False)。</li><li>DateField.auto_now_add: 当对象第一次被创建时自动设置当前时间(取值:True/False)。</li><li>DateField.default: 设置当前时间(取值:字符串格式时间如: ‘2019-6-1’)。</li><li>以上三个参数只能多选一</li></ul></li></ul></li><li><p>DateTimeField()</p><ul><li>数据库类型:datetime(6)</li><li>作用:表示日期和时间</li><li>auto_now_add=True</li></ul></li><li><p>DecimalField()</p><ul><li><p>数据库类型:decimal(x,y)</p></li><li><p>编程语言中:使用小数表示该列的值</p></li><li><p>在数据库中:使用小数</p></li><li><p>参数:</p><ul><li>DecimalField.max_digits: 位数总数，包括小数点后的位数。 该值必须大于等于decimal_places.</li><li>DecimalField.decimal_places: 小数点后的数字数量</li></ul></li><li><p>示例:</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">money=models.DecimalField(</span><br><span class="line">    max_digits=7,</span><br><span class="line">    decimal_places=2,</span><br><span class="line">    default=0.0</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>FloatField()</p><ul><li>数据库类型:double</li><li>编程语言中和数据库中都使用小数表示值</li></ul></li><li><p>EmailField()</p><ul><li>数据库类型:varchar</li><li>编程语言和数据库中使用字符串</li></ul></li><li><p>IntegerField()</p><ul><li>数据库类型:int</li><li>编程语言和数据库中使用整数</li></ul></li><li><p>URLField()</p><ul><li>数据库类型:varchar(200)</li><li>编程语言和数据库中使用字符串</li></ul></li><li><p>ImageField()</p><ul><li>数据库类型:varchar(100)</li><li>作用:在数据库中为了保存图片的路径</li><li>编程语言和数据库中使用字符串</li><li>示例:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image=models.ImageField(</span><br><span class="line">    upload_to=&quot;static/images&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li>upload_to:指定图片的上传路径<br>  在后台上传时会自动的将文件保存在指定的目录下</li></ul></li><li><p>TextField()</p><ul><li>数据库类型:longtext</li><li>作用:表示不定长的字符数据</li></ul></li></ol><ul><li>参考文档 <a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-types">https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-types</a></li></ul></li><li><p>字段选项FIELD_OPTIONS</p><ul><li>字段选项, 指定创建的列的额外的信息</li><li>允许出现多个字段选项,多个选项之间使用,隔开</li></ul><ol><li>primary_key<ul><li>如果设置为True,表示该列为主键,如果指定一个字段为主键，则此数库表不会创建id字段</li></ul></li><li>blank<ul><li>设置为True时，字段可以为空。设置为False时，字段是必须填写的。字符型字段CharField和TextField是用空字符串来存储空值的。 默认值是False。</li></ul></li><li>null<ul><li>如果设置为True,表示该列值允许为空。日期型、时间型和数字型字段不接受空字符串。所以设置IntegerField，DateTimeField型字段可以为空时，需要将blank，null均设为True。</li><li>默认为False,如果此选项为False建议加入default选项来设置默认值</li></ul></li><li>default<ul><li>设置所在列的默认值,如果字段选项null=False建议添加此项</li></ul></li><li>db_index<ul><li>如果设置为True,表示为该列增加索引</li></ul></li><li>unique<ul><li>如果设置为True,表示该字段在数据库中的值必须是唯一(不能重复出现的)</li></ul></li><li>db_column<ul><li>指定列的名称,如果不指定的话则采用属性名作为列名</li></ul></li><li>verbose_name<ul><li>设置此字段在admin界面上的显示名称。</li></ul></li></ol><ul><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个属性,表示用户名称,长度30个字符,必须是唯一的,不能为空,添加索引</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">30</span>, unique=<span class="literal">True</span>, null=<span class="literal">False</span>, db_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>文档参见:<ul><li><a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-options">https://docs.djangoproject.com/en/1.11/ref/models/fields/#field-options</a></li></ul></li></ul><h3 id="数据库迁移的错误处理方法"><a href="#数据库迁移的错误处理方法" class="headerlink" title="数据库迁移的错误处理方法"></a>数据库迁移的错误处理方法</h3><ul><li><p>当执行 <code>$ python3 manage.py makemigrations</code> 出现如下迁移错误时的处理方法</p><ul><li>错误信息  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python3 manage.py makemigrations</span><br><span class="line">You are trying to change the nullable field &#x27;title&#x27; on book to non-nullable without a default; we can&#x27;t do that (the database needs something to populate existing rows).</span><br><span class="line">Please select a fix:</span><br><span class="line">1) Provide a one-off default now (will be set on all existing rows with a null value for this column)</span><br><span class="line">2) Ignore for now, and let me handle existing rows with NULL myself (e.g. because you added a RunPython or RunSQL operation to handle NULL values in a previous data migration)</span><br><span class="line">3) Quit, and let me add a default in models.py</span><br><span class="line">Select an option: </span><br></pre></td></tr></table></figure></li><li>翻译为中文如下:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python3 manage.py makemigrations</span><br><span class="line">您试图将图书上的可空字段“title”更改为非空字段(没有默认值);我们不能这样做(数据库需要填充现有行)。</span><br><span class="line">请选择修复:</span><br><span class="line">1)现在提供一次性默认值(将对所有现有行设置此列的空值)</span><br><span class="line">2)暂时忽略，让我自己处理空值的现有行(例如，因为您在以前的数据迁移中添加了RunPython或RunSQL操作来处理空值)</span><br><span class="line">3)退出，让我在models.py中添加一个默认值</span><br><span class="line">选择一个选项:</span><br></pre></td></tr></table></figure></li><li>错误原因<ul><li>当将如下代码<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class Book(models.Model):</span><br><span class="line">    title = models.CharField(&quot;书名&quot;, max_length=50, null=True)</span><br></pre></td></tr></table></figure></li><li>去掉 null=True 改为如下内容时会出现上述错误<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class Book(models.Model):</span><br><span class="line">    title = models.CharField(&quot;书名&quot;, max_length=50)</span><br></pre></td></tr></table></figure></li><li>原理是 此数据库的title 字段由原来的可以为NULL改为非NULL状态,意味着原来这个字段可以不填值，现在改为必须填定一个值，那填什么值呢？此时必须添加一个缺省值。</li></ul></li><li>处理方法:<ol><li>选择1 手动给出一个缺省值，在生成 bookstore/migrations/000x_auto_xxxxxxxx_xxxx.py 文件时自动将输入的值添加到default参数中</li><li>暂时忽略，以后用其它的命令处理缺省值问题(不推荐)</li><li>退出当前生成迁移文件的过程，自己去修改models.py, 新增加一个<code>default=XXX</code> 的缺省值(推荐使用)</li></ol></li></ul></li><li><p>数据库的迁移文件混乱的解决办法</p><ol><li>删除 所有 migrations 里所有的 000?_XXXX.py (<code>__init__.py</code>除外)</li><li>删除 数据表<ul><li>sql&gt; drop database mywebdb;</li></ul></li><li>重新创建 数据表<ul><li>sql&gt; create datebase mywebdb default charset…;</li></ul></li><li>重新生成migrations里所有的 000?_XXXX.py<ul><li>python3 manage.py makemigrations</li></ul></li><li>重新更新数据库<ul><li>python3 manage.py migrate</li></ul></li></ol></li></ul><h2 id="数据库的基本操作"><a href="#数据库的基本操作" class="headerlink" title="数据库的基本操作"></a>数据库的基本操作</h2><ul><li>数据库的基本操作包括增删改查操作，即(CRUD操作)</li><li>CRUD是指在做计算处理时的增加(Create)、读取查询(Read)、更新(Update)和删除(Delete)</li></ul><h3 id="管理器对象"><a href="#管理器对象" class="headerlink" title="管理器对象"></a>管理器对象</h3><ul><li>每个继承自 models.Model 的模型类，都会有一个 objects 对象被同样继承下来。这个对象叫管理器对象</li><li>数据库的增删改查可以通过模型的管理器实现  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyModel</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">MyModel.objects.create(...) <span class="comment"># objects 是管理器对象</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="创建数据对象"><a href="#创建数据对象" class="headerlink" title="创建数据对象"></a>创建数据对象</h3><ul><li>Django 使用一种直观的方式把数据库表中的数据表示成Python 对象</li><li>创建数据中每一条记录就是创建一个数据对象<ol><li>MyModel.objects.create(属性1=值1, 属性2=值1,…)<ul><li>成功: 返回创建好的实体对象</li><li>失败: 抛出异常</li></ul></li><li>创建 MyModel 实例对象,并调用 save() 进行保存 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj = MyModel(属性=值,属性=值)</span><br><span class="line">obj.属性=值</span><br><span class="line">obj.save()</span><br><span class="line">无返回值,保存成功后,obj会被重新赋值</span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="Django-shell-的使用"><a href="#Django-shell-的使用" class="headerlink" title="Django shell 的使用"></a>Django shell 的使用</h3><ul><li>在Django提供了一个交互式的操作项目叫 <code>Django Shell</code> 它能够在交互模式用项目工程的代码执行相应的操作</li><li>利用 Django Shell 可以代替编写View的代码来进行直接操作</li><li>在Django Shell 下只能进行简单的操作，不能运行远程调式</li><li>启动方式:  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py shell</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><ul><li>数据库的查询需要使用管理器对象进行</li><li>通过 MyModel.objects 管理器方法调用查询接口<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>all()</td><td>查询全部记录,返回QuerySet查询对象</td></tr><tr><td>get()</td><td>查询符合条件的单一记录</td></tr><tr><td>filter()</td><td>查询符合条件的多条记录</td></tr><tr><td>exclude()</td><td>查询符合条件之外的全部记录</td></tr><tr><td>…</td><td></td></tr></tbody></table></li></ul><ol><li><p>all()方法</p><ul><li>方法: all()</li><li>用法: MyModel.objects.all()</li><li>作用: 查询MyModel实体中所有的数据<ul><li>等同于<ul><li>select * from tabel</li></ul></li></ul></li><li>返回值: QuerySet容器对象,内部存放 MyModel 实例</li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">books = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;书名&quot;</span>, book.title, <span class="string">&#x27;出版社:&#x27;</span>, book.pub)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>在模型类中定义 <code>def __str__(self): </code> 方法可以将自定义默认的字符串</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = ...</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;书名: %s, 出版社: %s, 定价: %s&quot;</span> % (self.title, self.pub, self.price)</span><br></pre></td></tr></table></figure></li><li><p>查询返回指定列(字典表示)</p><ul><li>方法: values(‘列1’, ‘列2’)</li><li>用法: MyModel.objects.values(…)</li><li>作用: 查询部分列的数据并返回<ul><li>select 列1,列2 from xxx</li></ul></li><li>返回值: QuerySet<ul><li>返回查询结果容器，容器内存字典，每个字典代表一条数据,</li><li>格式为: {‘列1’: 值1, ‘列2’: 值2}</li></ul></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">books = models.Book.objects.values(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;pub&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;书名&quot;</span>, book[<span class="string">&quot;title&quot;</span>], <span class="string">&#x27;出版社:&#x27;</span>, book[<span class="string">&#x27;pub&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;book=&quot;</span>, book)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>查询返回指定列（元组表示)</p><ul><li>方法:values_list(‘列1’,’列2’)</li><li>用法:MyModel.objects.values_list(…)</li><li>作用:<ul><li>返回元组形式的查询结果</li></ul></li><li>返回值: QuerySet容器对象,内部存放 <code>元组</code><ul><li>会将查询出来的数据封装到元组中,再封装到查询集合QuerySet中</li></ul></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">books = models.Book.objects.values_list(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;pub&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;book=&quot;</span>, book)  <span class="comment"># (&#x27;Python&#x27;, &#x27;清华大学出版社&#x27;)...</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>排序查询</p><ul><li>方法:order_by</li><li>用法:MyModel.objects.order_by(‘-列’,’列’)</li><li>作用:<ul><li>与all()方法不同，它会用SQL 语句的ORDER BY 子句对查询结果进行根据某个字段选择性的进行排序</li></ul></li><li>说明:</li><li>默认是按照升序排序,降序排序则需要在列前增加’-‘表示</li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">books = models.Book.objects.order_by(<span class="string">&quot;price&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;书名:&quot;</span>, book.title, <span class="string">&#x27;定价:&#x27;</span>, book.price)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>根据条件查询多条记录</p><ul><li>方法: filter(条件)</li><li>语法:   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyModel.objects.<span class="built_in">filter</span>(属性<span class="number">1</span>=值<span class="number">1</span>, 属性<span class="number">2</span>=值<span class="number">2</span>)</span><br></pre></td></tr></table></figure></li><li>返回值:<ul><li>QuerySet容器对象,内部存放 MyModel 实例</li></ul></li><li>说明:<ul><li>当多个属性在一起时为”与”关系，即当<code>Books.objects.filter(price=20, pub=&quot;清华大学出版社&quot;)</code> 返回定价为20 <code>且</code> 出版社为”清华大学出版社”的全部图书</li></ul></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># 查询书中出版社为&quot;清华大学出版社&quot;的图书</span></span><br><span class="line">    <span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">    books = models.Book.objects.<span class="built_in">filter</span>(pub=<span class="string">&quot;清华大学出版社&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;书名:&quot;</span>, book.title)</span><br><span class="line"></span><br><span class="line">    <span class="number">2.</span> 查询Author实体中<span class="built_in">id</span>为<span class="number">1</span>并且isActive为<span class="literal">True</span>的</span><br><span class="line">        - authors=Author.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>,isActive=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="字段查找"><a href="#字段查找" class="headerlink" title="字段查找"></a>字段查找</h3><ul><li>字段查询是指如何指定SQL语句中 WHERE 子句的内容。</li><li>字段查询需要通过QuerySet的filter(), exclude() and get()的关键字参数指定。</li><li>非等值条件的构建,需要使用字段查询</li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询作者中年龄大于30</span></span><br><span class="line">Author.objects.<span class="built_in">filter</span>(age__gt=<span class="number">30</span>)</span><br><span class="line"><span class="comment"># 对应</span></span><br><span class="line"><span class="comment"># SELECT .... WHERE AGE &gt; 35;</span></span><br></pre></td></tr></table></figure><h4 id="查询谓词"><a href="#查询谓词" class="headerlink" title="查询谓词"></a>查询谓词</h4></li><li>每一个查询谓词是一个独立的查询功能</li></ul><ol><li><code>__exact</code> : 等值匹配 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Author.objects.<span class="built_in">filter</span>(id__exact=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 等同于select * from author where id = 1</span></span><br></pre></td></tr></table></figure></li><li><code>__contains</code> : 包含指定值 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Author.objects.<span class="built_in">filter</span>(name__contains=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="comment"># 等同于 select * from author where name like &#x27;%w%&#x27;</span></span><br></pre></td></tr></table></figure></li><li><code>__startswith</code> : 以 XXX 开始</li><li><code>__endswith</code> : 以 XXX 开始</li><li><code>__gt</code> : 大于指定值 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Author.objects.filer(age__gt=<span class="number">50</span>)</span><br><span class="line"><span class="comment"># 等同于 select * from author where age &gt; 50</span></span><br></pre></td></tr></table></figure></li><li><code>__gte</code> : 大于等于</li><li><code>__lt</code> : 小于</li><li><code>__lte</code> : 小于等于</li><li><code>__in</code> : 查找数据是否在指定范围内<ul><li>示例<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Author.objects.<span class="built_in">filter</span>(country__in=[<span class="string">&#x27;中国&#x27;</span>,<span class="string">&#x27;日本&#x27;</span>,<span class="string">&#x27;韩国&#x27;</span>])</span><br><span class="line"><span class="comment"># 等同于 select * from author where country in (&#x27;中国&#x27;,&#x27;日本&#x27;,&#x27;韩国&#x27;)</span></span><br></pre></td></tr></table></figure></li></ul></li><li><code>__range</code>: 查找数据是否在指定的区间范围内 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找年龄在某一区间内的所有作者</span></span><br><span class="line">Author.objects.<span class="built_in">filter</span>(age__range=(<span class="number">35</span>,<span class="number">50</span>))</span><br><span class="line"><span class="comment"># 等同于 SELECT ... WHERE Author BETWEEN 35 and 50;</span></span><br></pre></td></tr></table></figure></li><li>详细内容参见: <a href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#field-lookups">https://docs.djangoproject.com/en/1.11/ref/models/querysets/#field-lookups</a></li></ol><ul><li><p>示例</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyModel.objects.<span class="built_in">filter</span>(id__gt=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 等同于 SELECT ... WHERE id &gt; 4;</span></span><br></pre></td></tr></table></figure></li><li><p>练习:</p><ol><li>查询Author表中age大于等于85的信息<ul><li><code>Author.objects.filter(age__gte=85)</code></li></ul></li><li>查询Author表中姓王的人的信息<ul><li><code>Author.objects.filter(name__startswith=&#39;王&#39;)</code></li></ul></li><li>查询Author表中Email中包含”wc”的人的信息<ul><li><code>Author.objects.filter(email__contains=&#39;wc&#39;)</code></li></ul></li></ol></li></ul><ol start="2"><li>不等的条件筛选<ul><li>语法:<br>  MyModel.objects.exclude(条件)</li><li>作用:<ul><li>返回不包含此 <code>条件</code> 的 全部的数据集</li></ul></li><li>示例:<ul><li>查询 <code>清华大学出版社，定价大于50</code> 以外的全部图书<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">        books = models.Book.objects.exclude(pub=<span class="string">&quot;清华大学出版社&quot;</span>, price__gt=<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">            <span class="built_in">print</span>(book)</span><br><span class="line">        ```    </span><br><span class="line"><span class="number">3.</span> 查询指定的一条数据</span><br><span class="line">    - 语法:</span><br><span class="line">        MyModel.objects.get(条件)</span><br><span class="line">    - 作用：</span><br><span class="line">      </span><br><span class="line">        - 返回满足条件的唯一一条数据</span><br><span class="line">    - 返回值:</span><br><span class="line">      </span><br><span class="line">        - MyModel 对象</span><br><span class="line">    - </span><br><span class="line">    - 说明:</span><br><span class="line">        - 该方法只能返回一条数据</span><br><span class="line">        - 查询结果多余一条数据则抛出,Model.MultipleObjectsReturned异常</span><br><span class="line">        - 查询结果如果没有数据则抛出Model.DoesNotExist异常</span><br><span class="line">    - 示例:</span><br><span class="line">        ```python</span><br><span class="line">        <span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">        book = models.Book.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(book.title)</span><br></pre></td></tr></table></figure><h3 id="修改数据记录"><a href="#修改数据记录" class="headerlink" title="修改数据记录"></a>修改数据记录</h3></li></ul></li></ul></li><li>修改单个实体的某些字段值的步骤:<ol><li>查<ul><li>通过 get() 得到要修改的实体对象</li></ul></li><li>改<ul><li>通过 对象.属性 的方式修改数据</li></ul></li><li>保存<ul><li>通过 对象.save() 保存数据</li></ul></li></ol><ul><li>如:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">abook = models.Book.objects.get(<span class="built_in">id</span>=<span class="number">10</span>)</span><br><span class="line">abook.market_price = <span class="string">&quot;10.5&quot;</span></span><br><span class="line">abook.save()</span><br></pre></td></tr></table></figure></li></ul></li><li>通过 QuerySet 批量修改 对应的全部字段<ul><li>直接调用QuerySet的update(属性=值) 实现批量修改</li><li>如:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 id大于3的所有图书价格定为0元</span></span><br><span class="line">books = Book.objects.<span class="built_in">filter</span>(id__gt=<span class="number">3</span>)</span><br><span class="line">books.update(price=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 将所有书的零售价定为100元</span></span><br><span class="line">books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">books.update(market_price=<span class="number">100</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h3><ul><li>删除记录是指删除数据库中的一条或多条记录</li><li>删除单个MyModel对象或删除一个查询结果集(QuerySet)中的全部对象都是调用 delete()方法</li></ul><ol><li>删除单个对象<ul><li>步骤<ol><li>查找查询结果对应的一个数据对象</li><li>调用这个数据对象的delete()方法实现删除</li></ol></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    auth = Author.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">    auth.delete()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(删除失败)</span><br></pre></td></tr></table></figure></li></ul></li><li>删除查询结果集<ul><li>步骤<ol><li>查找查询结果集中满足条件的全部QuerySet查询集合对象</li><li>调用查询集合对象的delete()方法实现删除</li></ol></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除全部作者中，年龄大于65的全部信息</span></span><br><span class="line">auths = Author.objects.<span class="built_in">filter</span>(age__gt=<span class="number">65</span>)</span><br><span class="line">auths.delete()</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><ul><li>聚合查询是指对一个数据表中的一个字段的数据进行部分或全部进行统计查询,查bookstore_book数据表中的全部书的平均价格，查询所有书的总个数等,都要使用聚合查询</li></ul><ol><li><p>不带分组聚合</p><ul><li>不带分组的聚合查询是指导将全部数据进行集中统计查询</li><li>聚合函数:<ul><li>定义模块: <code>django.db.models</code></li><li>用法: <code>from django.db.models import *</code></li><li>聚合函数: <ul><li>Sum, Avg, Count, Max, Min</li></ul></li></ul></li><li>语法: <ul><li>MyModel.objects.aggregate(结果变量名=聚合函数(‘列’))</li></ul></li><li>返回结果:<ul><li>由 结果变量名和值组成的字典</li><li>格式为:<ul><li>`{“结果变量名”: 值}</li></ul></li></ul></li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># 得到所有书的平均价格</span></span><br><span class="line">    <span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line">    result = models.Book.objects.aggregate(myAvg=Avg(<span class="string">&#x27;price&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;平均价格是:&quot;</span>, result[<span class="string">&#x27;myAvg&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result=&quot;</span>, result)  <span class="comment"># &#123;&quot;myAvg&quot;: 58.2&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 得到数据表里有多少本书</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line">    result = models.Book.objects.aggregate(mycnt=Count(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据记录总个数是:&quot;</span>, result[<span class="string">&#x27;mycnt&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;result=&quot;</span>, result)  <span class="comment"># &#123;&quot;mycnt&quot;: 10&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li><li><p>分组聚合</p><ul><li><p>分组聚合是指通过计算查询结果中每一个对象所关联的对象集合，从而得出总计值(也可以是平均值或总和)，即为查询集的每一项生成聚合。</p></li><li><p>语法: </p><ul><li>QuerySet.annotate(结果变量名=聚合函数(‘列’))</li></ul></li><li><p>用法步骤:</p><ol><li>通过先用查询结果MyModel.objects.value. 查找查询要分组聚合的列<ul><li>MyModel.objects.value(‘列1’, ‘列2’)</li><li>如:   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    pub_set = models.Book.objects.values(<span class="string">&#x27;pub&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(books)  <span class="comment"># &lt;QuerySet [&#123;&#x27;pub&#x27;: &#x27;清华大学出版社&#x27;&#125;, &#123;&#x27;pub&#x27;: &#x27;清华大学出版社&#x27;&#125;, &#123;&#x27;pub_hou &#123;&#x27;pub&#x27;: &#x27;机械工业出版社&#x27;&#125;, &#123;&#x27;pub&#x27;: &#x27;清华大学出版社&#x27;&#125;]&gt;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ul></li><li>通过返回结果的 QuerySet.annotate 方法分组聚合得到分组结果<ul><li>QuerySet.annotate(名=聚合函数(‘列’))</li><li>返回 QuerySet 结果集,内部存储结果的字典</li><li>如:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pub_count_set = pub_set.annotate(myCount=Count(<span class="string">&#x27;pub&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(pub_count_set)  <span class="comment"># &lt;QuerySet [&#123;&#x27;pub&#x27;: &#x27;清华大学出版社&#x27;, &#x27;myCount&#x27;: 7&#125;, &#123;&#x27;pub&#x27;: &#x27;机械工业出版社&#x27;, &#x27;myCount&#x27;: 3&#125;]&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>.values(‘查询列名’)</li></ul></li><li><p>示例:</p><ul><li>得到哪儿个出版社共出版多少本书</li></ul>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_annotate</span>(<span class="params">request</span>):</span><br><span class="line">   - <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 得到所有出版社的查询集合QuerySet</span></span><br><span class="line">    pub_set = models.Book.objects.values(<span class="string">&#x27;pub&#x27;</span>)</span><br><span class="line">    <span class="comment"># 根据出版社查询分组，出版社和Count的分组聚合查询集合</span></span><br><span class="line">    pub_count_set = pub_set.annotate(myCount=Count(<span class="string">&#x27;pub&#x27;</span>))  <span class="comment"># 返回查询集合</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> pub_count_set:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;出版社:&quot;</span>, item[<span class="string">&#x27;pub&#x27;</span>], <span class="string">&quot;图书有：&quot;</span>, item[<span class="string">&#x27;myCount&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;请查看服务器端控制台获取结果&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="F对象"><a href="#F对象" class="headerlink" title="F对象"></a>F对象</h3><ul><li>一个F对象代表数据库中某条记录的字段的信息</li></ul><ol><li><p>作用:</p><ul><li>通常是对数据库中的字段值在不获取的情况下进行操作</li><li>用于类属性(字段)之间的比较。</li></ul></li><li><p>用法</p><ul><li>F对象在数据包 django.db.models 中，使用时需要先导入<ul><li><code>from django.db.models import F</code></li></ul></li></ul></li><li><p>语法:</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">F(<span class="string">&#x27;列名&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>说明:</p><ul><li>一个 F() 对象代表了一个model的字段的值</li><li>F对象通常是对数据库中的字段值在不加载到内存中的情况下直接在数据库服务器端进行操作</li></ul></li></ol><ol start="5"><li>示例1<ul><li>更新Book实例中所有的零售价涨10元<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">models.Book.objects.<span class="built_in">all</span>().update(market_price=F(<span class="string">&#x27;market_price&#x27;</span>)+<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 以下做法好于如下代码</span></span><br><span class="line">books = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">    book.update(market_price=book.marget_price+<span class="number">10</span>)</span><br><span class="line">    book.save()</span><br></pre></td></tr></table></figure></li></ul></li><li>示例2<ul><li>对数据库中两个字段的值进行比较，列出哪儿些书的零售价高于定价?<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"><span class="keyword">from</span> bookstore <span class="keyword">import</span> models</span><br><span class="line">books = models.Book.objects.<span class="built_in">filter</span>(market_price__gt=F(<span class="string">&#x27;price&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(book.title, <span class="string">&#x27;定价:&#x27;</span>, book.price, <span class="string">&#x27;现价:&#x27;</span>, book.market_price)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="Q对象-Q"><a href="#Q对象-Q" class="headerlink" title="Q对象 - Q()"></a>Q对象 - Q()</h3><ul><li>当在获取查询结果集 使用复杂的逻辑或  <code>|</code> 、 逻辑非 <code>~</code> 等操作时可以借助于 Q对象进行操作</li><li>如: 想找出定价低于20元 或 清华大学出版社的全部书，可以写成  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.Book.objects.<span class="built_in">filter</span>(Q(price__lt=<span class="number">20</span>)|Q(pub=<span class="string">&quot;清华大学出版社&quot;</span>))</span><br></pre></td></tr></table></figure></li><li>Q对象在 数据包 django.db.models 中。需要先导入再使用<ul><li><code>from django.db.models import Q</code></li></ul></li></ul><ol><li>作用<ul><li>在条件中用来实现除 and(&amp;) 以外的 or(|) 或 not(~) 操作</li></ul></li><li>运算符:<ul><li>&amp; 与操作</li><li>| 或操作</li><li>〜 非操作</li></ul></li><li>语法 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">Q(条件<span class="number">1</span>)|Q(条件<span class="number">2</span>)  <span class="comment"># 条件1成立或条件2成立</span></span><br><span class="line">Q(条件<span class="number">1</span>)&amp;Q(条件<span class="number">2</span>)  <span class="comment"># 条件1和条件2同时成立</span></span><br><span class="line">Q(条件<span class="number">1</span>)&amp;~Q(条件<span class="number">2</span>)  <span class="comment"># 条件1成立且条件2不成立</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li>示例 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment"># 查找清华大学出版社的书或价格低于50的书</span></span><br><span class="line">models.Book.objects.<span class="built_in">filter</span>(Q(market_price__lt=<span class="number">50</span>) | Q(pub_house=<span class="string">&#x27;清华大学出版社&#x27;</span>))</span><br><span class="line"><span class="comment"># 查找不是机械工业出版社的书且价格低于50的书</span></span><br><span class="line">models.Book.objects.<span class="built_in">filter</span>(Q(market_price__lt=<span class="number">50</span>) &amp; ~Q(pub_house=<span class="string">&#x27;机械工业出版社&#x27;</span>))</span><br></pre></td></tr></table></figure></li></ol><h3 id="原生的数据库操作方法"><a href="#原生的数据库操作方法" class="headerlink" title="原生的数据库操作方法"></a>原生的数据库操作方法</h3><ul><li>使用MyModel.objects.raw()进行 数据库查询操作查询<ul><li>在django中，可以使用模型管理器的raw方法来执行select语句进行数据查询</li></ul><ol><li>语法: <ul><li><code>MyModel.objects.raw(sql语句)</code></li></ul></li><li>用法<ul><li><code>MyModel.objects.raw(&#39;sql语句&#39;)</code></li></ul></li><li>返回值:<ul><li>QuerySet 集合对象</li></ul></li></ol></li></ul><ol start="4"><li>示例 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    books = models.Book.objects.raw(<span class="string">&#x27;select * from bookstore_book&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        <span class="built_in">print</span>(book)</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>使用django中的游标cursor对数据库进行 增删改操作</p><ul><li><p>在Django中可以使用 如UPDATE,DELETE等SQL语句对数据库进行操作。</p></li><li><p>在Django中使用上述非查询语句必须使用游标进行操作</p></li><li><p>使用步骤:</p><ol><li>导入cursor所在的包<ul><li>Django中的游标cursor定义在 django.db.connection包中，使用前需要先导入</li><li>如：<ul><li><code>from django.db import connection</code></li></ul></li></ul></li><li>用创建cursor类的构造函数创建cursor对象，再使用cursor对象,为保证在出现异常时能释放cursor资源,通常使用with语句进行创建操作<ul><li>如:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line"><span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">    cur.execute(<span class="string">&#x27;执行SQL语句&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>示例  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用SQL语句将id 为 10的 书的出版社改为 &quot;XXX出版社&quot;</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line"><span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cur: </span><br><span class="line">    cur.execute(<span class="string">&#x27;update bookstore_book set pub_house=&quot;XXX出版社&quot; where id=10;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">    <span class="comment"># 删除 id为1的一条记录</span></span><br><span class="line">    cur.execute(<span class="string">&#x27;delete from bookstore_book where id=10;&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h2 id="admin-后台数据库管理"><a href="#admin-后台数据库管理" class="headerlink" title="admin 后台数据库管理"></a>admin 后台数据库管理</h2><ul><li>django 提供了比较完善的后台管理数据库的接口，可供开发过程中调用和测试使用</li><li>django 会搜集所有已注册的模型类，为这些模型类提拱数据管理界面，供开发者使用</li><li>使用步骤:<ol><li>创建后台管理帐号:<ul><li>后台管理–创建管理员帐号<ul><li><code>$ python3 manage.py createsuperuser</code>            </li><li>根据提示完成注册,参考如下:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 manage.py createsuperuser</span></span><br><span class="line">Username (leave blank to use &#x27;tarena&#x27;): tarena  # 此处输入用户名</span><br><span class="line">Email address: laowei@tedu.cn  # 此处输入邮箱</span><br><span class="line">Password: # 此处输入密码(密码要复杂些，否则会提示密码太简单)</span><br><span class="line">Password (again): # 再次输入重复密码</span><br><span class="line">Superuser created successfully.</span><br><span class="line"><span class="meta prompt_">$ </span></span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li>用注册的帐号登陆后台管理界面<ul><li>后台管理的登录地址:<ul><li><a href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></li></ul></li></ul></li></ol></li></ul><h3 id="自定义后台管理数据表"><a href="#自定义后台管理数据表" class="headerlink" title="自定义后台管理数据表"></a>自定义后台管理数据表</h3><ul><li>若要自己定义的模型类也能在 <code>/admin</code> 后台管理界中显示和管理，需要将自己的类注册到后台管理界面</li><li>添加自己定义模型类的后台管理数据表的,需要用<code>admin.site.register(自定义模型类)</code> 方法进行注册<ul><li>配置步骤如下:<ol><li>在应用app中的admin.py中导入注册要管理的模型models类, 如: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br></pre></td></tr></table></figure></li><li>调用 admin.site.register 方法进行注册,如: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">admin.site.register(自定义模型类)</span><br></pre></td></tr></table></figure></li></ol></li><li>如: 在 bookstore/admin.py 添加如下代码对Book类进行管理</li><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file: bookstore/admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">...</span><br><span class="line">admin.site.register(models.Book)  <span class="comment"># 将Book类注册为可管理页面</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="修改后台Models的展现形式"><a href="#修改后台Models的展现形式" class="headerlink" title="修改后台Models的展现形式"></a>修改后台Models的展现形式</h3><ul><li>在admin后台管理数据库中对自定义的数据记录都展示为 <code>XXXX object</code> 类型的记录，不便于阅读和判断</li><li>在用户自定义的模型类中可以重写 <code>def __str__(self):</code> 方法解决显示问题,如:<ul><li>在 自定义模型类中重写 <strong>str</strong>(self) 方法返回显示文字内容:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;书名&quot;</span> + self.title</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="模型管理器类"><a href="#模型管理器类" class="headerlink" title="模型管理器类"></a>模型管理器类</h3><ul><li><p>作用:</p><ul><li>为后台管理界面添加便于操作的新功能。</li></ul></li><li><p>说明:</p><ul><li>后台管理器类须继承自 <code>django.contrib.admin</code> 里的 <code>ModelAdmin</code> 类</li></ul></li><li><p>模型管理器的使用方法:</p><ol><li>在 <code>&lt;应用app&gt;/admin.py</code> 里定义模型管理器类 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">XXXX_Manager</span>(admin.ModelAdmin):</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure></li><li>注册管理器与模型类关联 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">admin.site.register(models.YYYY, XXXX_Manager) <span class="comment"># 注册models.YYYY 模型类与 管理器类 XXXX_Manager 关联</span></span><br></pre></td></tr></table></figure></li></ol><ul><li>示例:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : bookstore/admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;market_price&#x27;</span>]</span><br><span class="line"></span><br><span class="line">admin.site.register(models.Book, BookAdmin)</span><br></pre></td></tr></table></figure><ul><li>进入<a href="http://127.0.0.1:8000/admin/bookstore/book/">http://127.0.0.1:8000/admin/bookstore/book/</a> 查看显示方式和以前有所不同</li></ul></li></ul></li><li><p>模型管理器类ModelAdmin中实现的高级管理功能</p><ol><li>list_display 去控制哪些字段会显示在Admin 的修改列表页面中。</li><li>list_display_links 可以控制list_display中的字段是否应该链接到对象的“更改”页面。</li><li>list_filter 设置激活Admin 修改列表页面右侧栏中的过滤器</li><li>search_fields 设置启用Admin 更改列表页面上的搜索框。 </li><li>list_editable 设置为模型上的字段名称列表，这将允许在更改列表页面上进行编辑。</li><li>其它参见<a href="https://docs.djangoproject.com/en/1.11/ref/contrib/admin/">https://docs.djangoproject.com/en/1.11/ref/contrib/admin/</a></li></ol></li></ul><h3 id="数据库表管理"><a href="#数据库表管理" class="headerlink" title="数据库表管理"></a>数据库表管理</h3><ol><li>修改模型类字段的显示名字<ul><li>模型类各字段的第一个参数为 verbose_name,此字段显示的名字会在后台数据库管理页面显示</li><li>通过 verbose_name 字段选项,修改显示名称示例如下：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title = models.CharField(</span><br><span class="line">    max_length = <span class="number">30</span>,</span><br><span class="line">    verbose_name=<span class="string">&#x27;显示名称&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul></li><li>通过Meta内嵌类 定义模型类的属性及展现形式<ul><li>模型类可以通过定义内部类class Meta 来重新定义当前模型类和数据表的一些属性信息</li><li>用法格式如下:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = CharField(....)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        <span class="number">1.</span> db_table = <span class="string">&#x27;数据表名&#x27;</span></span><br><span class="line">            - 该模型所用的数据表的名称。(设置完成后需要立马更新同步数据库)</span><br><span class="line">        <span class="number">2.</span> verbose_name = <span class="string">&#x27;单数名&#x27;</span></span><br><span class="line">            - 给模型对象的一个易于理解的名称(单数),用于显示在/admin管理界面中</span><br><span class="line">        <span class="number">3.</span> verbose_name_plural = <span class="string">&#x27;复数名&#x27;</span></span><br><span class="line">            - 该对象复数形式的名称(复数),用于显示在/admin管理界面中</span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>练习:<ul><li>将Book模型类 和 Author 模型类都加入后台管理</li><li>制作一个AuthorManager管理器类，让后台管理Authors列表中显示作者的ID、姓名、年龄信息</li><li>用后台管理程序 添加三条 Author 记录</li><li>修改其中一条记录的年龄</li><li>删除最后一条添加的记录</li><li>将bookstore_author 数名表名称改为myauthor (需要重新迁移数据库)</li></ul></li></ul><h2 id="数据表关联关系映射"><a href="#数据表关联关系映射" class="headerlink" title="数据表关联关系映射"></a>数据表关联关系映射</h2><ul><li>在关系型数据库中，通常不会把所有数据都放在同一张表中，这样做会额外占用内存空间，</li><li>在关系列数据库中通常用表关联来解决数据库。</li><li>常用的表关联方式有三种:<ol><li>一对一映射<ul><li>如: 一个身份证对应一个人</li></ul></li><li>一对多映射<ul><li>如: 一个班级可以有多个学生</li></ul></li><li>多对多映射<ul><li>如: 一个学生可以报多个课程，一个课程可以有多个学生学习</li></ul></li></ol></li></ul><h3 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a>一对一映射</h3><ul><li>一对一是表示现实事物间存在的一对一的对应关系。</li><li>如:一个家庭只有一个户主，一个男人有一个妻子，一个人有一个唯一的指纹信息等</li></ul><ol><li>语法 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(model.Model):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(model.Model):</span><br><span class="line">    属性 = models.OneToOneField(A)</span><br></pre></td></tr></table></figure></li><li>用法示例<ol><li>创建作家和作家妻子类 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : xxxxxxxx/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;作家模型类&#x27;&#x27;&#x27;</span></span><br><span class="line">    name = models.CharField(<span class="string">&#x27;作家&#x27;</span>, max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wife</span>(models.Model):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;作家妻子模型类&#x27;&#x27;&#x27;</span></span><br><span class="line">    name = models.CharField(<span class="string">&quot;妻子&quot;</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    author = models.OneToOneField(Author)  <span class="comment"># 增加一对一属性</span></span><br></pre></td></tr></table></figure></li><li>查询<ul><li>在 Wife 对象中,通过 author 属性找到对应的author对象</li><li>在 Author 对象中,通过 wife 属性找到对应的wife对象</li></ul></li><li>创始一对一的数据记录 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">author1 = models.Author.objects.create(name=<span class="string">&#x27;王老师&#x27;</span>)</span><br><span class="line">wife1 = models.Wife.objects.create(name=<span class="string">&#x27;王夫人&#x27;</span>, author=author1)  <span class="comment"># 关联王老师</span></span><br><span class="line">author2 = models.Author.objects.create(name=<span class="string">&#x27;小泽老师&#x27;</span>)  <span class="comment"># 一对一可以没有数据对应的数据 </span></span><br></pre></td></tr></table></figure></li><li>一对一数据的相互获取<ol><li>正向查询<ul><li>直接通过关联属性查询即可<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 wife 找 author</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">wife = models.Wife.objects.get(name=<span class="string">&#x27;王夫人&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(wife.name, <span class="string">&#x27;的老公是&#x27;</span>, wife.author.name)</span><br></pre></td></tr></table></figure></li></ul></li><li>反向查询<ul><li>通过反向关联属性查询</li><li>反向关联属性为<code>实例对象.引用类名(小写)</code>，如作家的反向引用为<code>作家对象.wife</code></li><li>当反向引用不存在时，则会触发异常<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 author.wife 关联属性 找 wife,如果没有对应的wife刚触发异常</span></span><br><span class="line">author1 = models.Author.objects.get(name=<span class="string">&#x27;王老师&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(author1.name, <span class="string">&#x27;的妻子是&#x27;</span>, author1.wife.name)</span><br><span class="line">author2 = models.Author.objects.get(name=<span class="string">&#x27;小泽老师&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(author2.name, <span class="string">&#x27;的妻子是&#x27;</span>, author2.wife.name)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(author2.name, <span class="string">&#x27;还没有妻子&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ol></li></ol><ul><li>作用:<ul><li>主要是解决常用数据不常用数据的存储问题,把经常加载的一个数据放在主表中，不常用数据放在另一个副表中，这样在访问主表数据时不需要加载副表中的数据以提高访问速度提高效率和节省内存空间,如经常把书的内容和书名建成两张表，因为在网站上经常访问书名等信息，但不需要得到书的内容。</li></ul></li></ul><h3 id="一对多映射"><a href="#一对多映射" class="headerlink" title="一对多映射"></a>一对多映射</h3><ul><li>一对多是表示现实事物间存在的一对多的对应关系。</li><li>如:一个学校有多个班级,一个班级有多个学生, 一本图书只能属于一个出版社,一个出版社允许出版多本图书</li></ul><ol><li><p>用法语法</p><ul><li>当一个A类对象可以关联多个B类对象时<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(model.Model):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(model.Model):</span><br><span class="line">    属性 = models.ForeignKey(多对一中<span class="string">&quot;一&quot;</span>的模型类, ...)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>外键类ForeignKey </p><ul><li>构造函数:  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ForeignKey(to, on_delete, **options)</span><br></pre></td></tr></table></figure></li><li>常用参数:<ul><li>on_delete<ol><li>models.CASCADE  级联删除。 Django模拟SQL约束ON DELETE CASCADE的行为，并删除包含ForeignKey的对象。</li><li>models.PROTECT 抛出ProtectedError 以阻止被引用对象的删除;</li><li>SET_NULL 设置ForeignKey null；只有null是True才有可能。</li><li>SET_DEFAULT  将ForeignKey设置为其默认值；必须设置ForeignKey的默认值。</li><li>… 其它参请参考文档 <a href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#foreignkey">https://docs.djangoproject.com/en/1.11/ref/models/fields/#foreignkey</a> ForeignKey部分</li></ol></li><li><code>**options</code> 可以是常用的字段选项如:<ol><li>null</li><li>unique等</li><li>…</li></ol></li></ul></li></ul></li><li><p>示例</p><ul><li><p>有二个出版社对应五本书的情况.</p><ol><li><p><code>清华大学出版社</code> 有书</p><ol><li>C++</li><li>Java</li><li>Python</li></ol></li><li><p><code>北京大学出版社</code> 有书</p><ol><li>西游记</li><li>水浒</li></ol></li></ol></li></ul><ol><li>定义一对多类 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file: one2many/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Publisher</span>(models.Model):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;出版社&#x27;&#x27;&#x27;</span></span><br><span class="line">    name = models.CharField(<span class="string">&#x27;名称&#x27;</span>, max_length=<span class="number">50</span>, unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = models.CharField(<span class="string">&#x27;书名&#x27;</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    publisher = models.ForeignKey(Publisher, null=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ul><li><p>创建一对多的对象</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file: xxxxx/views.py</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line">pub1 = models.Publisher.objects.create(name=<span class="string">&#x27;清华大学出版社&#x27;</span>)</span><br><span class="line">models.Book.objects.create(title=<span class="string">&#x27;C++&#x27;</span>, publisher=pub1)</span><br><span class="line">models.Book.objects.create(title=<span class="string">&#x27;Java&#x27;</span>, publisher=pub1)</span><br><span class="line">models.Book.objects.create(title=<span class="string">&#x27;Python&#x27;</span>, publisher=pub1)</span><br><span class="line"></span><br><span class="line">pub2 = models.Publisher.objects.create(name=<span class="string">&#x27;北京大学出版社&#x27;</span>)</span><br><span class="line">models.Book.objects.create(title=<span class="string">&#x27;西游记&#x27;</span>, publisher=pub2)</span><br><span class="line">models.Book.objects.create(title=<span class="string">&#x27;水浒&#x27;</span>, publisher=pub2)</span><br></pre></td></tr></table></figure></li><li><p>查询:</p><ul><li>通过多查一<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过一本书找到对应的出版社</span></span><br><span class="line">abook = models.Book.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(abook.title, <span class="string">&#x27;的出版社是:&#x27;</span>, abook.publisher.name)</span><br></pre></td></tr></table></figure></li><li>通过一查多<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过出版社查询对应的书</span></span><br><span class="line">pub1 = models.Publisher.objects.get(name=<span class="string">&#x27;清华大学出版社&#x27;</span>)</span><br><span class="line">books = pub1.book_set.<span class="built_in">all</span>()  <span class="comment"># 通过book_set 获取pub1对应的多个Book数据对象</span></span><br><span class="line"><span class="comment"># books = models.Book.objects.filter(publisher=pub1)  # 也可以采用此方式获取</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;清华大学出版社的书有:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(book.title)</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>数据查询</p><ol><li>通过 Book 查询 Publisher <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过 publisher 属性查询即可</span><br><span class="line">练习:</span><br><span class="line">    查询 西游记 对应的出版社信息,打印在终端上</span><br></pre></td></tr></table></figure></li><li>通过 Publisher 查询 对应的所有的 Books <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Django会在Publisher中增加一个属性来表示对对应的Book们的查询引用</span><br><span class="line">属性:book_set(MyModel.objects)</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="多对多映射"><a href="#多对多映射" class="headerlink" title="多对多映射"></a>多对多映射</h3><ul><li>多对多表达对象之间多对多复杂关系，如: 每个人都有不同的学校(小学，初中，高中,…),每个学校都有不同的学生…</li></ul><ol><li>语法<ul><li>在关联的两个类中的任意一个类中,增加:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">属性 = models.ManyToManyField(MyModel)</span><br></pre></td></tr></table></figure></li></ul></li><li>示例<ul><li>一个作者可以出版多本图书</li><li>一本图书可以被多名作者同时编写<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    authors = models.ManyToManyField(Author)</span><br></pre></td></tr></table></figure></li></ul></li><li>数据查询<ol><li>通过 Book 查询对应的所有的 Authors <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book.authors.<span class="built_in">all</span>() -&gt; 获取 book 对应的所有的author的信息</span><br><span class="line">book.authors.<span class="built_in">filter</span>(age__gt=<span class="number">80</span>) -&gt; 获取book对应的作者中年龄大于<span class="number">80</span>岁的作者的信息</span><br></pre></td></tr></table></figure></li><li>通过 Author 查询对应的所有的Books<ul><li>Django会生成一个关联属性 book_set 用于表示对对应的book的查询对象相关操作<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">author.book_set.<span class="built_in">all</span>()</span><br><span class="line">author.book_set.<span class="built_in">filter</span>()</span><br><span class="line">author.book_set.create(...)  <span class="comment"># 创建新书并联作用author</span></span><br><span class="line">author.book_set.add(book)   <span class="comment"># 添加已有的书为当前作者author</span></span><br><span class="line">author.book_set.clear()  <span class="comment"># 删除author所有并联的书</span></span><br><span class="line">author.book_set.remove()  <span class="comment"># 删除所author所有并联的书</span></span><br></pre></td></tr></table></figure></li></ul></li></ol></li><li>示例:<ul><li>多对多模型<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;作家模型类&#x27;&#x27;&#x27;</span></span><br><span class="line">    name = models.CharField(<span class="string">&#x27;作家&#x27;</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = models.CharField(<span class="string">&#x27;书名&#x27;</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    author = models.ManyToManyField(Author, null=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.title</span><br></pre></td></tr></table></figure></li><li>多对多视图操作<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">many2many_init</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 创建两人个作者</span></span><br><span class="line">    author1 = models.Author.objects.create(name=<span class="string">&#x27;吕泽&#x27;</span>)</span><br><span class="line">    author2 = models.Author.objects.create(name=<span class="string">&#x27;魏老师&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 吕择和魏老师同时写了一本Python</span></span><br><span class="line">    book11 = author1.book_set.create(title=<span class="string">&quot;Python&quot;</span>)</span><br><span class="line">    author2.book_set.add(book11)  <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 魏老师还写了两本书</span></span><br><span class="line">    book21 = author2.book_set.create(title=<span class="string">&quot;C&quot;</span>)  <span class="comment"># 创建一本新书&quot;C&quot;</span></span><br><span class="line">    book22 = author2.book_set.create(title=<span class="string">&quot;C++&quot;</span>)  <span class="comment"># 创建一本新书&quot;C++&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;初始化成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_many2many</span>(<span class="params">request</span>):</span><br><span class="line">    authors = models.Author.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">for</span> auth <span class="keyword">in</span> authors:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;作者:&quot;</span>, auth.name, <span class="string">&#x27;发出版了&#x27;</span>, auth.book_set.count(), <span class="string">&#x27;本书: &#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;    &#x27;</span>, book.title)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----显示书和作者的关系----&quot;</span>)</span><br><span class="line">    books = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        auths = book.author.<span class="built_in">all</span>()</span><br><span class="line">        <span class="built_in">print</span>(book.title, <span class="string">&#x27;的作者是:&#x27;</span>, <span class="string">&#x27;、&#x27;</span>.join([<span class="built_in">str</span>(x.name) <span class="keyword">for</span> x <span class="keyword">in</span> auths]))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;显示成功，请查看服务器端控制台终端&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>多对多最终的SQL结果<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> many2many_author;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 吕泽      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 魏老师    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> many2many_book;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> title  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span> Python <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span> C      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span> C<span class="operator">+</span><span class="operator">+</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+--------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> many2many_book_author;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> book_id <span class="operator">|</span> author_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">17</span> <span class="operator">|</span>      <span class="number">13</span> <span class="operator">|</span>        <span class="number">11</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">20</span> <span class="operator">|</span>      <span class="number">13</span> <span class="operator">|</span>        <span class="number">12</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">18</span> <span class="operator">|</span>      <span class="number">14</span> <span class="operator">|</span>        <span class="number">12</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">19</span> <span class="operator">|</span>      <span class="number">15</span> <span class="operator">|</span>        <span class="number">12</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="cookies-和-session"><a href="#cookies-和-session" class="headerlink" title="cookies 和 session"></a>cookies 和 session</h2><h3 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h3><ul><li><p>cookies是保存在客户端浏览器上的存储空间，通常用来记录浏览器端自己的信息和当前连接的确认信息</p></li><li><p>cookies 在浏览器上是以键-值对的形式进行存储的，键和值都是以ASCII字符串的形存储(不能是中文字符串)</p></li><li><p>cookies 的内部的数据会在每次访问此网址时都会携带到服务器端，如果cookies过大会降低响应速度</p></li><li><p>在Django 服务器端来设置 设置浏览器的COOKIE 必须通过 HttpResponse 对象来完成</p></li><li><p>HttpResponse 关于COOKIE的方法</p><ul><li><p>添加、修改COOKIE</p><ul><li>HttpResponse.set_cookie(key, value=’’, max_age=None, expires=None)<ul><li>key:cookie的名字</li><li>value:cookie的值</li><li>max_age:cookie存活时间，秒为单位</li><li>expires:具体过期时间</li><li>当不指定max_age和expires 时,关闭浏览器时此数据失效</li></ul></li></ul></li><li><p>删除COOKIE</p><ul><li>HttpResponse.delete_cookie(key)</li><li>删除指定的key 的Cookie。 如果key 不存在则什么也不发生。</li></ul></li></ul></li><li><p>Django中的cookies</p><ul><li>使用 响应对象HttpResponse 等 将cookie保存进客户端<ol><li>方法1 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">resp = HttpResponse()</span><br><span class="line">resp.set_cookie(<span class="string">&#x27;cookies名&#x27;</span>, cookies值, 超期时间)</span><br></pre></td></tr></table></figure><ul><li>如:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resp = HttpResponse()</span><br><span class="line">resp.set_cookie(<span class="string">&#x27;myvar&#x27;</span>, <span class="string">&quot;weimz&quot;</span>, 超期时间)</span><br></pre></td></tr></table></figure></li></ul></li><li>方法二, 使用render对象 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line">resp = render(request,<span class="string">&#x27;xxx.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">resp.set_cookie(<span class="string">&#x27;cookies名&#x27;</span>, cookies值, 超期时间)</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol start="3"><li>获取cookie<ul><li>通过 request.COOKIES 绑定的字典(dict) 获取客户端的 COOKIES数据  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value = request.COOKIES.get(<span class="string">&#x27;cookies名&#x27;</span>, <span class="string">&#x27;没有值!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cookies名 = &quot;</span>, value)</span><br></pre></td></tr></table></figure></li></ul></li><li>注:<ul><li>Chrome 浏览器 可能通过开发者工具的 <code>Application</code> &gt;&gt; <code>Storage</code> &gt;&gt; <code>Cookies</code> 查看和操作浏览器端所有的 Cookies 值</li></ul></li></ol></li><li><p>cookies 示例</p><ul><li>以下示例均在视图函数中调用</li><li>添加cookie  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为浏览器添加键为 my_var1,值为123，过期时间为1个小时的cookie</span></span><br><span class="line">responds = HttpResponse(<span class="string">&quot;已添加 my_var1,值为123&quot;</span>)</span><br><span class="line">responds.set_cookie(<span class="string">&#x27;my_var1&#x27;</span>, <span class="number">123</span>, <span class="number">3600</span>)</span><br><span class="line"><span class="keyword">return</span> responds</span><br></pre></td></tr></table></figure></li><li>修改cookie  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为浏览器添加键为 my_var1,修改值为456，过期时间为2个小时的cookie</span></span><br><span class="line">responds = HttpResponse(<span class="string">&quot;已修改 my_var1,值为456&quot;</span>)</span><br><span class="line">responds.set_cookie(<span class="string">&#x27;my_var1&#x27;</span>, <span class="number">456</span>, <span class="number">3600</span>*<span class="number">2</span>)</span><br><span class="line"><span class="keyword">return</span> responds</span><br></pre></td></tr></table></figure></li><li>删除cookie  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除浏览器键为 my_var1的cookie</span></span><br><span class="line">responds = HttpResponse(<span class="string">&quot;已删除 my_var1&quot;</span>)</span><br><span class="line">responds.delete_cookie(<span class="string">&#x27;my_var1&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> responds</span><br></pre></td></tr></table></figure></li><li>获取cookie  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取浏览器中 my_var变量对应的值</span></span><br><span class="line">value = request.COOKIES.get(<span class="string">&#x27;my_var1&#x27;</span>, <span class="string">&#x27;没有值!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cookie my_var1 = &quot;</span>, value)</span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">&quot;my_var1:&quot;</span> + value)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="session-会话控制"><a href="#session-会话控制" class="headerlink" title="session 会话控制"></a>session 会话控制</h3><ul><li><p>什么是session</p></li><li><p>session又名会话控制，是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据</p></li><li><p>session的起源</p><ul><li>http协议是无状态的：每次请求都是一次新的请求，不会记得之前通信的状态</li><li>实现状态保持的方式：在客户端或服务器端存储与会话有关的数据</li><li>推荐使用sesison方式，所有数据存储在服务器端</li></ul></li><li><p>实现方式</p><ul><li>使用 session 需要在浏览器客户端启动 cookie，且用在cookie中存储sessionid</li><li>每个客户端都可以在服务器端有一个独立的Session</li><li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li></ul></li><li><p>Django启用Session</p><ul><li>在 settings.py 文件中</li><li>向 INSTALLED_APPS 列表中添加：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 启用 sessions 应用</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li>向 MIDDLEWARE_CLASSES 列表中添加：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment"># 启用 Session 中间件</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li><li><p>session的基本操作:</p><ul><li>session对于象是一个在似于字典的SessionStore类型的对象, 可以用类拟于字典的方式进行操作</li><li>session 只能够存储能够序列化的数据,如字典，列表等。</li></ul><ol><li>保存 session 的值到服务器<ul><li><code>request.session[&#39;KEY&#39;] = VALUE</code></li></ul></li><li>获取session的值<ul><li><code>VALUE = request.session[&#39;KEY&#39;]</code></li><li><code>VALUE = request.session.get(&#39;KEY&#39;, 缺省值)</code></li></ul></li></ol><ul><li>删除session的值<ul><li><code>del request.session[&#39;KEY&#39;]</code></li></ul></li><li>在 settings.py 中有关 session 的设置<ol><li>SESSION_COOKIE_AGE<ul><li>作用: 指定sessionid在cookies中的保存时长(默认是2周)，如下:</li><li><code>SESSION_COOKIE_AGE = 60 * 60 * 24 * 7 * 2</code></li></ul></li><li>SESSION_EXPIRE_AT_BROWSER_CLOSE = True<br> 设置只要浏览器关闭时,session就失效(默认为False)</li></ol></li><li>session 缺省配置<ul><li>模块<ul><li><code>import django.conf.global_settings</code></li></ul></li></ul></li></ul></li><li><p>注: 当使用session时需要迁移数据库,否则会出现错误</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 manage.py makemigrations</span><br><span class="line">$ python3 manage.py migrate</span><br></pre></td></tr></table></figure></li></ul><h3 id="session-会话控制-1"><a href="#session-会话控制-1" class="headerlink" title="session 会话控制"></a>session 会话控制</h3><ul><li><p>什么是session</p></li><li><p>session又名会话控制，是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据</p></li><li><p>session的起源</p><ul><li>http协议是无状态的：每次请求都是一次新的请求，不会记得之前通信的状态</li><li>实现状态保持的方式：在客户端或服务器端存储与会话有关的数据</li><li>推荐使用sesison方式，所有数据存储在服务器端</li></ul></li><li><p>实现方式</p><ul><li>使用 session 需要在浏览器客户端启动 cookie，且用在cookie中存储sessionid</li><li>每个客户端都可以在服务器端有一个独立的Session</li><li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li></ul></li><li><p>Django启用Session</p><ul><li>在 settings.py 文件中</li><li>向 INSTALLED_APPS 列表中添加：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 启用 sessions 应用</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li>向 MIDDLEWARE_CLASSES 列表中添加：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment"># 启用 Session 中间件</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></li><li><p>session的基本操作:</p><ul><li>session对于象是一个在似于字典的SessionStore类型的对象, 可以用类拟于字典的方式进行操作</li><li>session 只能够存储能够序列化的数据,如字典，列表等。</li></ul><ol><li>保存 session 的值到服务器<ul><li><code>request.session[&#39;KEY&#39;] = VALUE</code></li></ul></li><li>获取session的值<ul><li><code>VALUE = request.session[&#39;KEY&#39;]</code></li><li><code>VALUE = request.session.get(&#39;KEY&#39;, 缺省值)</code></li></ul></li></ol><ul><li>删除session的值<ul><li><code>del request.session[&#39;KEY&#39;]</code></li></ul></li><li>在 settings.py 中有关 session 的设置<ol><li>SESSION_COOKIE_AGE<ul><li>作用: 指定sessionid在cookies中的保存时长(默认是2周)，如下:</li><li><code>SESSION_COOKIE_AGE = 60 * 60 * 24 * 7 * 2</code></li></ul></li><li>SESSION_EXPIRE_AT_BROWSER_CLOSE = True<br> 设置只要浏览器关闭时,session就失效(默认为False)</li></ol></li><li>session 缺省配置<ul><li>模块<ul><li><code>import django.conf.global_settings</code></li></ul></li></ul></li></ul></li><li><p>注: 当使用session时需要迁移数据库,否则会出现错误</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 manage.py makemigrations</span><br><span class="line">$ python3 manage.py migrate</span><br></pre></td></tr></table></figure></li></ul><h3 id="用户登陆逻辑处理"><a href="#用户登陆逻辑处理" class="headerlink" title="用户登陆逻辑处理"></a>用户登陆逻辑处理</h3><ul><li><p>当用户登陆时，可以在session添加一个键 ‘user’ 绑定一个当前登陆用户的信息，如果在 <code> &#39;user&#39; in request.session</code> 成立，即当前用户为登陆状态，可以从<code>request.session[&#39;user&#39;] </code>获限登陆信息。否则为没有登陆状态</p></li><li><p>登陆逻辑处理</p><ol><li>检查用户和密码是否是合法用户</li><li>如果是合法用户，在当前用户的session记录 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在session内保存当前用的名称和id</span></span><br><span class="line">  request.session[<span class="string">&#x27;user&#x27;</span>] = &#123;</span><br><span class="line">      <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;tedu&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;id&#x27;</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># 注： 没有登陆的用户 request.session[&#x27;user&#x27;] 不存在</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>退出登陆的逻辑处理</p><ol start="3"><li>退出登陆时，删除session[‘user’]  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">in</span> request.session:</span><br><span class="line">    <span class="keyword">del</span> request.session[<span class="string">&#x27;user&#x27;</span>]</span><br></pre></td></tr></table></figure></li></ol></li><li><p>判断用户是否登陆:</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">in</span> request.session:</span><br><span class="line">    ...  当前用户登陆中</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ... 没有登陆</span><br></pre></td></tr></table></figure></li><li><p>练习:</p><ul><li><p>实现用户登陆、退出功能</p></li><li><p>说明:</p><ul><li>如果用户输入的登陆数据合法，则在session[‘user’]内记录一个已经登陆的用户状态</li></ul></li><li><p>要求 ：</p><ol><li>创建一个 user 应用 实现用户登陆,注册，退出登陆的逻辑<ul><li><code>python3 manage.py startapp user</code></li></ul></li><li>创建一个 index 应用 实现用户主页<ul><li><code>python3 manage.py startapp index</code></li></ul></li></ol></li><li><p>模型类</p><ol><li>用户模型类 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    username = models.CharField(<span class="string">&quot;用户名&quot;</span>, max_length=<span class="number">30</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    password = models.CharField(<span class="string">&quot;密码&quot;</span>, max_length=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户&quot;</span> + self.username</span><br></pre></td></tr></table></figure></li></ol></li><li><p>登陆设计规范(在user应用中写代码)</p><table><thead><tr><th>路由正则</th><th>视图函数</th><th>模板位置</th><th>说明</th></tr></thead><tbody><tr><td>/user/login</td><td>def login_view(request):</td><td>templates/user/login.html</td><td>用户登陆</td></tr><tr><td>/user/logout</td><td>def logout_view(request</td><td>无</td><td>退出用户登陆</td></tr></tbody></table></li><li><p>主页设计规范(在index应用中写代码)</p><table><thead><tr><th>路由正则</th><th>视图函数</th><th>模板位置</th><th>说明</th></tr></thead><tbody><tr><td>/</td><td>def index_view(request):</td><td>templates/index/index.html</td><td>主页</td></tr></tbody></table></li></ul></li></ul><h2 id="中间件-Middleware"><a href="#中间件-Middleware" class="headerlink" title="中间件 Middleware"></a>中间件 Middleware</h2><ul><li><p>中间件是 Django 请求/响应处理的钩子框架。它是一个轻量级的、低级的“插件”系统，用于全局改变 Django 的输入或输出。</p></li><li><p>每个中间件组件负责做一些特定的功能。例如，Django 包含一个中间件组件 AuthenticationMiddleware，它使用会话将用户与请求关联起来。</p></li><li><p>他的文档解释了中间件是如何工作的，如何激活中间件，以及如何编写自己的中间件。Django 具有一些内置的中间件，你可以直接使用。它们被记录在 built-in middleware reference 中。</p></li><li><p>中间件类:</p><ul><li>中间件类须继承自 <code>django.utils.deprecation.MiddlewareMixin</code>类</li><li>中间件类须实现下列五个方法中的一个或多个:<ul><li><code>def process_request(self, request):</code> 执行视图之前被调用，在每个请求上调用，返回None或HttpResponse对象 </li><li><code>def process_view(self, request, callback, callback_args, callback_kwargs):</code> 调用视图之前被调用，在每个请求上调用，返回None或HttpResponse对象</li><li><code>def process_response(self, request, response):</code> 所有响应返回浏览器之前被调用，在每个请求上调用，返回HttpResponse对象</li><li><code>def process_exception(self, request, exception):</code> 当处理过程中抛出异常时调用，返回一个HttpResponse对象</li><li><code>def process_template_response(self, request, response):</code> 在视图刚好执行完毕之后被调用，在每个请求上调用，返回实现了render方法的响应对象</li></ul></li><li>注： 中间件中的大多数方法在返回None时表示忽略当前操作进入下一项事件，当返回HttpResponese对象时表示此请求结果，直接返回给客户端</li></ul></li><li><p>编写中间件类:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file : middleware/mymiddleware.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, Http404</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMiddleWare</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间件方法 process_request 被调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self, request, callback, callback_args, callback_kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间件方法 process_view 被调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间件方法 process_response 被调用&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间件方法 process_exception 被调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_template_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间件方法 process_template_response 被调用&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><ul><li>注册中间件:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : settings.py</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;middleware.mymiddleware.MyMiddleWare&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul><h3 id="跨站请求伪造保护-CSRF"><a href="#跨站请求伪造保护-CSRF" class="headerlink" title="跨站请求伪造保护 CSRF"></a>跨站请求伪造保护 CSRF</h3><ul><li><p>跨站请求伪造攻击</p><ul><li>某些恶意网站上包含链接、表单按钮或者JavaScript，它们会利用登录过的用户在浏览器中的认证信息试图在你的网站上完成某些操作，这就是跨站请求伪造(CSRF，即Cross-Site Request Forgey)。 </li></ul></li><li><p>说明:</p><ul><li>CSRF中间件和模板标签提供对跨站请求伪造简单易用的防护。 </li></ul></li><li><p>作用:  </p><ul><li>不让其它表单提交到此 Django 服务器</li></ul></li><li><p>解决方案:</p><ol><li>取消 csrf 验证(不推荐)<ul><li>删除 settings.py 中 MIDDLEWARE 中的 <code>django.middleware.csrf.CsrfViewMiddleware</code> 的中间件</li></ul></li><li>通过验证 csrf_token 验证 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要在表单中增加一个标签 </span><br><span class="line">&#123;% csrf_token %&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="Django中的forms模块"><a href="#Django中的forms模块" class="headerlink" title="Django中的forms模块"></a>Django中的forms模块</h2><ul><li>在Django中提供了 forms 模块,用forms 模块可以自动生成form内部的表单控件,同时在服务器端可以用对象的形式接收并操作客户端表单元素，并能对表单的数据进行服务器端验证</li><li>forms模块的作用<ul><li>可以用类来描述表单内部的控件，最终生成 HTML 格式的表单内容</li><li>可以用 forms 模块进行表单验证</li></ul></li></ul><h3 id="用form生成表单"><a href="#用form生成表单" class="headerlink" title="用form生成表单"></a>用form生成表单</h3><ul><li><p>Form表单类示意：</p><ul><li>Django Form 实现 Form 表单  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySearch</span>(forms.Form):</span><br><span class="line">    input_text = forms.CharField(label = <span class="string">&#x27;请输入内容&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li>此 form 表单生成的代码  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;id_input_text&quot;</span>&gt;</span>请输入内容:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;input_text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_input_text&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用 forms 模块的步骤</p><ol><li>在应用中创建 forms.py</li><li>导入 django 提供的 forms 模模<ul><li><code>from django import forms</code></li></ul></li><li>创建一个表单类，并在表单类内添加相应的控件 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Form表单类名</span>(forms.Form):</span><br><span class="line">    表单元素 = forms.Field类型(参数...)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></li><li>创建表对象生成表单 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form1 =  FormName()</span><br><span class="line">html = form1.as_p()  <span class="comment"># html 绑定表单内部的input标签...</span></span><br></pre></td></tr></table></figure></li><li>利用Form 类型的对象自动成表单内容<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; form1.as_p &#125;&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol start="3"><li><p>forms.Form 示例:</p><ol><li>创建表单类 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegForm</span>(forms.Form):</span><br><span class="line">    username = forms.CharField(max_length=<span class="number">30</span>, label=<span class="string">&#x27;请输入用户名&#x27;</span>)</span><br><span class="line">    password = forms.CharField(max_length=<span class="number">30</span>, label=<span class="string">&#x27;请输入密码&#x27;</span>)</span><br><span class="line">    password2 = forms.CharField(max_length=<span class="number">20</span>, label=<span class="string">&#x27;请再次输入密码&#x27;</span>)</span><br><span class="line">    ... ...</span><br></pre></td></tr></table></figure></li></ol></li><li><p>字段参数</p><ol><li>label <ul><li>控件前的文本</li></ul></li><li>widget<ul><li>指定小部件</li></ul></li><li>initial<ul><li>控件的初始值(主要针对文本框类型)</li></ul></li><li>required<ul><li>是否为必填项，值为(True/False)，默认为True</li></ul></li></ol></li><li><p>在模板中解析form对象</p><ol><li>方法<ol><li>需要自定义 <form></li><li>表单中的按钮需要自定义</li></ol></li><li>解析form<ul><li>在 视图中创建form对象并发送到模板中解析.</li><li>示例  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form = XXXForm()</span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">&#x27;xx.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure></li></ul><ol><li>手动解析 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for field in form %&#125;</span><br><span class="line">    field : 表示的是form对象中的每个属性(控件)</span><br><span class="line">    &#123;&#123;field.label&#125;&#125; : 表示的是label参数值</span><br><span class="line">    &#123;&#123;field&#125;&#125; : 表示的就是控件</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li>自动解析<ol><li> <code>将 form 中的每个属性(控件/文本)都使用p标记包裹起来再显示</code></li><li> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将 form 中的每个属性(控件/文本)都使用li标记包裹起来再显示</span><br><span class="line">注意:必须手动提供ol 或 ul 标记</span><br></pre></td></tr></table></figure></li><li> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">            将 form 中的每个属性(控件/文本)都使用tr标记包裹起来再显示</span><br><span class="line">            注意:必须手动提供table标记</span><br><span class="line">            ```    </span><br><span class="line">    5. 通过 forms 对象获取表单数据</span><br><span class="line">        1. 通过 forms.Form 子类的构造器来接收 post 数据</span><br><span class="line">            - form = XXXForm(request.POST)</span><br><span class="line">        2. 必须是 form 通过验证后,才能取值</span><br><span class="line">            - form.is_valid()</span><br><span class="line">                - 返回True:通过验证,可以取值</span><br><span class="line">                - 返回False:暂未通过验证,则不能取值</span><br><span class="line">        3. 通过 form.cleaned_data 字典的属性接收数据</span><br><span class="line">            - form.cleaned_data : dict 类型</span><br><span class="line"></span><br><span class="line">7. Field 内置小部件 - widget</span><br><span class="line">    1. 什么是小部件</span><br><span class="line">        - 表示的是生成到网页上的控件以及一些其他的html属性</span><br><span class="line">        ```python</span><br><span class="line">        message=forms.CharField(widget=forms.Textarea)</span><br><span class="line">        upwd=forms.CharField(widget=forms.PasswordInput)</span><br></pre></td></tr></table></figure></li></ol></li><li>常用的小部件类型<table><thead><tr><th>widget名称</th><th>对应和type类值</th></tr></thead><tbody><tr><td>TextInput</td><td>type=’text’</td></tr><tr><td>PasswordInput</td><td>type=’password’</td></tr><tr><td>NumberInput</td><td>type=”number”</td></tr><tr><td>EmailInput</td><td>type=”email”</td></tr><tr><td>URLInput</td><td>type=”url”</td></tr><tr><td>HiddenInput</td><td>type=”hidden”</td></tr><tr><td>CheckboxInput</td><td>type=”checkbox”</td></tr><tr><td>CheckboxSelectMultiple</td><td>type=”checkbox”</td></tr><tr><td>RadioSelect</td><td>type=”radio”</td></tr><tr><td>Textarea</td><td>textarea标记</td></tr><tr><td>Select</td><td>select标记</td></tr><tr><td>SelectMultiple</td><td>select multiple 标记</td></tr></tbody></table></li></ol></li><li><p>小部件的使用</p><ol><li>继承自forms.Form<ol><li>基本版<ol><li>语法 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">属性 = forms.CharField() <span class="comment">#无预选值使用</span></span><br><span class="line">    text,password,email,url,textarea,checkbox</span><br><span class="line">属性 = forms.ChoiceField() <span class="comment">#有预选值使用</span></span><br><span class="line">    checkbox,radio,select</span><br><span class="line"></span><br><span class="line">属性 = forms.CharField(</span><br><span class="line">    label=<span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    widget=forms.小部件类型</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li>示例: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upwd = forms.CharField(</span><br><span class="line">    label=<span class="string">&#x27;用户密码&#x27;</span>,</span><br><span class="line">    widget=forms.PasswordInput</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">message = forms.CharField(</span><br><span class="line">    label=<span class="string">&#x27;评论内容&#x27;</span>,</span><br><span class="line">    widget=forms.Textarea</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol></li></ol></li></ol></li></ol><ul><li>文档参见<a href="https://docs.djangoproject.com/en/1.11/topics/forms/">https://docs.djangoproject.com/en/1.11/topics/forms/</a></li></ul><h3 id="Django之form表单验证"><a href="#Django之form表单验证" class="headerlink" title="Django之form表单验证"></a>Django之form表单验证</h3><ul><li><p>django form 提供表单和字段验证</p></li><li><p>当在创建有不同的多个表单需要提交的网站时，用表单验证比较方便验证的封装</p></li><li><p>当调用form.is_valid() 返回True表示当前表单合法，当返回False说明表单验证出现问题</p></li><li><p>验证步骤:</p><ol><li>先对form.XXXField() 参数值进行验证，比如:min_length,max_length,如果不符合form.is_valid()返回False</li><li>对各自from.clean_zzz属性名(self): 方法对相应属性进行验证,如果验证失败form.is_valid()返回False</li><li>调胳form.clean(self): 对表单的整体结构进行验证，如果验证失败form.is_valid()返回False</li><li>以上验证都成功 form.is_valid()返回True</li></ol></li><li><p>验证方法:</p><ul><li>def clean_xxx属性(self):<ul><li>验证失败必须抛出forms.ValidationError</li><li>验证成功必须返回xxx属性的值</li></ul></li><li>def clean(self):<ul><li>验证失败必须抛出forms.ValidationError</li><li>验证成功必须返回 self.cleaned_data</li></ul></li></ul></li><li><p>文档参见<a href="https://docs.djangoproject.com/en/1.11/ref/forms/validation/">https://docs.djangoproject.com/en/1.11/ref/forms/validation/</a></p></li><li><p>验证示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(forms.Form):</span><br><span class="line">    username = forms.CharField(label=<span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">&#x27;请输入密码&#x27;</span>, widget=forms.PasswordInput)</span><br><span class="line">    password2 = forms.CharField(label=<span class="string">&#x27;再次输入新密码&#x27;</span>, widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clean</span>(<span class="params">self</span>):</span><br><span class="line">        pwd1 = self.cleaned_data[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        pwd2 = self.cleaned_data[<span class="string">&#x27;password2&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> pwd1 != pwd2:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">&#x27;两次密码不一致!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data  <span class="comment"># 必须返回cleaned_data</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clean_username</span>(<span class="params">self</span>):</span><br><span class="line">        username = self.cleaned_data[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(username) &lt; <span class="number">6</span>:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">&quot;用户名太短&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure></li></ul><h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><ul><li>分页是指在web页面有大量数据需要显示，为了阅读方便在每个页页中只显示部分数据。</li><li>好处:<ol><li>方便阅读</li><li>减少数据提取量，减轻服务器压力。</li></ol></li><li>Django提供了Paginator类可以方便的实现分页功能 </li><li>Paginator类位于<code>django.core.paginator</code> 模块中。</li></ul><h3 id="Paginator对象"><a href="#Paginator对象" class="headerlink" title="Paginator对象"></a>Paginator对象</h3><ul><li><p>对象的构造方法</p><ul><li>Paginator(object_list, per_page)</li><li>参数<ul><li>object_list 需要分类数据的对象列表</li><li>per_page 每页数据个数</li></ul></li><li>返回值:<ul><li>分页对象</li></ul></li></ul></li><li><p>Paginator属性</p><ul><li>count：需要分类数据的对象总数</li><li>num_pages：分页后的页面总数</li><li>page_range：从1开始的range对象, 用于记录当前面码数</li><li>per_page 每页数据的个数</li></ul></li><li><p>Paginator方法</p><ul><li>Paginator.page(number)<ul><li>参数 number为页码信息(从1开始)</li><li>返回当前number页对应的页信息</li><li>如果提供的页码不存在，抛出InvalidPage异常</li></ul></li></ul></li><li><p>Paginator异常exception</p><ul><li>InvalidPage：当向page()传入一个无效的页码时抛出</li><li>PageNotAnInteger：当向page()传入一个不是整数的值时抛出</li><li>EmptyPage：当向page()提供一个有效值，但是那个页面上没有任何对象时抛出</li></ul></li></ul><h3 id="Page对象"><a href="#Page对象" class="headerlink" title="Page对象"></a>Page对象</h3><ul><li><p>创建对象<br>Paginator对象的page()方法返回Page对象，不需要手动构造</p></li><li><p>Page对象属性</p><ul><li>object_list：当前页上所有数据对象的列表</li><li>number：当前页的序号，从1开始</li><li>paginator：当前page对象相关的Paginator对象</li></ul></li><li><p>Page对象方法</p><ul><li>has_next()：如果有下一页返回True</li><li>has_previous()：如果有上一页返回True</li><li>has_other_pages()：如果有上一页或下一页返回True</li><li>next_page_number()：返回下一页的页码，如果下一页不存在，抛出InvalidPage异常</li><li>previous_page_number()：返回上一页的页码，如果上一页不存在，抛出InvalidPage异常</li><li>len()：返回当前页面对象的个数</li></ul></li><li><p>说明:</p><ul><li>Page 对象是可迭代对象,可以用 for 语句来 访问当前页面中的每个对象</li></ul></li><li><p>参考文档<a href="https://docs.djangoproject.com/en/1.11/topics/pagination/">https://docs.djangoproject.com/en/1.11/topics/pagination/</a></p></li></ul><ul><li>分页示例:<ul><li>视图函数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">book</span>(<span class="params">request</span>):</span><br><span class="line">    bks = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    paginator = Paginator(bks, <span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前对象的总个数是:&#x27;</span>, paginator.count)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前对象的面码范围是:&#x27;</span>, paginator.page_range)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;总页数是：&#x27;</span>, paginator.num_pages)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;每页最大个数:&#x27;</span>, paginator.per_page)</span><br><span class="line"></span><br><span class="line">    cur_page = request.GET.get(<span class="string">&#x27;page&#x27;</span>, <span class="number">1</span>)  <span class="comment"># 得到默认的当前页</span></span><br><span class="line">    page = paginator.page(cur_page)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;bookstore/book.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure></li><li>模板设计<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>分页显示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% for b in page %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; b.title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 分页功能 #&#125;</span><br><span class="line">&#123;# 上一页功能 #&#125;</span><br><span class="line">&#123;% if page.has_previous %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;book&#x27; %&#125;?page=&#123;&#123; page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">上一页</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for p in paginator.page_range %&#125;</span><br><span class="line">    &#123;% if p == page.number %&#125;</span><br><span class="line">        &#123;&#123; p &#125;&#125;</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;book&#x27; %&#125;?page=&#123;&#123; p &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; p &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;#下一页功能#&#125;</span><br><span class="line">&#123;% if page.has_next %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;book&#x27; %&#125;?page=&#123;&#123; page.next_page_number &#125;&#125;&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">下一页</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">总页数: &#123;&#123; page.len &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><ul><li>文件上传必须为POST提交方式</li><li>表单<code>&lt;form&gt;</code>中文件上传时必须有带有<code>enctype=&quot;multipart/form-data&quot;</code> 时才会包含文件内容数据。</li><li>表单中用<code>&lt;input type=&quot;file&quot; name=&quot;xxx&quot;&gt;</code>标签上传文件<ul><li>名字<code>xxx</code>对应<code>request.FILES[&#39;xxx&#39;]</code> 对应的内存缓冲文件流对象。可通能过<code>request.FILES[&#39;xxx&#39;]</code> 返回的对象获取上传文件数据</li><li><code>file=request.FILES[&#39;xxx&#39;]</code> file 绑定文件流对象，可以通过文件流对象的如下信息获取文件数据<br>  file.name 文件名<br>  file.file 文件的字节流数据</li></ul></li></ul><ul><li><p>上传文件的表单书写方式</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- file: index/templates/index/upload.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myfile&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在setting.py 中设置一个变量MEDIA_ROOT 用来记录上传文件的位置</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : settings.py</span></span><br><span class="line">...</span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">&#x27;static/files&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>在当前项目文件夹下创建 <code>static/files</code> 文件夹</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p static/files</span></span><br></pre></td></tr></table></figure></li><li><p>添加路由及对应的处理函数</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^upload&#x27;</span>, views.upload_view)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>上传文件的视图处理函数</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, Http404</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;index/upload.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        a_file = request.FILES[<span class="string">&#x27;myfile&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;上传文件名是:&quot;</span>, a_file.name)</span><br><span class="line"></span><br><span class="line">        filename =os.path.join(settings.MEDIA_ROOT, a_file.name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = a_file.file.read()</span><br><span class="line">            f.write(data)</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&quot;接收文件:&quot;</span> + a_file.name + <span class="string">&quot;成功&quot;</span>)</span><br><span class="line">    <span class="keyword">raise</span> Http404</span><br></pre></td></tr></table></figure></li><li><p>访问地址: <a href="http://127.0.0.1:8000/static/upload.html">http://127.0.0.1:8000/static/upload.html</a></p></li></ul><h2 id="Django中的用户认证-使用Django认证系统"><a href="#Django中的用户认证-使用Django认证系统" class="headerlink" title="Django中的用户认证 (使用Django认证系统)"></a>Django中的用户认证 (使用Django认证系统)</h2><ul><li><p>Django带有一个用户认证系统。 它处理用户账号、组、权限以及基于cookie的用户会话。</p></li><li><p>作用:</p><ol><li>添加普通用户和超级用户</li><li>修改密码</li></ol></li><li><p>文档参见</p><ul><li><a href="https://docs.djangoproject.com/en/1.11/topics/auth/">https://docs.djangoproject.com/en/1.11/topics/auth/</a></li></ul></li><li><p>User模型类</p><ul><li>位置: <code>from django.contrib.auth.models import User</code></li></ul></li><li><p>默认user的基本属性有：</p><table><thead><tr><th>属性名</th><th>类型</th><th>是否必选</th></tr></thead><tbody><tr><td>username</td><td>用户名</td><td>是</td></tr><tr><td>password</td><td>密码</td><td>是</td></tr><tr><td>email</td><td>邮箱</td><td>可选</td></tr><tr><td>first_name</td><td>名</td><td></td></tr><tr><td>last_name</td><td>姓</td><td></td></tr><tr><td>is_superuser</td><td>是否是管理员帐号(/admin)</td><td></td></tr><tr><td>is_staff</td><td>是否可以访问admin管理界面</td><td></td></tr><tr><td>is_active</td><td>是否是活跃用户,默认True。一般不删除用户，而是将用户的is_active设为False。</td><td></td></tr><tr><td>last_login</td><td>上一次的登录时间</td><td></td></tr><tr><td>date_joined</td><td>用户创建的时间</td><td></td></tr></tbody></table></li><li><p>数据库表现形式</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> use myauth;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> auth_user;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field        <span class="operator">|</span> Type         <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id           <span class="operator">|</span> <span class="type">int</span>(<span class="number">11</span>)      <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> password     <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">128</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> last_login   <span class="operator">|</span> datetime(<span class="number">6</span>)  <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_superuser <span class="operator">|</span> tinyint(<span class="number">1</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> username     <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">150</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> UNI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> first_name   <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> last_name    <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">30</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> email        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">254</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_staff     <span class="operator">|</span> tinyint(<span class="number">1</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_active    <span class="operator">|</span> tinyint(<span class="number">1</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> date_joined  <span class="operator">|</span> datetime(<span class="number">6</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul><h3 id="auth基本模型操作"><a href="#auth基本模型操作" class="headerlink" title="auth基本模型操作:"></a>auth基本模型操作:</h3><ul><li>创建用户<ul><li>创建普通用户create_user  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> models</span><br><span class="line">user = models.User.objects.create_user(username=<span class="string">&#x27;用户名&#x27;</span>, password=<span class="string">&#x27;密码&#x27;</span>, email=<span class="string">&#x27;邮箱&#x27;</span>,...)</span><br><span class="line">...</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure></li><li>创建超级用户create_superuser  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> models</span><br><span class="line">user = models.User.objects.create_superuser(username=<span class="string">&#x27;用户名&#x27;</span>, password=<span class="string">&#x27;密码&#x27;</span>, email=<span class="string">&#x27;邮箱&#x27;</span>,...)</span><br><span class="line">...</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure></li></ul></li><li>删除用户  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user = models.User.objects.get(username=<span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">    user.is_active = <span class="literal">False</span>  <span class="comment"># 记当前用户无效</span></span><br><span class="line">    user.save()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;删除普通用户成功！&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;删除普通用户失败&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/user/info&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li>修改密码set_password  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user = models.User.objects.get(username=<span class="string">&#x27;laowei&#x27;</span>)</span><br><span class="line">    user.set_password(<span class="string">&#x27;654321&#x27;</span>)</span><br><span class="line">    user.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;修改密码成功！&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;修改密码失败！&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>检查密码是否正确check_password  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user = models.User.objects.get(username=<span class="string">&#x27;laowei&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> user.check_password(<span class="string">&#x27;654321&#x27;</span>):  <span class="comment"># 成功返回True,失败返回False</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;密码正确&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;密码错误&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;没有此用户！&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><ul><li>项目部署是指在软件开发完毕后，将开发机器上运行的开发板软件实际安装到服务器上进行长期运行</li><li>部署要分以下几个步骤进行<ol><li>在安装机器上安装和配置同版本的数据库</li><li>django 项目迁移(在安装机器上配置与开发环境相同的python版本及依懒的包)</li><li>用 uwsgi 替代<code>python3 manage.py runserver</code> 方法启动服务器</li><li>配置 nginx 反向代理服务器</li><li>用nginx 配置静态文件路径,解决静态路径问题</li></ol></li></ul><ol><li>安装同版本的数据库<ul><li>安装步骤略</li></ul></li><li>django 项目迁移<ol><li>安装python<ul><li><code>$ sudo apt install python3</code></li></ul></li><li>安装相同版本的包<ul><li>导出当前模块数据包的信息:<ul><li><code>$ pip3 freeze &gt; package_list.txt</code></li></ul></li><li>导入到另一台新主机<ul><li><code>$ pip3 install -r package_list.txt</code></li></ul></li></ul></li><li>将当前项目源代码复制到运程主机上(scp 命令)<ul><li>$ sudo scp -a 当前项目源代码 远程主机地址和文件夹</li></ul></li></ol></li></ol><h3 id="WSGI-Django工作环境部署"><a href="#WSGI-Django工作环境部署" class="headerlink" title="WSGI Django工作环境部署"></a>WSGI Django工作环境部署</h3><ul><li>WSGI (Web Server Gateway Interface)Web服务器网关接口，是Python应用程序或框架和Web服务器之间的一种接口，被广泛使用</li><li>它实现了WSGI协议、http等协议。Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换。WSGI是一种Web服务器网关接口。</li></ul><h3 id="uWSGI-网关接口配置-ubuntu-18-04-配置"><a href="#uWSGI-网关接口配置-ubuntu-18-04-配置" class="headerlink" title="uWSGI 网关接口配置 (ubuntu 18.04 配置)"></a>uWSGI 网关接口配置 (ubuntu 18.04 配置)</h3><ul><li><p>使用 <code>python manage.py runserver</code> 通常只在开发和测试环境中使用。</p></li><li><p>当开发结束后，完善的项目代码需要在一个高效稳定的环境中运行，这时可以使用uWSGI</p></li><li><p>uWSGI是WSGI的一种,它可以让Django、Flask等开发的web站点运行其中.</p></li><li><p>安装uWSGI</p><ul><li>在线安装 uwsgi  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo pip3 install uwsgi</span></span><br></pre></td></tr></table></figure></li><li>离线安装<ol><li>在线下载安装包:  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip3 download uwsgi</span></span><br></pre></td></tr></table></figure><ul><li>下载后的文件为 <code>uwsgi-2.0.18.tar.gz</code></li></ul></li><li>离线安装 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar -xzvf uwsgi-2.0.18.tar.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> uwsgi-2.0.18</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo python3 setup.py install</span></span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p>配置uWSGI</p><ul><li>添加配置文件 <code>项目文件夹/uwsgi.ini</code><ul><li>如: mysite1/uwsgi.ini<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="comment"># 套接字方式的 IP地址:端口号</span></span><br><span class="line"><span class="comment"># socket=127.0.0.1:8000</span></span><br><span class="line"><span class="comment"># Http通信方式的 IP地址:端口号</span></span><br><span class="line"><span class="attr">http</span>=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span></span><br><span class="line"><span class="comment"># 项目当前工作目录</span></span><br><span class="line"><span class="attr">chdir</span>=/home/weimz/.../my_project 这里需要换为项目文件夹的绝对路径</span><br><span class="line"><span class="comment"># 项目中wsgi.py文件的目录，相对于当前工作目录</span></span><br><span class="line"><span class="attr">wsgi-file</span>=my_project/wsgi.py</span><br><span class="line"><span class="comment"># 进程个数</span></span><br><span class="line"><span class="attr">process</span>=<span class="number">4</span></span><br><span class="line"><span class="comment"># 每个进程的线程个数</span></span><br><span class="line"><span class="attr">threads</span>=<span class="number">2</span></span><br><span class="line"><span class="comment"># 服务的pid记录文件</span></span><br><span class="line"><span class="attr">pidfile</span>=uwsgi.pid</span><br><span class="line"><span class="comment"># 服务的目志文件位置</span></span><br><span class="line"><span class="attr">daemonize</span>=uwsgi.log</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>uWSGI的运行管理</p><ul><li>启动 uwsgi  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> 项目文件夹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo uwsgi --ini 项目文件夹/uwsgi.ini</span></span><br></pre></td></tr></table></figure></li><li>停止 uwsgi  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> 项目文件夹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo uwsgi --stop uwsgi.pid</span></span><br></pre></td></tr></table></figure></li><li>说明:<ul><li>当uwsgi 启动后,当前django项目的程序已变成后台守护进程,在关闭当前终端时此进程也不会停止。</li></ul></li></ul></li><li><p>测试:</p><ul><li>在浏览器端输入<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a> 进行测试</li><li>注意，此时端口号为8000</li></ul></li></ul><h3 id="nginx-反向代理配置"><a href="#nginx-反向代理配置" class="headerlink" title="nginx 反向代理配置"></a>nginx 反向代理配置</h3><ul><li><p>Nginx是轻量级的高性能Web服务器，提供了诸如HTTP代理和反向代理、负载均衡、缓存等一系列重要特性，在实践之中使用广泛。</p></li><li><p>C语言编写，执行效率高</p></li><li><p>nginx 作用</p><ul><li>负载均衡， 多台服务器轮流处理请求</li><li>反向代理</li></ul></li><li><p>原理:</p></li><li><p>客户端请求nginx,再由nginx 请求 uwsgi, 运行django下的python代码</p></li><li><p>ubuntu 下 nginx 安装<br>  $ sudo apt install nginx</p></li><li><p>nginx 配置 </p><ul><li>修改nginx 的配置文件 /etc/nginx/sites-available/default<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 在server节点下添加新的location项，指向uwsgi的ip与端口。</span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location / &#123;</span><br><span class="line">        uwsgi_pass 127.0.0.1:8000;  # 重定向到127.0.0.1的8000端口</span><br><span class="line">        include /etc/nginx/uwsgi_params; # 将所有的参数转到uwsgi下</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>nginx服务控制</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo /etc/init.d/nginx start|stop|restart|status</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo service nginx start|stop|restart|status</span></span><br></pre></td></tr></table></figure><blockquote><p>通过 start,stop,restart,status 可能实现nginx服务的启动、停止、重启、查扑克状态等操作</p></blockquote></li><li><p>修改uWSGI配置 </p><ul><li>修改<code>项目文件夹/uwsgi.ini</code>下的Http通信方式改为socket通信方式,如:<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="comment"># 去掉如下</span></span><br><span class="line"><span class="comment"># http=127.0.0.1:8000</span></span><br><span class="line"><span class="comment"># 改为</span></span><br><span class="line"><span class="attr">socket</span>=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure></li><li>重启uWSGI服务<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo uwsgi --stop uwsgi.pid</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo uwsgi --ini 项目文件夹/uwsgi.ini</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">- 测试:</span><br><span class="line">    - 在浏览器端输入&lt;http://127.0.0.1&gt; 进行测试</span><br><span class="line">    - 注意，此时端口号为80(nginx默认值)</span><br><span class="line"></span><br><span class="line">### nginx 配置静态文件路径</span><br><span class="line">- 解决静态路径问题</span><br><span class="line">    ```ini</span><br><span class="line">    # file : /etc/nginx/sites-available/default</span><br><span class="line">    # 新添加location /static 路由配置，重定向到指定的绝对路径</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        location /static &#123;</span><br><span class="line">            # root static文件夹所在的绝对路径,如:</span><br><span class="line">            root /home/weimz/my_django_project; # 重定向/static请求的路径，这里改为你项目的文件夹</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>修改配置文件后需要重新启动 nginx 服务</p></li></ul><h3 id="404-界面"><a href="#404-界面" class="headerlink" title="404 界面"></a>404 界面</h3><ul><li>在模板文件夹内添加 404.html 模版，当视图触发Http404 异常时将会被显示</li><li>404.html 仅在发布版中(即setting.py 中的 DEBUG=False时) 才起作用</li><li>当向应处理函数触发Http404异常时就会跳转到404界面  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xxx_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> Http404  <span class="comment"># 直接返回404</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Django是一个开放源代码的Web应用框架，由Python写成。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Linux搭建Hexo</title>
    <link href="https://rencheng.cc/2019/10/12/hexo/Linux%E6%90%AD%E5%BB%BAHexo/"/>
    <id>https://rencheng.cc/2019/10/12/hexo/Linux%E6%90%AD%E5%BB%BAHexo/</id>
    <published>2019-10-12T02:26:02.000Z</published>
    <updated>2019-10-12T02:26:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>为这个博客系统搭建一个远程站点</p><span id="more"></span><h2 id="方法1：Docker的node镜像部署"><a href="#方法1：Docker的node镜像部署" class="headerlink" title="方法1：Docker的node镜像部署"></a>方法1：Docker的node镜像部署</h2><h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4000:4000 --name hexo \</span><br><span class="line">-v /dockerData/Blog:/Blog \</span><br><span class="line">node /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br></pre></td></tr></table></figure><h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it hexo bash</span><br></pre></td></tr></table></figure><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><p><strong>如果初始化博客</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir hexo</span><br><span class="line">cd hexo   </span><br><span class="line">hexo init </span><br></pre></td></tr></table></figure><blockquote><p>hexo init 自动把资源文件下载好；会等待一段时间</p></blockquote><p><strong>如果已经有博客</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd Blog</span><br><span class="line">npm install hexo --save</span><br><span class="line">npm audit fix</span><br></pre></td></tr></table></figure><h3 id="运行博客"><a href="#运行博客" class="headerlink" title="运行博客"></a>运行博客</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup hexo s &amp;</span><br></pre></td></tr></table></figure><h2 id="方法2：手动搭建Node环境"><a href="#方法2：手动搭建Node环境" class="headerlink" title="方法2：手动搭建Node环境"></a>方法2：手动搭建Node环境</h2><h3 id="安装Node"><a href="#安装Node" class="headerlink" title="安装Node"></a>安装Node</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nodejs</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">npm install</span><br><span class="line">npm run build</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><blockquote><p>安装时间会很久，闹心等待。</p><p>卧槽，无情。安装失败了</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;为这个博客系统搭建一个远程站点&lt;/p&gt;</summary>
    
    
    
    
    <category term="教程" scheme="https://rencheng.cc/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="hexo" scheme="https://rencheng.cc/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>Docker运行Nginx</title>
    <link href="https://rencheng.cc/2019/10/09/docker/Docker%E8%BF%90%E8%A1%8CNginx/"/>
    <id>https://rencheng.cc/2019/10/09/docker/Docker%E8%BF%90%E8%A1%8CNginx/</id>
    <published>2019-10-09T07:18:54.000Z</published>
    <updated>2019-10-09T07:18:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>如果我们有自己的服务器，就经常肯定会使用到Nginx，下面我们就用Docker来部署一个Nginx</p><span id="more"></span><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p><strong>移除旧版本</strong><br>1.查询安装过的包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum list installed | grep docker</span><br><span class="line"></span><br><span class="line">docker-engine.x86_64                 17.03.0.ce-1.el7.centos         @dockerrepo</span><br></pre></td></tr></table></figure><p>2.删除安装的软件包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove docker-engine.x86_64</span><br></pre></td></tr></table></figure><p>3.删除镜像/容器等</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/docker</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>安装一些必要的系统工具:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><p><strong>添加软件源信息：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p><strong>更新 yum 缓存</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum makecache fast</span><br></pre></td></tr></table></figure><p><strong>安装 Docker-ce：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 Docker</span></span><br><span class="line">sudo yum -y install docker-ce</span><br></pre></td></tr></table></figure><p><strong>启动 Docker 后台服务:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><p><strong>测试运行 hello-world</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>出现<code>hello world</code>就证明安装正常了</p><h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><p>安装<code>nginx</code>前，我们现在本地建立几个文件，用于存放<code>nginx</code>的配置文件等</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到服务器根目录</span></span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="comment"># 创建主目录</span></span><br><span class="line"><span class="built_in">mkdir</span> dockerData</span><br><span class="line"><span class="comment"># 创建文件</span></span><br><span class="line"><span class="built_in">mkdir</span> dockerData/nginx dockerData/nginx/conf dockerData/nginx/logs dockerData/nginx/www dockerData/nginx/ssl</span><br></pre></td></tr></table></figure><p>上面的 <code>dockerData</code> 可以换成自己喜欢的名字</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dockerData/nginx 用于存放 docker 下 nginx 自定义文件</span><br><span class="line">dockerData/nginx/conf 存放 nginx 配置文件</span><br><span class="line">dockerData/nginx/log 存放 nginx 日志文件</span><br><span class="line">dockerData/nginx/www 存放 nginx 访问的资源文件</span><br><span class="line">dockerData/nginx/ssl 存放 ssl 证书</span><br></pre></td></tr></table></figure><p>启动 nginx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx -p 80:80 -d --rm nginx</span><br></pre></td></tr></table></figure><p>如果你没有备案，可以将上面的<code>80:80</code>换成<code>8081:80</code>，因为这个东西一会儿也要删掉，所以加上<code>--rm</code>参数，命令执行玩后通过 <code>docker ps</code> 查看 <code>nginx</code> 是否在运行，在运行的情况下访问你的域名加端口号查看是否正常安装，<code>80</code>直接省略。如下表示访问成功</p><p>导出配置文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp nginx:/etc/nginx/nginx.conf /dockerData/nginx/conf/nginx.conf 导出配置文件 nginx.conf</span><br><span class="line">docker cp nginx:/etc/nginx/conf.d /dockerData/nginx/conf/conf.d 导出配置为你 nginx.conf</span><br></pre></td></tr></table></figure><p>执行 <code>docker stop nginx</code> ，会自动删除现在的 <code>nginx</code> 容器，然后执行如下命令重新启动一个 <code>nginx</code> 容器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 --name nginx \</span><br><span class="line">-v /dockerData/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /dockerData/nginx/ssl:/etc/nginx/ssl \</span><br><span class="line">-v /dockerData/nginx/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /dockerData/nginx/www:/usr/share/nginx/html \</span><br><span class="line">-v /dockerData/nginx/logs:/var/log/nginx nginx</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-v /dockerData/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \ 挂载配置文件nginx.conf</span><br><span class="line">-v /dockerData/nginx/conf/conf.d:/etc/nginx/conf.d 挂载配置文件default.conf</span><br><span class="line">-v /dockerData/nginx/www:/usr/share/nginx/html  挂载项目文件</span><br><span class="line">-v /dockerData/nginx/logs:/var/log/nginx 挂载配置文件</span><br></pre></td></tr></table></figure><p>访问你的域名，你会发现报错了<br>这时我们可以前往 <code>/dockerData/nginx/logs</code> 下查看日志文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019/08/05 14:57:54 [error] 6#6: *3 directory index of &quot;/usr/share/nginx/html/&quot; is forbidden, client: 121.32.33.217, server: localhost, request: &quot;GET / HTTP/1.1&quot;, host: &quot;www.jinjianh.com&quot; </span><br></pre></td></tr></table></figure><p>因为 <code>/usr/share/nginx/html/</code> 被挂载到了服务器上面的/dockerData/nginx/www目录下，原来的欢迎页面在 <code>dockerData/nginx/www</code> 是没有的，所有就报错了，这里我们随便建一个。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 打开项目文件</span><br><span class="line">cd /dockerData/nginx/www</span><br><span class="line"># 使用vim 创建并编辑文件</span><br><span class="line">vim index.html</span><br><span class="line"># 此时我们会进入vim界面，按 i 插入，然后输入</span><br><span class="line">&lt;h1&gt;Hello Docker-Nginx&lt;/h1&gt;</span><br><span class="line"># 输入完后，按 esc，然后输入 :wq</span><br></pre></td></tr></table></figure><p>再次访问我们的域名就可以看到我们刚刚写的h1标签内容</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;如果我们有自己的服务器，就经常肯定会使用到Nginx，下面我们就用Docker来部署一个Nginx&lt;/p&gt;</summary>
    
    
    
    
    <category term="docker" scheme="https://rencheng.cc/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>iOS-图片压缩</title>
    <link href="https://rencheng.cc/2019/10/01/ios/general/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E6%8A%80%E6%9C%AF/"/>
    <id>https://rencheng.cc/2019/10/01/ios/general/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E6%8A%80%E6%9C%AF/</id>
    <published>2019-10-01T08:38:25.000Z</published>
    <updated>2019-10-01T08:38:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>移动端开发经常会遇到图片压缩的问题，场景有更新头像，发帖等。今天我们就了解一下</p><span id="more"></span><h2 id="图片格式基础"><a href="#图片格式基础" class="headerlink" title="图片格式基础"></a>图片格式基础</h2><ul><li>点阵图：也叫位图。用像素为单位，像素保存颜色信息，排列像素实现显示。</li><li>矢量图：记录元素形状和颜色的算法，显示时展示算法运算的结果。</li></ul><h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><p>表示颜色时，有两种形式，一种为索引色（Index Color），一种为直接色（Direct Color）</p><ul><li>索引色：用一个数字索引代表一种颜色，在图像信息中存储数字到颜色的映射关系表（调色盘 Palette）。每个像素保存该像素颜色对应的数字索引。一般调色盘只能存储有限种类的颜色，通常为 256 种。所以每个像素的数字占用 1 字节（8 bit）大小。</li><li>直接色：用四个数字来代表一种颜色，数字分别对应颜色中红色，绿色，蓝色，透明度（RGBA）。每个像素保存这四个纬度的信息来代表该像素的颜色。根据色彩深度（每个像素存储颜色信息的 bit 数不同），最多可以支持的颜色种类也不同，常见的有 8 位（R3+G3+B2）、16 位（R5+G6+B5）、24 位（R8+G8+B8）、32 位（A8+R8+G8+B8）。所以每个像素占用 1~4 字节大小。</li></ul><h2 id="移动端常用图片格式"><a href="#移动端常用图片格式" class="headerlink" title="移动端常用图片格式"></a>移动端常用图片格式</h2><p>图片格式中一般分为静态图和动态图</p><h3 id="静态图"><a href="#静态图" class="headerlink" title="静态图"></a>静态图</h3><ul><li><p>JPG：是支持 JPEG（ 一种有损压缩方法）标准中最常用的图片格式。采用点阵图。常见的是使用 24 位的颜色深度的直接色（不支持透明）。</p></li><li><p>PNG：是支持无损压缩的图片格式。采用点阵图。PNG 有 5 种颜色选项：索引色、灰度、灰度透明、真彩色（24 位直接色）、真彩色透明（32 位直接色）。</p></li><li><p>WebP：是同时支持有损压缩和无所压缩的的图片格式。采用点阵图。支持 32 位直接色。移动端支持情况如下：</p></li></ul><table><thead><tr><th>系统</th><th>原生</th><th>WebView</th><th>浏览器</th></tr></thead><tbody><tr><td>iOS</td><td>第三方库支持</td><td>不支持</td><td>支持</td></tr><tr><td>Android</td><td>4.3后支持完整功能</td><td>支持</td><td>支持</td></tr></tbody></table><h3 id="动态图"><a href="#动态图" class="headerlink" title="动态图"></a>动态图</h3><ul><li>GIF：是支持无损压缩的图片格式。采用点阵图。使用索引色，并有 1 位透明度通道（透明与否）。</li><li>APNG：基于 PNG 格式扩展的格式，加入动态图支持。采用点阵图。使用 32 位直接色。但没有被官方 PNG 接纳。移动端支持情况如下：</li></ul><table><thead><tr><th>系统</th><th>原生</th><th>WebView</th><th>浏览器</th></tr></thead><tbody><tr><td>iOS</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>Android</td><td>第三方库支持</td><td>不支持</td><td>不支持</td></tr></tbody></table><ul><li>Animated Webp：Webp 的动图形式，实际上是文件中打包了多个单帧 Webp，在 libwebp 0.4 后开始支持。移动端支持情况如下：</li></ul><table><thead><tr><th>系统</th><th>原生</th><th>WebView</th><th>浏览器</th></tr></thead><tbody><tr><td>iOS</td><td>第三方库支持</td><td>不支持</td><td>不支持</td></tr><tr><td>Android</td><td>第三方库支持</td><td>不支持</td><td>不支持</td></tr></tbody></table><p>而由于一般项目需要兼容三端（iOS、Android、Web 的关系），最简单就是支持 JPG、PNG、GIF 这三种通用的格式。所以本文暂不讨论其余图片格式的压缩。</p><h2 id="移动端系统图片处理架构"><a href="#移动端系统图片处理架构" class="headerlink" title="移动端系统图片处理架构"></a>移动端系统图片处理架构</h2><p>根据我的了解，画了一下 iOS&amp;Android 图片处理架构。iOS 这边，也是可以直接调用底层一点的框架的。</p><p><img src="https://cdn.rencheng.cc/blog/f7jhz.jpg-thumb100"></p><h2 id="iOS-的-ImageIO"><a href="#iOS-的-ImageIO" class="headerlink" title="iOS 的 ImageIO"></a>iOS 的 ImageIO</h2><p>本文 iOS 端处理图片主要用 ImageIO 框架，使用的原因主要是静态图动态图 API 调用保持一致，且不会因为 UIImage 转换时会丢失一部分数据的信息。</p><p>ImageIO 主要提供了图片编解码功能，封装了一套 C 语言接口。在 Swift 中不需要对 C 对象进行内存管理，会比 Objective-C 中使用方便不少，但 api 结果返回都是 Optional（实际上非空），需要用 <code>guard/if</code>，或者 !进行转换。</p><h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p><strong>1. 创建 CGImageSource</strong><br><code>CGImageSource</code> 相当于 ImageIO 数据来源的抽象类。通用的使用方式 <code>CGImageSourceCreateWithDataProvider:</code> 需要提供一个 DataProvider，可以指定文件、URL、Data 等输入。也有通过传入 CFData 来进行创建的便捷方法 <code>CGImageSourceCreateWithData:</code>。方法的第二个参数 options 传入一个字典进行配置。根据 Apple 在 WWDC 2018 上的 <a href="https://developer.apple.com/videos/play/wwdc2018/219/">Image and Graphics Best Practices</a> 上的例子，当不需要解码仅需要创建 <code>CGImageSource</code> 的时候，应该将 <code>kCGImageSourceShouldCache</code> 设为 false。</p><p><img src="https://cdn.rencheng.cc/blog/lmr0l.jpg-thumb100"></p><p><strong>2. 解码得到 CGImage</strong><br>用 <code>CGImageSourceCreateImageAtIndex:</code> 或者 <code>CGImageSourceCreateThumbnailAtIndex:</code> 来获取生成的 <code>CGImage</code>，这里参数的 Index 就是第几帧图片，静态图传入 0 即可。</p><h3 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h3><p><strong>1. 创建 CGImageDestination</strong><br><code>CGImageDestination</code> 相当于<code>ImageIO</code>数据输出的抽象类。通用的使用方式 <code>CGImageDestinationCreateWithDataConsumer: </code>需要提供一个 <code>DataConsumer</code>，可以置顶 URL、Data 等输入。也有通过传入 CFData 来进行创建的便捷方法 <code>CGImageDestinationCreateWithData:</code>，输出会写入到传入的<code>Data</code>中。方法还需要提供图片类型，图片帧数。</p><p><strong>2. 添加 CGImage</strong><br>添加 <code>CGImage</code> 使用<code>CGImageDestinationAddImage:</code>方法，动图的话，按顺序多次调用就行了。</p><p>而且还有一个特别的 <code>CGImageDestinationAddImageFromSource:</code> 方法，添加的其实是一个<code> CGImageSource</code>，有什么用呢，通过<code> options</code> 参数，达到改变图像设置的作用。比如改变 JPG 的压缩参数，用上这个功能后，就不需要转换成更顶层的对象（比如 <code>UIImage</code>），减少了转换时的编解码的损耗，达到性能更优的目的。</p><p><strong>3. 进行编码</strong><br>调用 <code>CGImageDestinationFinalize: </code>，表示开始编码，完成后会返回一个<code>Bool</code>值，并将数据写入 <code>CGImageDestination</code> 提供的 DataConsumer 中。</p><h2 id="压缩思路分析"><a href="#压缩思路分析" class="headerlink" title="压缩思路分析"></a>压缩思路分析</h2><p>位图占用的空间大小，其实就是像素数量 x 单像素占用空间 x 帧数。所以减小图片空间大小，其实就从这三个方向下手。其中单像素占用空间，在直接色的情况下，主要和色彩深度相关。在实际项目中，改变色彩深度会导致图片颜色和原图没有保持完全一致，笔者并不建议对色彩深度进行更改。而像素数量就是平时非常常用的图片分辨率缩放。除此之外，JPG 格式还有特有的通过指定压缩系数来进行有损压缩。</p><p>JPG：压缩系数 + 分辨率缩放 + 色彩深度降低<br>PNG： 分辨率缩放 + 降低色彩深度<br>GIF：减少帧数 + 每帧分辨率缩放 + 减小调色盘</p><p><a href="https://nemocdz.github.io/post/%E6%B5%85%E8%B0%88%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/#%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E5%9F%BA%E7%A1%80">https://nemocdz.github.io/post/%E6%B5%85%E8%B0%88%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/#%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E5%9F%BA%E7%A1%80</a></p><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>减少图片占用内存空间</p><h2 id="质量压缩"><a href="#质量压缩" class="headerlink" title="质量压缩"></a>质量压缩</h2><p>图片的质量压缩 降低图片质量（大小）。<br><strong>原理</strong><br>通过算法扣掉（同化）了 图片中的一些某个点附近相近的像素，达到降低质量 减少 文件大小的目的。</p><blockquote><p>他其实只能 实现对 file 的影响，对加载这个图片出来的bitmap 内存是无法节省的 ，还是那么大。 因为 bitmap 在内存中的大小是按照 像素 计算的 ，也就是width * height ，对于质量压缩，并不会改变图片的真实的像素（像素大小不会变）。</p></blockquote><h2 id="尺寸压缩"><a href="#尺寸压缩" class="headerlink" title="尺寸压缩"></a>尺寸压缩</h2><p>就是按照一定的倍数对图片减少单位尺寸的像素值。<br><strong>原理</strong><br>通过减少单位尺寸的像素值，真正意义上的降低像素值。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;移动端开发经常会遇到图片压缩的问题，场景有更新头像，发帖等。今天我们就了解一下&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>微信分享卡片点击跳转App</title>
    <link href="https://rencheng.cc/2019/09/27/search/%E5%BE%AE%E4%BF%A1%E5%88%86%E4%BA%AB%E5%8D%A1%E7%89%87%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%ACApp/"/>
    <id>https://rencheng.cc/2019/09/27/search/%E5%BE%AE%E4%BF%A1%E5%88%86%E4%BA%AB%E5%8D%A1%E7%89%87%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%ACApp/</id>
    <published>2019-09-27T05:38:50.000Z</published>
    <updated>2019-09-27T05:38:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>微信内置浏览器已禁止使用外部url scheme跳转至其他app。<br>如何突破这一壁垒实现需求呢？</p><span id="more"></span><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>App分享卡片到微信，微信点击打开卡片连接，点击【按钮】直接唤起App；</p><h2 id="问题点"><a href="#问题点" class="headerlink" title="问题点"></a>问题点</h2><p>微信内置浏览器已禁止使用外部url scheme跳转至其他app。<br>官方没有给具体的链接，但是就不能跳转。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="解决方案1（推荐使用）-类似虎扑"><a href="#解决方案1（推荐使用）-类似虎扑" class="headerlink" title="解决方案1（推荐使用）(类似虎扑)"></a>解决方案1（推荐使用）(类似虎扑)</h3><p>引导打开浏览器，iOS在Safari中打开，Android在浏览器中打开</p><table><thead><tr><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img src="https://cdn.rencheng.cc/blog/ubs3d.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/dbozx.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/l9iol.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/fq67j.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/g4aaa.jpg-thumb100"></td></tr></tbody></table><blockquote><p>基于<code>universal link</code> 和 <code>scheme</code><br>技术相对简单，虽说达到了跳转目的，但过程过于繁琐</p></blockquote><h3 id="解决方案2"><a href="#解决方案2" class="headerlink" title="解决方案2"></a>解决方案2</h3><p>集成第三方程序（无需花时间去维护）</p><blockquote><p>使用<code>DeepLink</code> 技术，突破微信跳转问题<br>技术门槛高，但第三方帮我们解决了。</p></blockquote><h4 id="LinkedME"><a href="#LinkedME" class="headerlink" title="LinkedME"></a><a href="https://www.linkedme.cc/">LinkedME</a></h4><p>—国内⾸首家企业级深度链接服务提供商，致⼒于帮助APP解决 ⽤用户增⻓(拉新、拉活、留留存、转化等)和流量变现等问题。</p><table><thead><tr><th align="center">唤醒指定页面</th><th align="center">场景还原</th><th align="center">沉默用户唤醒</th></tr></thead><tbody><tr><td align="center">&lt;video src=”<a href="https://www.linkedme.cc/img/LInkPage.mp4&quot;controls=&quot;controls&quot;">https://www.linkedme.cc/img/LInkPage.mp4&quot;controls=&quot;controls&quot;</a> width=180px&gt;</video></td><td align="center">&lt;video src=”<a href="https://www.linkedme.cc/img/li.mp4&quot;controls=&quot;controls&quot;">https://www.linkedme.cc/img/li.mp4&quot;controls=&quot;controls&quot;</a> width=180px&gt;</video></td><td align="center">&lt;video src=”<a href="https://www.linkedme.cc/img/vancl.mp4&quot;controls=&quot;controls&quot;">https://www.linkedme.cc/img/vancl.mp4&quot;controls=&quot;controls&quot;</a> width=180px&gt;</video></td></tr></tbody></table><p><strong>唤醒指定页面</strong></p><table><thead><tr><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img src="https://cdn.rencheng.cc/blog/zs2r8.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/c4llg.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/tttst.jpg-thumb100"></td></tr></tbody></table><h4 id="极光魔链"><a href="#极光魔链" class="headerlink" title="极光魔链"></a><a href="https://www.jiguang.cn/jmlink/#/app/d3c04300ca1878475ad651f7/overview">极光魔链</a></h4><p>今年极光收购了魔窗，产品名称是极光魔链。可以快速集成，但是稳定性待测试。<br><img src="https://cdn.rencheng.cc/blog/7ukxa.png-thumb100"></p><h4 id="实际测试结果"><a href="#实际测试结果" class="headerlink" title="实际测试结果"></a>实际测试结果</h4><p><strong>iOS</strong><br>微信：可以完美唤起App以及指定页面App；（打开App的时候显示的是第三方应用）<br><strong>Android</strong><br>微信：当App在后台时可以直接唤起App（Android Q除外，它跟杀死唤起机制一样）；如果App杀死之后，需要浏览器唤起。</p><h3 id="解决方案3"><a href="#解决方案3" class="headerlink" title="解决方案3"></a>解决方案3</h3><p>小程序可以打开App（类似Bilibili）<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/launchApp.html">官方文档</a></p><table><thead><tr><th align="left"></th><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img src="https://cdn.rencheng.cc/blog/svcqk.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/gympp.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/1civj.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/du3l5.jpg-thumb100"></td></tr></tbody></table><h3 id="解决方案4"><a href="#解决方案4" class="headerlink" title="解决方案4"></a>解决方案4</h3><p>通过自己调研开发DeepLink（参考一点资讯）</p><table><thead><tr><th align="left"></th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img src="https://cdn.rencheng.cc/blog/jh51j.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/fqvrl.jpg-thumb100"></td><td align="left"><img src="https://cdn.rencheng.cc/blog/skrvs.jpg-thumb100"></td></tr></tbody></table><blockquote><p>超级复杂，需要移动端，Web，服务器；三端联调。预计3人两周到三周工作量。阅读英文文档，需要懂架构的人。<br>实际测试，也并没有100%全部跳转成功</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;微信内置浏览器已禁止使用外部url scheme跳转至其他app。&lt;br&gt;如何突破这一壁垒实现需求呢？&lt;/p&gt;</summary>
    
    
    
    
    <category term="技术调研" scheme="https://rencheng.cc/tags/%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/"/>
    
  </entry>
  
  <entry>
    <title>Python-监测iOS发布更新</title>
    <link href="https://rencheng.cc/2019/09/26/python/%E7%9B%91%E6%B5%8BiOS%E5%8F%91%E5%B8%83%E6%9B%B4%E6%96%B0/"/>
    <id>https://rencheng.cc/2019/09/26/python/%E7%9B%91%E6%B5%8BiOS%E5%8F%91%E5%B8%83%E6%9B%B4%E6%96%B0/</id>
    <published>2019-09-26T05:14:02.000Z</published>
    <updated>2019-09-26T05:14:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于发布版本之后，Appstore一直都没有更新，就写了个脚本。</p><span id="more"></span><p><strong>该脚本是需要所有信息更新完成才能触发</strong></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># xpath</span></span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="comment"># 延迟</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求最新版本数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">requestLastVersionData</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        header = &#123;<span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>&#125;</span><br><span class="line">        res = requests.get(<span class="string">&#x27;https://apps.apple.com/cn/app/id******&#x27;</span>, headers=header)</span><br><span class="line">        html = etree.HTML(res.text)</span><br><span class="line">        html_data = html.xpath(<span class="string">&quot;//p[@class=&#x27;l-column small-6 medium-12 whats-new__latest__version&#x27;]/text()&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> html_data[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 钉钉通知</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">robotNotice</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        header = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">        data = &#123;<span class="string">&quot;msgtype&quot;</span>:<span class="string">&quot;link&quot;</span>,<span class="string">&quot;link&quot;</span>:&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;已更新&quot;</span>,<span class="string">&quot;text&quot;</span>:<span class="string">&quot;已更新&quot;</span>,<span class="string">&quot;picUrl&quot;</span>:<span class="string">&quot;https://rencheng.cc/images/avatar.JPG&quot;</span>,<span class="string">&quot;messageUrl&quot;</span>:<span class="string">&quot;https://apps.apple.com/cn/app/id******&quot;</span>&#125;&#125;</span><br><span class="line">        requests.post(<span class="string">&#x27;https://oapi.dingtalk.com/robot/send?access_token=******&#x27;</span>, json=data, headers=header, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 死循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    version = requestLastVersionData()</span><br><span class="line">    <span class="keyword">if</span> version != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> version != <span class="string">&quot;版本 2.0.3&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;已更新&quot;</span>)</span><br><span class="line">            robotNotice()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;最新%s&quot;</span> % version)</span><br><span class="line">    sleep(<span class="number">10</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;由于发布版本之后，Appstore一直都没有更新，就写了个脚本。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="脚本" scheme="https://rencheng.cc/tags/%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>iOS-事故记录</title>
    <link href="https://rencheng.cc/2019/09/26/ios/record/%E4%B8%8A%E7%BA%BF%E4%BA%8B%E6%95%85%E8%AE%B0%E5%BD%9501/"/>
    <id>https://rencheng.cc/2019/09/26/ios/record/%E4%B8%8A%E7%BA%BF%E4%BA%8B%E6%95%85%E8%AE%B0%E5%BD%9501/</id>
    <published>2019-09-26T02:41:07.000Z</published>
    <updated>2019-09-26T02:41:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>2019-09-26 上线事故记录<br>已经发布版本，在AppStore迟迟迟迟迟迟没有看到。</p><span id="more"></span><h2 id="事故？"><a href="#事故？" class="headerlink" title="事故？"></a>事故？</h2><p>按照摘要描述的，这本不是一个事故，为什么叫事故呢？<br>由于此版本是强更版本，移动端，Web，后台，全部需要统一上线；最后其他端都上线了，就iOS没有更新，导致线上宕机25h20m，并且收到了很多差评。</p><h2 id="上线流程"><a href="#上线流程" class="headerlink" title="上线流程"></a>上线流程</h2><table><thead><tr><th align="left">时间</th><th align="left">操作</th></tr></thead><tbody><tr><td align="left">09:00</td><td align="left">发布停服更新公告</td></tr><tr><td align="left">10:00</td><td align="left">停服，导数据，代码合并Master上线</td></tr><tr><td align="left">10:10</td><td align="left">Web合并Master上线</td></tr><tr><td align="left">11:00</td><td align="left">释放Android包同时配置强更</td></tr><tr><td align="left">11:10</td><td align="left">iOS发布版本同时配置强更</td></tr><tr><td align="left">14:00</td><td align="left">开服</td></tr></tbody></table><p>按照这个流程，iOS这边只需要静悄悄的等待上线就好了，按照正常的时间，iOS这边是半个小时到2个小时，这个时间肯定是够够的。但是，就怕这个但是，我们等了25h20m。</p><h2 id="iOS操作流程"><a href="#iOS操作流程" class="headerlink" title="iOS操作流程"></a>iOS操作流程</h2><table><thead><tr><th align="left">时间</th><th align="left">操作状态</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">2019-09-22 22:39</td><td align="left">2.1.0准备提交</td><td align="left"></td></tr><tr><td align="left">2019-09-23 13:19</td><td align="left">提交审核</td><td align="left"></td></tr><tr><td align="left">2019-09-24 04:56</td><td align="left">正在审核</td><td align="left"></td></tr><tr><td align="left">2019-09-24 05:55</td><td align="left">等待开发人员发布</td><td align="left"></td></tr><tr><td align="left">2019-09-25 11:10</td><td align="left">发布此版本</td><td align="left"></td></tr><tr><td align="left">2019-09-25 16:43</td><td align="left">更改价格及发布地区</td><td align="left">刷新状态</td></tr><tr><td align="left">2019-09-25 18:15</td><td align="left">给Apple发邮件</td><td align="left"></td></tr><tr><td align="left">2019-09-26 10:00</td><td align="left">下架应用</td><td align="left">刷新状态</td></tr><tr><td align="left">2019-09-26 10:00</td><td align="left">发布版本</td><td align="left">刷新状态</td></tr><tr><td align="left">2019-09-26 10:36</td><td align="left">Apple回复邮件</td><td align="left">可供销售后，最多等待24小时</td></tr><tr><td align="left">2019-09-26 11:03</td><td align="left">2.1.1准备提交</td><td align="left">只为尝试提交让其刷新状态，并没有用</td></tr><tr><td align="left">2019-09-26 11:13</td><td align="left">Call Apple</td><td align="left">回复说我们重新上架，还要等最多24小时</td></tr><tr><td align="left">2019-09-26 12:14</td><td align="left">商店封面图更新</td><td align="left"></td></tr><tr><td align="left">2019-09-26 12:16</td><td align="left">商店可以刷到最新包</td><td align="left"></td></tr><tr><td align="left">2019-09-26 12:30</td><td align="left">商店文案更新</td><td align="left"></td></tr><tr><td align="left">2019-09-26 12:38</td><td align="left">发布上线通知</td><td align="left"></td></tr></tbody></table><p><strong>下面是Apple的邮件回复</strong><br><img src="https://cdn.rencheng.cc/blog/xcs2q.jpg"></p><h2 id="实时监测最新版本的脚本"><a href="#实时监测最新版本的脚本" class="headerlink" title="实时监测最新版本的脚本"></a>实时监测最新版本的脚本</h2><p><a href="https://rencheng.cc/2019/09/26/python/%E7%9B%91%E6%B5%8BiOS%E5%8F%91%E5%B8%83%E6%9B%B4%E6%96%B0/">监测iOS发布更新</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>优化上线流程，iOS和Android应该提前发布，然后再走后端上线流程。</p><blockquote><p>如果后台的流程后置的话，一定要保障其自动化部署和迁移脚本能够顺利进行。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;2019-09-26 上线事故记录&lt;br&gt;已经发布版本，在AppStore迟迟迟迟迟迟没有看到。&lt;/p&gt;</summary>
    
    
    
    <category term="事故记录" scheme="https://rencheng.cc/categories/%E4%BA%8B%E6%95%85%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-代理检测</title>
    <link href="https://rencheng.cc/2019/09/26/ios/objc/iOS-%E4%BB%A3%E7%90%86%E6%A3%80%E6%B5%8B/"/>
    <id>https://rencheng.cc/2019/09/26/ios/objc/iOS-%E4%BB%A3%E7%90%86%E6%A3%80%E6%B5%8B/</id>
    <published>2019-09-25T16:18:52.000Z</published>
    <updated>2019-09-25T16:18:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>当我们开发移动App时候，为了避免别人抓包，所以我们要有自己的检测机制</p><span id="more"></span><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 判断是否设置了代理</span></span><br><span class="line">- (<span class="type">BOOL</span>)checkProxySetting &#123;</span><br><span class="line">    <span class="comment">// 获取当前系统代理配置</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *proxySettings = (__bridge <span class="built_in">NSDictionary</span> *)(<span class="built_in">CFNetworkCopySystemProxySettings</span>());</span><br><span class="line">    <span class="comment">// 获取代理的信息 - url一般都填baidu</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;https://www.baidu.com&quot;</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *proxies = (__bridge <span class="built_in">NSArray</span> *)(<span class="built_in">CFNetworkCopyProxiesForURL</span>((__bridge <span class="built_in">CFURLRef</span>)(url), (__bridge <span class="built_in">CFDictionaryRef</span>)(proxySettings)));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (proxies.count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *proxyType = [proxies.firstObject objectForKey:(<span class="built_in">NSString</span> *)kCFProxyTypeKey];</span><br><span class="line">        <span class="keyword">if</span> (![proxyType isEqualToString:(__bridge <span class="built_in">NSString</span> *)kCFProxyTypeNone]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; proxies.count; i++) &#123;</span><br><span class="line">                <span class="built_in">NSDictionary</span> *settings = proxies[i];</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">NSLog</span>(<span class="string">@&quot;---------------代理配置---------------&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;host: %@&quot;</span>, [settings objectForKey:(<span class="built_in">NSString</span> *)kCFProxyHostNameKey]);</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;port: %@&quot;</span>, [settings objectForKey:(<span class="built_in">NSString</span> *)kCFProxyPortNumberKey]);</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;type: %@&quot;</span>, [settings objectForKey:(<span class="built_in">NSString</span> *)kCFProxyTypeKey]);</span><br><span class="line">                <span class="keyword">if</span> (i == proxies.count - <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">NSLog</span>(<span class="string">@&quot;-------------------------------------&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">NSLog</span>(<span class="string">@&quot;---------------------------&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;当我们开发移动App时候，为了避免别人抓包，所以我们要有自己的检测机制&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="Objc" scheme="https://rencheng.cc/tags/Objc/"/>
    
  </entry>
  
  <entry>
    <title>Python-脚本后台执行</title>
    <link href="https://rencheng.cc/2019/09/20/python/%E8%84%9A%E6%9C%AC%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C/"/>
    <id>https://rencheng.cc/2019/09/20/python/%E8%84%9A%E6%9C%AC%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C/</id>
    <published>2019-09-20T02:02:40.000Z</published>
    <updated>2019-09-20T02:02:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近被一款养成游戏感染了，为了不浪费我的时间，我抓了它的请求，写了个脚本自动养成；在Pycharm上面运行着好好的，但是我不能一直开着电脑吧，然后我就有一个需求，就是把脚本部署到服务器上，但是部署到服务器上，怎么能让他在后台执行呢？</p><span id="more"></span><h2 id="初级版"><a href="#初级版" class="headerlink" title="初级版"></a>初级版</h2><p>脚本后加<code>&amp;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ***.py &amp;</span><br></pre></td></tr></table></figure><blockquote><p><strong>此方法在ssh连接断开之后自动停止</strong><br>如果你想临时让他后台执行的话，这种方法很适合你</p></blockquote><h2 id="终极版"><a href="#终极版" class="headerlink" title="终极版"></a>终极版</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python ***.py &amp;</span><br></pre></td></tr></table></figure><p><strong>如何把<code>print</code>输入重定向到执行文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python -u myscript.py params1 &gt; nohup.out 2&gt;&amp;1 &amp; </span><br></pre></td></tr></table></figure><p>python的输出有缓冲，导致nohup.out不能够马上看到输出。加上<code>-u</code>参数得到解决</p><blockquote><p>这种方法就算退出登录也会执行</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近被一款养成游戏感染了，为了不浪费我的时间，我抓了它的请求，写了个脚本自动养成；在Pycharm上面运行着好好的，但是我不能一直开着电脑吧，然后我就有一个需求，就是把脚本部署到服务器上，但是部署到服务器上，怎么能让他在后台执行呢？&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python-logging</title>
    <link href="https://rencheng.cc/2019/09/18/python/logging/"/>
    <id>https://rencheng.cc/2019/09/18/python/logging/</id>
    <published>2019-09-18T08:56:33.000Z</published>
    <updated>2019-09-18T08:56:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>logging模块是Python内置的标准模块，主要用于输出运行日志，可以设置输出日志的等级、日志保存路径、日志文件回滚等</p><span id="more"></span><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul><li>可以通过设置不同的日志等级，在release版本中只输出重要信息，而不必显示大量的调试信息；</li><li>print将所有信息都输出到标准输出中，严重影响开发者从标准输出中查看其它数据；logging则可以由开发者决定将信息输出到什么地方，以及怎么输出；</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level = logging.INFO,<span class="built_in">format</span> = <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&quot;Start print log&quot;</span>)</span><br><span class="line">logger.debug(<span class="string">&quot;Do something&quot;</span>)</span><br><span class="line">logger.warning(<span class="string">&quot;Something maybe fail.&quot;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;Finish&quot;</span>)</span><br></pre></td></tr></table></figure><p>logging中可以选择很多消息级别，如debug、info、warning、error以及critical。通过赋予logger或者handler不同的级别，开发者就可以只输出错误信息到特定的记录文件，或者在调试时只记录调试信息。</p><h3 id="logging-basicConfig函数各参数："><a href="#logging-basicConfig函数各参数：" class="headerlink" title="logging.basicConfig函数各参数："></a>logging.basicConfig函数各参数：</h3><p>filename：指定日志文件名；<br>filemode：和file函数意义相同，指定日志文件的打开模式，’w’或者’a’；<br>format：指定输出的格式和内容，format可以输出很多有用的信息，</p><p>参数：作用</p><p>%(levelno)s：打印日志级别的数值<br>%(levelname)s：打印日志级别的名称<br>%(pathname)s：打印当前执行程序的路径，其实就是sys.argv[0]<br>%(filename)s：打印当前执行程序名<br>%(funcName)s：打印日志的当前函数<br>%(lineno)d：打印日志的当前行号<br>%(asctime)s：打印日志的时间<br>%(thread)d：打印线程ID<br>%(threadName)s：打印线程名称<br>%(process)d：打印进程ID<br>%(message)s：打印日志信息<br>datefmt：指定时间格式，同time.strftime()；</p><p>level：设置日志级别，默认为logging.WARNNING；</p><p>stream：指定将日志的输出流，可以指定输出到sys.stderr，sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略；</p><h2 id="将日志写入到文件"><a href="#将日志写入到文件" class="headerlink" title="将日志写入到文件"></a>将日志写入到文件</h2><h3 id="将日志写入到文件-1"><a href="#将日志写入到文件-1" class="headerlink" title="将日志写入到文件"></a>将日志写入到文件</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level = logging.INFO)</span><br><span class="line">handler = logging.FileHandler(<span class="string">&quot;log.txt&quot;</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&quot;Start print log&quot;</span>)</span><br><span class="line">logger.debug(<span class="string">&quot;Do something&quot;</span>)</span><br><span class="line">logger.warning(<span class="string">&quot;Something maybe fail.&quot;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;Finish&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="将日志同时输出到屏幕和日志文件"><a href="#将日志同时输出到屏幕和日志文件" class="headerlink" title="将日志同时输出到屏幕和日志文件"></a>将日志同时输出到屏幕和日志文件</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level = logging.INFO)</span><br><span class="line">handler = logging.FileHandler(<span class="string">&quot;log.txt&quot;</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">console = logging.StreamHandler()</span><br><span class="line">console.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">logger.addHandler(handler)</span><br><span class="line">logger.addHandler(console)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&quot;Start print log&quot;</span>)</span><br><span class="line">logger.debug(<span class="string">&quot;Do something&quot;</span>)</span><br><span class="line">logger.warning(<span class="string">&quot;Something maybe fail.&quot;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;Finish&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="日志回滚"><a href="#日志回滚" class="headerlink" title="日志回滚"></a>日志回滚</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> RotatingFileHandler</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level = logging.INFO)</span><br><span class="line"><span class="comment">#定义一个RotatingFileHandler，最多备份3个日志文件，每个日志文件最大1K</span></span><br><span class="line">rHandler = RotatingFileHandler(<span class="string">&quot;log.txt&quot;</span>,maxBytes = <span class="number">1</span>*<span class="number">1024</span>,backupCount = <span class="number">3</span>)</span><br><span class="line">rHandler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">rHandler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">console = logging.StreamHandler()</span><br><span class="line">console.setLevel(logging.INFO)</span><br><span class="line">console.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">logger.addHandler(rHandler)</span><br><span class="line">logger.addHandler(console)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&quot;Start print log&quot;</span>)</span><br><span class="line">logger.debug(<span class="string">&quot;Do something&quot;</span>)</span><br><span class="line">logger.warning(<span class="string">&quot;Something maybe fail.&quot;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;Finish&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;logging模块是Python内置的标准模块，主要用于输出运行日志，可以设置输出日志的等级、日志保存路径、日志文件回滚等&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python-日期时间</title>
    <link href="https://rencheng.cc/2019/09/18/python/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4/"/>
    <id>https://rencheng.cc/2019/09/18/python/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4/</id>
    <published>2019-09-18T02:31:00.000Z</published>
    <updated>2019-09-18T02:31:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Python 程序能用很多方式处理日期和时间，转换日期格式是一个常见的功能。<br>Python 提供了一个<code>time</code>和<code>calendar</code>模块可以用于格式化日期和时间。<br>时间间隔是以秒为单位的浮点小数。<br>每个时间戳都以自从1970年1月1日午夜（历元）经过了多长时间来表示。</p><span id="more"></span><p>Python 的 time 模块下有很多函数可以转换常见日期格式。如函数<code>time.time()</code>用于获取当前时间戳, 如下实例:</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="built_in">print</span>(time.time())</span><br></pre></td></tr></table></figure><blockquote><p>时间戳单位最适于做日期运算。但是1970年之前的日期就无法以此表示了。太遥远的日期也不行，UNIX和Windows只支持到2038年。</p></blockquote><h2 id="获取当前时间戳"><a href="#获取当前时间戳" class="headerlink" title="获取当前时间戳"></a>获取当前时间戳</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.time()</span><br></pre></td></tr></table></figure><h2 id="格式化日期"><a href="#格式化日期" class="headerlink" title="格式化日期"></a>格式化日期</h2><p>由于我们获取的时间是距离1970年的时间戳，我们要转换成我们想要的格式，比如2018-09-10 08:09:00;也有将日期时间转换成时间戳</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化成2018-09-10 08:09:00形式</span></span><br><span class="line"><span class="built_in">print</span>(time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化成Sat Sep 10 08:09:00 2018形式</span></span><br><span class="line"><span class="built_in">print</span> (time.strftime(<span class="string">&quot;%a %b %d %H:%M:%S %Y&quot;</span>, time.localtime()))</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 将格式字符串转换为时间戳</span></span><br><span class="line">a = <span class="string">&quot;Sat Mar 28 22:24:24 2016&quot;</span></span><br><span class="line"><span class="built_in">print</span> (time.mktime(time.strptime(a,<span class="string">&quot;%a %b %d %H:%M:%S %Y&quot;</span>)))</span><br></pre></td></tr></table></figure><p><strong>python中时间日期格式化符号</strong></p><table><thead><tr><th align="left">符号</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">%y</td><td align="left">两位数的年份表示（00-99）</td></tr><tr><td align="left">%Y</td><td align="left">四位数的年份表示（000-9999）</td></tr><tr><td align="left">%m</td><td align="left">月份（01-12）</td></tr><tr><td align="left">%d</td><td align="left">月内中的一天（0-31）</td></tr><tr><td align="left">%H</td><td align="left">24小时制小时数（0-23）</td></tr><tr><td align="left">%I</td><td align="left">12小时制小时数（01-12）</td></tr><tr><td align="left">%Mv</td><td align="left">分钟数（00=59）</td></tr><tr><td align="left">%S</td><td align="left">秒（00-59）</td></tr><tr><td align="left">%a</td><td align="left">本地简化星期名称</td></tr><tr><td align="left">%A</td><td align="left">本地完整星期名称</td></tr><tr><td align="left">%b</td><td align="left">本地简化的月份名称</td></tr><tr><td align="left">%B</td><td align="left">本地完整的月份名称</td></tr><tr><td align="left">%c</td><td align="left">本地相应的日期表示和时间表示</td></tr><tr><td align="left">%j</td><td align="left">年内的一天（001-366）</td></tr><tr><td align="left">%p</td><td align="left">本地A.M.或P.M.的等价符</td></tr><tr><td align="left">%U</td><td align="left">一年中的星期数（00-53）星期天为星期的开始</td></tr><tr><td align="left">%w</td><td align="left">星期（0-6），星期天为星期的开始</td></tr><tr><td align="left">%W</td><td align="left">一年中的星期数（00-53）星期一为星期的开始</td></tr><tr><td align="left">%x</td><td align="left">本地相应的日期表示</td></tr><tr><td align="left">%X</td><td align="left">本地相应的时间表示</td></tr><tr><td align="left">%Z</td><td align="left">当前时区的名称</td></tr><tr><td align="left">%%</td><td align="left">%号本身</td></tr></tbody></table><h2 id="程序耗时检测方法"><a href="#程序耗时检测方法" class="headerlink" title="程序耗时检测方法"></a>程序耗时检测方法</h2><p>由于CPU调度问题，我们使用<code>time.time()</code>方法不是特别准确，Python为我们提供了更加准确的方法</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ime.perf_counter()  <span class="comment"># 返回系统运行时间</span></span><br><span class="line">time.process_time()  <span class="comment"># 返回进程运行时间</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Python 程序能用很多方式处理日期和时间，转换日期格式是一个常见的功能。&lt;br&gt;Python 提供了一个&lt;code&gt;time&lt;/code&gt;和&lt;code&gt;calendar&lt;/code&gt;模块可以用于格式化日期和时间。&lt;br&gt;时间间隔是以秒为单位的浮点小数。&lt;br&gt;每个时间戳都以自从1970年1月1日午夜（历元）经过了多长时间来表示。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>iOS-三方库</title>
    <link href="https://rencheng.cc/2019/09/14/ios/general/%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93/"/>
    <id>https://rencheng.cc/2019/09/14/ios/general/%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93/</id>
    <published>2019-09-14T08:27:51.000Z</published>
    <updated>2019-09-14T08:27:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>列出用过比较好用的三方库，以达成最佳实践</p><span id="more"></span><table><thead><tr><th align="left">类别</th><th align="left">Objective-c</th><th align="left">Swift</th></tr></thead><tbody><tr><td align="left">网络请求库</td><td align="left"><a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a></br><a href="https://github.com/yuantiku/YTKNetwork">YTKNetwork</a></td><td align="left"><a href="https://github.com/Alamofire/Alamofire">Alamofire</a></br><a href="https://github.com/Moya/Moya">Moya</a></td></tr><tr><td align="left">图片异步加载</td><td align="left"><a href="https://sdwebimage.github.io/">SDWebImage</a></td><td align="left"><a href="https://github.com/onevcat/Kingfisher">Kingfisher</a>（喵神）</td></tr><tr><td align="left">刷新控件</td><td align="left"><a href="https://github.com/CoderMJLee/MJRefresh">MJRefresh</a>(MJ)</td><td align="left"></td></tr><tr><td align="left">布局约束</td><td align="left"><a href="https://github.com/SnapKit/Masonry">Masonry</a></td><td align="left"><a href="http://snapkit.io/">SnapKit</a></td></tr><tr><td align="left">JSON 解析</td><td align="left"><a href="https://github.com/ibireme/YYModel">YYModel</a>（郭耀源）(最高效)</br><a href="https://github.com/CoderMJLee/MJExtension">MJExtention</a>（MJ）</td><td align="left"><a href="https://www.cnblogs.com/mjios/p/11352776.html">KakaJSON</a>（MJ）</br><a href="https://github.com/alibaba/HandyJSON">HandyJson</a>（Alibaba）</br><a href="https://github.com/SwiftyJSON/SwiftyJSON">SwiftyJSON</a></td></tr><tr><td align="left">基础库</td><td align="left"><a href="https://github.com/ibireme/YYKit">YYKit</a>（郭耀源）</td><td align="left"></td></tr><tr><td align="left">播放器</td><td align="left"><a href="https://github.com/renzifeng/ZFPlayer">ZFPlayer</a>（任子峰）</td><td align="left"><a href="https://github.com/BrikerMan/BMPlayer">BMPlayer</a>（模仿ZF）</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;列出用过比较好用的三方库，以达成最佳实践&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="Objc" scheme="https://rencheng.cc/tags/Objc/"/>
    
  </entry>
  
  <entry>
    <title>iOS中级面试题</title>
    <link href="https://rencheng.cc/2019/09/02/ios/general/iOS%E4%B8%AD%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>https://rencheng.cc/2019/09/02/ios/general/iOS%E4%B8%AD%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%A2%98/</id>
    <published>2019-09-02T11:44:59.000Z</published>
    <updated>2019-09-02T11:44:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>基础面试提纲</p><ul><li><input checked="" disabled="" type="checkbox"> 应用程序生命周期</li></ul><span id="more"></span><ol><li>应用程序生命周期发生变化时，是先触发UIAppDelegate内的方法还是本地通知？<br> 答：系统会先回调相应的方法，待回调方法执行后，再发送相应的通知</li><li></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;基础面试提纲&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 应用程序生命周期&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Python-csv模块</title>
    <link href="https://rencheng.cc/2019/08/31/python/csv%E6%A8%A1%E5%9D%97/"/>
    <id>https://rencheng.cc/2019/08/31/python/csv%E6%A8%A1%E5%9D%97/</id>
    <published>2019-08-31T13:37:18.000Z</published>
    <updated>2019-08-31T13:37:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>在Python中，csv文件的存取操作</p><span id="more"></span><h2 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、导入模块</span><br><span class="line">2、打开csv文件</span><br><span class="line">3、初始化写入对象</span><br><span class="line">4、写入数据(参数为列表)</span><br></pre></td></tr></table></figure><h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单行写入（writerow([]))</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f)</span><br><span class="line">    writer.writerow([<span class="string">&#x27;白眉鹰王&#x27;</span>,<span class="string">&#x27;43&#x27;</span>])</span><br><span class="line">    writer.writerow([<span class="string">&#x27;金毛狮王&#x27;</span>,<span class="string">&#x27;45&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多行写入(writerows([(),(),()]</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f)</span><br><span class="line">    writer.writerows([(<span class="string">&#x27;王源&#x27;</span>,<span class="string">&#x27;18&#x27;</span>),(<span class="string">&#x27;易烊千玺&#x27;</span>,<span class="string">&#x27;20&#x27;</span>),(<span class="string">&#x27;王俊凯&#x27;</span>,<span class="string">&#x27;19&#x27;</span>)])</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;在Python中，csv文件的存取操作&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="持久化" scheme="https://rencheng.cc/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>iOS底层面试题</title>
    <link href="https://rencheng.cc/2019/08/28/ios/general/iOS%E5%BA%95%E5%B1%82%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>https://rencheng.cc/2019/08/28/ios/general/iOS%E5%BA%95%E5%B1%82%E9%9D%A2%E8%AF%95%E9%A2%98/</id>
    <published>2019-08-28T01:55:40.000Z</published>
    <updated>2019-08-28T01:55:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>底层面试概要</p><ul><li><input checked="" disabled="" type="checkbox"> 对象的本质</li><li><input checked="" disabled="" type="checkbox"> Category</li><li><input disabled="" type="checkbox"> Block</li><li><input disabled="" type="checkbox"> Runtime</li><li><input checked="" disabled="" type="checkbox"> RunLoop</li><li><input checked="" disabled="" type="checkbox"> 多线程</li><li><input checked="" disabled="" type="checkbox"> 内存管理</li><li><input disabled="" type="checkbox"> 性能优化<span id="more"></span></li></ul><h2 id="对象的本质"><a href="#对象的本质" class="headerlink" title="对象的本质"></a>对象的本质</h2><h3 id="Objective-C对象的本质"><a href="#Objective-C对象的本质" class="headerlink" title="Objective-C对象的本质"></a>Objective-C对象的本质</h3><ol><li>一个NSObject对象占用多少内存<br> 系统分配了16个字节；64位环境下，NSObject内部只使用了8个字节（64位环境下）存储isa。</li><li>对象的isa指向哪里？<br> instance对象的isa-&gt;类对象<br> 类对象的isa-&gt;metaClass对象<br> metaClass对象的isa-&gt;基类的metaClass对象<br> 基类的metaClass对象-&gt;基类的metaClass对象</li><li>OC的类信息存放在哪里？<br> 实例对象的方法，属性，成员变量，协议存在类对象中<br> 类对象的方法存在元类对象中</li></ol><h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><ol><li>Category的实现原理<ul><li>Category编译之后，底层结构是struct category_t，里面存储着分类的对象方法，类方法，属性，协议信息</li><li>在程序运行的时候，Runtime会将Category的数据，合并到类信息中（类对象，元类对象）</li></ul></li><li>Category和Extension的区别？<ul><li>Extension发生在编译的时候，他的信息已经包含在类信息中</li><li>Category是在运行时，将信息同步到类信息中</li></ul></li><li>Category中有load方法吗？load方法什么时候调用？能继承吗？<ul><li>有load方法</li><li>load方法是在Runtime加载类/分类的时候调用（静态调用-函数地址调用）。</li><li>load方法可以继承，但是开发中强烈不建议主动调用load方法</li></ul></li><li>load和initialize方法的区别是什么？<ul><li>调用方式：load是函数地址直接调用；initialize是通过objc_msgSend调用</li><li>调用时机：load方法是程序启动Runtime加载类/分类的时候调用；initialize是该类第一次收到消息的时候调用。</li><li>调用次数：load方法，一般系统自动执行，每个类只会执行一次。initialize如果子类没有实现，会调用父类的initialize，所以initialize会调用多次。</li></ul></li><li>他们在Category中的调用顺序？以及出现继承时他们之间的调用过程？<ul><li>load：先调用类的load，按照编译顺序加载，但是如果有父类，先处理父类（递归）；其次再调用分类的load，按照编译的顺序加载。</li><li>initialize：调用子类的+initialize前，先调用父类+initialize（递归）</li></ul></li><li>Category能否添加成员变量？如果可以，如何给Category添加成员变量<ul><li>可以，通过关联对象添加。</li></ul></li></ol><h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><ol><li>block原理是怎样的？本质是什么？<ul><li>block是封装<code>函数</code>及其<code>上下文</code>的<code>OC对象</code></li><li></li></ul></li><li>__block的作用是什么？有什么使用注意点？<ul><li>编译器会将__block修饰的变量封装成对象，解决block可以修改auto变量</li><li>MRC环境，block不会对修饰的OC对象产生强引用</li></ul></li><li>block的属性修饰词为什么是copy？使用block有哪些注意点？<ul><li>如果block不进行copy操作，就不会在堆上。就无法控制block生命周期</li><li>注意点：循环引用的问题</li></ul></li><li>block修改NSMutableArray内部数据的时候，需不需要加__block？<ul><li>不需要</li></ul></li></ol><h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><ol><li><p>如果需要交换UIControl的didMoveToSuperview方法，用于捕获控件的点击事件，需要的注意点是什么？</p><ul><li>由于didMoveToSuperview方法是UIView的方法，UIControl继承自UIView，所以在方法交换之后，UIView及继承UIView的子类，都需要增加交换的方法，否则会因为找不到方法而崩溃</li></ul></li><li><p>讲一下OC的消息机制</p><ul><li>OC的方法调用都是转换成<code>objc_msgSend</code>函数调用，给<code>receiver</code>方法调用者发送一个消息<code>@selector方法名</code></li><li><code>objc_msgSend</code>底层有3大阶段<ul><li>消息发送</li><li>动态方法解析</li><li>消息转发</li></ul></li></ul></li><li><p>消息转发机制流程</p><ul><li><code>forwardTargetForSelector</code> 返回target对象</li><li><code>methodSignatureForSelector</code> 返回方法签名；如果返回签名不为空，进行第3步</li><li><code>forwardInvocation:</code> 参数传入一个方法调用对象，可以自定义调用机制 </li></ul></li><li><p>什么是Runtime？平时项目中有用过吗？<br> * </p></li></ol><h2 id="RunLoop"><a href="#RunLoop" class="headerlink" title="RunLoop"></a>RunLoop</h2><ol><li><p>讲讲 RunLoop，项目中有用到吗？</p><ul><li>定时器（Timer）、PerformSelector</li><li>GCD Async Main Queue</li><li>事件响应、手势识别、界面刷新</li><li>网络请求</li><li>AutoreleasePool</li></ul></li><li><p>RunLoop的基本作用</p><ul><li>保持程序的持续运行</li><li>处理App中的各种事件（比如触摸事件、定时器事件等）</li><li>节省CPU资源，提高程序性能：该做事时做事，该休息时休息</li></ul></li><li><p>Runloop内部实现逻辑？</p><ol><li>通知Observers：进入Loop</li><li>通知Observers：即将处理Timers</li><li>通知Observers：即将处理Sources</li><li>处理Blocks</li><li>处理Source0（可能会再次处理Blocks）</li><li>如果存在Source1，就跳转到第8步</li><li>通知Observers：开始休眠（等待消息唤醒）</li><li>通知Observers：结束休眠（被某个消息唤醒）<ol><li>处理Timer</li><li>处理GCD Async To Main Queue</li><li>处理Source1</li></ol></li><li>处理Blocks</li><li>根据前面的执行结果，决定如何操作<ol><li>回到第02步</li><li>退出Loop</li></ol></li><li>通知Observers：退出Loop</li></ol></li><li><p>Runloop和线程的关系？</p><ul><li>每条线程都有唯一的一个与之对应的RunLoop对象</li><li><code>RunLoop</code>保存在一个全局的Dictionary里，线程作为key，<code>RunLoop</code>作为value;{thread: Runloop}</li><li>线程刚创建时并没有RunLoop对象，RunLoop会在第一次获取它时创建</li><li><code>RunLoop</code>会在线程结束时销毁</li><li>主线程的<code>RunLoop</code>已经自动获取（创建），子线程默认没有开启<code>RunLoop</code></li></ul></li><li><p>Timer 与 Runloop 的关系？</p><ul><li>结构上来说：Timer里面有模式，模式里面有Timer</li><li>流程上来说：Timer是在Runloop运行流程中工作的</li></ul></li><li><p>程序中添加每3秒响应一次的NSTimer，当拖动tableview时timer可能无法响应要怎么解决？</p><ul><li>将Timer添加到Runloop的CommonMode里</li></ul></li><li><p>runloop 是怎么响应用户操作的， 具体流程是什么样的？</p><ol><li>Source1来捕获系统事件</li><li>Source1把事件包装成事件队列（EventQueue）</li><li>Source0处理事件队列</li></ol></li><li><p>说说runLoop的几种状态</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Run Loop Observer Activities */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">CF_OPTIONS</span><span class="params">(CFOptionFlags, CFRunLoopActivity)</span> &#123;</span><br><span class="line">    kCFRunLoopEntry = (<span class="number">1UL</span> &lt;&lt; <span class="number">0</span>),           <span class="comment">// 即将进入Loop</span></span><br><span class="line">    kCFRunLoopBeforeTimers = (<span class="number">1UL</span> &lt;&lt; <span class="number">1</span>),    <span class="comment">// 即将处理Timer</span></span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1UL</span> &lt;&lt; <span class="number">2</span>),   <span class="comment">// 即将处理Source</span></span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1UL</span> &lt;&lt; <span class="number">5</span>),   <span class="comment">// 即将进入休眠</span></span><br><span class="line">    kCFRunLoopAfterWaiting = (<span class="number">1UL</span> &lt;&lt; <span class="number">6</span>),    <span class="comment">// 刚从休眠中唤醒</span></span><br><span class="line">    kCFRunLoopExit = (<span class="number">1UL</span> &lt;&lt; <span class="number">7</span>),            <span class="comment">// 即将推出Loop</span></span><br><span class="line">    kCFRunLoopAllActivities = <span class="number">0x0FFFFFFF</span>U</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>runloop的mode作用是什么？</p><ul><li>kCFRunLoopDefaultMode（NSDefaultRunLoopMode）：App的默认Mode，通常主线程是在这个Mode下运行</li><li>UITrackingRunLoopMode：界面跟踪 Mode，用于 ScrollView 追踪触摸滑动，保证界面滑动时不受其他 Mode 影响</li></ul></li></ol><h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><ol><li><p>你理解的多线程？</p></li><li><p>iOS的多线程方案有哪几种？你更倾向于哪一种？<br> <code>pthread</code>    <code>NSThread</code> <code>GCD</code> <code>NSOperation</code><br> 更倾向于GCD；但是也要看场景</p></li><li><p>GCD 的队列类型<br> <code>同步队列``并发队列</code></p></li><li><p>说一下 OperationQueue 和 GCD 的区别，以及各自的优势<br> <code>Operation Queue</code> 是基于<code>GCD</code>封装的抽象类，目的是为了提高灵活度，以满足多线程操作频繁、灵活度要求高的复杂场景。</p></li><li><p>线程安全的处理手段有哪些？<br> <code>加锁</code>，<code>GCD同步队列</code>，<code>信号量</code>等</p></li><li><p>OC你了解的锁有哪些？在你回答基础上进行二次提问；自旋和互斥对比？使用以上锁需要注意哪些？<br> <a href="https://rencheng.cc/2018/06/18/ios/objc/OC-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#%E9%94%81">路由地址</a></p></li><li><p>以下代码是在主线程执行的，会不会产生死锁？</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    [<span class="keyword">self</span> test];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)test &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;执行任务1&quot;</span>);</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;执行任务2&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;执行任务3&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p> 答：会产生死锁，因为<code>viewDidLoad</code>方法就是在主线程(主队列)中进行的，而<code>line-9</code>仍然想让代码块 <strong>立即</strong> 在主线程(主队列)中同步执行。</p></li><li><p>问下面代码的打印结果是什么？</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1&quot;</span>);</span><br><span class="line">        [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) withObject:<span class="literal">nil</span> afterDelay:<span class="number">.0</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;3&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)test &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 答：打印结果是：1, 3。<br> 原因：<code>performSelector:withObject:afterDelay:</code>的本质是往Runloop中添加定时器，子线程默认没有启动<code>Runloop</code>。解决方法：在<code>line-8</code>后插入</p> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[[NSRunLoop currentRunLoop] addPort:[NSPort new] forMode:NSDefaultRunLoopMode];</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] runMode:<span class="built_in">NSDefaultRunLoopMode</span> beforeDate:[<span class="built_in">NSDate</span> distantFuture]];</span><br></pre></td></tr></table></figure></li><li><p>请问下面代码的打印结果是什么？</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSThread</span> *thread = [[<span class="built_in">NSThread</span> alloc] initWithBlock:^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;1&quot;</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    [thread start];</span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="type">void</span>)test &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>答：只会打印1。因为在调用test的时候，线程已经销毁了。会报错<code>target thread exited while waiting for the perform</code></p></li></ol><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><ol><li><p>使用CADisplayLink、NSTimer有什么注意点？<br> <code>CADisplayLink</code>、<code>NSTimer</code>会对<code>target</code>产生强引用，如果<code>target</code>又对它们产生强引用，那么就会引发循环引用。解决方案：1：使用Block处理。2.使用代理对象<code>NSProxy</code></p></li><li><p>介绍下内存的几大区域</p><ul><li>代码段：编译之后的代码</li><li>数据段<ul><li>字符串常量：比如NSString *str = @”123”</li><li>已初始化数据：已初始化的全局变量、静态变量等</li><li>未初始化数据：未初始化的全局变量、静态变量等</li></ul></li><li>栈：函数调用开销，比如局部变量。分配的内存空间地址越来越小</li><li>堆：通过alloc、malloc、calloc等动态分配的空间，分配的内存空间地址越来越大</li></ul></li><li><p>讲一下你对 iOS 内存管理的理解</p></li><li><p>ARC 都帮我们做了什么？<br> 答：LLVM+Runtime相互协作；ARC利用LLVM编译器，自动帮我们生成release，retain，autorelease代码。像弱引用会在运行时做操作。</p></li><li><p>weak指针的实现原理<br> 答：将弱引用存到哈希表里面，对象将要销毁的时候，取出弱引用表，将指向当前对象的弱指针置为nil。</p></li><li><p>autorelease对象在什么时机会被调用release</p></li><li><p>方法里有局部对象， 出了方法后会立即释放吗</p></li></ol><ol><li>一下两段代码能发生什么事？有什么区别？ <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;abcdefghijklmn&quot;</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;abc&quot;</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 答：上面一段执行，会出现坏内存的崩溃。下面一段代码name变量存储的是<code>Tagged Pointer</code>，涉及不到对象的内存管理，而上面一段代码因为多线程操作一个对象，有可能会造成对象的过度释放，导致崩溃。</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;底层面试概要&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 对象的本质&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Category&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Block&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; Runtime&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; RunLoop&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 多线程&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 内存管理&lt;/li&gt;
&lt;li&gt;&lt;input disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 性能优化</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>window-软件推荐</title>
    <link href="https://rencheng.cc/2019/08/26/recommend/window-%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/"/>
    <id>https://rencheng.cc/2019/08/26/recommend/window-%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/</id>
    <published>2019-08-26T02:36:55.000Z</published>
    <updated>2019-08-26T02:36:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>Windows软件推荐（服务器运维）（包含下载地址）</p><span id="more"></span><table><thead><tr><th>名称</th><th>描述</th><th>下载地址</th></tr></thead><tbody><tr><td>Fiddler</td><td>抓包工具-配合谷歌插件<code>Proxy-SwitchyOmega</code></td><td><a href="https://object.rencheng.cc/software/windows/Fiddler_5.0.20173.49666_Setup.rar">博主</a></td></tr><tr><td>Finder证书信任</td><td>抓包失败，可能是证书没有被信任</td><td><a href="https://object.rencheng.cc/software/windows/Fiddler%E6%B7%BB%E5%8A%A0%E8%AF%81%E4%B9%A6%E4%BF%A1%E4%BB%BB%E7%9A%84%E6%96%B9%E6%B3%95.zip">博主</a></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;Windows软件推荐（服务器运维）（包含下载地址）&lt;/p&gt;</summary>
    
    
    
    
    <category term="推荐" scheme="https://rencheng.cc/tags/%E6%8E%A8%E8%8D%90/"/>
    
  </entry>
  
  <entry>
    <title>Python-tqdm</title>
    <link href="https://rencheng.cc/2019/08/22/python/tqdm/"/>
    <id>https://rencheng.cc/2019/08/22/python/tqdm/</id>
    <published>2019-08-22T06:56:33.000Z</published>
    <updated>2019-08-22T06:56:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>Tqdm进度条库让你的python进度可视化。<br>Tqdm在阿拉伯语表示进步，在西班牙语中表示我非常爱你。是一个快速，可扩展的Python进度条，可以在Python长循环中添加一个进度提示信息，用户只需要封装任意的迭代器tqdm(iterator)即可完成进度条。相比ProgressBar来说Tqdm的开销非常低，同时Tqdm可以在任何环境中不需要任何依赖运行。</p><span id="more"></span><h2 id="tqdm安装"><a href="#tqdm安装" class="headerlink" title="tqdm安装"></a>tqdm安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install tqdm</span><br><span class="line">或</span><br><span class="line">conda install -c conda-forge tqdm</span><br></pre></td></tr></table></figure><h2 id="tqdm用法"><a href="#tqdm用法" class="headerlink" title="tqdm用法"></a>tqdm用法</h2><p>tqdm是非常通用的，并且可以以多种方式使用。</p><h3 id="基于可迭代"><a href="#基于可迭代" class="headerlink" title="基于可迭代"></a>基于可迭代</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import tqdm</span><br><span class="line">pbar = tqdm([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;])</span><br><span class="line">for char in pbar:</span><br><span class="line">    pbar.set_description(&quot;Processing %s&quot; % char)</span><br></pre></td></tr></table></figure><h3 id="手册"><a href="#手册" class="headerlink" title="手册"></a>手册</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">with tqdm(total=100) as pbar:</span><br><span class="line">    for i in range(10):</span><br><span class="line">        pbar.update(10)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/tqdm/tqdm/master/images/tqdm.gif"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Tqdm进度条库让你的python进度可视化。&lt;br&gt;Tqdm在阿拉伯语表示进步，在西班牙语中表示我非常爱你。是一个快速，可扩展的Python进度条，可以在Python长循环中添加一个进度提示信息，用户只需要封装任意的迭代器tqdm(iterator)即可完成进度条。相比ProgressBar来说Tqdm的开销非常低，同时Tqdm可以在任何环境中不需要任何依赖运行。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Python-正则（regex）</title>
    <link href="https://rencheng.cc/2019/08/12/python/%E6%AD%A3%E5%88%99/"/>
    <id>https://rencheng.cc/2019/08/12/python/%E6%AD%A3%E5%88%99/</id>
    <published>2019-08-12T01:53:18.000Z</published>
    <updated>2019-08-12T01:53:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>即文本的高级匹配模式，提供搜索，替代等功能。其本质是一系列由特殊符号组成的字串，这个字串即正则表达式。<br>由普通字符和特殊符号组成字符串，通过描述字符的重复和位置等行为，达到匹配某一类字符串的目的</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h3><ol><li>文本处理已经成为计算机的常见工作之一</li><li>对文本内容的搜索，定位，提取是逻辑比较复杂的工作</li><li>为了快速解决上述问题，产生了正则表达式技术</li></ol><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>即文本的高级匹配模式，提供搜索，替代等功能。其本质是一系列由特殊符号组成的字串，这个字串即正则表达式。</p><h3 id="匹配原理"><a href="#匹配原理" class="headerlink" title="匹配原理"></a>匹配原理</h3><p>由普通字符和特殊符号组成字符串，通过描述字符的重复和位置等行为，达到匹配某一类字符串的目的</p><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ol><li>熟练掌握正则表达式符号</li><li>实现基本的文本搜索，定位，提取，理解正则用法</li><li>能够适用re模块操作正则表达式</li></ol><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>方便文本处理</li><li>支持语言众多</li><li>使用灵活多样</li></ul><h2 id="基础实践"><a href="#基础实践" class="headerlink" title="基础实践"></a>基础实践</h2><h3 id="re模块简单实用"><a href="#re模块简单实用" class="headerlink" title="re模块简单实用"></a>re模块简单实用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.findall(pattern, string)</span><br></pre></td></tr></table></figure><p>功能: 使用正则表达式匹配目标字符串内容<br>参数</p><ul><li>pattern  正则表达式</li><li>string   目标字符串<br>返回值： 列表，列表中为匹配到的内容</li></ul><h3 id="元字符的使用"><a href="#元字符的使用" class="headerlink" title="元字符的使用"></a>元字符的使用</h3><h4 id="普通字符"><a href="#普通字符" class="headerlink" title="普通字符"></a>普通字符</h4><p><strong>元字符</strong> ： <code>a</code>  <code>b</code>   <code>c</code><br><strong>匹配规则</strong>： 每个字符匹配对应的字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;hello&quot;,&quot;hello world&quot;)</span><br><span class="line">[&#x27;hello&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;你好&quot;,&quot;你好北京&quot;)</span><br><span class="line">[&#x27;你好&#x27;]</span><br></pre></td></tr></table></figure><h4 id="或"><a href="#或" class="headerlink" title="或"></a>或</h4><p><strong>元字符</strong>：  <code>|</code><br><strong>匹配规则</strong>： 匹配 | 两边任意一个正则表达式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;ab|cd&quot;,&quot;abcdefghialkjasbab&quot;)</span><br><span class="line">[&#x27;ab&#x27;, &#x27;cd&#x27;, &#x27;ab&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配单个字符"><a href="#匹配单个字符" class="headerlink" title="匹配单个字符"></a>匹配单个字符</h4><p><strong>元字符</strong>：  <code>.</code><br><strong>匹配规则</strong>： 匹配除换行外的任意字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f.o --&gt; foo  fao  f@o  f o</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;f.o&quot;,&quot;foo is not fao&quot;)</span><br><span class="line">[&#x27;foo&#x27;, &#x27;fao&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配开始位置"><a href="#匹配开始位置" class="headerlink" title="匹配开始位置"></a>匹配开始位置</h4><p><strong>元字符</strong> ： <code>^</code><br><strong>匹配规则</strong>：匹配目标字符串的开头位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;^Tom&quot;,&quot;Tom is a boy&quot;)</span><br><span class="line">[&#x27;Tom&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配结束位置"><a href="#匹配结束位置" class="headerlink" title="匹配结束位置"></a>匹配结束位置</h4><p><strong>元字符</strong> ： <code>$</code><br><strong>匹配规则</strong> ： 匹配字符串的结束位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;Tom$&quot;,&quot;hi Tom&quot;)</span><br><span class="line">[&#x27;Tom&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配重复"><a href="#匹配重复" class="headerlink" title="匹配重复 *"></a>匹配重复 *</h4><p><strong>元字符</strong> ： <code>*</code><br><strong>匹配规则</strong>： 匹配前面的字符出现0次或多次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fo*  --&gt; fooooooooo  f  fo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;fo*&quot;,&quot;fadsfafoooafo&quot;)</span><br><span class="line">[&#x27;f&#x27;, &#x27;f&#x27;, &#x27;fooo&#x27;, &#x27;fo&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配重复-1"><a href="#匹配重复-1" class="headerlink" title="匹配重复 +"></a>匹配重复 +</h4><p><strong>元字符</strong> ： <code>+</code><br><strong>匹配规则</strong>： 匹配前面的字符出现1次或多次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fo+  --&gt; fo   fooooo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;fo+&quot;,&quot;fadsfafoooafo&quot;)</span><br><span class="line">[&#x27;fooo&#x27;, &#x27;fo&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配重复-？"><a href="#匹配重复-？" class="headerlink" title="匹配重复 ？"></a>匹配重复 ？</h4><p><strong>元字符</strong> ： <code>?</code><br><strong>匹配规则</strong>： 匹配前面的字符出现0次或1次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fo? --&gt;  f   fo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;fo?&quot;,&quot;fasdffoafooooo&quot;)</span><br><span class="line">[&#x27;f&#x27;, &#x27;f&#x27;, &#x27;fo&#x27;, &#x27;fo&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配重复-n"><a href="#匹配重复-n" class="headerlink" title="匹配重复 {n}"></a>匹配重复 {n}</h4><p><strong>元字符</strong> ： <code>&#123;n&#125;</code><br><strong>匹配规则</strong>： 匹配指定的重复次数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fo&#123;3&#125;  --&gt; fooo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;fo&#123;2&#125;&quot;,&quot;fasdffoafooooo&quot;)</span><br><span class="line">[&#x27;foo&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配重复-m-n"><a href="#匹配重复-m-n" class="headerlink" title="匹配重复 {m,n}"></a>匹配重复 {m,n}</h4><p><strong>元字符</strong> ： <code>&#123;m,n&#125;</code><br><strong>匹配规则</strong> ： 匹配前面的正则表达式 m–n次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fo&#123;2,4&#125; --&gt; foo  fooo  foooo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;fo&#123;2,4&#125;&quot;,&quot;fasdfofoooafooooo&quot;)</span><br><span class="line">[&#x27;fooo&#x27;, &#x27;foooo&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配字符集合"><a href="#匹配字符集合" class="headerlink" title="匹配字符集合"></a>匹配字符集合</h4><p><strong>元字符</strong>： <code>[字符集]</code><br><strong>匹配规则</strong> ： 匹配任意一个字符集中的字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[abc123]   a  b  c  1  2  3 </span><br><span class="line">[a-z]  </span><br><span class="line">[A-Z]</span><br><span class="line">[0-9]</span><br><span class="line">[_123a-z]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;^[A-Z][a-z]*&quot;,&quot;Boy&quot;)</span><br><span class="line">[&#x27;Boy&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配字符集"><a href="#匹配字符集" class="headerlink" title="匹配字符集"></a>匹配字符集</h4><p><strong>元字符</strong> ： <code>[^...]</code><br><strong>匹配规则</strong> ：字符集取非，除列出的字符之外任意一个字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[^abc] --&gt; 除a b c之外任意字符</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;[^ ]+&quot;,&quot;a little boy&quot;)</span><br><span class="line">[&#x27;a&#x27;, &#x27;little&#x27;, &#x27;boy&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配任意（非）数字字符"><a href="#匹配任意（非）数字字符" class="headerlink" title="匹配任意（非）数字字符"></a>匹配任意（非）数字字符</h4><p><strong>元字符</strong> ： <code>\d</code>  <code>\D</code><br><strong>匹配规则</strong>：</p><ul><li><code>\d</code> 匹配任意数字字符     <code>[0-9]</code></li><li><code>\D</code> 匹配任意非数字字符   <code>[^0-9]</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;1\d&#123;10&#125;&quot;,&quot;18888886666&quot;)</span><br><span class="line">[&#x27;18888886666&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配任意（非）普通字符"><a href="#匹配任意（非）普通字符" class="headerlink" title="匹配任意（非）普通字符"></a>匹配任意（非）普通字符</h4><p><strong>元字符</strong> ： <code>\w</code>   <code>\W</code><br><strong>匹配规则</strong>: </p><ul><li><code>\w</code> 普通字符  <code>[_0-9a-zA-Z]</code> 也能匹配普通汉字</li><li><code>\W</code> 非普通字符</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;\w+&quot;,&quot;hello#nihao%asdf@adsgdfg!df&amp;&quot;)</span><br><span class="line">[&#x27;hello&#x27;, &#x27;nihao&#x27;, &#x27;asdf&#x27;, &#x27;adsgdfg&#x27;, &#x27;df&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;\W+&quot;,&quot;hello#nihao%asdf@adsgdfg!df&amp;&quot;)</span><br><span class="line">[&#x27;#&#x27;, &#x27;%&#x27;, &#x27;@&#x27;, &#x27;!&#x27;, &#x27;&amp;&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配任意（非）空字符"><a href="#匹配任意（非）空字符" class="headerlink" title="匹配任意（非）空字符"></a>匹配任意（非）空字符</h4><p><strong>元字符</strong> ： </p><ul><li><code>\s</code>  匹配任意空字符  <code>[ \r\t\n\v\f]</code></li><li><code>\S</code>  匹配任意非空字符</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;\w+\s+\w+&quot;,&quot;hello   world&quot;)</span><br><span class="line">[&#x27;hello   world&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;\S+&quot;,&quot;hello this is tom&quot;)</span><br><span class="line">[&#x27;hello&#x27;, &#x27;this&#x27;, &#x27;is&#x27;, &#x27;tom&#x27;]</span><br></pre></td></tr></table></figure><blockquote><p>空格也属于空字符</p></blockquote><h4 id="匹配字符串位置"><a href="#匹配字符串位置" class="headerlink" title="匹配字符串位置"></a>匹配字符串位置</h4><p><strong>元字符</strong> ： <code>\A</code>   <code>\Z</code><br><strong>匹配规则</strong>：  </p><ul><li><code>\A</code> 匹配字符串开头位置  <code>^</code></li><li><code>\Z</code> 匹配字符串结尾位置  <code>$</code> </li></ul><p>绝对匹配 ： 正则表达式要完全匹配目标字符串内容</p><p>在正则表达式开始和结束位置加上<code>^</code> <code>$</code> (或者<code>\A</code> <code>\Z</code>)。这样正则表达式必须匹配整个目标字符串才会有结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(&quot;\A\d+\Z&quot;,&quot;123445&quot;)</span><br><span class="line">[&#x27;123445&#x27;]</span><br></pre></td></tr></table></figure><h4 id="匹配（非）单词边界"><a href="#匹配（非）单词边界" class="headerlink" title="匹配（非）单词边界"></a>匹配（非）单词边界</h4><p><strong>元字符</strong> ： <code>\b</code>   <code>\B</code><br><strong>匹配规则</strong> ： </p><ul><li><code>\b</code> 匹配单词边界位置 普通字符和非普通字符交界认为是单词边界</li><li><code>\B</code> 匹配非单词边界位置</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(r&quot;num\b&quot;,&quot;num#asdf#&quot;)</span><br><span class="line">[&#x27;num&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(r&quot;num\b&quot;,&quot;numasdf#&quot;)</span><br><span class="line">[]</span><br></pre></td></tr></table></figure><h4 id="元字符总结"><a href="#元字符总结" class="headerlink" title="元字符总结"></a>元字符总结</h4><p>匹配单个字符 ： <code>a</code>   <code>.</code>   <code>\d</code>  <code>\D</code>  <code>\w</code>  <code>\W</code>  <code>\s</code>  <code>\S</code> <code>[...]</code>  <code>[^...]</code></p><p>匹配重复 ： <code>*</code>   <code>+</code> <code>?</code>  <code>&#123;n&#125;</code>  <code>&#123;m,n&#125;</code></p><p>匹配位置 ： <code>^</code>  <code>$</code>  <code>\A</code>  <code>\Z</code>  <code>\b</code>  <code>\B</code> </p><p>其他 ： <code>|</code>  <code>()</code>  <code>\</code></p><p>正则表达式转义</p><p>正则中的特殊符号：</p><p><code>.</code>  <code>*</code>  <code>+</code>  <code>?</code>  <code>^</code>  <code>$</code>  <code>[]</code>  <code>&#123;&#125;</code> <code>()</code>  <code>|</code> <code>\</code></p><p>正则表达式如果匹配特殊字符需要加 <code>\</code> 表达转义</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> 正则          目标字符串</span><br><span class="line">e.g.    \$\d+  ----&gt;    $10</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">         pattern        string</span><br><span class="line">python  &quot;\\$\\d+&quot;       &quot;$10&quot; </span><br><span class="line"></span><br><span class="line">raw     r&quot;\$\d+&quot;       &quot;$10&quot; </span><br></pre></td></tr></table></figure><p>raw字串 ： 原始字符串对内容不解释转义，就表达内容原            本意义</p><h3 id="贪婪与非贪婪"><a href="#贪婪与非贪婪" class="headerlink" title="贪婪与非贪婪"></a>贪婪与非贪婪</h3><p><strong>贪婪模式</strong> ： 正则表达式的重复匹配总是尽可能多的向后匹配更多内容</p><p><code>*</code>   <code>+</code>   <code>?</code>  <code>&#123;m,n&#125;</code></p><p><strong>非贪婪（懒惰模式）</strong> ： 尽可能少的匹配内容</p><p>贪婪 —&gt; 非贪婪  <code>*?</code>  <code>+?</code>  <code>??</code>  <code>&#123;m,n&#125;?</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(r&quot;ab+?&quot;,&quot;abbbbbbbb&quot;)</span><br><span class="line">[&#x27;ab&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.findall(r&quot;ab??&quot;,&quot;abbbbbbbb&quot;)</span><br><span class="line">[&#x27;a&#x27;]</span><br></pre></td></tr></table></figure><h4 id="正则表达式的子组"><a href="#正则表达式的子组" class="headerlink" title="正则表达式的子组"></a>正则表达式的子组</h4><p>可以使用<code>()</code>为正则表达式建立子组，子组可以看做是正则表达式内部操作的一个整体</p><blockquote><p>子组是在正则表达式整体匹配到内容的前提下才会发挥作用，它不影响正则表达式整体去匹配目标内容这一原则</p></blockquote><h5 id="子组使用"><a href="#子组使用" class="headerlink" title="子组使用"></a>子组使用</h5><ol><li>作为内部整体可以改变某些元字符的行为</li></ol><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.search(<span class="string">r&quot;(ab)+\d+&quot;</span>,<span class="string">&quot;ababab1234&quot;</span>).group()</span><br><span class="line"><span class="string">&#x27;ababab1234&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.search(<span class="string">r&quot;\w+@\w+\.(com|cn)&quot;</span>,<span class="string">&quot;abc@123.com&quot;</span>).group()</span><br><span class="line"><span class="string">&#x27;abc@123.com&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>子组在某些操作中可以单独提取出匹配内容</li></ol><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.search(<span class="string">r&quot;(https|http|ftp)://\S+&quot;</span>,<span class="string">&quot;https://www.baidu.com&quot;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;https&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="子组使用注意事项"><a href="#子组使用注意事项" class="headerlink" title="子组使用注意事项"></a>子组使用注意事项</h5><ul><li>一个正则表达式中可以有多个子组</li><li>子组一般由外到内，由左到右称之为第一，第二 第三。。。。子组</li><li>子组不能重叠，嵌套也不宜很多</li></ul><blockquote><p>search 只能匹配一个结果</p></blockquote><h4 id="捕获组-和-非捕获组"><a href="#捕获组-和-非捕获组" class="headerlink" title="捕获组 和 非捕获组"></a>捕获组 和 非捕获组</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式 ： （?P&lt;name&gt;pattern）</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">re.search(<span class="string">r&quot;(?P&lt;dog&gt;ab)cdef&quot;</span>,<span class="string">&#x27;abcdefghti&#x27;</span>).group(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line">Out[<span class="number">130</span>]: <span class="string">&#x27;ab&#x27;</span></span><br></pre></td></tr></table></figure><p>作用 ： 可以通过组名更方便获取某组内容</p><h3 id="正则表达式设计原则"><a href="#正则表达式设计原则" class="headerlink" title="正则表达式设计原则"></a>正则表达式设计原则</h3><ol><li>正确性 ，能正确匹配到目标内容</li><li>排他性 ，除了要匹配的内容，尽可能不会匹配与到其他内容</li><li>全面性 ，需要对目标的各种情况进行考虑，做到不遗漏</li></ol><h2 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h2><h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><p>用来生成正则表达式对象</p><p><strong>regex = compile(pattern,flags=0)</strong></p><ul><li>功能 ： 生成正则表达式对象</li><li>参数 ： <ul><li>pattern  正则表达式</li><li>flags  功能标志位，丰富正则表达式的匹配功能</li></ul></li><li>返回值 : 返回正则表达式对象</li></ul><h3 id="findall"><a href="#findall" class="headerlink" title="findall"></a>findall</h3><h4 id="re模块调用"><a href="#re模块调用" class="headerlink" title="re模块调用"></a>re模块调用</h4><p><strong>re.findall(pattern,string,flags)</strong></p><ul><li>功能 ：从目标字符串查找正则匹配内容</li><li>参数 ： <ul><li>pattern  正则表达式</li><li>string  目标字符串</li><li>flags  标志位</li></ul></li><li>返回值 ： 返回匹配到的内容 如果正则有子组则只返回子组对应内容</li></ul><h4 id="正则对象调用"><a href="#正则对象调用" class="headerlink" title="正则对象调用"></a>正则对象调用</h4><p><strong>regex.findall(string,pos,endpos)</strong></p><ul><li>功能 ：从目标字符串查找正则匹配内容</li><li>参数 ： <ul><li>string  目标字符串</li><li>pos  匹配目标的起始位置</li><li>endpos  匹配目标的终止位置</li></ul></li><li>返回值 ： 返回匹配到的内容 如果正则有子组则只返回子组对应内容</li></ul><h3 id="split"><a href="#split" class="headerlink" title="split"></a>split</h3><p>正则表达式所匹配的内容，做字符串的切割<br><strong>re.split(pattern,string,flags = 0)</strong></p><ul><li>功能：根据正则匹配内容切割字符串</li><li>参数： pattern  string  flags</li><li>返回值： 返回列表，列表中为切割的内容</li></ul><h3 id="sub"><a href="#sub" class="headerlink" title="sub"></a>sub</h3><p>使用一个字符串去替换目标字符串被正则表达式匹配到的内容<br><strong>re.sub(pattern,replaceStr,string,max,flags)</strong></p><ul><li>功能： 替换正则匹配到的目标子串部分</li><li>参数： <ul><li>pattern</li><li>replaceStr ： 要替换的内容</li><li>string </li><li>max   最多替换几处 默认全部替换</li><li>flags</li></ul></li><li>返回值 ： 返回替换后的字符串</li></ul><h3 id="subn"><a href="#subn" class="headerlink" title="subn"></a>subn</h3><p>使用一个字符串去替换目标字符串被正则表达式匹配到的内容<br><strong>re.subn(pattern,replaceStr,string,max,flags)</strong></p><ul><li>功能： 替换正则匹配到的目标子串部分</li><li>参数： <ul><li>pattern</li><li>replaceStr ： 要替换的内容</li><li>string </li><li>max   最多替换几处 默认全部替换</li><li>flags</li></ul></li><li>返回值 ： 返回一个元组，为实际替换了几处和替换后的字符串</li></ul><blockquote><p>sub 和 subn区别</p><ul><li>sub返回替换后的字符串</li><li>subn返回替换了几处</li></ul></blockquote><h3 id="finditer"><a href="#finditer" class="headerlink" title="finditer"></a>finditer</h3><p>相比findall返回一个迭代对象<br><strong>re.finditer(pattern,string,flags)</strong></p><ul><li>功能： 使用正则表达式匹配目标字符串</li><li>参数： pattern  string flags</li><li>返回值： 返回一个迭代对象，迭代到的内容是一个<em>match</em>对象</li></ul><h3 id="fullmatch"><a href="#fullmatch" class="headerlink" title="fullmatch"></a>fullmatch</h3><p>相当于在最前面写一个<code>^</code>，最后面写一个<code>$</code>， 只匹配到一处，返回一个match对象<br><strong>fullmatch(pattern,string,flags)</strong></p><ul><li>功能： 完全匹配目标字符串</li><li>参数： pattern,string,flags</li><li>返回值：返回匹配到的match对象 如果没匹配成功返回None</li></ul><h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><p>相当于只匹配到开头，返回一个match对象<br><strong>match(pattern,string,flags)</strong></p><ul><li>功能： 从开头位置匹配目标字符串</li><li>参数： pattern,string,flags</li><li>返回值：返回匹配到的match对象 如果没匹配成功返回None</li></ul><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><p><strong>search(pattern,string,flags)</strong></p><ul><li>功能： 正则表达式匹配目标字符串，<strong>只匹配第一处</strong></li><li>参数： pattern,string,flags</li><li>返回值：返回匹配到的match对象 如果没匹配成功返回None</li></ul><p>compile对象属性：</p><p>flags  ： 标志位<br>pattern ： 正则表达式<br>groups： 有多少子组<br>groupindex ： 捕获组形成组名和序列号的字典<br>              组名为键，第几组为值</p><h3 id="match对象属性"><a href="#match对象属性" class="headerlink" title="match对象属性"></a>match对象属性</h3><h4 id="属性变量"><a href="#属性变量" class="headerlink" title="属性变量"></a>属性变量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pos     匹配目标字符串的开始位置</span><br><span class="line">endpos  匹配目标字符串的结束位置</span><br><span class="line">re      正则表达式</span><br><span class="line">string  目标字符串</span><br><span class="line">lastgroup  最后一组的组名</span><br><span class="line">lastindex  最后一组是第几组</span><br></pre></td></tr></table></figure><h4 id="属性方法"><a href="#属性方法" class="headerlink" title="属性方法"></a>属性方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">span()  匹配内容的开始位置</span><br><span class="line">start() 匹配内容的结束位置</span><br><span class="line">end()   匹配内容的起止位置</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">group()</span><br><span class="line">功能 ： 获取match对象对应的内容</span><br><span class="line">参数 ： 默认为0 表示获取整个正则匹配的内容</span><br><span class="line">        如果为序列号或者子组名则为获取某个子组匹配的对应内容</span><br><span class="line">返回值：返回得到的子串</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupdict()  获取捕获组名作为键，对应内容作为值的字典</span><br><span class="line">groups()   获取每个子组匹配内容</span><br></pre></td></tr></table></figure><h3 id="flags-参数的使用"><a href="#flags-参数的使用" class="headerlink" title="flags  参数的使用"></a>flags  参数的使用</h3><p>re.compile  re.findall  re.search  re.match<br>re.finditer  re.fullmatch  re.sub  re.subn  re.split<br>上面这些方法都有flags参数<br>作用： 辅助正则表达式，丰富匹配结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I ==  IGNORECASE  匹配时忽略字母的大小写</span><br><span class="line">S ==  DOTALL     作用于元字符 . 使其可以匹配换行 </span><br><span class="line">M ==  MULTILINE  作用于^  $  使其可以匹配每一行开头结尾位置</span><br><span class="line">X ==  VERBOSE    可以给正则添加注释</span><br></pre></td></tr></table></figure><p>使用多个标志位使用按位或连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">flags = re.X | re.I</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;即文本的高级匹配模式，提供搜索，替代等功能。其本质是一系列由特殊符号组成的字串，这个字串即正则表达式。&lt;br&gt;由普通字符和特殊符号组成字符串，通过描述字符的重复和位置等行为，达到匹配某一类字符串的目的&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="正则" scheme="https://rencheng.cc/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-聚合操作</title>
    <link href="https://rencheng.cc/2019/08/12/mongodb/%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/"/>
    <id>https://rencheng.cc/2019/08/12/mongodb/%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/</id>
    <published>2019-08-12T01:50:32.000Z</published>
    <updated>2019-08-12T01:50:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>对文档的筛选结果进行整理统计</p><span id="more"></span><p>聚合操作</p><p>对文档的筛选结果进行整理统计</p><p>db.collection.aggregate()<br>功能 : 完成聚合操作<br>参数 ： 聚合条件 —》 聚合操作符</p><p>聚合操作符 </p><p>$group   分组聚合  需要配合具体的分组统计选项</p><pre><code>$sum  : 求和e.g.db.class0.aggregate(&#123;$group:&#123;_id:&#39;$gender&#39;,num:&#123;$sum:1&#125;&#125;&#125;)db.class0.aggregate(&#123;$group:&#123;_id:&#39;$gender&#39;,num:&#123;$sum:&#39;$age&#39;&#125;&#125;&#125;)$avg : 求平均数e.g.   db.class0.aggregate(&#123;$group:&#123;_id:&#39;$gender&#39;,avg:&#123;$avg:&#39;$age&#39;&#125;&#125;&#125;)$max  求最大值e.g.db.class0.aggregate(&#123;$group:&#123;_id:&#39;$gender&#39;,max:&#123;$max:&#39;$age&#39;&#125;&#125;&#125;)$min  求最小值e.g.db.class0.aggregate(&#123;$group:&#123;_id:&#39;$gender&#39;,min:&#123;$min:&#39;$age&#39;&#125;&#125;&#125;)</code></pre><p>$project<br> 修改文档的显示效果</p><p>e.g.  project值得用法和find函数field格式一致<br> db.class0.aggregate({$project:{_id:0,name:1,age:1}})</p><p> db.class0.aggregate({$project:{_id:0,Name:’$name’,Age:’$age’}})</p><p>$match<br> 数据筛选<br> $match值得用法同query一致</p><p> e.g.  过滤年龄大于18岁的数据文档<br> db.class0.aggregate({$match:{age:{$gt:18}}})</p><p>$limit<br> 筛选前几条文档</p><p> e.g. 筛选前三条数据文档<br> db.class0.aggregate({$limit:3})</p><p>$skip<br> 跳过几条文档显示</p><p> e.g. 跳过前三条文档<br>  db.class0.aggregate({$skip:3})</p><p>$sort<br>  将数据排序</p><p>   e.g. 按照年龄排序<br>    db.class0.aggregate({$sort:{age:1}})</p><p>聚合管道 </p><p>聚合管道指的是将上一个聚合的操作结果给下一个聚合继续操作</p><p>db.collection.aggregate([{聚合},{},{}…])</p><p>e.g.  match –&gt; project –&gt; sort<br>db.class0.aggregate([{$match:{gender:’m’}},{$project:{_id:0}},{$sort:{age:1}}])</p><p>e.g.  group —&gt; match  找到重名学生<br>db.class0.aggregate([{$group:{_id:’$name’,num:{$sum:1}}},{$match:{num:{$gt:1}}}])</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;对文档的筛选结果进行整理统计&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-索引</title>
    <link href="https://rencheng.cc/2019/08/12/mongodb/%E7%B4%A2%E5%BC%95/"/>
    <id>https://rencheng.cc/2019/08/12/mongodb/%E7%B4%A2%E5%BC%95/</id>
    <published>2019-08-12T01:49:40.000Z</published>
    <updated>2019-08-12T01:49:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>指建立指定键值及所在文档存储位置的对照清单，使用索引可以方便我们进行快速查找，减少遍历次数提高查找效率</p><span id="more"></span><p>指建立指定键值及所在文档存储位置的对照清单，使用索引可以方便我们进行快速查找，减少遍历次数提高查找效率</p><p>ensureIndex()<br>功能 ： 创建索引<br>参数 ： 索引域和索引选项</p><p>e.g.  根据name域创建索引<br>db.class0.ensureIndex({name:1})</p><ul><li>1表示正序索引 -1表示逆序索引</li></ul><p>查看集合中索引</p><p>db.collection.getIndexes()</p><p>自定义索引名称<br>db.collection.ensureIndex({},{name:’myIndex’})</p><p>e.g.  对age域创建索引命名ageIndex<br>db.class0.ensureIndex({age:1},{name:’ageIndex’})</p><p>删除索引</p><p>db.collection.dropIndex(“index”)<br>功能：删除索引<br>参数： 要删除的索引名称或者键值对</p><p> e.g.<br>  db.class0.dropIndex({name：1})<br>  db.class0.dropIndex(‘ageIndex’)</p><p>db.collection.dropIndexes()<br>功能：删除所有索引</p><ul><li>_id是系统自动创建的主键索引，不能删除</li></ul><p>索引类型</p><p>  复合索引<br>  根据多个域创建一个索引</p><p>  e.g.<br>  db.class0.ensureIndex({name:1,age:-1},{name:’name_age’})</p><p>  数组索引 ，子文档索引<br>  如果对某个域的值为数组或者子文档的域创建索引，那么通过数组或者子文档中某一项进行查找也是索引查找</p><p>  e.g.  如果对score创建了索引那么该查找就是索引查找<br>  db.class1.find({‘score.1’:88})</p><p>  唯一索引<br>  创建索引的域要求值不能够重复</p><pre><code>e.g.  对name创建唯一索引db.class0.ensureIndex(&#123;name:1&#125;,&#123;unique:true&#125;)</code></pre><ul><li>当对某个域创建了唯一索引就不能插入重复的值</li></ul><p>  稀疏索引（间隙索引）<br>  只针对有指定索引域的文档创建索引，没有该域的文档不会插入到索引表</p><p>  e.g. 只对有age域的文档创建索引<br>  db.class0.ensureIndex({age:1},{sparse:true})</p><p>索引约束</p><ul><li>索引表需要占用一定的数据库磁盘空间</li><li>当对数据进行增 删 改等写入操作时索引也需要更新，降低了数据修改的</li></ul><p>综上 ： 数据量较小时不适合创建索引，当数据库进行频繁的修改操作而不是查找操作时也不适合创建索引。针对一个集合并不是创建索引越多越好。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;指建立指定键值及所在文档存储位置的对照清单，使用索引可以方便我们进行快速查找，减少遍历次数提高查找效率&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-数据类型</title>
    <link href="https://rencheng.cc/2019/08/12/mongodb/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <id>https://rencheng.cc/2019/08/12/mongodb/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</id>
    <published>2019-08-12T01:49:15.000Z</published>
    <updated>2019-08-12T01:49:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>mongo中存储时间大多为 ISODate</p><span id="more"></span><p>时间数据类型</p><p>mongo中存储时间大多为 ISODate</p><p>存储当前时间方法</p><ol><li>new Date()  自动生成当前时间<br>e.g.<br>db.class2.insert({book:’Python入门’,date:new Date()})</li><li>ISODate()  自动生成当前时间<br>e.g.<br>db.class2.insert({book:’Python精通’,date:ISODate()})</li><li>Date()   将系统时间转换为字符串<br>e.g.<br>db.class2.insert({book:’Python疯狂’,date:Date()})</li></ol><p>指定时间<br>   ISODate()<br>   功能 : 生成mongo标准时间类型数据<br>   参数 ： 如果不传参默认为当前时间<br>           传参表示指定时间<br>         “2018-01-01 12:12:12”<br>         “20180101 12:12:12”<br>         “20180101”<br>   e.g.<br>   db.class2.insert({book:’Python崩溃’,date:ISODate(“2018-07-01 11:15:56”)})</p><p>时间戳</p><p>valueOf()<br>获取某个时间的时间戳<br>  e.g.  获取当前标准时间时间戳<br>    db.class2.insert({book:’Python涅槃’,date:ISODate().valueOf()})</p><p>Null 类型</p><p>值   null </p><ol><li>如果某个域存在却没有值可以赋值为null<br>e.g.<br>db.class2.insert({book:’Python死去活来’,price:null})</li><li>可以查找某个域不存在的情况<br>e.g. 如果date域不存在也能find到<br>db.class2.find({date:null})</li></ol><p>Object （内部文档）</p><p>文档内部某个域的值还是一个文档数据则这个文档就是内部文档类型数据</p><p>通常使用外部文档域名 . 引用内部文档域名的方式使用内部文档</p><p>e.g.<br> db.class3.find({‘book.title’:’狂人日记’})</p><p>e.g.<br> db.class3.update({‘book.title’:’围城’},{$set:{‘book.price’:48.8}})</p><p>通过数组下标直接操作某一项</p><p>e.g. 通过数组下标引用第一项进行查找<br>db.class1.find({‘score.0’:{$gt:90}},{_id:0})</p><p>e.g.<br>db.class1.update({name:’小刚’},{$set:{‘score.1’:80}})</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;mongo中存储时间大多为 ISODate&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-查找操作</title>
    <link href="https://rencheng.cc/2019/08/11/mongodb/%E6%9F%A5%E6%89%BE%E6%93%8D%E4%BD%9C/"/>
    <id>https://rencheng.cc/2019/08/11/mongodb/%E6%9F%A5%E6%89%BE%E6%93%8D%E4%BD%9C/</id>
    <published>2019-08-11T03:50:14.000Z</published>
    <updated>2019-08-11T03:50:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>MongoDB 查询文档使用 find() 方法。find() 方法以非结构化的方式来显示所有文档。</p><span id="more"></span><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query,field)</span><br></pre></td></tr></table></figure><ul><li>功能 ：   查找文档</li><li>参数 <ul><li>query  查找条件，相当于where子句</li><li>field  查找的域</li></ul></li><li>返回值 ： 查找到的所有文档</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">query：  以键值对方式传递参数，如果是空&#123;&#125;表示查找所          有内容</span><br><span class="line"></span><br><span class="line">  e.g.   查找所有性别为w的文档  </span><br><span class="line">         db.class0.find(&#123;sex:&#x27;w&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">field：  以键值对的方式给出要查找（不查找）的域</span><br><span class="line">        以域名为键，以0,1为值分别表示不查找和查找</span><br></pre></td></tr></table></figure><ul><li>如果某一个或多个域设置为0 表示这些域不查找，其他域均查找</li><li>如果某一个或多个域设置为1 表示这些域查找，其他域均不查找</li><li><code>_id</code> 除非设置为0 否则均会查找</li><li>除<code>_id</code>域其他域不能有的设置1有的设置0</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 查找结果只有name域</span><br><span class="line">db.class0.find(&#123;sex:&#x27;w&#x27;&#125;,&#123;_id:0,name:1&#125;)</span><br></pre></td></tr></table></figure><h2 id="findOne"><a href="#findOne" class="headerlink" title="findOne"></a>findOne</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findOne(query,field)</span><br></pre></td></tr></table></figure><ul><li>功能 ： 查找第一条符合条件的文档</li><li>参数 ： 同find</li><li>返回值： 返回查找到的文档</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 查找集合中性别为女的第一个文档</span><br><span class="line">db.class0.findOne(&#123;sex:&#x27;w&#x27;&#125;,&#123;_id:0,name:1&#125;)</span><br></pre></td></tr></table></figure><h2 id="query更多的筛选用法"><a href="#query更多的筛选用法" class="headerlink" title="query更多的筛选用法"></a>query更多的筛选用法</h2><p>操作符 ： 使用<code>$</code>符号注明的一个特殊字符串，表达一定的含义，比如 <code>$lt</code> 表示小于</p><h3 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h3><h4 id="eq-等于"><a href="#eq-等于" class="headerlink" title="$eq 等于 =="></a><em>$eq</em> 等于 ==</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g. 查找年龄等于18</span><br><span class="line">db.class0.find(&#123;age:&#123;$eq:18&#125;&#125;,&#123;_id:0&#125;)</span><br><span class="line">==&gt; db.class0.find(&#123;age:18&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h4 id="lt-小于-lt"><a href="#lt-小于-lt" class="headerlink" title="$lt 小于 &lt;"></a><em>$lt</em> 小于 &lt;</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g. 查找年龄小于18的</span><br><span class="line">db.class0.find(&#123;age:&#123;$lt:18&#125;&#125;,&#123;_id:0&#125;)</span><br><span class="line">db.class0.find(&#123;name:&#123;$lt:&quot;John&quot;&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>在mongodb中字符串可以比较大小</p></blockquote><h4 id="lte-小于等于-lt"><a href="#lte-小于等于-lt" class="headerlink" title="$lte  小于等于 &lt;="></a><em>$lte</em>  小于等于 &lt;=</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  年龄小于等于18 </span><br><span class="line">db.class0.find(&#123;age:&#123;$lte:18&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h4 id="gt-大于-gt"><a href="#gt-大于-gt" class="headerlink" title="$gt  大于 &gt;"></a><em>$gt</em>  大于 &gt;</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  查找年龄大于16 且 小于19</span><br><span class="line">db.class0.find(&#123;age:&#123;$gt:16,$lt:19&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>在mongodb中所有的{} [] 中都可以写多个条件。但根据   参数的不同表达的意思不一样</p></blockquote><h4 id="gte-大于等于-gt"><a href="#gte-大于等于-gt" class="headerlink" title="$gte 大于等于 &gt;="></a><em>$gte</em> 大于等于 &gt;=</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  大于等于19</span><br><span class="line">db.class0.find(&#123;age:&#123;$gte:19&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h4 id="ne-不等于"><a href="#ne-不等于" class="headerlink" title="$ne  不等于  !="></a><em>$ne</em>  不等于  !=</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  性别不等于‘m’的 </span><br><span class="line">db.class0.find(&#123;sex:&#123;$ne:&#x27;m&#x27;&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>使用ne查找也会找到该域不存在的文档</p></blockquote><h4 id="in-包含"><a href="#in-包含" class="headerlink" title="$in  包含"></a><em>$in</em>  包含</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 找到年龄为 [10,20,30]</span><br><span class="line">db.class0.find(&#123;age:&#123;$in:[10,20,30]&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h4 id="nin-不包含"><a href="#nin-不包含" class="headerlink" title="$nin 不包含"></a><em>$nin</em> 不包含</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  找到年龄不是 17  18   19 的</span><br><span class="line">db.class0.find(&#123;age:&#123;$nin:[17,18,19]&#125;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><h4 id="and-逻辑与"><a href="#and-逻辑与" class="headerlink" title="$and 逻辑与"></a><em>$and</em> 逻辑与</h4><ol><li>在 query 如果写多个条件默认即为 and 关系</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">db.class0.find(&#123;age:&#123;$lt:18&#125;,sex:&#x27;m&#x27;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>逻辑与 $and</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 年龄小于18并且 性别为男</span><br><span class="line">db.class0.find(&#123;$and:[&#123;age:&#123;$lt:18&#125;&#125;,&#123;sex:&#x27;m&#x27;&#125;]&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>区别： 第一种不能对相同的域进行操作</p></blockquote><h4 id="or-逻辑或"><a href="#or-逻辑或" class="headerlink" title="$or  逻辑或"></a><em>$or</em>  逻辑或</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 年龄小于16或者年龄大于18</span><br><span class="line">db.class0.find(&#123;$or:[&#123;age:&#123;$lte:16&#125;&#125;,&#123;age:&#123;$gt:18&#125;&#125;]&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure><h4 id="not-逻辑非"><a href="#not-逻辑非" class="headerlink" title="$not  逻辑非"></a><em>$not</em>  逻辑非</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e.g.  查找年龄不小于18岁的</span><br><span class="line">db.class0.find(&#123;age:&#123;$not:&#123;$lt:18&#125;&#125;&#125;,&#123;_id:0&#125;)```</span><br><span class="line">&gt; 非运算并不是正常运算取反</span><br><span class="line">&gt; age &lt; 18 不等于 not[age &lt; 18]</span><br><span class="line">&gt; 是因为mongo过于灵活，某个域的值的类型不一致</span><br><span class="line"></span><br><span class="line">#### *$nor*   not  (a or b)  ===&gt; (not a) and (not b)</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>e.g.  性别不是m且年龄不小于18<br>db.class0.find({$nor:[{sex:’m’},{age:{$lt:18}}]},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 逻辑条件混合</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（年龄大于17 并且 为男生）  或者 姓名叫 Abby<br> db.class0.find({$or:[{age:{$gt:17},sex:’m’},{name:’Abby’}]},{_id:0})</p><p>（年龄不大于18 或者为 女性） 并且 姓名 大于Lucy<br> e.g.<br> db.class0.find({$or:[{age:{$not:{$gt:18}}},{sex:’w’}],name:{$gt:’Lucy’}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 数组 Array</span><br><span class="line"></span><br><span class="line">* 数组是有序的数据集合</span><br><span class="line">* mongo中数组也可以有多重数据元素混合</span><br><span class="line"></span><br><span class="line">查找数组中包含某一条件的元素</span><br></pre></td></tr></table></figure><p>e.g.  只要score数组中包含小于60的元素即可查询过滤<br>db.class1.find({score:{$lt:60}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### $all</span><br><span class="line"></span><br><span class="line">查找数组同时包含多项的文档</span><br></pre></td></tr></table></figure><p>e.g.  查找同时包含49  67的文档<br>db.class1.find({score:{$all:[49,67]}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### $size</span><br><span class="line">通过数组元素个数查找</span><br></pre></td></tr></table></figure><p>e.g. 查找score中包含两个元素的文档<br>db.class1.find({score:{$size:2}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### $slice</span><br><span class="line">取数组的部分进行显示，在`field`中声明</span><br></pre></td></tr></table></figure><p>e.g.  显示数组中前两项<br>db.class2.find({},{_id:0,score:{$slice:2}})</p><p>e.g.   跳过第一项显示后面两项<br>db.class2.find({},{_id:0,score:{$slice:[1,2]}})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 其他常用查找操作符</span><br><span class="line"></span><br><span class="line">#### $exists</span><br><span class="line">通过某个域是否存在筛选（true表示存在false表示不存在）</span><br></pre></td></tr></table></figure><p>e.g. ： 查找不存在sex域的文档<br>db.class1.find({sex:{$exists:false}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### $mod</span><br><span class="line">余数查找</span><br></pre></td></tr></table></figure><p>e.g.  找出年龄为单数的文档<br>db.class1.find({age:{$mod:[2,1]}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#### $type</span><br><span class="line">找出指定数据类型的文档</span><br></pre></td></tr></table></figure><p>e.g.  查找name域值类型为2的文档<br>db.class1.find({name:{$type:2}},{_id:0})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### $regex</span><br><span class="line">找出指定正则的文档</span><br><span class="line"></span><br><span class="line">### 查找结果的操作函数</span><br><span class="line"></span><br><span class="line">#### distinct</span><br></pre></td></tr></table></figure><p>db.collection.distinct(filed)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 功能： 查看某个域的值范围</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>e.g.  获取某个域的值，去重<br>db.class0.distinct(‘age’)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### pretty()</span><br><span class="line">功能：格式化显示查询结果</span><br></pre></td></tr></table></figure><p>e.g.<br>db.class0.find().pretty()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### limit(n)</span><br><span class="line">功能：显示前n条结果</span><br></pre></td></tr></table></figure><p>e.g. 显示查询结果前三条<br>db.class0.find({},{_id:0}).limit(3)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### skip(n)</span><br><span class="line">功能： 跳过前n条显示后面的查询结构</span><br></pre></td></tr></table></figure><p>e.g. ： 跳过前5条文档，显示后面的查询结果<br>db.class0.find({},{_id:0}).skip(5)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### count()</span><br><span class="line">功能 ： 统计查询结果数量</span><br><span class="line"></span><br><span class="line">&gt; 在统计数量时要给出一定query条件</span><br></pre></td></tr></table></figure><p>e.g.  统计性别为w的文档个数<br>db.class0.find({sex:’w’},{_id:0}).count()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### sort(&#123;field: 1/-1&#125;)</span><br><span class="line">功能： 对查找结果排序</span><br><span class="line">参数： 以键值对表示按照哪个field排序</span><br><span class="line">       1 表示升序，-1表示降序</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>e.g.  查找结果按照降序排序<br>db.class0.find({},{_id:0}).sort({age:-1})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 复合排序</span><br></pre></td></tr></table></figure><p>e.g. 按照年龄升序排序，年龄相同时按照姓名降序<br>db.class0.find({},{_id:0}).sort({age:1,name:-1})</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">函数的连续调用</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>e.g.<br>db.class0.find({},{_id:0}).sort({age:1}).limit(3)</p><pre><code>练习：1. 创建数据 名称 grade   use  grade 2. 创建集合 名称 class   3. 集合中插入若干（5-8条即可）文档 文档格式&#123;name:&#39;zhangsan&#39;,age:10,sex:&#39;m&#39;,hobby:[&#39;a&#39;,&#39;b&#39;]&#125; 年龄范围 6-15 爱好选择：draw  sing  dance  basketball  football  pingpong  computer 每个同学选择2-5项   db.class.insert(&#123;name:&#39;zhangsan&#39;,age:10,sex:&#39;m&#39;,hobby:[&#39;draw&#39;,&#39;sing&#39;]&#125;)4. 查找练习 查看班级所有学生信息   find() 查看班级中年龄为8岁的学生信息   find(&#123;age:8&#125;) 查看班级中年龄大于10岁学生信息   find(&#123;age:&#123;$gt:10&#125;&#125;) 查看班级中年龄在8-11岁之间的学生信息   find(&#123;age:&#123;$gte:8,$lte:11&#125;&#125;) 查看班级中年龄10岁且为男生的学生信息   find(&#123;age:10,sex:&#39;m&#39;&#125;) 查看班级中小于7岁或者大于14岁的学生   find(&#123;$or:[&#123;age:&#123;$lt:7&#125;&#125;,&#123;age:&#123;$gt:14&#125;&#125;]&#125;) 查看班级中年龄为8岁或者11岁的学生   find(&#123;age:&#123;$in:[8,11]&#125;&#125;) 找到有2项兴趣爱好的学生   find(&#123;hobby:&#123;$size:2&#125;&#125;) 找到兴趣中 有draw的学生   find(&#123;hobby:&#39;draw&#39;&#125;) 找到既喜欢画画又喜欢跳舞的学生   find(&#123;hobby:&#123;$all:[&#39;draw&#39;,&#39;dance&#39;]&#125;&#125;) 统计兴趣有4项的学生人数   find(&#123;hobby:&#123;$size:4&#125;&#125;).count() 找出本班年龄第二大的学生   find().sort(&#123;age:-1&#125;).skip(1).limit(1)  查看本班学生兴趣爱好涵盖哪些方面   db.class.distinct(&#39;hobby&#39;) 找到年龄最大的三个学生   find().sort(&#123;age:-1&#125;).limit(3) 删除所有年龄大于16或者小于7岁的学生除非他的爱好有三项以上   remove(&#123;$or:[&#123;age:&#123;$gt:16&#125;&#125;,&#123;age:&#123;$lt:7&#125;&#125;],&#123;hobby:&#123;$size:2&#125;&#125;&#125;)  </code></pre>]]></content>
    
    
    <summary type="html">&lt;p&gt;MongoDB 查询文档使用 find() 方法。find() 方法以非结构化的方式来显示所有文档。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-文档操作</title>
    <link href="https://rencheng.cc/2019/08/11/mongodb/%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/"/>
    <id>https://rencheng.cc/2019/08/11/mongodb/%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/</id>
    <published>2019-08-11T02:55:52.000Z</published>
    <updated>2019-08-11T02:55:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>这一节是文档的创建，删除，修改，查询</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>mongodb中数据的组织形式</p><p>mongodb文档 ： 是以键值对的形成组成的一组数据。类似python中字典描述数据的方式</p><ol><li>文档是bson数据类型</li><li>文档是由键值对构成</li><li>文档是MongoDB的基本单元</li></ol><h3 id="键"><a href="#键" class="headerlink" title="键"></a>键</h3><p>即文档的域，表达了一个键值对的含义</p><h4 id="键的命名规则："><a href="#键的命名规则：" class="headerlink" title="键的命名规则："></a>键的命名规则：</h4><ol><li><code>utf-8</code>格式<code>字符串</code></li><li>不能使用<code>\0</code></li><li>一个文档中的键不能<code>重复</code></li></ol><h3 id="值"><a href="#值" class="headerlink" title="值"></a>值</h3><p>即文档存储的数据。<br>bson支持的数据类型值</p><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><table><thead><tr><th>类型</th><th>值</th></tr></thead><tbody><tr><td>整型</td><td>整数 1  2   3</td></tr><tr><td>布尔类型</td><td>true  false</td></tr><tr><td>浮点型</td><td>小数</td></tr><tr><td>Array</td><td>数组</td></tr><tr><td>Date</td><td>时间日期</td></tr><tr><td>Timestamp</td><td>时间戳</td></tr><tr><td>String</td><td>字符串</td></tr><tr><td>Symbol</td><td>特殊字符串</td></tr><tr><td>Binary data</td><td>二进制子串</td></tr><tr><td>Null</td><td>null 空值</td></tr><tr><td>Object</td><td>内部文档（对象）</td></tr><tr><td>code</td><td>js代码</td></tr><tr><td>regex</td><td>正则子串</td></tr><tr><td>ObjectId</td><td>自动生成ID标记</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;_id&quot; : ObjectId(&quot;5ba07671b17d2b40342f7c5c&quot;)</span><br></pre></td></tr></table></figure><h3 id="id"><a href="#id" class="headerlink" title="_id"></a>_id</h3><p>当mongodb插入文档时如果不指定<code>_id</code>域则自动生成_id域。值如果不自己指定即会自动生成一个ObjectId值</p><p>24位16进制  使用ObjectId经过算法处理保证其唯一性</p><p>5ba07671 b17d2b 4034 2f7c5c<br>8位文档创建时间  6位  机器ID   4位进程id  6位计数器</p><blockquote><p>文档中键值对是有序的<br>文档中键值对严格区分大小写</p></blockquote><h3 id="集合中的文档"><a href="#集合中的文档" class="headerlink" title="集合中的文档"></a>集合中的文档</h3><ol><li><p>集合中的文档不一定有相同的域 </p><ul><li>个数不同</li><li>域不相同</li><li>数据类型不同</li></ul></li><li><p>集合中文档各自比较独立，相互并不影响</p></li></ol><h3 id="集合创建原则"><a href="#集合创建原则" class="headerlink" title="集合创建原则"></a>集合创建原则</h3><ol><li>集合中的文档要描述同一类事物</li><li>数据库中同一类数据尽量集中存放在相同的集合</li><li>集合中的文档嵌套层数不要太多</li></ol><h2 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert()</span><br><span class="line">功能 ： 插入一个文档</span><br><span class="line">参数 ： 要插入的文档</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. </span><br><span class="line">db.class0.insert(&#123;&#x27;name&#x27;:&#x27;Lucy&#x27;,&quot;age&quot;:18,&quot;sex&quot;:&#x27;w&#x27;&#125;)</span><br></pre></td></tr></table></figure><h3 id="插入单个文档"><a href="#插入单个文档" class="headerlink" title="插入单个文档"></a>插入单个文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.class0.insert(&#123;_id:1,name:&#x27;Jame&#x27;,age:16,sex:&#x27;m&#x27;&#125;)</span><br><span class="line">或者</span><br><span class="line">db.class0.insertOne(&#123;_id:1,name:&#x27;Jame&#x27;,age:16,sex:&#x27;m&#x27;&#125;)</span><br></pre></td></tr></table></figure><ul><li>插入操作中键可以不加引号</li><li>查看插入结果 db.class0.find()</li><li>_id 值可以自己插入，但是不能重复</li></ul><h3 id="插入多条文档"><a href="#插入多条文档" class="headerlink" title="插入多条文档"></a>插入多条文档</h3><p>参数用中括号里面放入多个文档</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.class0.insert([&#123;&#125;,&#123;&#125;,...])</span><br><span class="line">或</span><br><span class="line">db.class0.insertMany([])</span><br><span class="line"></span><br><span class="line">e.g.</span><br><span class="line">db.class0.insert([&#123;name:&quot;Alex&quot;,age:19,sex:&#x27;m&#x27;&#125;,&#123;name:&#x27;Abby&#x27;,age:18,sex:&#x27;w&#x27;&#125;])</span><br><span class="line"></span><br><span class="line">db.class0.insertMany([&#123;name:&quot;John&quot;,age:16,sex:&#x27;m&#x27;&#125;,&#123;name:&quot;Lenzer&quot;,age:17,sex:&#x27;m&#x27;&#125;])</span><br></pre></td></tr></table></figure><h3 id="save插入文档"><a href="#save插入文档" class="headerlink" title="save插入文档"></a>save插入文档</h3><blockquote><p>跟insert插入的区别就是，如果_id重复，save会覆盖，insert会报错</p></blockquote><p>如果正常插入与insert用法相同</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.save()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">db.class0.save(&#123;name:&#x27;Allen&#x27;,age:19,sex:&#x27;m&#x27;&#125;)</span><br><span class="line">db.class0.save([&#123;name:&quot;Sunny&quot;,age:17,sex:&#x27;w&#x27;&#125;,&#123;name:&#x27;Alice&#x27;,age:16,sex:&#x27;w&#x27;&#125;])</span><br></pre></td></tr></table></figure><p>如果插入数据是有_id域，且_id域值存在时则会修改原有文档，如果该值不存在则正常插入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.class0.save(&#123;_id:2,name:&#x27;Mary&#x27;,age:20,sex:&#x27;w&#x27;&#125;)</span><br></pre></td></tr></table></figure><h2 id="获取集合对象方法"><a href="#获取集合对象方法" class="headerlink" title="获取集合对象方法"></a>获取集合对象方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.class0  ===&gt; db.getCollection(&#x27;class0&#x27;)</span><br><span class="line"></span><br><span class="line">e.g.</span><br><span class="line">db.getCollection(&quot;class0&quot;).find()</span><br></pre></td></tr></table></figure><h2 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h2><h3 id="删除一条或多条文档"><a href="#删除一条或多条文档" class="headerlink" title="删除一条或多条文档"></a>删除一条或多条文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remove(query,justOne)</span><br></pre></td></tr></table></figure><p>功能 ： 删除文档<br>参数 ： </p><ul><li>query  用法同find </li><li>justOne  布尔值 默认为false表示删除所有符合条                 件的文档 设置为true则表示只删除一条</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 删除所有不存在sex域的文档</span><br><span class="line">db.class1.remove(&#123;sex:&#123;$exists:false&#125;&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  删除第一条性别为w的文档</span><br><span class="line">db.class1.remove(&#123;sex:&#x27;w&#x27;&#125;,true)</span><br></pre></td></tr></table></figure><h3 id="删除集合中所有文档"><a href="#删除集合中所有文档" class="headerlink" title="删除集合中所有文档"></a>删除集合中所有文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 删除class1中所有文档</span><br><span class="line">db.class1.remove(&#123;&#125;)</span><br></pre></td></tr></table></figure><h2 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h2><h3 id="更新单个文档"><a href="#更新单个文档" class="headerlink" title="更新单个文档"></a>更新单个文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateOne(query,update,upsert,multi)</span><br></pre></td></tr></table></figure><p>功能 ： 修改文档<br>参数 ： </p><ul><li>query  筛选条件  用法同find</li><li>update  要修改成什么内容 通常配合修改操作符        （修改器）使用</li><li>upsert  布尔值，默认是false  如果query没有筛         选到文档则不做任何操作<pre><code>          如果设置为true 则如果query没有筛选到匹配文档则根据query和update内容插入新的文档</code></pre></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  将Tom的年龄修改为18</span><br><span class="line">db.class0.update(&#123;name:&#x27;Tom&#x27;&#125;,&#123;$set:&#123;age:18&#125;&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  如果有name=Jame的文档则修改，如果没有则根据         query update插入新的文档</span><br><span class="line">db.class0.update(&#123;name:&#x27;Jame&#x27;&#125;,&#123;$set:&#123;age:15&#125;&#125;,true)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  修改所有年龄小于17的为18</span><br><span class="line">db.class0.update(&#123;age:&#123;$lt:17&#125;&#125;,&#123;$set:&#123;age:18&#125;&#125;,false,true)</span><br></pre></td></tr></table></figure><h3 id="更新多个文档"><a href="#更新多个文档" class="headerlink" title="更新多个文档"></a>更新多个文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateMany(query,update,upsert)</span><br></pre></td></tr></table></figure><h3 id="查到到某个然后将其修改"><a href="#查到到某个然后将其修改" class="headerlink" title="查到到某个然后将其修改"></a>查到到某个然后将其修改</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.findOneAndUpdate()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 找到名字为jpy的人，更改它的名字是lilei</span><br><span class="line">db.class.findOneAndUpdate(&#123;name:&#x27;Jpy&#x27;&#125;, &#123;$set:&#123;name:&#x27;lilei&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure><h3 id="查到到某个然后将其替换"><a href="#查到到某个然后将其替换" class="headerlink" title="查到到某个然后将其替换"></a>查到到某个然后将其替换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.findOneAndReplace()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 找到名字是eveb的这个人，并且把替换文档</span><br><span class="line">db.class.findOneAndReplace(&#123;name:&quot;eveb&quot;&#125;, &#123;name:&#x27;aaa&#x27;, age:34&#125;)</span><br></pre></td></tr></table></figure><h3 id="修改器的使用"><a href="#修改器的使用" class="headerlink" title="修改器的使用"></a>修改器的使用</h3><h4 id="set"><a href="#set" class="headerlink" title="$set"></a>$set</h4><p>修改一个值或者也可以增加一个域</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 修改姓名ebal的年龄为49岁</span><br><span class="line">db.class.updateOne(&#123;name:&#x27;ebal&#x27;&#125;, &#123;$set:&#123;age:49&#125;&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 修改姓名ebal的年龄为49岁, 性别为女，并且新增一个喜好的域</span><br><span class="line">db.class.updateOne(&#123;name:&#x27;ebal&#x27;&#125;, &#123;$set:&#123;age:49, sex:0, habby:[1, 2]&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="unset"><a href="#unset" class="headerlink" title="$unset"></a>$unset</h4><p>删除一个域</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 删除名字Jpy的age域（字段）</span><br><span class="line">db.class.updateMany(&#123;name:&#x27;Jpy&#x27;&#125;, &#123;$unset:&#123;age:&#x27;&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="rename"><a href="#rename" class="headerlink" title="$rename"></a>$rename</h4><p>给一个域重命名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 当前集合中所有的sex域更名为gender</span><br><span class="line">db.class.updateMany(&#123;&#125;, &#123;$rename:&#123;sex:&#x27;gender&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="inc"><a href="#inc" class="headerlink" title="$inc"></a>$inc</h4><p>加法修改器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 将所有人的年龄都加上1岁</span><br><span class="line">db.class.updateMany(&#123;&#125;, &#123;$inc:&#123;age:1&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="mul"><a href="#mul" class="headerlink" title="$mul"></a>$mul</h4><p>乘法修改器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 将所有人的年龄都成上3</span><br><span class="line">db.class.updateMany(&#123;&#125;, &#123;$mul:&#123;age:3&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="max"><a href="#max" class="headerlink" title="$max"></a>$max</h4><p>指定一个值的下限</p><blockquote><p>小于指定的值则修改该值，大于不变</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 将所有人的年龄小于18的都修改为18</span><br><span class="line">db.class.updateMany(&#123;&#125;, &#123;$max:&#123;age:18&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="min"><a href="#min" class="headerlink" title="$min"></a>$min</h4><p>指定一个值的上限</p><blockquote><p>大于指定的值则修改该值，小于不变</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 将所有人的年龄大于18的都修改为18</span><br><span class="line">db.class.updateMany(&#123;&#125;, &#123;$min:&#123;age:18&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="setOnInsert"><a href="#setOnInsert" class="headerlink" title="$setOnInsert"></a>$setOnInsert</h4><p>如果使用update插入了文档，则将该修改器内容作为插入文档的一部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  如果插入了新文档则setOnInsert内容也会作为新文档一部分</span><br><span class="line">db.class0.update(&#123;name:&#x27;Jame&#x27;&#125;,&#123;$set:&#123;age:18&#125;,$setOnInsert:&#123;gender:&#x27;m&#x27;,tel:&#x27;123456&#x27;&#125;&#125;,true)</span><br></pre></td></tr></table></figure><h3 id="数组修改器"><a href="#数组修改器" class="headerlink" title="数组修改器"></a>数组修改器</h3><h4 id="push"><a href="#push" class="headerlink" title="$push"></a>$push</h4><p>向数组中添加一项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  给小红 score数组中添加一项91</span><br><span class="line">db.class1.update(&#123;name:&#x27;小红&#x27;&#125;,&#123;$push:&#123;score:91&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="pushAll"><a href="#pushAll" class="headerlink" title="$pushAll"></a>$pushAll</h4><p>向数组中添加多项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">db.class1.update(&#123;name:&#x27;小乔&#x27;&#125;,&#123;$pushAll:&#123;score:[94,10]&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="pull"><a href="#pull" class="headerlink" title="$pull"></a>$pull</h4><p>从数组中删除一项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  从数组中删除一项</span><br><span class="line">db.class1.update(&#123;name:&#x27;小红&#x27;&#125;,&#123;$pull:&#123;score:78&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="pullAll"><a href="#pullAll" class="headerlink" title="$pullAll"></a>$pullAll</h4><p>从数组中删除多项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">db.class1.update(&#123;name:&#x27;小乔&#x27;&#125;,&#123;$pullAll:&#123;score:[92,10]&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="each"><a href="#each" class="headerlink" title="$each"></a>$each</h4><p>对多个值逐个进行操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  分别插入99  10</span><br><span class="line">db.class1.update(&#123;name:&#x27;小乔&#x27;&#125;,&#123;$push:&#123;score:&#123;$each:[99,10]&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="position"><a href="#position" class="headerlink" title="$position"></a>$position</h4><p>指定插入位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  将67 插入到数组1号位置</span><br><span class="line">db.class1.update(&#123;name:&#x27;小明&#x27;&#125;,&#123;$push:&#123;score:&#123;$each:[67],$position:1&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h4><p>数组排序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  将说有score域的数组降序排序</span><br><span class="line">db.class1.update(&#123;&#125;,&#123;$push:&#123;score:&#123;$each:[],$sort:-1&#125;&#125;&#125;,false,true)</span><br></pre></td></tr></table></figure><h4 id="pop"><a href="#pop" class="headerlink" title="$pop"></a>$pop</h4><p>弹出一项 1表示弹出最后一项  -1弹出第一项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.  删除小明score中第一项</span><br><span class="line">db.class1.update(&#123;name:&#x27;小明&#x27;&#125;,&#123;$pop:&#123;score:-1&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="addToSet"><a href="#addToSet" class="headerlink" title="$addToSet"></a>$addToSet</h4><p>向数组中添加一项 但是不能添加重复的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g. 如果数组中没有81 则添加81</span><br><span class="line">db.class1.update(&#123;name:&#x27;小刚&#x27;&#125;,&#123;$addToSet:&#123;score:81&#125;&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;这一节是文档的创建，删除，修改，查询&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-集合操作</title>
    <link href="https://rencheng.cc/2019/08/11/mongodb/%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C/"/>
    <id>https://rencheng.cc/2019/08/11/mongodb/%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C/</id>
    <published>2019-08-11T02:47:26.000Z</published>
    <updated>2019-08-11T02:47:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>这一节是集合的创建，删除，修改，查询。类似于MySQL中的表一样</p><span id="more"></span><h2 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h2><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(collection_name)</span><br><span class="line"></span><br><span class="line">e.g. 创建class1集合</span><br><span class="line">db.createCollection(&#x27;class1&#x27;)</span><br></pre></td></tr></table></figure><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>当向一个集合中插入数据的时候, 如果集合不存在则自动创建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection_name.insert(...)</span><br></pre></td></tr></table></figure><h2 id="查看数据库中集合"><a href="#查看数据库中集合" class="headerlink" title="查看数据库中集合"></a>查看数据库中集合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br><span class="line">或</span><br><span class="line">show tables</span><br></pre></td></tr></table></figure><h2 id="集合命名规则"><a href="#集合命名规则" class="headerlink" title="集合命名规则"></a>集合命名规则</h2><ol><li>合法的<code>UTF-8</code>字符</li><li>不能有<code>\0</code></li><li>不能以<code>system.</code>开头，因为这是系统保留集合前缀 </li><li>不能和关键字<code>重名</code></li></ol><h2 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collection.drop()</span><br><span class="line"></span><br><span class="line">e.g. 删除class2集合</span><br><span class="line">    db.class2.drop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="集合的重命名"><a href="#集合的重命名" class="headerlink" title="集合的重命名"></a>集合的重命名</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.renameCollection(&quot;new_name&quot;)</span><br><span class="line"></span><br><span class="line">e.g. 将class集合重命名为 class0</span><br><span class="line">db.class.renameCollection(&quot;class0&quot;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;这一节是集合的创建，删除，修改，查询。类似于MySQL中的表一样&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-数据库操作</title>
    <link href="https://rencheng.cc/2019/08/11/mongodb/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/"/>
    <id>https://rencheng.cc/2019/08/11/mongodb/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/</id>
    <published>2019-08-11T02:43:47.000Z</published>
    <updated>2019-08-11T02:43:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>在上一节中主要说的是数据库的介绍，安装以及基本的命令<br>这一节主要说数据库的操作。比如：创建数据库，展示所有数据库，数据库命名规则，数据库备份与恢复，数据库监测等</p><span id="more"></span><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use  databaseName</span><br><span class="line">e.g.  创建一个名字为stu的数据库</span><br><span class="line">use stu</span><br></pre></td></tr></table></figure><blockquote><p>use实际为选择使用哪个数据库，当数据库不存在时会自   动创建<br>use 后并不会立即创建出数据库，而是需要等到插入数   据时数据库才会创建</p></blockquote><h2 id="查看系统中的数据库"><a href="#查看系统中的数据库" class="headerlink" title="查看系统中的数据库"></a>查看系统中的数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">或</span><br><span class="line">show databasees</span><br></pre></td></tr></table></figure><p>系统数据库说明<br><strong>admin</strong> ： 存储用户信息<br><strong>local</strong> ： 存储本地数据<br><strong>config</strong> ： 存储分片信息</p><h2 id="数据库命名规则"><a href="#数据库命名规则" class="headerlink" title="数据库命名规则"></a>数据库命名规则</h2><ol><li>使用 <code>utf-8</code> 字符 （mongo默认支持utf-8）</li><li>不能含有 <code>空格  .  /  \   &#39;\0&#39; </code> 字符</li><li>长度不超过 <code>64</code> 字节</li><li>不能和系统数据库<code>重名</code></li></ol><blockquote><p>db ： mongodb的全局量，代表当前正在使用的数据库</p></blockquote><blockquote><p>如果不选择使用任何数据库db代表test，直接插入数据就会建立test数据库</p></blockquote><h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><p>删除db所代表的数据库</p><h2 id="数据库的备份和恢复"><a href="#数据库的备份和恢复" class="headerlink" title="数据库的备份和恢复"></a>数据库的备份和恢复</h2><p>备份和恢复数据的命令跟mongo都是shell命令，并不是<strong>Mongo Shell</strong>命令</p><h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongodump  -h host  -d  dbname -o  bak</span><br><span class="line"></span><br><span class="line">e.g. 将本机test数据库备份到bak目录下</span><br><span class="line">mongodump -h 127.0.0.1 -d test -o bak</span><br></pre></td></tr></table></figure><h3 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongorestore  -h  dbhost:port -d  dbname path</span><br><span class="line"></span><br><span class="line">e.g. 将test数据库恢复到本机的res数据库中（res不存在自动创建）</span><br><span class="line">mongorestore -h 127.0.0.1:27017 -d res  bak/test</span><br></pre></td></tr></table></figure><h2 id="数据库的监测"><a href="#数据库的监测" class="headerlink" title="数据库的监测"></a>数据库的监测</h2><h3 id="监测数据库运行数据"><a href="#监测数据库运行数据" class="headerlink" title="监测数据库运行数据"></a>监测数据库运行数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongostat  </span><br></pre></td></tr></table></figure><p>常用的检测的字段含义</p><table><thead><tr><th align="left">字段</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">insert</td><td align="left">每秒增加的次数</td></tr><tr><td align="left">query</td><td align="left">每秒查的次数</td></tr><tr><td align="left">update</td><td align="left">每秒改的次数</td></tr><tr><td align="left">delete</td><td align="left">每秒删的次数</td></tr><tr><td align="left">flushes</td><td align="left">每秒和磁盘交互次数</td></tr><tr><td align="left">vsize</td><td align="left">虚拟内存</td></tr><tr><td align="left">res</td><td align="left">物理内存</td></tr><tr><td align="left">time</td><td align="left">时间</td></tr><tr><td align="left"></td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td></tr></tbody></table><h3 id="监控数据库读写时长"><a href="#监控数据库读写时长" class="headerlink" title="监控数据库读写时长"></a>监控数据库读写时长</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongotop</span><br></pre></td></tr></table></figure><p>常用的检测的字段含义</p><table><thead><tr><th align="left">字段</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">ns</td><td align="left">数据表</td></tr><tr><td align="left">total</td><td align="left">总时间</td></tr><tr><td align="left">read</td><td align="left">读时间</td></tr><tr><td align="left">write</td><td align="left">写时间</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;在上一节中主要说的是数据库的介绍，安装以及基本的命令&lt;br&gt;这一节主要说数据库的操作。比如：创建数据库，展示所有数据库，数据库命名规则，数据库备份与恢复，数据库监测等&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB-概述</title>
    <link href="https://rencheng.cc/2019/08/11/mongodb/%E6%A6%82%E8%BF%B0/"/>
    <id>https://rencheng.cc/2019/08/11/mongodb/%E6%A6%82%E8%BF%B0/</id>
    <published>2019-08-11T02:03:50.000Z</published>
    <updated>2019-08-11T02:03:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</p><p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="非关系型数据库-（NoSql-–-gt-not-only-sql）"><a href="#非关系型数据库-（NoSql-–-gt-not-only-sql）" class="headerlink" title="非关系型数据库 （NoSql –&gt; not  only  sql）"></a>非关系型数据库 （NoSql –&gt; not  only  sql）</h3><ul><li>优点 ： <ul><li>高并发，读写能力强</li><li>弱化数据结构一致性，使用更加灵活</li><li>有良好的可扩展性</li></ul></li><li>缺点 ： <ul><li>通用性差，没有sql语句那样同于的语句</li><li>操作灵活导致容易出错和混乱</li><li>没有外键关联等复杂的操作</li></ul></li></ul><h3 id="Nosql的使用情况"><a href="#Nosql的使用情况" class="headerlink" title="Nosql的使用情况"></a>Nosql的使用情况</h3><ol><li>对数据存储灵活性要求高，一致性要求低</li><li>数据处理海量并发，要求瞬间效率速度比较高</li><li>数据比较容易建立Nosql模型</li><li>网站临时缓冲存储，爬虫应用</li></ol><h3 id="Nosql分类"><a href="#Nosql分类" class="headerlink" title="Nosql分类"></a>Nosql分类</h3><p>1.键值型数据库  Redis<br>2.文档型数据库  MongoDB<br>3.列存储数据库  HBase<br>4.图形数据库</p><h2 id="MongoDB数据库"><a href="#MongoDB数据库" class="headerlink" title="MongoDB数据库"></a>MongoDB数据库</h2><p>标签 ： 非关系型数据库   文档型数据库<br>        最像关系型的非关系型数据库</p><p>特点 ：</p><ol><li>是由c++编写的数据库管理系统</li><li>支持丰富的数据操作，增删改查索引聚合</li><li>支持丰富的数据类型</li><li>使用方便，可以很好的扩展。相对比较成熟</li><li>支持众多的编程语言接口 （python  PHP c++  c#） </li></ol><p>要求：</p><ol><li>关系型数据库和非关系型数据库各自有什么特点</li><li>MongoDB是一个什么样的数据库</li></ol><h3 id="MongoDB的安装"><a href="#MongoDB的安装" class="headerlink" title="MongoDB的安装"></a>MongoDB的安装</h3><h4 id="自动安装"><a href="#自动安装" class="headerlink" title="自动安装"></a>自动安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mongodb</span><br></pre></td></tr></table></figure><p>默认安装位置 ： /var/lib/mongodb<br>配置文件位置 ： /etc/mongodb.conf<br>命令集： /usr/bin   /usr/local/bin</p><h4 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h4><ol><li>下载安装包<br><a href="www.mongodb.com">官网</a></li><li>解压安装包<br>/usr/local   /opt</li><li>将解压后的MongoDB文件夹中的bin目录添加到环境比变量<br>PATH=$PAHT:/opt/mongo…../bin<br>export PATH<br>将以上两句写入启动脚本  /etc/rc.local</li><li>重启</li></ol><h3 id="mysql-和-mongodb-概念对比"><a href="#mysql-和-mongodb-概念对比" class="headerlink" title="mysql 和 mongodb 概念对比"></a>mysql 和 mongodb 概念对比</h3><table><thead><tr><th align="left">mysql</th><th align="left">mongodb</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">database</td><td align="left">database</td><td align="left">数据库</td></tr><tr><td align="left">table</td><td align="left">collection</td><td align="left">表/集合</td></tr><tr><td align="left">column</td><td align="left">field</td><td align="left">字段/域</td></tr><tr><td align="left">row</td><td align="left">document</td><td align="left">记录/文档</td></tr><tr><td align="left">index</td><td align="left">index</td><td align="left">索引</td></tr></tbody></table><h3 id="Mongodb-命令"><a href="#Mongodb-命令" class="headerlink" title="Mongodb 命令"></a>Mongodb 命令</h3><ol><li>设置数据库存储位置</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath  目录</span><br><span class="line">  e.g.  将存储路径设置为dbs</span><br><span class="line">mongod --dbpath  dbs </span><br></pre></td></tr></table></figure><ol start="2"><li>设置数据库监听端口</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod --port  8080</span><br><span class="line">* 默认监听端口27017</span><br></pre></td></tr></table></figure><ol start="3"><li>进入数据库交互操作界面 </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongo shell ： 用来操作mongodb数据库的界面，在这里可                以使用mongo语句操作数据库内容</span><br><span class="line"></span><br><span class="line">退出 mongo shell：quit()  exit  ctrl-c</span><br></pre></td></tr></table></figure><p>组织结构 ： 键值对 –&gt; 文档 –&gt;集合 –&gt; 数据库</p><p><strong>在MongoDB中如何表示下面的数据表</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-------------------------</span><br><span class="line"> ID   |   NAME   |   AGE</span><br><span class="line">-------------------------</span><br><span class="line"> 1    |   Lily   |   17</span><br><span class="line">-------------------------</span><br><span class="line"> 2    |   Lucy   |   18</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;ID&quot;:1,</span><br><span class="line">  &quot;NAME&quot;:&#x27;Lily&#x27;,</span><br><span class="line">  &quot;AGE&quot;:17</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ID&quot;:2,</span><br><span class="line">  &quot;NAME&quot;:&#x27;Lucy&#x27;,</span><br><span class="line">  &quot;AGE&quot;:18</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。&lt;/p&gt;
&lt;p&gt;MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="MongoDB" scheme="https://rencheng.cc/tags/MongoDB/"/>
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>iOS-支持Dark Mode</title>
    <link href="https://rencheng.cc/2019/07/30/ios/general/DarkMode/"/>
    <id>https://rencheng.cc/2019/07/30/ios/general/DarkMode/</id>
    <published>2019-07-30T05:52:01.000Z</published>
    <updated>2019-07-30T05:52:01.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.rencheng.cc/blog/flxpq.png-thumb100"></p><p>经过多年的等待和期待，iOS13 终于支持本机<code>Dark Mode</code>！ 用户可以选择启用系统范围的深色外观，所有正式应用程序都将支持该外观。</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在应用中启用<code>Dark Mode</code>支持就像使用新的iOS13 SDK一样容易！ 使用最新的SDK时，iOS将自动更新系统控件，例如开关，表格视图和按钮。如我们所见，Apple还使开发人员可以轻松地添加<code>Dark Mode</code>支持。<br>但是，iOS不会自动切换图像或文本颜色，因此您可能会在<code>Dark Mode</code>下注意到很多与应用有关的问题。<br>尽管使用新的iOS13 SDK进行构建会自动更新系统控件，但Apple强烈建议所有开发人员检查并更新其应用程序，以确保在启用<code>Dark Mode</code>时所有文本和图像都能正确显示。<br>幸运的是，由于苹果在过去几年中对资产目录进行了许多改进，因此大多数iOS应用程序应该能够采用<code>Dark Mode</code>，而无需进行重大代码更改。</p><h2 id="适配颜色"><a href="#适配颜色" class="headerlink" title="适配颜色"></a>适配颜色</h2><h3 id="System-Color"><a href="#System-Color" class="headerlink" title="System Color"></a>System Color</h3><p>iOS13现在在<code>UIColor</code>中包括新的系统颜色，例如<code>label</code>颜色。 通过使用iOS13中可用的新系统颜色，您的应用程序可以自动支持<code>Dark Mode</code>和高对比度模式。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">label.color = <span class="built_in">UIColor</span>.secondaryLabel</span><br></pre></td></tr></table></figure><h3 id="Custom-Colors"><a href="#Custom-Colors" class="headerlink" title="Custom Colors"></a>Custom Colors</h3><p>尽管强烈建议您使用系统颜色来自动适应界面更改并确保各个应用程序之间的一致性，但是您可能希望在自定义颜色上支持深色模式。<br>使用iOS11的新资产目录颜色，可以通过添加自定义颜色的深色版本来轻松支持深色模式。<br>要添加资产目录颜色的深色版本，只需在目录中选择颜色，然后在“属性”检查器中将<code>Appearances</code>切换为<code>Any</code>，<code>Dark</code>。 然后，添加颜色的深色外观版本。<br><img src="https://cdn.rencheng.cc/blog/1130i.png-thumb100"><br>就是这样-启用深色模式时，iOS会自动切换到资产目录颜色的深色版本，而您无需进行其他工作！</p><blockquote><p>如果工程未使用资产目录颜色？<br>资产目录颜色使支持<code>Dark Mode</code>更加容易！ 请参阅<a href="https://twitter.com/twannl">Antoine van der Lee</a>撰写的<a href="https://www.avanderlee.com/xcode/dark-mode-on-ios-preparations-using-asset-catalog-colors/">博客文章</a>，详细了解如何使用资产目录颜色，如果您不希望切换，请参阅下面的以编程方式<a href="https://schiavo.me/2019/implementing-dark-mode/#detecting-dark-mode-programmatically">检测Dark Mode</a>。</p></blockquote><h2 id="适配图片"><a href="#适配图片" class="headerlink" title="适配图片"></a>适配图片</h2><p>虽然大多数图像在<code>Dark Mode</code>下看起来都不错，尤其是当您使用模板图像时，如果您将其放置在工作中以自动切换颜色（请参见上文的“适应颜色”），该图像会自动更改色调，但您可能希望<code>Dark Mode</code>下看某些图像具有不同的颜色。<br><img src="https://cdn.rencheng.cc/blog/1x26o.png-thumb100"><br>与资产目录颜色一样，启用<code>Dark Mode</code>时自动切换资产目录中的图像很简单。 要添加任何图像的深色版本，只需在目录中选择该图像，然后在“属性”检查器中将<code>Appearances</code>切换为<code>Any</code>，<code>Dark</code>。 然后，只需添加图像的深色外观版本。</p><h2 id="代码检测Dark-Mode"><a href="#代码检测Dark-Mode" class="headerlink" title="代码检测Dark Mode"></a>代码检测Dark Mode</h2><p>在某些情况下，您需要以代码来检测外观变化并相应地更改用户界面。</p><blockquote><p>⚠️警告：响应外观更改时，请确保尽快更新您的界面。 不要执行与外观更改无关的任务，因为这可能会导致延迟，尤其是当用户从Control Center切换外观时。</p></blockquote><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">override func traitCollectionDidChange(_ previousTraitCollection: <span class="built_in">UITraitCollection</span>?) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.traitCollectionDidChange(previousTraitCollection)</span><br><span class="line"></span><br><span class="line">    let userInterfaceStyle = traitCollection.userInterfaceStyle <span class="comment">// Either .unspecified, .light, or .dark</span></span><br><span class="line">    <span class="comment">// Update your user interface based on the appearance</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过在视图控制器上重写traitCollectionDidChange，检测外观变化很简单，只需访问视图控制器的<code>traitCollection.userInterfaceStyle</code>。<br>但是要记住，我们也要针对其他情况更改（例如设备旋转）调用<code>traitCollectionDidChange</code>。 您可以使用此新方法检查当前外观是否不同：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">override func traitCollectionDidChange(_ previousTraitCollection: <span class="built_in">UITraitCollection</span>?) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.traitCollectionDidChange(previousTraitCollection)</span><br><span class="line"></span><br><span class="line">    let hasUserInterfaceStyleChanged = previousTraitCollection.hasDifferentColorAppearance(comparedTo: traitCollection) <span class="comment">// Bool</span></span><br><span class="line">    <span class="comment">// Update your user interface based on the appearance</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要从任何地方访问当前特征集，也可以使用<code>UITraitCollection.current</code>。</p><h2 id="重写-User-Interface-Style"><a href="#重写-User-Interface-Style" class="headerlink" title="重写 User Interface Style"></a>重写 User Interface Style</h2><h3 id="全局控制"><a href="#全局控制" class="headerlink" title="全局控制"></a>全局控制</h3><p>系统会自动在与iOS13或更高版本的SDK链接的任何应用中选择采用浅色和深色外观。 如果您需要更多时间来处理应用程序的<code>Dark Mode</code>支持，或者希望将应用保持单一样式，则可以通过在应用的<code>Info.plist</code>文件中添加<code>UIUserInterfaceStyle</code>键（值为<code>Light</code>或<code>Dark</code>）来控制。 设置此键会导致系统忽略用户的偏好，并始终将特定外观应用于您的应用。</p><blockquote><p>⚠️Note️注意：强烈建议支持深色模式。 在改进应用程序的<code>Dark Mode</code>支持时，请使用UIUserInterfaceStyle键暂时停用。</p></blockquote><h3 id="特定页面"><a href="#特定页面" class="headerlink" title="特定页面"></a>特定页面</h3><p>在iOS13中，您现在可以在特定视图或视图控制器上重写<code>User Interface Style</code>。例如，您可能只希望某个视图控制器处于<code>Dark Mode</code>，而应用程序的其余部分处于<code>Light</code>模式。<br>要覆盖用户界面样式，只需在顶视图或视图控制器中覆盖此变量，它将向下传播到子视图：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside a UIViewController</span></span><br><span class="line">override func viewDidLoad() &#123;</span><br><span class="line">    <span class="variable language_">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always adopt a dark interface style.    </span></span><br><span class="line">    overrideUserInterfaceStyle = .dark</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="打印切换信息"><a href="#打印切换信息" class="headerlink" title="打印切换信息"></a>打印切换信息</h2><p>Edit Scheme -&gt; Run -&gt; Arguments -&gt; Arguments Passed On Launch<br>加入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-UITraitCollectionChangeLoggingEnabled YES</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在文章中，我们探讨了如何使您的应用在iOS13的<code>Dark Mode</code>中看起来更漂亮，以及如何调整图像，颜色和自定义用户界面元素以匹配新样式。<br>我迫不及待想看到肯定会在秋天出现的所有出色的<code>Dark Mode</code>应用程序！<br>本文所有信息全部摘自<a href="https://developer.apple.com/videos/play/wwdc2019/214/">WWDC</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://cdn.rencheng.cc/blog/flxpq.png-thumb100&quot;&gt;&lt;/p&gt;
&lt;p&gt;经过多年的等待和期待，iOS13 终于支持本机&lt;code&gt;Dark Mode&lt;/code&gt;！ 用户可以选择启用系统范围的深色外观，所有正式应用程序都将支持该外观。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS13和Xcode11踩坑</title>
    <link href="https://rencheng.cc/2019/07/24/ios/general/iOS13%E5%92%8CXcode11%E8%B8%A9%E5%9D%91/"/>
    <id>https://rencheng.cc/2019/07/24/ios/general/iOS13%E5%92%8CXcode11%E8%B8%A9%E5%9D%91/</id>
    <published>2019-07-24T06:41:04.000Z</published>
    <updated>2019-07-24T06:41:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.rencheng.cc/blog/g8big.png"></p><p>今年整体上问题不大，没有出现编译报错问题。</p><p>用 Xcode10 编译的 App 在 iOS 13 上使用甚至几乎完美<br>用 Xcode11 编译的 App 再在 iOS 13 上跑，就有些问题了</p><span id="more"></span><h2 id="modal新样式"><a href="#modal新样式" class="headerlink" title="modal新样式"></a>modal新样式</h2><p>iOS 13 多了一个新的枚举类型 <code>UIModalPresentationAutomatic</code>，且是<code>modalPresentationStyle</code>的默认值。</p><p><code>UIModalPresentationAutomatic</code>实际是表现是在 =iOS 13的设备上被映射成<code>UIModalPresentationPageSheet</code>。</p><p>我这边的设计师表示，新样式不错，可以不用改😆。</p><p>不过， <code>PageSheet</code> 与 <code>FullScreen</code> 对比 有个需要注意的地方，控制器的生命周期有点区别：</p><p>以 <code>控制器A</code>、<code>控制器B</code> 举例：</p><ul><li><code>控制器A</code> present <code>控制器B</code><br>  <code>控制器A</code> 不会调用 <code>viewWillDisappear</code> 以及 <code>viewDidDisappear</code></li><li><code>控制器B</code> dismiss 时<br>  <code>控制器A</code> 不会调用 <code>viewWillAppear</code> 以及 <code>viewDidAppear</code></li></ul><p>那么如果有些业务逻辑会在<code>控制器A</code>的生命周期里做的话，就需要考虑其他方式实现，或者改回<code>UIModalPresentationFullScreen</code><br><img src="https://cdn.rencheng.cc/blog/ojqu0.gif"></p><p>如果需要改成原本全屏的样式，可以处理Controller:</p><ul><li>初始化时设置<code>modalPresentationStyle</code>值</li><li>跳转修改<code>modalPresentationStyle</code>值</li><li>覆盖<code>modalPresentationStyle</code>的get方法</li></ul><p>看上面gif，用户是可以通过手势下拉关闭被present出来的控制器的，那如果我需要禁止他下来要怎么实现呢？</p><blockquote><p>可以参考<a href="https://developer.apple.com/documentation/uikit/view_controllers/disabling_pulling_down_a_sheet?language=objc">disabling_pulling_down_a_sheet</a>的Demo</p></blockquote><p>设置<code>presentationController.delegate</code> 代理对象，实现<code>UIAdaptivePresentationControllerDelegate</code>协议方法</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XXViewController</span> () &lt;<span class="title">UIAdaptivePresentationControllerDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="type">BOOL</span> allowBack;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XXViewController</span></span></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果vc被navigation套了一层就要取navigation的presentationController</span></span><br><span class="line">    <span class="keyword">self</span>.navigationController.presentationController.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用UIAdaptivePresentationControllerDelegate 协议方法控制能否下拉dismiss</span></span><br><span class="line"><span class="comment">// 或者不实现这个协议，设置self.modalInPresentation（YES-不允许下拉关闭，NO-可以下拉关闭）</span></span><br><span class="line">- (<span class="type">BOOL</span>)presentationControllerShouldDismiss:(<span class="built_in">UIPresentationController</span> *)presentationController &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.allowBack;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 self.modalInPresentation=YES 或者</span></span><br><span class="line"><span class="comment">// 上面协议方法return NO，用户再下拉就会在这收到回调</span></span><br><span class="line">- (<span class="type">void</span>)presentationControllerDidAttemptToDismiss:(<span class="built_in">UIPresentationController</span> *)presentationController &#123;</span><br><span class="line">    <span class="comment">// 如果self.allowBack == NO，会回调到这里</span></span><br><span class="line">    <span class="comment">// 可以在这里做一些事情然后再考虑让 self.allowBack=YES 或</span></span><br><span class="line">    <span class="comment">// 则让 self.modalInPresentation=NO 即可让页面可以下拉返回</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="textfield-leftview"><a href="#textfield-leftview" class="headerlink" title="textfield.leftview"></a>textfield.leftview</h2><p>如下方式，直接给<code>textfield.leftView</code>赋值一个<code>UILabel</code>对象，他的宽高会被 <code>sizeToFit</code>，而不是创建时的值。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// left view label</span></span><br><span class="line"><span class="built_in">UILabel</span> *phoneLabel = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">63</span>, <span class="number">50</span>)];</span><br><span class="line">phoneLabel.text = <span class="string">@&quot;手机号&quot;</span>;</span><br><span class="line">phoneLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">16</span>];</span><br><span class="line"><span class="comment">// set textfield left view</span></span><br><span class="line"><span class="keyword">self</span>.textfieldName.leftView = phoneLabel;</span><br></pre></td></tr></table></figure><p>如所看到，实际leftview的width为59，height为19：<br><img src="https://cdn.rencheng.cc/blog/mefgj.png"><br>通过监听<code>leftView</code>的<code>frame</code>变化，发现是<code>layoutSubview</code>之后变化的。<br>最终还是给UILabel多套了一个UIView来解决</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// label</span></span><br><span class="line"><span class="built_in">UILabel</span> *phoneLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">phoneLabel.text = <span class="string">@&quot;手机号&quot;</span>;</span><br><span class="line">phoneLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">16</span>];</span><br><span class="line">[phoneLabel sizeToFit];</span><br><span class="line">phoneLabel.centerY = <span class="number">50</span>/<span class="number">2.</span>f;</span><br><span class="line"><span class="comment">// left view</span></span><br><span class="line"><span class="built_in">UIView</span> *leftView = [[<span class="built_in">UIView</span> alloc] initWithFrame:(<span class="built_in">CGRect</span>)&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">63</span>, <span class="number">50</span>&#125;];</span><br><span class="line">[leftView addSubview:phoneLabel];</span><br><span class="line"><span class="comment">// set textfield left view</span></span><br><span class="line"><span class="keyword">self</span>.textfieldName.leftView = leftView;</span><br></pre></td></tr></table></figure><h2 id="KVC访问私有属性Crash"><a href="#KVC访问私有属性Crash" class="headerlink" title="KVC访问私有属性Crash"></a>KVC访问私有属性Crash</h2><p>打开有<code>UISearchBar</code>的页面发现Crash了，看到控制台输出提示：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取_searchField</span></span><br><span class="line"><span class="built_in">UITextField</span> *sField = [<span class="keyword">self</span>.searchbar valueForKey:<span class="string">@&quot;_searchField&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// crash log</span></span><br><span class="line">*** Terminating app due to uncaught exception <span class="string">&#x27;NSGenericException&#x27;</span>, reason: </span><br><span class="line"><span class="string">&#x27;Access to UISearchBar&#x27;</span>s _searchField ivar is prohibited. </span><br><span class="line">This is an application bug<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>看起来是禁止访问私有属性了。</strong></p><p>用 Xcode 10 编译的 App 在 iOS 13 上能正常使用，那么就是 Xcode 11 做了限制访问私有属性的一些处理了。</p><p>偶然发现 iOS 13 中增加了<code>UISearchTextField</code>类，且暴露了<code>searchTextField</code>。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UISearchTextField.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UIKIT_CLASS_AVAILABLE_IOS_ONLY</span>(<span class="number">13.0</span>)</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UISearchTextField</span> : <span class="title">UITextField</span></span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UISearchBar</span> (<span class="title">UITokenSearch</span>)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UISearchTextField</span> *searchTextField;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>但是仅在 iOS 13 以上系统支持，还是暂时用遍历view的方式去做了😂</p><h2 id="navigationBar-shouldPopItem"><a href="#navigationBar-shouldPopItem" class="headerlink" title="navigationBar:shouldPopItem:"></a>navigationBar:shouldPopItem:</h2><p>点击导航栏返回的时候Crash了，控制台输出提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Теrmіnаtіng арр due to uncaught exception&#x27; NSInternalInconsistencyException&#x27; , </span><br><span class="line">reason : &#x27; Override of -navigationBar : shouldPopItem: returned YES after </span><br><span class="line">manually popping a view controller ( navigat ionController=&lt;MHCRNavgationController : 0x106039400&gt;) &#x27;</span><br></pre></td></tr></table></figure><p>因为我们工程里，基本上所有的<code>Controller</code>是继承基类<code>BaseViewController</code>并实现<code>- (BOOL)naviBack:</code>方法，用于实现在用户点击返回和侧滑返回时，一些不能返回的特殊处理。<br>其根本原理是通过实现<code>UINavgationBar</code>的代理方法<code>- (BOOL)navigationBar:shouldPopItem:</code>来做的控制：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)navigationBar:(UINavigationBar *)navigationBar</span><br><span class="line">        shouldPopItem:(UINavigationItem *)item &#123;</span><br><span class="line">    </span><br><span class="line">    // 默认可以返回</span><br><span class="line">    BOOL canGoBack = YES;</span><br><span class="line">    </span><br><span class="line">    // BaseViewController定义协议方法判断能否能点击返回上一层</span><br><span class="line">    UIViewController *vc = self.viewControllers.lastObject;</span><br><span class="line">    if ([vc isKindOfClass:BaseViewController.class]) &#123;</span><br><span class="line">        canGoBack = [(BaseViewController *)vc naviBack:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (canGoBack) &#123;</span><br><span class="line">        [self popViewControllerAnimated:YES];</span><br><span class="line">    &#125;</span><br><span class="line">    return canGoBack;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是我实现的时候有<code>Return YES</code>啊！想了想，试着<strong>注释</strong>了<code>[self popViewControllerAnimated:YES]</code>，发现没有崩溃了。<br>但是在iOS 12上，会发现控制器没有回到上一层，如图，只有navbar回到上一层了：<br><img src="https://cdn.rencheng.cc/blog/m2g0d.gif"><br>好吧，那只能判断一下版本解决这个问题了，修改方式：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">BOOL</span>)navigationBar:(<span class="built_in">UINavigationBar</span> *)navigationBar</span><br><span class="line">        shouldPopItem:(<span class="built_in">UINavigationItem</span> *)item &#123;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 判断 iOS 版本低于13</span></span><br><span class="line">    <span class="type">BOOL</span> bellow13 = !@available(iOS <span class="number">13.0</span>, *);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 默认可以返回</span></span><br><span class="line">    <span class="type">BOOL</span> canGoBack = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// BaseViewController定义协议方法判断能否能点击返回上一层</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *vc = <span class="keyword">self</span>.viewControllers.lastObject;</span><br><span class="line">    <span class="keyword">if</span> ([vc isKindOfClass:BaseViewController.class]) &#123;</span><br><span class="line">        canGoBack = [(BaseViewController *)vc naviBack:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (canGoBack &amp;&amp; bellow13) &#123;</span><br><span class="line">        <span class="comment">// 如果低于13且可以返回，就执行popViewController</span></span><br><span class="line">        [<span class="keyword">self</span> popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> canGoBack;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="夜间模式"><a href="#夜间模式" class="headerlink" title="夜间模式"></a>夜间模式</h2><p>WWDC 19 直播的时候看到夜间模式，老实说挺开心的，直到我用 Xcode 11 开始做适配，妈耶！x N</p><p><strong>注意：使用 Xcode 10 编译的 App 依然是日间模式，不会产生效果！！！</strong></p><p>初步扫了一下出现的问题如下图，大致情况是：没有设置背景色的系统控件会被设置成黑色，部分控件是tintColor没设置的话也会被改。<br><img src="https://cdn.rencheng.cc/blog/kpbaf.jpg"><br><img src="https://cdn.rencheng.cc/blog/i0378.jpg"></p><p>由于Assets里的Color配置是<code>iOS 12</code>以上才能使用的，所以如果没有做全局主题色设计且需要支持iOS 12以下设备，改起来会比较恶心。</p><p>对此现象，找设计师沟通。设计师表示，暂时没有精力做夜间模式规划。<br>设计师问：能否强制只日间模式？<br>答：能。配置方式有两种，<code>单页面配置</code> 和 <code>全局配置</code>。</p><ul><li>单页配置<br>  将需要配置的<code>UIViewControler</code>对象的<code>overrideUserInterfaceStyle</code>属性设置成<code>UIUserInterfaceStyleLight</code>或者<code>UIUserInterfaceStyleDark</code>以强制是某个页面显示为<code>浅/深色模式</code></li><li>全局配置<br>  在工程的<code>Info.plist</code>的中，增加/修改<code>UIUserInterfaceStyle</code>为<code>UIUserInterfaceStyleLight</code>或<code>UIUserInterfaceStyleDark</code></li></ul><h2 id="禁用方法"><a href="#禁用方法" class="headerlink" title="禁用方法"></a>禁用方法</h2><p><strong>textField 更改holder颜色崩溃</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[textField setValue:HexColor(<span class="number">0x999999</span>) forKeyPath:<span class="string">@&quot;_placeholderLabel.textColor&quot;</span>];</span><br></pre></td></tr></table></figure><p><strong>解决方式</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSAttributedString</span> *attrString = [[<span class="built_in">NSAttributedString</span> alloc] initWithString:<span class="string">@&quot;请输入占位文字&quot;</span> attributes:@&#123;<span class="built_in">NSForegroundColorAttributeName</span>:HexColor(<span class="number">0x999999</span>), <span class="built_in">NSFontAttributeName</span>:textField.font&#125;];</span><br><span class="line">textField.attributedPlaceholder = attrString;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://cdn.rencheng.cc/blog/g8big.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;今年整体上问题不大，没有出现编译报错问题。&lt;/p&gt;
&lt;p&gt;用 Xcode10 编译的 App 在 iOS 13 上使用甚至几乎完美&lt;br&gt;用 Xcode11 编译的 App 再在 iOS 13 上跑，就有些问题了&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Swift</title>
    <link href="https://rencheng.cc/2019/07/20/ios/swift/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"/>
    <id>https://rencheng.cc/2019/07/20/ios/swift/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</id>
    <published>2019-07-20T02:51:47.000Z</published>
    <updated>2019-07-20T02:51:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>基于swift5.1写的</p><span id="more"></span><h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>不用编写main函数，Swift将全局范围内的首句可执行代码作为程序入口</p></li><li><p>一句代码尾部可以省略分号(;)，多句代码写到同一行时必须用分号(;)隔开 </p></li><li><p>用<code>var</code>定义变量，<code>let</code>定义常量，编译器能自动推断出变量\常量的类型</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> b <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> c <span class="operator">=</span> a <span class="operator">+</span> b</span><br><span class="line">c <span class="operator">+=</span> <span class="number">30</span></span><br></pre></td></tr></table></figure></li><li><p>Playground可以快速预览代码效果，是学习语法的好帮手 </p></li><li><p><code>Command + Shift + Enter</code>:运行整个Playground</p></li><li><p><code>Shift + Enter</code>:运行截止到某一行代码</p></li></ul><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 1</span></span><br><span class="line"><span class="comment"> <span class="comment">/* 多行注释嵌套 */</span></span></span><br><span class="line"><span class="comment"> 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><ul><li>只能赋值1次</li><li>它的值不要求在编译时期确定，但使用之前必须赋值1次</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age1 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> age2: <span class="type">Int</span></span><br><span class="line">age2 <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getAge</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> age3 <span class="operator">=</span> getAge()</span><br></pre></td></tr></table></figure><ul><li>常量、变量在初始化之前，都不能使用</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age: <span class="type">Int</span></span><br><span class="line"><span class="keyword">var</span> height: <span class="type">Int</span></span><br><span class="line"><span class="built_in">print</span>(age)</span><br><span class="line"><span class="built_in">print</span>(height)</span><br></pre></td></tr></table></figure><ul><li>下面代码是错误的</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age</span><br><span class="line">age <span class="operator">=</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><ul><li>标识符(比如常量名、变量名、函数名)几乎可以使用任何字符</li><li>标识符不能以数字开头，不能包含空白字符、制表符、箭头等特殊字符</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> 🐂🍺() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;666&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">🐂🍺()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> 👽 <span class="operator">=</span> <span class="string">&quot;ET&quot;</span></span><br><span class="line"><span class="keyword">var</span> 🥛 <span class="operator">=</span> <span class="string">&quot;milk&quot;</span></span><br></pre></td></tr></table></figure><h3 id="常用数据类型"><a href="#常用数据类型" class="headerlink" title="常用数据类型"></a>常用数据类型</h3><p><img src="https://cdn.rencheng.cc/blog/m7u8l.png"></p><ul><li><p>整数类型:Int8、Int16、Int32、Int64、UInt8、UInt16、UInt32、UInt64 </p></li><li><p>在32bit平台，Int等价于Int32，Int等价于Int64</p></li><li><p>整数的最值:UInt8.max、Int16.min</p></li><li><p>一般情况下，都是直接使用Int即可</p></li><li><p>浮点类型:Float，32位，精度只有6位;Double，64位，精度至少15位</p></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> letFloat: <span class="type">Float</span> <span class="operator">=</span> <span class="number">30.0</span></span><br><span class="line"><span class="keyword">let</span> letDouble <span class="operator">=</span> <span class="number">30.0</span></span><br></pre></td></tr></table></figure><h3 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h3><p><strong>布尔</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bool <span class="operator">=</span> <span class="literal">true</span> <span class="comment">// 取反是false</span></span><br></pre></td></tr></table></figure><p><strong>字符串</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> string <span class="operator">=</span> <span class="string">&quot;飞翔&quot;</span></span><br></pre></td></tr></table></figure><p><strong>字符(可存储ASCII字符、Unicode字符)</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> character: <span class="type">Character</span> <span class="operator">=</span> <span class="string">&quot;🐶&quot;</span></span><br></pre></td></tr></table></figure><p><strong>整数</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> intDecimal <span class="operator">=</span> <span class="number">15</span> <span class="comment">//十进制</span></span><br><span class="line"><span class="keyword">let</span> intBinary <span class="operator">=</span> <span class="number">0b10001</span> <span class="comment">// 二进制</span></span><br><span class="line"><span class="keyword">let</span> intOctal <span class="operator">=</span> <span class="number">0o21</span> <span class="comment">// 八进制</span></span><br><span class="line"><span class="keyword">let</span> intHexadecimal <span class="operator">=</span> <span class="number">0x11</span> <span class="comment">// 十六进制</span></span><br></pre></td></tr></table></figure><blockquote><p> 整数和浮点数可以添加额外的零或者添加下划线来增强可读性 <code>p100_0000</code>、 <code>1_000_000.000_000_1</code>、 <code>000123.456</code></p></blockquote><p><strong>浮点数</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> doubleDecimal <span class="operator">=</span> <span class="number">15.0</span> <span class="comment">//十进制, 等价于1.25e2,0.0125等价于1.25e-2</span></span><br><span class="line"><span class="keyword">let</span> doubleHexadecimal1 <span class="operator">=</span> <span class="number">0xFp2</span> <span class="comment">// 十六进制, 意味着25×2^2，相当于十进制的60</span></span><br><span class="line"><span class="keyword">let</span> doubleHexadecimal2 <span class="operator">=</span> <span class="number">0xFp-2</span> <span class="comment">// 十六进制, 意味着25×2^-2，相当于十进制的3.75</span></span><br></pre></td></tr></table></figure><p><strong>数组</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array <span class="operator">=</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><p><strong>字典</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dictionary <span class="operator">=</span> [<span class="string">&quot;age&quot;</span>: <span class="number">18</span>, <span class="string">&quot;height&quot;</span>: <span class="number">168</span>, <span class="string">&quot;weight&quot;</span>: <span class="number">120</span>]</span><br></pre></td></tr></table></figure><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p><strong>整数转换</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> int1: <span class="type">UInt16</span> <span class="operator">=</span> <span class="number">2_000</span></span><br><span class="line"><span class="keyword">let</span> int2: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> int3 <span class="operator">=</span> int1 <span class="operator">+</span> <span class="type">UInt16</span>(int2)</span><br></pre></td></tr></table></figure><p><strong>整数、浮点数转换</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> int <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> double <span class="operator">=</span> <span class="number">0.14</span></span><br><span class="line"><span class="keyword">let</span> pi <span class="operator">=</span> <span class="type">Double</span>(int) <span class="operator">+</span> double</span><br><span class="line"><span class="keyword">let</span> intPi <span class="operator">=</span> <span class="type">Int</span>(pi)</span><br></pre></td></tr></table></figure><p><strong>字面量相加</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字面量可以直接相加，欣慰数字字面量本身没有明确类型</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> <span class="number">3</span> <span class="operator">+</span> <span class="number">0.14</span></span><br></pre></td></tr></table></figure><h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http404Error <span class="operator">=</span> (<span class="number">404</span>, <span class="string">&quot;Not Found&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(http404Error.<span class="number">0</span>)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (statusCode, statusMessage) <span class="operator">=</span> http404Error</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(statusCode)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (justTheStatusCode, <span class="keyword">_</span>) <span class="operator">=</span> http404Error</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> http200Error <span class="operator">=</span> (statusCode: <span class="number">200</span>, description: <span class="string">&quot;OK&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(http200Error.statusCode)</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="if-else"><a href="#if-else" class="headerlink" title="if-else"></a>if-else</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">if</span> age <span class="operator">&gt;=</span> <span class="number">22</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Get married&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> age <span class="operator">&gt;=</span> <span class="number">18</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Being a adult&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> age <span class="operator">&gt;=</span> <span class="number">7</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Go to school&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Just a child&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>if后面的条件可以省略小括号</li><li>条件后边的大括号不可以省略</li><li>if后边的条件智能是Bool类型</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误代码</span></span><br><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> age &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">where</span> num <span class="operator">&gt;</span> <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;num is <span class="subst">\(num)</span>&quot;</span>)</span><br><span class="line">    num <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="comment">//打印了5次</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;num is <span class="subst">\(num)</span>&quot;</span>)</span><br><span class="line">    num <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">while</span> num <span class="operator">&gt;</span> <span class="number">0</span> <span class="comment">//打印了1次</span></span><br></pre></td></tr></table></figure><ul><li>repeat-while 相当于C语言的do-while</li><li>这里不用num–，是因为从Swift3开始，去除了自增（++），自减（–）运算符</li></ul><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><h4 id="闭区间运算符：a…b-a-lt-取值-lt-b"><a href="#闭区间运算符：a…b-a-lt-取值-lt-b" class="headerlink" title="闭区间运算符：a…b, a &lt;= 取值 &lt;= b"></a>闭区间运算符：a…b, a &lt;= 取值 &lt;= b</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;Anna&quot;</span>, <span class="string">&quot;Alex&quot;</span>, <span class="string">&quot;Brian&quot;</span>, <span class="string">&quot;Jack&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(names[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Anna, Alex, Brian, Jack</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;Anna&quot;</span>, <span class="string">&quot;Alex&quot;</span>, <span class="string">&quot;Brian&quot;</span>, <span class="string">&quot;Jack&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> range <span class="operator">=</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range &#123;</span><br><span class="line">    <span class="built_in">print</span>(names[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Alex, Brian, Jack</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;Anna&quot;</span>, <span class="string">&quot;Alex&quot;</span>, <span class="string">&quot;Brian&quot;</span>, <span class="string">&quot;Jack&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a<span class="operator">...</span>b &#123;</span><br><span class="line">    <span class="built_in">print</span>(name[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Alex, Brian</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// i默认是let, 如果有需要可以声明为var</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">var</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    i <span class="operator">+=</span> <span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 6 7 8</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">_</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;for&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印了三次</span></span><br></pre></td></tr></table></figure><h4 id="半开区间运算符：a-lt-b-a-lt-取值-lt-b"><a href="#半开区间运算符：a-lt-b-a-lt-取值-lt-b" class="headerlink" title="半开区间运算符：a..&lt;b, a &lt;= 取值 &lt; b"></a>半开区间运算符：a..&lt;b, a &lt;= 取值 &lt; b</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">..&lt;</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 2 3 4</span></span><br></pre></td></tr></table></figure><h4 id="区间运算符用在数组上"><a href="#区间运算符用在数组上" class="headerlink" title="区间运算符用在数组上"></a>区间运算符用在数组上</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;Anna&quot;</span>, <span class="string">&quot;Alex&quot;</span>, <span class="string">&quot;Brian&quot;</span>, <span class="string">&quot;Jack&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="number">0</span><span class="operator">...</span><span class="number">3</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Anna, Alex, Brian, Jack</span></span><br></pre></td></tr></table></figure><p><strong>单侧区间</strong><br>让区间朝着一个方向尽可能的远</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;Anna&quot;</span>, <span class="string">&quot;Alex&quot;</span>, <span class="string">&quot;Brian&quot;</span>, <span class="string">&quot;Jack&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="number">2</span><span class="operator">...</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Brian, Jack</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="operator">...</span><span class="number">2</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Anna, Alex, Brian</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="operator">..&lt;</span><span class="number">2</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Anna, Alex</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range <span class="operator">=</span> <span class="operator">...</span><span class="number">5</span></span><br><span class="line">range.contains(<span class="number">7</span>) <span class="comment">// false</span></span><br><span class="line">range.contains(<span class="number">4</span>) <span class="comment">// true</span></span><br><span class="line">range.contains(<span class="number">7</span><span class="operator">-</span><span class="number">3</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="区间类型"><a href="#区间类型" class="headerlink" title="区间类型"></a>区间类型</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range1: <span class="type">ClosedRange</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> range2: <span class="type">Range</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span>  <span class="number">1</span><span class="operator">..&lt;</span><span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> range3: <span class="type">PartialRangeThrough</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> <span class="operator">...</span><span class="number">5</span></span><br></pre></td></tr></table></figure><p><strong>字符、字符串也能使用区间运算符，但默认不能用在for-in中</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stringRange1 <span class="operator">=</span> <span class="string">&quot;cc&quot;</span><span class="operator">...</span><span class="string">&quot;ff&quot;</span> <span class="comment">// ClosedRange&lt;String&gt; </span></span><br><span class="line">stringRange1.contains(<span class="string">&quot;cb&quot;</span>) <span class="comment">// false </span></span><br><span class="line">stringRange1.contains(<span class="string">&quot;dz&quot;</span>) <span class="comment">// true</span></span><br><span class="line">stringRange1.contains(<span class="string">&quot;fg&quot;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="keyword">let</span> stringRange2 <span class="operator">=</span> <span class="string">&quot;a&quot;</span><span class="operator">...</span><span class="string">&quot;f&quot;</span></span><br><span class="line">stringRange2.contains(<span class="string">&quot;d&quot;</span>) <span class="comment">// true</span></span><br><span class="line">stringRange2.contains(<span class="string">&quot;h&quot;</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// \0到~囊括了所有可能要用到的ASCII字符</span></span><br><span class="line"><span class="keyword">let</span> characterRange: <span class="type">ClosedRange</span>&lt;<span class="type">Character</span>&gt; <span class="operator">=</span> <span class="string">&quot;<span class="subst">\0</span>&quot;</span><span class="operator">...</span><span class="string">&quot;~&quot;</span> characterRange.contains(<span class="string">&quot;G&quot;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="带间隔的区间值"><a href="#带间隔的区间值" class="headerlink" title="带间隔的区间值"></a>带间隔的区间值</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hours <span class="operator">=</span> <span class="number">11</span></span><br><span class="line"><span class="keyword">let</span> hourInterval <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="comment">// tickMark的取值:从4开始，累加2，不超过11</span></span><br><span class="line"><span class="keyword">for</span> tickMark <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">4</span>, through: hours, by: hourInterval) &#123;</span><br><span class="line">    <span class="built_in">print</span>(tickMark)</span><br><span class="line">&#125; <span class="comment">// 4 6 8 10</span></span><br></pre></td></tr></table></figure><h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><ul><li>case、default后面不能写大括号{}</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 1&quot;</span>)</span><br><span class="line"><span class="keyword">break</span> <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 2&quot;</span>)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is other&quot;</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125; <span class="comment">// number is 1</span></span><br></pre></td></tr></table></figure><ul><li>默认可以不写break，并不会贯穿到后面的条件</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 1&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is other&quot;</span>)</span><br><span class="line">&#125; <span class="comment">// number is 1</span></span><br></pre></td></tr></table></figure><ul><li>使用fallthrough可以实现贯穿效果</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 1&quot;</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is other&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// number is 1</span></span><br><span class="line"><span class="comment">// number is 2</span></span><br></pre></td></tr></table></figure><ul><li>switch必须要保证能处理所有情况</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示范，编译器会报错；应该加上default</span></span><br><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;number is 1&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;number is 2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>case、default后面至少要有一条语句</li><li>如果不想做任何事，加个break即可</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 1&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;number is 2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果能保证已处理所有情况，也可以不必使用default</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">enum Answer &#123; case right, wrong &#125; </span><br><span class="line">let answer = Answer.right</span><br><span class="line">switch answer &#123;</span><br><span class="line">case Answer.right:</span><br><span class="line">    print(&quot;right&quot;) </span><br><span class="line">case Answer.wrong: </span><br><span class="line">    print(&quot;wrong&quot;)</span><br><span class="line">&#125;</span><br><span class="line">// 由于已确定answer是Ansewer类型，因此可以省略Answer </span><br><span class="line">switch answer &#123;</span><br><span class="line">case .right:</span><br><span class="line">    print(&quot;right&quot;) </span><br><span class="line">case .wrong:</span><br><span class="line">    print(&quot;wrong&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>switch也支持Character、String类型</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> string <span class="operator">=</span> <span class="string">&quot;Jack&quot;</span></span><br><span class="line"><span class="keyword">switch</span> string &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Jack&quot;</span>:</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Rose&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right person&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Right person</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> character: <span class="type">Character</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="keyword">switch</span> character &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;a&quot;</span>, <span class="string">&quot;A&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The letter A&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not the letter A&quot;</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// The letter A</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> string &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Rose&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right person&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Right person</span></span><br></pre></td></tr></table></figure><ul><li>区间匹配、元组匹配</li><li>可以使用下划线 _ 忽略某个值</li><li>关于case匹配问题，属于模式匹配(Pattern Matching)的范畴，以后会再次详细展开讲解</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count <span class="operator">=</span> <span class="number">62</span></span><br><span class="line"><span class="keyword">switch</span> count &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;none&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span><span class="operator">..&lt;</span><span class="number">5</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a few&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span><span class="operator">..&lt;</span><span class="number">12</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;several&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="number">12</span><span class="operator">..&lt;</span><span class="number">100</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;dozens of&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="number">100</span><span class="operator">..&lt;</span><span class="number">1000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hundreds of&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;many&quot;</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// dozens of</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the origin&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="keyword">_</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the x-axis&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">_</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the y-axis&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> (<span class="operator">-</span><span class="number">2</span><span class="operator">...</span><span class="number">2</span>, <span class="operator">-</span><span class="number">2</span><span class="operator">...</span><span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;inside the box&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;outside of the box&quot;</span>) &#125; </span><br><span class="line"><span class="comment">// inside the box</span></span><br></pre></td></tr></table></figure><ul><li>值绑定 必要时 let也可以改为var</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="keyword">let</span> x, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the x-axis with an x value of <span class="subst">\(x)</span>&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">let</span> y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the y-axis with a y value of <span class="subst">\(y)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;somewhere else at (<span class="subst">\(x)</span>, <span class="subst">\(y)</span>)&quot;</span>) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// on the x-axis with an x value of 2</span></span><br></pre></td></tr></table></figure><ul><li>where</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">1</span>, <span class="operator">-</span><span class="number">1</span>)</span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">==</span> y:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the line x == y&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">==</span> <span class="operator">-</span>y:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;on the line x == -y&quot;</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(<span class="subst">\(x)</span>, <span class="subst">\(y)</span>) is just some arbitrary point&quot;</span>) &#125; </span><br><span class="line">    </span><br><span class="line"><span class="comment">// on the line x == -y</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将所有正数加起来</span></span><br><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">10</span>, <span class="number">20</span>, <span class="operator">-</span><span class="number">10</span>, <span class="operator">-</span><span class="number">20</span>, <span class="number">30</span>, <span class="operator">-</span><span class="number">30</span>]</span><br><span class="line"><span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers <span class="keyword">where</span> num <span class="operator">&gt;</span> <span class="number">0</span> &#123; <span class="comment">// 使用where来过滤num</span></span><br><span class="line">    sum <span class="operator">+=</span> num </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(sum) <span class="comment">// 60</span></span><br></pre></td></tr></table></figure><ul><li>标签语句；指定跳出的循环层级</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">outer: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">4</span> &#123; </span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">4</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> k <span class="operator">==</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span> outer</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i <span class="operator">==</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> outer </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;i == <span class="subst">\(i)</span>, k == <span class="subst">\(k)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数的定义"><a href="#函数的定义" class="headerlink" title="函数的定义"></a>函数的定义</h3><ul><li>形参默认是let，也只能是let</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">pi</span>() -&gt; <span class="type">Double</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">3.14</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20</span>)</span><br></pre></td></tr></table></figure><ul><li>无返回值</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sayHello</span>() -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sayHello</span>() -&gt; () &#123; </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sayHello</span>() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="隐式返回-Implicit-Return"><a href="#隐式返回-Implicit-Return" class="headerlink" title="隐式返回(Implicit Return)"></a>隐式返回(Implicit Return)</h3><ul><li>如果整个函数体是一个单一表达式，那么函数会隐式返回这个表达式</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20</span>) <span class="comment">// 30</span></span><br></pre></td></tr></table></figure><h3 id="返回元组-实现多返回值"><a href="#返回元组-实现多返回值" class="headerlink" title="返回元组:实现多返回值"></a>返回元组:实现多返回值</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">calculate</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; (sum: <span class="type">Int</span>, difference: <span class="type">Int</span>, average: <span class="type">Int</span>) &#123; </span><br><span class="line">    <span class="keyword">let</span> sum <span class="operator">=</span> v1 <span class="operator">+</span> v2</span><br><span class="line">    <span class="keyword">return</span> (sum, v1 <span class="operator">-</span> v2, sum <span class="operator">&gt;&gt;</span> <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> calculate(v1: <span class="number">20</span>, v2: <span class="number">10</span>) </span><br><span class="line">result.sum <span class="comment">// 30</span></span><br><span class="line">result.difference <span class="comment">// 10 </span></span><br><span class="line">result.average <span class="comment">// 15</span></span><br></pre></td></tr></table></figure><h3 id="函数的文档注释"><a href="#函数的文档注释" class="headerlink" title="函数的文档注释"></a>函数的文档注释</h3><p><a href="https://swift.org/documentation/api-design-guidelines/">参考官方文档</a></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 求和【概述】 </span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// 将2个整数相加【更详细的描述】 </span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter v1: 第1个整数</span></span><br><span class="line"><span class="comment">/// - Parameter v2: 第2个整数</span></span><br><span class="line"><span class="comment">/// - Returns: 2个整数的和 </span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Note:传入2个整数即可【批注】</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    v1 <span class="operator">+</span> v2 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参数标签-Argument-Label"><a href="#参数标签-Argument-Label" class="headerlink" title="参数标签(Argument Label)"></a>参数标签(Argument Label)</h3><p><strong>可以修改参数标签</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">goToWork</span>(<span class="params">at</span> <span class="params">time</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this time is <span class="subst">\(time)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">goToWork(at: <span class="string">&quot;08:00&quot;</span>)</span><br><span class="line"><span class="comment">// this time is 08:00</span></span><br></pre></td></tr></table></figure><p><strong>可以使用下划线_ 省略参数标签</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">v1</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><h3 id="默认参数值-Default-Parameter-Value"><a href="#默认参数值-Default-Parameter-Value" class="headerlink" title="默认参数值(Default Parameter Value)"></a>默认参数值(Default Parameter Value)</h3><p><strong>参数可以有默认值</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">check</span>(<span class="params">name</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;nobody&quot;</span>, <span class="params">age</span>: <span class="type">Int</span>, <span class="params">job</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;none&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;name=<span class="subst">\(name)</span>, age=<span class="subst">\(age)</span>, job=<span class="subst">\(job)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">check(name: <span class="string">&quot;Jack&quot;</span>, age: <span class="number">20</span>, job: <span class="string">&quot;Doctor&quot;</span>) <span class="comment">// name=Jack, age=20, job=Doctor</span></span><br><span class="line">check(name: <span class="string">&quot;Rose&quot;</span>, age: <span class="number">18</span>) <span class="comment">// name=Rose, age=18, job=none</span></span><br><span class="line">check(age: <span class="number">10</span>, job: <span class="string">&quot;Batman&quot;</span>) <span class="comment">// name=nobody, age=10, job=Batman</span></span><br><span class="line">check(age: <span class="number">15</span>) <span class="comment">// name=nobody, age=15, job=none</span></span><br></pre></td></tr></table></figure><p><strong>C++的默认参数值有个限制:必须从右往左设置。由于Swift拥有参数标签，因此并没有此类限制<br>但是在省略参数标签时，需要特别注意，避免出错</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的middle不可以省略参数标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>(<span class="keyword">_</span> <span class="params">first</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">10</span>, <span class="params">middle</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">last</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">30</span>) &#123; &#125; test(middle: <span class="number">20</span>)</span><br></pre></td></tr></table></figure><h3 id="可变参数-Variadic-Parameter"><a href="#可变参数-Variadic-Parameter" class="headerlink" title="可变参数(Variadic Parameter)"></a>可变参数(Variadic Parameter)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="type">Int</span>...) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>) <span class="comment">// 100</span></span><br></pre></td></tr></table></figure><p><strong>一个函数最多只能有1个可变参数</strong><br><strong>紧跟在可变参数后面的参数不能省略参数标签</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数string不能省略标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="type">Int</span>..., <span class="params">string</span>: <span class="type">String</span>, <span class="keyword">_</span> <span class="params">other</span>: <span class="type">String</span>) &#123; &#125;</span><br><span class="line">test(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, string: <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Rose&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="Swift自带的print函数"><a href="#Swift自带的print函数" class="headerlink" title="Swift自带的print函数"></a>Swift自带的print函数</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// - Parameters:</span></span><br><span class="line"><span class="comment">///     - items: Zero or more items to print.</span></span><br><span class="line"><span class="comment">///     - separator: A string to print between each item. The default is a single space (`&quot; &quot;`). </span></span><br><span class="line"><span class="comment">///     - terminator: The string to print after all items have been printed. The</span></span><br><span class="line"><span class="comment">///       default is a newline (`&quot;\n&quot;`).</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">print</span>(<span class="keyword">_</span> <span class="params">items</span>: <span class="keyword">Any</span><span class="operator">...</span>, <span class="params">separator</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot; &quot;</span>, <span class="params">terminator</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;<span class="subst">\n</span>&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 1 2 3 4 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, separator: <span class="string">&quot;_&quot;</span>) <span class="comment">// 1_2_3_4_5</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is Jake.&quot;</span>, terminator: <span class="string">&quot;&quot;</span>) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My age is 18.&quot;</span>)</span><br><span class="line"><span class="comment">// My name is Jake.My age is 18.</span></span><br></pre></td></tr></table></figure><h3 id="输入输出参数-In-Out-Parameter"><a href="#输入输出参数-In-Out-Parameter" class="headerlink" title="输入输出参数(In-Out Parameter)"></a>输入输出参数(In-Out Parameter)</h3><p><strong>可以用inout定义一个输入输出参数:可以在函数内部修改外部实参的值</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">swapValues</span>(<span class="keyword">_</span> <span class="params">v1</span>: <span class="keyword">inout</span> <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">v2</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123; </span><br><span class="line">    <span class="keyword">let</span> tmp <span class="operator">=</span> v1</span><br><span class="line">    v1 <span class="operator">=</span> v2</span><br><span class="line">    v2 <span class="operator">=</span> tmp </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> num1 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> num2 <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>num1, <span class="operator">&amp;</span>num2)</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">swapValues</span>(<span class="keyword">_</span> <span class="params">v1</span>: <span class="keyword">inout</span> <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">v2</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123; </span><br><span class="line">    (v1, v2) <span class="operator">=</span> (v2, v1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可变参数不能标记为inout<br>inout参数不能有默认值<br>inout参数只能传入可以被多次赋值的<br>inout参数的本质是地址传递(引用传递)</p></blockquote><h3 id="函数重载-Function-Overload"><a href="#函数重载-Function-Overload" class="headerlink" title="函数重载(Function Overload)"></a>函数重载(Function Overload)</h3><ul><li>规则<ul><li>函数名相同</li><li>参数个数不同 || 参数类型不同 || 参数标签不同</li></ul></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>, <span class="params">v3</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2 <span class="operator">+</span> v3</span><br><span class="line">&#125; <span class="comment">// 参数个数不同</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Double</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    v1 <span class="operator">+</span> <span class="type">Double</span>(v2) &#125; <span class="comment">// 参数类型不同</span></span><br><span class="line">&#125; <span class="comment">// 参数类型不同</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">v1</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125; <span class="comment">//https://cdn.rencheng.cc/blog</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    a<span class="operator">+</span>b</span><br><span class="line">&#125; <span class="comment">// 参数标签不同</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20</span>) <span class="comment">// 30 </span></span><br><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20</span>, v3: <span class="number">30</span>) <span class="comment">// 60 </span></span><br><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20.0</span>) <span class="comment">// 30.0 </span></span><br><span class="line">sum(v1: <span class="number">10.0</span>, v2: <span class="number">20</span>) <span class="comment">// 30.0 </span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>) <span class="comment">// 30</span></span><br><span class="line">sum(a: <span class="number">10</span>, b: <span class="number">20</span>) <span class="comment">// 30</span></span><br></pre></td></tr></table></figure><p><strong>返回值类型与函数重载无关</strong><br><img src="https://cdn.rencheng.cc/blog/g2c1n.png"><br><strong>默认参数值和函数重载一起使用产生二义性时，编译器并不会报错(在C++中会报错)</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>, <span class="params">v3</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">10</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    v1 <span class="operator">+</span> v2 <span class="operator">+</span> v3 </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 会调用sum(v1: Int, v2: Int) </span></span><br><span class="line">sum(v1: <span class="number">10</span>, v2: <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p><strong>可变参数、省略参数标签、函数重载一起使用产生二义性时，编译器有可能会报错</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line">https:<span class="comment">//cdn.rencheng.cc/blog</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">v1</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    v1 <span class="operator">+</span> v2 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="type">Int</span>...) -&gt; <span class="type">Int</span> &#123; <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error: ambiguous use of &#x27;sum&#x27;</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><h3 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h3><p><img src="https://cdn.rencheng.cc/blog/i1pnj.png"></p><ul><li><p>如果开启了编译器优化(Release模式默认会开启优化)，编译器会自动将某些函数变成内联函数 p将函数调用展开成函数体</p></li><li><p>哪些函数不会被自动内联? </p><ul><li>函数体比较长 </li><li>包含递归调用 </li><li>包含动态派发</li></ul></li></ul><p><strong>@inline</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 永远不会被内联(即使开启了编译器优化) </span></span><br><span class="line"><span class="meta">@inline</span>(never) <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启编译器优化后，即使代码很长，也会被内联(递归调用函数、动态派发的函数除外) </span></span><br><span class="line"><span class="meta">@inline</span>(__always) <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在Release模式下，编译器已经开启优化，会自动决定哪些函数需要内联，因此没必要使用@inline</p></blockquote><h3 id="函数类型-Function-Type"><a href="#函数类型-Function-Type" class="headerlink" title="函数类型(Function Type)"></a>函数类型(Function Type)</h3><p><strong>每一个函数都是有类型的，函数类型由形式参数类型、返回值类型组成</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>() &#123; &#125; <span class="comment">// () -&gt; Void 或者 () -&gt; ()</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    a<span class="operator">+</span>b</span><br><span class="line">&#125; <span class="comment">// (Int, Int) -&gt; Int</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义变量</span></span><br><span class="line"><span class="keyword">var</span> fn: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="operator">=</span> sum </span><br><span class="line">fn(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">// 5，调用时不需要参数标签</span></span><br></pre></td></tr></table></figure><p><strong>函数类型作为函数参数</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">+</span> v2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">difference</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    v1 <span class="operator">-</span> v2 </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">printResult</span>(<span class="keyword">_</span> <span class="params">mathFn</span>: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) &#123; </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: <span class="subst">\(mathFn(a, b))</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">printResult(sum, <span class="number">5</span>, <span class="number">2</span>) <span class="comment">// Result: 7</span></span><br><span class="line">printResult(difference, <span class="number">5</span>, <span class="number">2</span>) <span class="comment">// Result: 3</span></span><br></pre></td></tr></table></figure><p><strong>函数类型作为函数返回值</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">next</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    input <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">previous</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input <span class="operator">-</span> <span class="number">1</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">forward</span>(<span class="keyword">_</span> <span class="params">forward</span>: <span class="type">Bool</span>) -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    forward <span class="operator">?</span> next : previous</span><br><span class="line">&#125;</span><br><span class="line">forward(<span class="literal">true</span>)(<span class="number">3</span>) <span class="comment">// 4</span></span><br><span class="line">forward(<span class="literal">false</span>)(<span class="number">3</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>返回值是函数类型的函数，叫做高阶函数(Higher-Order Function)</p></blockquote><h3 id="函数别名（typealias）"><a href="#函数别名（typealias）" class="headerlink" title="函数别名（typealias）"></a>函数别名（typealias）</h3><p><strong>typealias用来给类型起别名</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Byte</span> <span class="operator">=</span> <span class="type">Int8</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Short</span> <span class="operator">=</span> <span class="type">Int16</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Long</span> <span class="operator">=</span> <span class="type">Int64</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Date</span> <span class="operator">=</span> (year: <span class="type">Int</span>, month: <span class="type">Int</span>, day: <span class="type">Int</span>) <span class="keyword">func</span> <span class="title function_">test</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(date.<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(date.year) </span><br><span class="line">&#125;</span><br><span class="line">test((<span class="number">2011</span>, <span class="number">9</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure><p><strong>按照Swift标准库的定义，Void就是空元组()</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Void</span> <span class="operator">=</span> ()</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">IntFn</span> <span class="operator">=</span> (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">difference</span>(<span class="params">v1</span>: <span class="type">Int</span>, <span class="params">v2</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; </span><br><span class="line">    v1 <span class="operator">-</span> v2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fn: <span class="type">IntFn</span> <span class="operator">=</span> difference</span><br><span class="line">fn(<span class="number">20</span>, <span class="number">10</span>) <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">setFn</span>(<span class="keyword">_</span> <span class="params">fn</span>: <span class="type">IntFn</span>) &#123; &#125; setFn(difference)</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getFn</span>() -&gt; <span class="type">IntFn</span> &#123; </span><br><span class="line">    difference </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;基于swift5.1写的&lt;/p&gt;</summary>
    
    
    
    
    <category term="Swift" scheme="https://rencheng.cc/tags/Swift/"/>
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-组件化（CocoaPods）</title>
    <link href="https://rencheng.cc/2019/07/14/ios/general/%E7%BB%84%E4%BB%B6%E5%8C%96%EF%BC%88CocoaPods%EF%BC%89/"/>
    <id>https://rencheng.cc/2019/07/14/ios/general/%E7%BB%84%E4%BB%B6%E5%8C%96%EF%BC%88CocoaPods%EF%BC%89/</id>
    <published>2019-07-14T04:45:02.000Z</published>
    <updated>2019-07-14T04:45:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>随着移动互联网的不断发展，很多程序代码量和业务越来越多，现有架构已经不适合公司业务的发展速度了，很多都面临着重构的问题。<br>在公司项目开发中，如果项目比较小，普通的单工程+MVC架构就可以满足大多数需求了。但是像淘宝、蘑菇街、微信这样的大型项目，原有的单工程架构就不足以满足架构需求了。</p><span id="more"></span><h2 id="组件化简介"><a href="#组件化简介" class="headerlink" title="组件化简介"></a>组件化简介</h2><p>将一个工程分解为各个组件，然后按照某种方式任意组织成为一一个拥有完整业务逻辑的工程。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>组件的独立性</li><li>资源重用</li><li>高效迭代</li><li>配合我们二进制，加快项目的编译速度</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>增加开发人员的学习成本</li><li>增加了代码的冗余，组件化颗粒度越细，中间代码越多</li><li>增加了项目的复杂度，复杂度越高越容易出问题</li></ol><h3 id="组建划分"><a href="#组建划分" class="headerlink" title="组建划分"></a>组建划分</h3><ol><li><p><strong>基础组件</strong><br>基础配置(宏，常量)，分类， 网络(AFNetworking, SDWebImage二次封装)、工具类(日期时间的处理，文件处理，设备处理)</p></li><li><p><strong>功能组件</strong><br>控件(弹幕，轮播器，选项卡);功能(断点续传，音频处理)</p></li><li><p><strong>业务组件</strong><br>业务线一，业务线二。</p></li></ol><h2 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h2><p>多人协作的项目工程中，独立的代码模块划分的重要性是毋庸置疑的。而CocoaPods是一个iOS的包管理第三方工具(类似的概念)，它可以方便的帮助我们管理代码模块。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>一般情况下，下面这条命令就能安装最新的cocoapods到本地。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods</span><br></pre></td></tr></table></figure><p><strong>然而有时候也会由于以下几个问题导致安装失败:</strong></p><ul><li>gem版本太旧</li><li>gem源访问不到</li><li>ruby环境问题</li></ul><p>具体问题还得再去发动Google大法找一找如何解决。</p><h4 id="更新gem版本和替换gem源"><a href="#更新gem版本和替换gem源" class="headerlink" title="更新gem版本和替换gem源"></a>更新gem版本和替换gem源</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem update --system # 这里请翻墙一下</span><br><span class="line">gem -v</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br><span class="line">gem sources -l</span><br><span class="line">https://gems.ruby-china.com</span><br><span class="line"># 确保只有 gems.ruby-china.com</span><br></pre></td></tr></table></figure><h4 id="更换Ruby环境"><a href="#更换Ruby环境" class="headerlink" title="更换Ruby环境"></a>更换Ruby环境</h4><p>由于MacOS系统自带了一个Ruby环境，但是usr/bin的访问权限可能会导致一些问题，最好还是使用Homebrew安装一个ruby。</p><p>使用brew install ruby装好Ruby后记得给Shell配一下环境变量如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;/usr/local/lib/ruby/gems/2.5.0/bin:/usr/local/opt/ruby/bin:/usr/local/bin:$PATH&quot;</span><br></pre></td></tr></table></figure><h2 id="本地pod库"><a href="#本地pod库" class="headerlink" title="本地pod库"></a>本地pod库</h2><h3 id="pod的原理"><a href="#pod的原理" class="headerlink" title="pod的原理"></a>pod的原理</h3><p>CocoaPods的工作主要是通过ProjectName.xcworkspace来组织的，在打开ProjectName.xcworkspace文件后，发现Xcode会多出一个Pods工程。</p><ol><li>库文件引入及配置：<br>库文件的引入主要由Pods工程中的Pods-ProjectName-frameworks.sh脚本负责，在每次编译的时候，该脚本会帮你把预引入的所有三方库文件打包的成ProjectName.a静态库文件，放在我们原Xcode工程中Framework文件夹下，供工程使用。<br>如果Podfile使用了use_frameworks!,这是生成的是.framework的动态库文件。引入方式也略有不同。</li><li>Resource文件：<br>Resource资源文件主要由Pods工程中的Pods-ProjectName-resources.sh脚本负责，在每次编译的时候，该脚本会帮你将所有三方库的Resource文件copy到目标目录中。</li><li>依赖参数设置：<br>在Pods工程中的的每个库文件都有一个相应的SDKName.xcconfig，在编译时，CocoaPods就是通过这些文件来设置所有的依赖参数的，编译后，在主工程的Pods文件夹下会生成两个配置文件，Pods-ProjectName.debug.xcconfig、Pods-ProjectName.release.xcconfig。</li></ol><h3 id="创建本地pod库"><a href="#创建本地pod库" class="headerlink" title="创建本地pod库"></a>创建本地pod库</h3><p><strong>1.创建一个本地Demo工程</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib create RCDownloader</span><br></pre></td></tr></table></figure><p><strong>2.填入询问的问题，填完之后会自动打开一个Demo工程</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">What platform do you want to use?? [ iOS / macOS ]</span><br><span class="line"> &gt; iOS</span><br><span class="line">What language do you want to use?? [ Swift / ObjC ]</span><br><span class="line"> &gt; Objc</span><br><span class="line">Would you like to include a demo application with your library? [ Yes / No ]</span><br><span class="line"> &gt; Yes</span><br><span class="line">Which testing frameworks will you use? [ Specta / Kiwi / None ]</span><br><span class="line"> &gt; None</span><br><span class="line">Would you like to do view based testing? [ Yes / No ]</span><br><span class="line"> &gt; No</span><br><span class="line">What is your class prefix?</span><br><span class="line"> &gt; RC</span><br></pre></td></tr></table></figure><p><strong>3.找到<code>Pod工程</code>下面有一个<code>Development Pods</code>文件夹下面的<code>工程名</code>下面的<code>ReplaceMe.m</code>文件</strong></p><p><strong>4.右键<code>ReplaceMe.m</code>文件，<code>Show in Finder</code>到Finder文件夹，把我们封装的<code>.h和.m文件</code>替换掉<code>ReplaceMe.m</code></strong></p><p><strong>5.将替换进来的文件，拖拽到工程刚刚<code>ReplaceMe.m</code>所在的文件夹，然后全选Target</strong></p><p><strong>6.<code>主工程</code>下面有一个<code>Example for &lt;classname&gt;</code>文件夹，这个文件夹是用来调试的类库</strong></p><p><strong>7.在我们需要引入该Pod库的工程的<code>Podfile</code>文件中加入<code>pod &#39;RCDownloader&#39;, :path =&gt; &#39;可以是绝对路径/相对路径&#39;</code></strong></p><p><strong>8.执行<code>pod install</code></strong></p><p><strong>注意：</strong><br>如果我们的Pod有需要依赖的Framework，那么就打开组建工程的spec文件，里面有配置framework的地方。</p><h2 id="远程pod库"><a href="#远程pod库" class="headerlink" title="远程pod库"></a>远程pod库</h2><h3 id="创建远程索引库"><a href="#创建远程索引库" class="headerlink" title="创建远程索引库"></a>创建远程索引库</h3><p><strong>1.打开<a href="https://gitee.com/">码云</a>(<del>他家私有库不要钱，github私有库要钱</del>)</strong></p><p><strong>2.创建一个项目：名称是<code>RCSpecs</code>，私有的Objc</strong></p><p><strong>3.添加本地索引库</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo add RCSpecs https://gitee.com/****/RCSpecs.git</span><br></pre></td></tr></table></figure><p><strong>4.查看本地索引库列表</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo</span><br></pre></td></tr></table></figure><p><strong>5.将本地Pod库关联本地索引库</strong><br>1.在码云上再创建一个项目名称是<code>RCDownloader</code>私有的<br>2.终端切换到RCDownloader工程根目录<br>3.提交代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;初始化工程&quot;</span><br><span class="line">git remote add origin https://gitee.com/****/RCDownloader.git</span><br><span class="line">git push origin master -f</span><br></pre></td></tr></table></figure><p>4.修改本地spec文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.homepage         = &#x27;https://gitee.com/htyh_manito_rencheng11/RCDownloader&#x27;</span><br><span class="line">s.source           = &#123; :git =&gt; &#x27;https://gitee.com/******/RCDownloader.git&#x27;, :tag =&gt; s.version.to_s &#125;</span><br></pre></td></tr></table></figure><p>5.打 tag 0.1.0（跟s.version保持一致）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag 0.1.0</span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure><p>6.将修改的spec文件上传到远程仓库</p><figure class="highlight plaintext"><figcaption><span>add .</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;修改spec&quot;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>7.验证spec文件(警告可以忽略)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint</span><br></pre></td></tr></table></figure><p>8.上传RCDownloader.spec到远程索引库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo push RCSpecs RCDownloader.podspec --allow-warnings</span><br></pre></td></tr></table></figure><p>9.Podfile文件中增加source</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source &#x27;https://gitee.com/htyh_manito_rencheng11/RCSpecs.git&#x27;</span><br><span class="line">source &#x27;https://github.com/CocoaPods/Specs.git&#x27;</span><br></pre></td></tr></table></figure><p>10.pod install引入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 这么写可以每次获取最新版本</span><br><span class="line">pod RCDownloader, :git=&gt;&#x27;http://*****/RCDownloader.git&#x27;</span><br><span class="line">pod install</span><br></pre></td></tr></table></figure><h2 id="清除Pod缓存"><a href="#清除Pod缓存" class="headerlink" title="清除Pod缓存"></a>清除Pod缓存</h2><ol><li>移除项目目录 Pods 文件下的 <code>xxx</code>。</li><li>删除 <code>CocoaPods</code> 目录缓存, 找到 <code>~/Library/Caches/CocoaPods/Pods/Release</code>, 删除此目录。</li><li>点击<code>Xcode -&gt; Preferences -&gt; Locations -&gt; Derived Data</code> 点击下方的右箭头跳转到相应目, 删除此目录即可。</li><li>项目根目录执行<code>pod repo update</code>。</li><li>项目根目录执行<code>pod install</code>。</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;随着移动互联网的不断发展，很多程序代码量和业务越来越多，现有架构已经不适合公司业务的发展速度了，很多都面临着重构的问题。&lt;br&gt;在公司项目开发中，如果项目比较小，普通的单工程+MVC架构就可以满足大多数需求了。但是像淘宝、蘑菇街、微信这样的大型项目，原有的单工程架构就不足以满足架构需求了。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="组件化" scheme="https://rencheng.cc/tags/%E7%BB%84%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>mac-软件推荐</title>
    <link href="https://rencheng.cc/2019/07/14/recommend/mac-%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/"/>
    <id>https://rencheng.cc/2019/07/14/recommend/mac-%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/</id>
    <published>2019-07-14T04:31:14.000Z</published>
    <updated>2019-07-14T04:31:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>Mac软件推荐（iOS开发+服务器运维+常用软件）（包含下载地址）</p><span id="more"></span><h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><table><thead><tr><th align="left">名称</th><th align="left">描述</th><th align="left">下载地址</th></tr></thead><tbody><tr><td align="left">sip</td><td align="left">颜色提取器</td><td align="left"><a href="https://object.rencheng.cc/software/mac/Sip.zip">博主</a></td></tr><tr><td align="left">Apple Configurator 2</td><td align="left">AppStore中ipa包获取工具</td><td align="left"><a href="https://itunes.apple.com/cn/app/apple-configurator-2/id1037126344?mt=12&ign-mpt=uo=8">AppStore</a></td></tr><tr><td align="left">Assets提取工具</td><td align="left">提取ipa包中的图片</td><td align="left"><a href="https://object.rencheng.cc/software/mac/Assets%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7.zip">博主</a></td></tr><tr><td align="left">Prepo</td><td align="left">AppIcon 生成工具</td><td align="left"><a href="https://itunes.apple.com/cn/app/p.m.-prepo-free/id476533227?mt=12">AppStore</a></td></tr><tr><td align="left">Asset Catalog Creator Pro</td><td align="left">AppIcon/LaunchImage生成工具</td><td align="left"><a href="https://apps.apple.com/cn/app/asset-catalog-creator-free/id866571115?mt=12">AppStore</a></td></tr><tr><td align="left">HandShaker</td><td align="left">安卓手机管理器</td><td align="left"><a href="https://apps.apple.com/cn/app/handshaker-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/id1012930195?mt=12">AppStore</a></td></tr></tbody></table><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><table><thead><tr><th align="left">名称</th><th align="left">描述</th><th align="left">下载地址</th></tr></thead><tbody><tr><td align="left">FileZilla</td><td align="left">ftp、sftp连接客户端</td><td align="left"><a href="https://object.rencheng.cc/software/mac/FileZilla_3.28.0_macosx-x86.app.tar.bz2">博主</a></td></tr><tr><td align="left">Microsoft Remote Desktop</td><td align="left">windows server连接工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/MicrosoftRemoteDesktop.dmg">博主</a></td></tr><tr><td align="left">parallels client    windows</td><td align="left">server 连接工具</td><td align="left"><a href="https://itunes.apple.com/cn/app/parallels-client/id600925318?mt=12">AppStore</a></td></tr><tr><td align="left">ShellCraft</td><td align="left">ssh连接管理器</td><td align="left"><a href="https://object.rencheng.cc/software/mac/ShellCraft%20for%20MAC1.0.8.dmg">博主</a></td></tr><tr><td align="left">SocketTool</td><td align="left">socket调试工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/SocketTool.zip">博主</a></td></tr><tr><td align="left">Sequel Pro</td><td align="left">MySQL连接工具</td><td align="left"><a href="http://www.sequelpro.com/">官方</a> <a href="https://object.rencheng.cc/software/mac/sequel-pro-1.1.2.dmg">博主</a></td></tr><tr><td align="left">Medis</td><td align="left">Redis连接工具</td><td align="left"><a href="https://itunes.apple.com/cn/app/medis-gui-for-redis/id1063631769?mt=12">AppStore</a> <a href="https://object.rencheng.cc/software/mac/Medis.zip">博主</a></td></tr></tbody></table><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><table><thead><tr><th align="left">名称</th><th align="left">描述</th><th align="left">下载地址</th></tr></thead><tbody><tr><td align="left">MWeb</td><td align="left">Markdown编辑工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/MWeb_3.1.8_uswd.dmg">博主</a></td></tr><tr><td align="left">OmniGraffle</td><td align="left">画图</td><td align="left"><a href="https://object.rencheng.cc/software/mac/macOmniGraffle-7.17.5.dmg">博主</a></td></tr><tr><td align="left">CleanMyMac X</td><td align="left">空间清理工具</td><td align="left"><a href="https://macpaw.com/cleanmymac">官方</a> <a href="https://object.rencheng.cc/software/mac/CleanMyMac_X_4.6.1%E4%B8%AD%E6%96%87%E7%A0%B4%E8%A7%A3%E7%89%88.dmg">博主</a></td></tr><tr><td align="left">zoom.us</td><td align="left">屏幕共享软件</td><td align="left"><a href="https://zoom.us/download#client_4meeting">官方</a> <a href="https://object.rencheng.cc/software/mac/Zoom.pkg">博主</a></td></tr><tr><td align="left">VirtualBox</td><td align="left">虚拟机</td><td align="left"><a href="https://www.virtualbox.org/wiki/Downloads">官方</a></td></tr><tr><td align="left">VLC</td><td align="left">流媒体播放软件</td><td align="left"><a href="https://object.rencheng.cc/software/mac/vlc-mac-2.2.8.dmg">博主</a></td></tr><tr><td align="left">Shadowsocks</td><td align="left">VPN</td><td align="left"><a href="https://object.rencheng.cc/software/mac/ShadowsocksX-NG-R8.zip">博主</a></td></tr><tr><td align="left">ClashX</td><td align="left">VPN</td><td align="left"><a href="https://object.rencheng.cc/software/mac/ClashX.dmg">博主</a></td></tr><tr><td align="left">Realm Browser</td><td align="left">Realm数据库查看</td><td align="left"><a href="https://itunes.apple.com/cn/app/realm-browser/id1007457278?mt=12">AppStore</a></td></tr><tr><td align="left">OBS</td><td align="left">音视频推流工具</td><td align="left"><a href="https://obsproject.com/">官方</a></td></tr><tr><td align="left">Charles</td><td align="left">抓包工具</td><td align="left"><a href="https://www.charlesproxy.com/download/">官方</a> <a href="https://www.zzzmode.com/mytools/charles/">破解工具</a></td></tr><tr><td align="left">java-抓包</td><td align="left">抓包工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/java-%E6%8A%93%E5%8C%85.zip">博主</a></td></tr><tr><td align="left">jmeter</td><td align="left">性能测试工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/apache-jmeter-3.3.zip">博主</a></td></tr><tr><td align="left">AirServer</td><td align="left">镜像服务</td><td align="left"><a href="https://object.rencheng.cc/software/mac/AirServer_7.2.0.dmg">博主</a></td></tr><tr><td align="left">Xmind2020</td><td align="left">思维导图</td><td align="left"><a href="https://object.rencheng.cc/software/mac/XMind2020_10.1.3.zip">博主</a></td></tr><tr><td align="left">jetbrains2020.2激活</td><td align="left">激活工具</td><td align="left"><a href="https://object.rencheng.cc/software/mac/jetbrains2020.2%E6%BF%80%E6%B4%BB.zip">博主</a></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;Mac软件推荐（iOS开发+服务器运维+常用软件）（包含下载地址）&lt;/p&gt;</summary>
    
    
    
    
    <category term="推荐" scheme="https://rencheng.cc/tags/%E6%8E%A8%E8%8D%90/"/>
    
  </entry>
  
  <entry>
    <title>iOS-屏幕尺寸</title>
    <link href="https://rencheng.cc/2019/07/14/ios/general/%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8/"/>
    <id>https://rencheng.cc/2019/07/14/ios/general/%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8/</id>
    <published>2019-07-14T03:51:33.000Z</published>
    <updated>2019-07-14T03:51:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>在苹果推出iPhoneX后，可以说苹果的机型有很多了，显示屏的大小和形状也变得各式各样。<br>iPhone各型号物理分辨率和逻辑分辨率列举</p><span id="more"></span><table><thead><tr><th align="left">设备</th><th align="left">尺寸</th><th align="left">逻辑分辨率</th><th align="left">Scale</th><th align="left">设备分辨率</th><th align="left">PPI</th></tr></thead><tbody><tr><td align="left">3GS</td><td align="left">3.5</td><td align="left">320x480</td><td align="left">@1x</td><td align="left">320x480</td><td align="left">163</td></tr><tr><td align="left">4s</td><td align="left">3.5</td><td align="left">320x480</td><td align="left">@2x</td><td align="left">640x960</td><td align="left">326</td></tr><tr><td align="left">5/5c/5s/SE</td><td align="left">4</td><td align="left">320x568</td><td align="left">@2x</td><td align="left">640x1136</td><td align="left">326</td></tr><tr><td align="left">6/6s/7/8/SE2</td><td align="left">4.7</td><td align="left">375x667</td><td align="left">@2x</td><td align="left">750x1334</td><td align="left">326</td></tr><tr><td align="left">6/6s/7/8 Plus</td><td align="left">5.5</td><td align="left">414x736</td><td align="left">@3x</td><td align="left">1242x2208</td><td align="left">401</td></tr><tr><td align="left">X/Xs/11 Pro</td><td align="left">5.8</td><td align="left">375x812</td><td align="left">@3x</td><td align="left">1125x2436</td><td align="left">458</td></tr><tr><td align="left">Xs Max/11 Pro Max</td><td align="left">6.5</td><td align="left">414x896</td><td align="left">@3x</td><td align="left">1242×2688</td><td align="left">458</td></tr><tr><td align="left">XR/11</td><td align="left">6.1</td><td align="left">414x896</td><td align="left">@2x</td><td align="left">828×1792</td><td align="left">326</td></tr><tr><td align="left">12 Mini</td><td align="left">5.4</td><td align="left">375x812</td><td align="left">@3x</td><td align="left">1080×2340</td><td align="left">476</td></tr><tr><td align="left">12/12 Pro</td><td align="left">6.1</td><td align="left">390x844</td><td align="left">@3x</td><td align="left">1170×2532</td><td align="left">460</td></tr><tr><td align="left">12 Pro Max</td><td align="left">6.7</td><td align="left">428x926</td><td align="left">@3x</td><td align="left">1284×2778</td><td align="left">458</td></tr></tbody></table><p><a href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/#Device%20Screen%20Sizes%20and%20Orientations">https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/#Device%20Screen%20Sizes%20and%20Orientations</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在苹果推出iPhoneX后，可以说苹果的机型有很多了，显示屏的大小和形状也变得各式各样。&lt;br&gt;iPhone各型号物理分辨率和逻辑分辨率列举&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>hexo-增加时序图</title>
    <link href="https://rencheng.cc/2019/07/14/hexo/%E5%A2%9E%E5%8A%A0%E6%97%B6%E5%BA%8F%E5%9B%BE/"/>
    <id>https://rencheng.cc/2019/07/14/hexo/%E5%A2%9E%E5%8A%A0%E6%97%B6%E5%BA%8F%E5%9B%BE/</id>
    <published>2019-07-14T03:08:49.000Z</published>
    <updated>2019-07-14T03:08:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>hexo默认是不支持UML时序图的，但是官方网站上提供了一个插件让我们支持时序图</p><span id="more"></span><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><a href="https://github.com/bubkoo/hexo-filter-sequence">hexo-filter-sequence</a> 插件:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-filter-sequence</span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>站点配置文件 _config.yml 中增加如下配置:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sequence:</span><br><span class="line">  webfont: https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js</span><br><span class="line">  raphael: https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js</span><br><span class="line">  underscore: https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js</span><br><span class="line">  sequence: https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js</span><br><span class="line">  css: # optional, the url for css, such as hand drawn theme </span><br><span class="line">  options: </span><br><span class="line">    theme: simple</span><br><span class="line">    css_class:</span><br></pre></td></tr></table></figure><h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p>源码修改后才能正常使用，进入插件目录作如下修改：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">var assign = require(&#x27;deep-assign&#x27;);</span><br><span class="line">var renderer = require(&#x27;./lib/renderer&#x27;);</span><br><span class="line">hexo.config.sequence = assign(&#123;</span><br><span class="line">  webfont: &#x27;https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js&#x27;,</span><br><span class="line">  raphael: &#x27;https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js&#x27;,</span><br><span class="line">  underscore: &#x27;https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js&#x27;,</span><br><span class="line">  sequence: &#x27;https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js&#x27;,</span><br><span class="line">  css: &#x27;&#x27;,</span><br><span class="line">  options: &#123;</span><br><span class="line">    theme: &#x27;simple&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, hexo.config.sequence);</span><br><span class="line">hexo.extend.filter.register(&#x27;before_post_render&#x27;, renderer.render, 9);</span><br></pre></td></tr></table></figure><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>新建文章，增加如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Alice-&gt;Bob: Hello Bob, how are you?</span><br><span class="line">Note right of Bob: Bob thinks</span><br><span class="line">Bob--&gt;Alice: I am good thanks!</span><br></pre></td></tr></table></figure><p>效果如下：<br>Alice-&gt;Bob: Hello Bob, how are you?<br>Note right of Bob: Bob thinks<br>Bob–&gt;Alice: I am good thanks!</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;hexo默认是不支持UML时序图的，但是官方网站上提供了一个插件让我们支持时序图&lt;/p&gt;</summary>
    
    
    
    
    <category term="教程" scheme="https://rencheng.cc/tags/%E6%95%99%E7%A8%8B/"/>
    
    <category term="hexo" scheme="https://rencheng.cc/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>iOS-高精度定时器</title>
    <link href="https://rencheng.cc/2019/07/14/ios/objc/iOS-%E9%AB%98%E7%B2%BE%E5%BA%A6%E5%AE%9A%E6%97%B6%E5%99%A8/"/>
    <id>https://rencheng.cc/2019/07/14/ios/objc/iOS-%E9%AB%98%E7%B2%BE%E5%BA%A6%E5%AE%9A%E6%97%B6%E5%99%A8/</id>
    <published>2019-07-14T02:59:35.000Z</published>
    <updated>2019-07-14T02:59:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>苹果上面的App一般都是不允许在后台运行的，比如说定时器计时，当用户切换到后台，定时器就被被挂起，等回到App之后，才会Resume。</p><span id="more"></span><h2 id="场景描述"><a href="#场景描述" class="headerlink" title="场景描述"></a>场景描述</h2><p>在实际开发过程中，我们经常遇到定时器NSTimer不准确的情况。比如</p><pre><code>1. 滑动视图的时候，NSTimer干脆就不走了；2. 两台设备同样倒计时300，有的设备走得快，有的设备走得慢，如果是抢购商品，这个不准确就很扯皮了；</code></pre><p>解决方案：</p><pre><code>1. 可以通过切换runloop的模式来处理2. 更换计时方案</code></pre><h2 id="NSTimer为什么不准"><a href="#NSTimer为什么不准" class="headerlink" title="NSTimer为什么不准"></a>NSTimer为什么不准</h2><p>NSTimer受runloop的影响，由于runloop需要处理很多任务，导致NSTimer的精度降低</p><h2 id="dispatch-source-t-（高精度定时器）"><a href="#dispatch-source-t-（高精度定时器）" class="headerlink" title="dispatch_source_t （高精度定时器）"></a>dispatch_source_t （高精度定时器）</h2><p><strong>简述</strong>：GCD 比 NSTimer 更准的定时器<br><strong>优点</strong>：精度很高，系统自动触发，系统级别</p><p><strong>注意</strong>：dispatch_source_t在后台可以走，但是在一段时间（30s或3min）后，程序也会被挂起，这个时候dispatch_source_t还是不准，所以我们要给程序开一个后台任务，让程序在后台能夺走一会儿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">// 宏定义 @weakify是YYKit提供的</span><br><span class="line">#ifndef WEAK_SELF</span><br><span class="line">#define WEAK_SELF @weakify(self)</span><br><span class="line">#define STRONG_SELF @strongify(self)</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">@interface classname ()</span><br><span class="line">// 定义属性</span><br><span class="line">@property (nonatomic, strong) dispatch_source_t timer;    //!&lt; 定时器</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - 开始定时器</span><br><span class="line">- (void)startTime &#123;</span><br><span class="line">    dispatch_resume(self.timer);</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - 关闭定时器</span><br><span class="line">- (void)closeTime &#123;</span><br><span class="line">    dispatch_source_cancel(_timer);</span><br><span class="line">    dispatch_source_set_cancel_handler(_timer, ^&#123;</span><br><span class="line">        self-&gt;_timer = nil;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 懒加载</span><br><span class="line">- (dispatch_source_t)timer &#123;</span><br><span class="line">    if (!_timer) &#123;</span><br><span class="line">        WEAK_SELF</span><br><span class="line">        _timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_main_queue());</span><br><span class="line">        dispatch_source_set_timer(_timer, dispatch_walltime(NULL, 0), 1.0 * NSEC_PER_SEC, 0);</span><br><span class="line">        dispatch_source_set_event_handler(_timer, ^&#123;</span><br><span class="line">            STRONG_SELF</span><br><span class="line">            if (!self) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            if (self.lessSecond &lt; 0) &#123;</span><br><span class="line">                dispatch_source_cancel(self-&gt;_timer);</span><br><span class="line">                [self showTimeOutAlertController];</span><br><span class="line">                [(AppDelegate *)[UIApplication sharedApplication].delegate endBackgroundTask];</span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                NSInteger min = self.lessSecond / 60;</span><br><span class="line">                NSInteger second = self.lessSecond % 60;</span><br><span class="line">                NSString *title = [NSString stringWithFormat:@&quot;%02ld:%02ld&quot;, min, second];</span><br><span class="line">                NSLog(@&quot;%@&quot;, title);</span><br><span class="line">                self.lessSecond--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return _timer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@interface AppDelegate : UIResponder &lt;UIApplicationDelegate&gt;</span><br><span class="line">@property (strong</span><br><span class="line">- (void)endBackgroundTask;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">@interface AppDelegate ()</span><br><span class="line">@property (nonatomic, assign) UIBackgroundTaskIdentifier backgroundTaskIdentifier;  //!&lt; 后台任务标识</span><br><span class="line">@property (nonatomic, strong) NSTimer *backgroundTimer;        //!&lt; 后台定时器</span><br><span class="line">@end</span><br><span class="line">/ 当应用程序掉到后台时，执行该方法</span><br><span class="line"></span><br><span class="line">// 当一个 iOS 应用被送到后台,它的主线程会被暂停。你用 NSThread 的 detachNewThreadSelector:toTar get:withObject:类方法创建的线程也被挂起了。</span><br><span class="line">// 如果你想在后台完成一个长期任务,就必须调用 UIApplication 的 beginBackgroundTaskWithExpirationHandler:实例方法,来向 iOS 借点时间。</span><br><span class="line">// 默认情况下，如果在这个期限内,长期任务没有被完成,iOS 将终止程序。</span><br><span class="line">// 怎么办？可以使用 beginBackgroundTaskWithExpirationHandler:实例方法,来向 iOS 再借点时间。</span><br><span class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;    </span><br><span class="line">    // 使用这个方法来释放公共的资源、存储用户数据、停止我们定义的定时器（timers）、并且存储在程序终止前的相关信息。</span><br><span class="line">    // 如果，我们的应用程序提供了后台执行的方法，那么，在程序退出时，这个方法将代替applicationWillTerminate方法的执行。</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    // 标记一个长时间运行的后台任务将开始</span><br><span class="line">    // 通过调试，发现，iOS给了我们额外的10分钟（600s）来执行这个任务。</span><br><span class="line">    self.backgroundTaskIdentifier = [application beginBackgroundTaskWithExpirationHandler:^(void) &#123;</span><br><span class="line">        // 当应用程序留给后台的时间快要到结束时（应用程序留给后台执行的时间是有限的）， 这个Block块将被执行</span><br><span class="line">        // 我们需要在次Block块中执行一些清理工作。</span><br><span class="line">        // 如果清理工作失败了，那么将导致程序挂掉</span><br><span class="line">        </span><br><span class="line">        // 清理工作需要在主线程中用同步的方式来进行</span><br><span class="line">        [self endBackgroundTask];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    // 模拟一个Long-Running Task</span><br><span class="line">    self.backgroundTimer = [NSTimer scheduledTimerWithTimeInterval:1.0f</span><br><span class="line">                                                            target:self</span><br><span class="line">                                                          selector:@selector(timerMethod:)</span><br><span class="line">                                                          userInfo:nil</span><br><span class="line">                                                           repeats:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)endBackgroundTask &#123;</span><br><span class="line">    dispatch_queue_t mainQueue = dispatch_get_main_queue();</span><br><span class="line">    AppDelegate *weakSelf = self;</span><br><span class="line">    dispatch_async(mainQueue, ^(void) &#123;</span><br><span class="line">        AppDelegate *strongSelf = weakSelf;</span><br><span class="line">        if (strongSelf != nil) &#123;</span><br><span class="line">            [strongSelf.backgroundTimer invalidate];// 停止定时器</span><br><span class="line">            self-&gt;_backgroundTimer = nil;// 停止定时器</span><br><span class="line">            // 每个对 beginBackgroundTaskWithExpirationHandler:方法的调用,必须要相应的调用 endBackgroundTask:方法。这样，来告诉应用程序你已经执行完成了。</span><br><span class="line">            // 也就是说,我们向 iOS 要更多时间来完成一个任务,那么我们必须告诉 iOS 你什么时候能完成那个任务。</span><br><span class="line">            // 也就是要告诉应用程序：“好借好还”嘛。</span><br><span class="line">            // 标记指定的后台任务完成</span><br><span class="line">            [[UIApplication sharedApplication] endBackgroundTask:self.backgroundTaskIdentifier];</span><br><span class="line">            // 销毁后台任务标识符</span><br><span class="line">            strongSelf.backgroundTaskIdentifier = UIBackgroundTaskInvalid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 模拟的一个 Long-Running Task 方法</span><br><span class="line">- (void)timerMethod:(NSTimer *)paramSender &#123;</span><br><span class="line">    // backgroundTimeRemaining 属性包含了程序留给的我们的时间</span><br><span class="line">    NSTimeInterval backgroundTimeRemaining =[[UIApplication sharedApplication] backgroundTimeRemaining];</span><br><span class="line">    if (backgroundTimeRemaining == DBL_MAX) &#123;</span><br><span class="line">        NSLog(@&quot;Background Time Remaining = Undetermined&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        NSLog(@&quot;Background Time Remaining = %.02f Seconds&quot;, backgroundTimeRemaining);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;苹果上面的App一般都是不允许在后台运行的，比如说定时器计时，当用户切换到后台，定时器就被被挂起，等回到App之后，才会Resume。&lt;/p&gt;</summary>
    
    
    
    
    <category term="iOS" scheme="https://rencheng.cc/tags/iOS/"/>
    
    <category term="Objc" scheme="https://rencheng.cc/tags/Objc/"/>
    
  </entry>
  
  <entry>
    <title>Python-网络编程（一）</title>
    <link href="https://rencheng.cc/2019/07/14/python/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B02/"/>
    <id>https://rencheng.cc/2019/07/14/python/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B02/</id>
    <published>2019-07-14T02:28:42.000Z</published>
    <updated>2019-07-14T02:28:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>基于Python语言的网络编程，主要是socket网络通信</p><span id="more"></span><p>socket网络通信</p><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用于网络计算机通信的一种接口</span><br><span class="line">利用socket在系统软件级实现数据收发处理</span><br><span class="line">最早由加州大学伯克利分校开发</span><br><span class="line">是目前互联网通信的基础、标准</span><br><span class="line">计算机双方要进行通信，必须创建socket</span><br></pre></td></tr></table></figure><h3 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h3><ol><li>服务器<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">创建(socket)</span><br><span class="line">绑定地址(bind)</span><br><span class="line">监听(listen)</span><br><span class="line">接受(accept)</span><br><span class="line">接收数据(recv)</span><br><span class="line">发送数据(send)</span><br><span class="line">关闭连接(close)</span><br></pre></td></tr></table></figure></li><li>客户端<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建(socket)</span><br><span class="line">连接服务器(connect)</span><br><span class="line">发送数据(send)</span><br><span class="line">接收数据(recv)</span><br><span class="line">关闭连接(close)</span><br></pre></td></tr></table></figure></li></ol><h3 id="套接字类型"><a href="#套接字类型" class="headerlink" title="套接字类型"></a>套接字类型</h3><ol><li>流式套接字(SOCK_STREAM)： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">面向连接、可靠传输、数据无差错的收发序列</span><br><span class="line">提供流量控制功能</span><br><span class="line">数据被看做字节流，长度无限制，多个数据包的数据持续流入</span><br></pre></td></tr></table></figure></li><li>数据报套接字(SOCK_DGRAM) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">面向无连接、不可靠传输，数据可能丢失、错误、重发</span><br><span class="line">数据构成一个一个独立的数据报，每次一次发送就是一个数据报</span><br></pre></td></tr></table></figure></li></ol><h3 id="Socket方法"><a href="#Socket方法" class="headerlink" title="Socket方法"></a>Socket方法</h3><ol><li><p>创建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">socket.socket(socket_family = AF_INET,  socket_type = SOCK_STREAM, proto = 0)</span><br><span class="line">参数：socket_family  地址族类型, 默认填写AF_INET</span><br><span class="line">     socket_type    套接字类型</span><br><span class="line">     SOCK_STREAM    流式套接字</span><br><span class="line">     SOCK_DGRAM     数据报套接字</span><br><span class="line">     proto          子协议类型，默认填写0</span><br></pre></td></tr></table></figure></li><li><p>绑定：绑定IP地址和端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socket.bind(address)</span><br><span class="line">参数：address   地址，元组类型; 第一个值为IP，第二个值为端口</span><br></pre></td></tr></table></figure></li><li><p>监听：使服务器可以接收连接请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socket.listen(backlog)</span><br><span class="line">参数： backlog     未接收连接请求个数; 超过该值，则会拒绝后面的请求</span><br></pre></td></tr></table></figure></li><li><p>接受连接：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connfd,addr = sockfd.accept()</span><br><span class="line">功能：阻塞，等待客户端连接请求; </span><br><span class="line">如果有新的连接，则返回; </span><br><span class="line">返回值为一个新的socket(用于数据通信)和客户端地址</span><br></pre></td></tr></table></figure></li><li><p>接收数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = connfd.recv(buffersize)</span><br><span class="line">功能 ： 流式套接字接收消息</span><br><span class="line">参数 ： 一次最多接收多大的消息  字节</span><br><span class="line">返回值 ： 返回接收到的内容</span><br><span class="line">          如果对方关闭或发送完成，则返回空串</span><br></pre></td></tr></table></figure></li><li><p>发送数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = connfd.send(data)</span><br><span class="line">功能 ： 流式套接字发送消息</span><br><span class="line">参数 ： 要发送的内容  要求bytes格式</span><br><span class="line">返回值 ： 返回实际发送的字节数</span><br></pre></td></tr></table></figure></li><li><p>关闭套接字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sockfd.close（）</span><br><span class="line">功能：关闭套接字 tcp套接字连接断开</span><br></pre></td></tr></table></figure></li><li><p>请求连接(只能在客户端调用)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sockfd.connect(addr)</span><br><span class="line">功能: 连接服务端套接字</span><br><span class="line">参数: addr  服务端地址</span><br></pre></td></tr></table></figure></li></ol><h3 id="示例程序"><a href="#示例程序" class="headerlink" title="示例程序"></a>示例程序</h3><h4 id="简单交互"><a href="#简单交互" class="headerlink" title="简单交互"></a>简单交互</h4><h5 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">address = (&quot;127.0.0.1&quot;, 9999)</span><br><span class="line"></span><br><span class="line">svr = socket.socket()</span><br><span class="line">svr.bind(address)</span><br><span class="line">svr.listen(10)</span><br><span class="line">print(&quot;服务器已启动：&quot;, address)</span><br><span class="line"></span><br><span class="line">sockfd, addr = svr.accept()</span><br><span class="line">print(&quot;收到客户端请求：&quot;, addr)</span><br><span class="line"></span><br><span class="line">data = sockfd.recv(1024)</span><br><span class="line">print(data.decode())</span><br><span class="line"></span><br><span class="line">sockfd.close()</span><br><span class="line">svr.close()</span><br></pre></td></tr></table></figure><h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">address = (&quot;127.0.0.1&quot;, 9999)</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect(address)</span><br><span class="line">print(&quot;连接服务器成功&quot;)</span><br><span class="line"></span><br><span class="line">msg = &quot;This is test msg&quot;</span><br><span class="line">client.send(msg.encode())</span><br><span class="line"></span><br><span class="line">print(&quot;发送消息：&quot;,msg)</span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure><h4 id="循环接收"><a href="#循环接收" class="headerlink" title="循环接收"></a>循环接收</h4><h5 id="服务器-1"><a href="#服务器-1" class="headerlink" title="服务器"></a>服务器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">address = (&quot;127.0.0.1&quot;, 9999)</span><br><span class="line">svr = socket.socket()</span><br><span class="line">svr.bind(address)</span><br><span class="line">svr.listen(10)</span><br><span class="line">print(&quot;服务器已启动：&quot;, address) </span><br><span class="line">sockfd, addr = svr.accept()</span><br><span class="line">print(&quot;收到客户端请求：&quot;, addr)</span><br><span class="line">while True:</span><br><span class="line">data = sockfd.recv(1024)</span><br><span class="line">if data == &quot;&quot;: </span><br><span class="line">sockfd.close()</span><br><span class="line">print(data.decode())</span><br><span class="line">svr.close()</span><br></pre></td></tr></table></figure><h5 id="循环客户端"><a href="#循环客户端" class="headerlink" title="循环客户端"></a>循环客户端</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">address = (&quot;127.0.0.1&quot;, 9999)</span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect(address)</span><br><span class="line">print(&quot;连接服务器成功&quot;)</span><br><span class="line">while True:</span><br><span class="line">msg = input(&quot;请输入要发送的消息:&quot;)</span><br><span class="line">if msg == &quot;q&quot; or msg == &quot;Q&quot;:</span><br><span class="line">break</span><br><span class="line">client.send(msg.encode()) </span><br><span class="line">print(&quot;发送消息：&quot;,msg)</span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;基于Python语言的网络编程，主要是socket网络通信&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="网络编程" scheme="https://rencheng.cc/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>网络编程基础篇</title>
    <link href="https://rencheng.cc/2019/07/14/python/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B01/"/>
    <id>https://rencheng.cc/2019/07/14/python/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B01/</id>
    <published>2019-07-14T02:06:54.000Z</published>
    <updated>2019-07-14T02:06:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>本片文章主要讲述网络的基本概念。<br>将多个节点通过特定的介质联系起来的一种关系。<br>以计算设备作为节点，通信线路作为介质的网络。</p><span id="more"></span><h2 id="网络的概念"><a href="#网络的概念" class="headerlink" title="网络的概念"></a>网络的概念</h2><ul><li>什么是网络：将多个节点通过特定的介质联系起来的一种关系<br>  例如：铁路网、交通网、人际关系网</li><li>计算机网络：以计算设备作为节点，通信线路作为介质的网络</li><li>英特网：把许多网络连到一起的网络</li><li>网络起源于美苏冷战，最初是美国国防部高级研究计划局的一个项目，后来转为民用</li></ul><h2 id="网络功能"><a href="#网络功能" class="headerlink" title="网络功能"></a>网络功能</h2><ul><li>数据与信息的传输</li><li>实现资源共享</li><li>打破时空限制，优化资源配置</li></ul><h2 id="网络分类"><a href="#网络分类" class="headerlink" title="网络分类"></a>网络分类</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">局域网、城域网、广域网</span><br></pre></td></tr></table></figure><h2 id="网络性能衡量指标"><a href="#网络性能衡量指标" class="headerlink" title="网络性能衡量指标"></a>网络性能衡量指标</h2><ul><li>带宽：通信信道支持的最高数据频率(Mb/s, kb/s, Gb/s)</li><li>传输速率：每秒传输多少个bit数据</li><li>吞吐量：单位时间内通过某个网络的数据量</li><li>时延：<ul><li>传输时延：发送数据时候，到完成发送</li><li>传播时延：电磁波、电信号传输需花费的时间</li><li>处理时延：网络数据交换节点存储、转发所必需的处理时间</li><li>排队时延：网络节点队列分组、排队所经历的时间</li></ul></li></ul><h2 id="常用概念"><a href="#常用概念" class="headerlink" title="常用概念"></a>常用概念</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">客户端：请求服务的一方</span><br><span class="line">服务器：提供服务的一方</span><br><span class="line">通信：数据传输过程</span><br><span class="line">协议：数据组织、编码、传输、校验、解码的规则</span><br></pre></td></tr></table></figure><h2 id="网络通信要解决的几个问题"><a href="#网络通信要解决的几个问题" class="headerlink" title="网络通信要解决的几个问题"></a>网络通信要解决的几个问题</h2><table><thead><tr><th>客户端</th><th>服务器</th></tr></thead><tbody><tr><td><strong>如何找到对方</strong></br>查阅地址(DNS)</td><td><strong>如何让对方联系自己</strong></br>公布自己的网络地址</td></tr><tr><td><strong>如何联系对方</strong></br>主动敲门(发起网络连接)</td><td><strong>如何让对方联系自己</strong></br>开门迎客(监听、接收连接)</td></tr><tr><td><strong>如何正确传输数据</strong></br>通信协议</td><td><strong>如何正确传输数据</strong></br>通信协议</br></td></tr><tr><td><strong>如何让对方理解自己的意思</strong></br>应用协议</td><td><strong>如何让对方理解自己的意思</strong></br>应用协议</td></tr><tr><td><strong>如何结束对话</strong></br>关闭连接</td><td><strong>如何结束对话</strong></br>释放资源</td></tr></tbody></table><h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">生活中的协议：汽车转向灯、交通信号灯</span><br><span class="line">协议是一组规则，数据组织、发送、传输、解析的规则</span><br><span class="line">协议由第三方机构事先指定，或通信双方约定</span><br><span class="line">协议需要通信各方共同遵守，否则就无法完成正常通信</span><br></pre></td></tr></table></figure><h2 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h2><p>OSI/ISO七层模型 –&gt; 网络通信标准化流程<br>ISO(国际标准化组织)<br>OSI(开放系统互联模型)</p><h3 id="OSI七层模型如下"><a href="#OSI七层模型如下" class="headerlink" title="OSI七层模型如下"></a>OSI七层模型如下</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">应用层 : 提供用户服务,具体功能有程序体现</span><br><span class="line">表示层 : 数据的压缩优化和加密</span><br><span class="line">会话层 : 建立应用连接,选择合适的传输服务</span><br><span class="line">传输层 : 提供传输服务,进行流量控制</span><br><span class="line">网络层 : 路由选择,网络互连</span><br><span class="line">链路层 : 进行数据交换,控制具体消息收发,链路连接</span><br><span class="line">物理层 : 提供物理硬件传输,网卡,接口设置,传输介质</span><br></pre></td></tr></table></figure><h3 id="OSI七层模型优势"><a href="#OSI七层模型优势" class="headerlink" title="OSI七层模型优势:"></a>OSI七层模型优势:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">建立了统一的网络工作流程 </span><br><span class="line">每个层次功能清晰,各司其职</span><br><span class="line">降低了耦合度,方便了开发流程</span><br></pre></td></tr></table></figure><h4 id="分层原则"><a href="#分层原则" class="headerlink" title="分层原则:"></a>分层原则:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">高内聚: 模块功能尽可能单一,不要相互掺杂</span><br><span class="line">低耦合: 模块之间的关联影响尽可能少</span><br></pre></td></tr></table></figure><h3 id="四层模型-TCP-IP模型"><a href="#四层模型-TCP-IP模型" class="headerlink" title="四层模型 (TCP/IP模型)"></a>四层模型 (TCP/IP模型)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">应用层   传输层  网络层  物理链路层</span><br></pre></td></tr></table></figure><blockquote><p>将应用层,表示层,会话层统一为应用层,便于开发实践</p></blockquote><h3 id="五层模型"><a href="#五层模型" class="headerlink" title="五层模型"></a>五层模型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">应用层   传输层  网络层  链路层  物理层</span><br></pre></td></tr></table></figure><h2 id="数据的传输流程"><a href="#数据的传输流程" class="headerlink" title="数据的传输流程"></a>数据的传输流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">发送端由应用层逐层根据协议添加首部信息,最终在物理层实现发送</span><br><span class="line">发送的消息经过中间多个节点转发到达目标主机</span><br><span class="line">目标主机根据协议逐层解析首部,最终到达应用层获取数据</span><br></pre></td></tr></table></figure><h3 id="消息发送的流程"><a href="#消息发送的流程" class="headerlink" title="消息发送的流程"></a>消息发送的流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">封装：每个层次接收上层传递的数据，加入本层的控制信息，传递给下一层</span><br><span class="line">解封：每个层次接收下层传来的数据，读取并去掉控制信息，将数据送给上一层处理</span><br></pre></td></tr></table></figure><h3 id="数据包如何寻找路径"><a href="#数据包如何寻找路径" class="headerlink" title="数据包如何寻找路径"></a>数据包如何寻找路径</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网络节点分配一个IP地址（全世界独一无二的）</span><br><span class="line">数据包中，包含了数据的源地址、目标地址</span><br><span class="line">根据路由表中记录的路径信息，将数据投递给下一站，循环直至数据送达对方</span><br></pre></td></tr></table></figure><h2 id="网络地址表示方式"><a href="#网络地址表示方式" class="headerlink" title="网络地址表示方式"></a>网络地址表示方式</h2><p><strong>网络主机</strong>:  在网络中标识一台主机的标志</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">本地使用 : &#x27;localhost&#x27; </span><br><span class="line"> &#x27;127.0.0.1&#x27;</span><br><span class="line"></span><br><span class="line">网络使用 : &#x27;192.168.56.131&#x27;</span><br><span class="line"> &#x27;0.0.0.0&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>ifconfig : 查看本地网络信息 (Unix, Linux)<br>ipconfig : 查看本地网络信息 (Windows) </p></blockquote><p><strong>IP地址</strong> : 在网络上查找一台主机的网络位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">IPv4 : 点分十进制 192.168.1.2   每部分取值:0--255</span><br><span class="line"></span><br><span class="line">IPv6 : 扩充地址的范围</span><br><span class="line"></span><br><span class="line">ping [ip] : 网络连接测试</span><br><span class="line"></span><br><span class="line">特殊IP</span><br><span class="line">   127.0.0.1  本机测试IP</span><br><span class="line">   0.0.0.0  本机自动获取能够使用的网卡IP</span><br><span class="line">   192.168.1.0  表达一个网段</span><br><span class="line">   192.168.1.1  表示网关地址</span><br><span class="line">   192.168.1.255  广播地址</span><br></pre></td></tr></table></figure><p><strong>域名</strong> : 网络服务器的别名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">方便记忆,表达一定的含义</span><br></pre></td></tr></table></figure><p><strong>端口号</strong> port</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">端口号是网络地址的一部分,用于区分主机上不同的网络应用</span><br><span class="line"></span><br><span class="line">在一个系统中应用监听的端口不重复</span><br><span class="line"></span><br><span class="line">取值范围:</span><br><span class="line">        1 -- 65535</span><br><span class="line">        1 -- 255  一些众所周知的公共程序端口</span><br><span class="line">        256 -- 1023  系统应用端口</span><br><span class="line">        1024 -- 65535  自用端口</span><br></pre></td></tr></table></figure><p><strong>网络字节序</strong> : 网络上数据传输的排列方式</p><h2 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h2><h3 id="面向连接的传输服务"><a href="#面向连接的传输服务" class="headerlink" title="面向连接的传输服务"></a>面向连接的传输服务</h3><p>基于TCP协议的数据传输</p><h4 id="传输特征"><a href="#传输特征" class="headerlink" title="传输特征 :"></a>传输特征 :</h4><p>提供可靠的数据传输,可靠性指的是传输。过程中无丢失,无失序,无差错,无重复</p><h4 id="实现手段"><a href="#实现手段" class="headerlink" title="实现手段"></a>实现手段</h4><p>在通信前需要建立通信连接，通信结束需要断开连接。</p><h4 id="连接过程-三次握手"><a href="#连接过程-三次握手" class="headerlink" title="连接过程 (三次握手)"></a>连接过程 (三次握手)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 客户端向服务端发起连接请求</span><br><span class="line">2. 服务端收到客户端请求报文(消息序列号),回复报文    消息表示可以连接</span><br><span class="line">3. 客户端收到服务端回复,再从发送报文最终建立连接</span><br></pre></td></tr></table></figure><h4 id="连接断开-四次挥手"><a href="#连接断开-四次挥手" class="headerlink" title="连接断开 (四次挥手)"></a>连接断开 (四次挥手)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 主动方发送报文提出断开连接</span><br><span class="line">2. 被动方接收到断开请求,立即返回消息表示开始准备    断开</span><br><span class="line">3. 被动方处理消息完毕,完成断开准备,再次发送报文    表示可以断开</span><br><span class="line">4. 主动方收到断开指令,发送报文最终确认断开</span><br></pre></td></tr></table></figure><h4 id="适用情况"><a href="#适用情况" class="headerlink" title="适用情况"></a>适用情况</h4><p>对数据传输有准确性的要求,传输文件较大;<br>需要确保传输可靠性。比如 : 网页获取,文件下载,邮件收发</p><h3 id="面向无连接的传输服务"><a href="#面向无连接的传输服务" class="headerlink" title="面向无连接的传输服务"></a>面向无连接的传输服务</h3><p>基于UDP协议的传输</p><h4 id="传输特征-1"><a href="#传输特征-1" class="headerlink" title="传输特征"></a>传输特征</h4><p>不保证传输的可靠性,数据传输不需要提前           建立连接</p><h4 id="适用情况-1"><a href="#适用情况-1" class="headerlink" title="适用情况"></a>适用情况</h4><p>网络情况较差,对传输可靠性要求不高。比如:网络视频,群聊,广播</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本片文章主要讲述网络的基本概念。&lt;br&gt;将多个节点通过特定的介质联系起来的一种关系。&lt;br&gt;以计算设备作为节点，通信线路作为介质的网络。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://rencheng.cc/tags/Python/"/>
    
    <category term="网络编程" scheme="https://rencheng.cc/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-教程01</title>
    <link href="https://rencheng.cc/2019/07/02/mysql/%E6%95%99%E7%A8%8B01/"/>
    <id>https://rencheng.cc/2019/07/02/mysql/%E6%95%99%E7%A8%8B01/</id>
    <published>2019-07-02T12:02:43.000Z</published>
    <updated>2019-07-02T12:02:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>数据库软件：一个软件,看的见,可操作,实现数据库的逻辑功能<br>数据库：是一种逻辑概念,用来存放数据的仓库,侧重存储<br>数据仓库：从数据量上来说,比数据库庞大的多,主要用于数据分析和</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">存储数据的仓库</span><br></pre></td></tr></table></figure><h3 id="都有哪些公司在用数据库"><a href="#都有哪些公司在用数据库" class="headerlink" title="都有哪些公司在用数据库"></a>都有哪些公司在用数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">金融机构、游戏网站、购物网站、论坛网站 ... ...</span><br></pre></td></tr></table></figure><h3 id="提供数据库服务的软件"><a href="#提供数据库服务的软件" class="headerlink" title="提供数据库服务的软件"></a>提供数据库服务的软件</h3><ol><li>软件分类</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MySQL、Oracle、SQL_Server、DB2、MongoDB、MariaDB </span><br></pre></td></tr></table></figure><ol start="2"><li>生产环境中,如何选择使用哪个数据库软件<ol><li>是否开源<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  1. 开源软件：MySQL、Mariadb、MongoDB</span><br><span class="line">2. 商业软件：Oracle、DB2、SQL_Server</span><br></pre></td></tr></table></figure></li><li>是否跨平台<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 不跨平台 ：SQL_Server</span><br><span class="line">2. 跨平台 ：...</span><br></pre></td></tr></table></figure></li><li>公司的类型<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 商业软件 ：政府部门、金融机构</span><br><span class="line">2. 开源软件 ：游戏网站、购物网站、论坛网站 ..</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="MySQL的特点"><a href="#MySQL的特点" class="headerlink" title="MySQL的特点"></a>MySQL的特点</h3><h4 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h4><pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 数据是以行和列(表格)的形式去存储的</span><br><span class="line">2. 表中的每一行叫一条记录,每一列叫一个字段</span><br><span class="line">3. 表和表之间的逻辑关联叫关系</span><br></pre></td></tr></table></figure>**示例**<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">关系型数据库存储</span><br><span class="line"></span><br><span class="line">表1、学生信息表</span><br><span class="line"> 姓名   年龄  班级</span><br><span class="line"> 星矢    25   三班</span><br><span class="line"> 水冰月  25   六班</span><br><span class="line"></span><br><span class="line">表2、班级信息表</span><br><span class="line"> 班级   班主任</span><br><span class="line"> 三班   大空翼</span><br><span class="line"> 六班   松人</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 非关系型数据库中存储</span><br><span class="line"> </span><br><span class="line"> &#123;&quot;姓名&quot;:&quot;水冰月&quot;,&quot;年龄&quot;:25,&quot;班级&quot;:&quot;六班&quot;&#125;</span><br><span class="line">&#123;&quot;姓名&quot;:&quot;星矢&quot;,&quot;年龄&quot;:25,&quot;班级&quot;:&quot;三班&quot;,&quot;班主任&quot;:&quot;大空翼&quot;&#125;</span><br></pre></td></tr></table></figure>  </code></pre><h5 id="跨平台"><a href="#跨平台" class="headerlink" title="跨平台"></a>跨平台</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以在Unix、Linux、Windows上运行数据库服务</span><br></pre></td></tr></table></figure><h5 id="支持多种编程语言"><a href="#支持多种编程语言" class="headerlink" title="支持多种编程语言"></a>支持多种编程语言</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python、java、php ... ...</span><br></pre></td></tr></table></figure><h4 id="数据库软件、数据库、数据仓库的概念"><a href="#数据库软件、数据库、数据仓库的概念" class="headerlink" title="数据库软件、数据库、数据仓库的概念"></a>数据库软件、数据库、数据仓库的概念</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 数据库软件</span><br><span class="line">    一个软件,看的见,可操作,实现数据库的逻辑功能</span><br><span class="line">2. 数据库</span><br><span class="line">      是一种逻辑概念,用来存放数据的仓库,侧重存储</span><br><span class="line">3. 数据仓库</span><br><span class="line">    从数据量上来说,比数据库庞大的多,主要用于数据分析和数据挖掘</span><br></pre></td></tr></table></figure><h2 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h2><h3 id="Ubuntu安装软件"><a href="#Ubuntu安装软件" class="headerlink" title="Ubuntu安装软件"></a>Ubuntu安装软件</h3><ol><li><p>更新apt-get</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li><li><p>把本地已安装软件与刚下载的软件列表进行对比,如果发现已安装软件版本低,则更新</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure></li><li><p>修复依赖关系</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><blockquote><p>访问源列表中的每个网址,读取软件列表,保存到本地<br><code>/var/lib/apt/lists/</code></p></blockquote></li></ol><h3 id="Windows安装"><a href="#Windows安装" class="headerlink" title="Windows安装"></a>Windows安装</h3><ol><li>下载MySQL安装包(windows)<br>   mysql-installer<em><strong>5.7.</strong></em>.msi</li><li>安装教程去安装</li></ol><h3 id="Mac安装"><a href="#Mac安装" class="headerlink" title="Mac安装"></a>Mac安装</h3><ol><li>cd</li><li>vi .bash_profile<br>添加 ：PATH=”$PATH”:/usr/local/mysql/bin</li><li>source .bash_profile</li></ol><h2 id="启动和连接MySQL服务"><a href="#启动和连接MySQL服务" class="headerlink" title="启动和连接MySQL服务"></a>启动和连接MySQL服务</h2><ol><li><p>服务端启动</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看MySQL状态</span><br><span class="line">sudo /etc/init.d/mysql status</span><br><span class="line">启动，停止，重启</span><br><span class="line">sudo /etc/init.d/mysql start | stop | restart</span><br></pre></td></tr></table></figure></li><li><p>客户端连接</p><ol><li>命令格式</li></ol> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h主机地址 -u用户名 -p密码</span><br><span class="line">mysql -hlocalhost -uroot -p123456</span><br></pre></td></tr></table></figure><p> 2、本地连接可省略 -h 选项</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></table></figure></li></ol><h2 id="基本SQL命令"><a href="#基本SQL命令" class="headerlink" title="基本SQL命令"></a>基本SQL命令</h2><h3 id="SQL命令的使用规则"><a href="#SQL命令的使用规则" class="headerlink" title="SQL命令的使用规则"></a>SQL命令的使用规则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、每条命令必须以 ; 结尾</span><br><span class="line">2、SQL命令不区分字母大小写</span><br><span class="line">3、使用 \c 来终止当前命令的执行</span><br></pre></td></tr></table></figure><h3 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h3><h4 id="库的基本操作"><a href="#库的基本操作" class="headerlink" title="库的基本操作"></a>库的基本操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、查看已有库</span><br><span class="line">show databases;</span><br><span class="line">2、创建库(指定字符集)</span><br><span class="line">create database 库名 [character set utf8];</span><br><span class="line">3、查看创建库的语句(字符集)</span><br><span class="line">show create database 库名;</span><br><span class="line">4、查看当前所在库</span><br><span class="line">select database();</span><br><span class="line">5、切换库</span><br><span class="line">use 库名;</span><br><span class="line">6、查看库中已有表</span><br><span class="line">show tables;</span><br><span class="line">7、删除库</span><br><span class="line">drop database 库名;</span><br></pre></td></tr></table></figure><h4 id="库名的命名规则"><a href="#库名的命名规则" class="headerlink" title="库名的命名规则"></a>库名的命名规则</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、数字、字母、下划线,但不能使用纯数字</span><br><span class="line">2、库名区分字母大小写</span><br><span class="line">3、不能使用特殊字符和mysql关键字</span><br></pre></td></tr></table></figure><h3 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h3><h4 id="表的基本操作"><a href="#表的基本操作" class="headerlink" title="表的基本操作"></a>表的基本操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、创建表(指定字符集)</span><br><span class="line">create table 表名(</span><br><span class="line">   字段名 数据类型,</span><br><span class="line">   字段名 数据类型,</span><br><span class="line">   ...</span><br><span class="line">   字段名 数据类型</span><br><span class="line">);</span><br><span class="line">2、查看已有表的字符集</span><br><span class="line">show create table 表名;</span><br><span class="line">3、查看表结构</span><br><span class="line">desc 表名;</span><br><span class="line">4、删除表</span><br><span class="line">drop table 表名;</span><br></pre></td></tr></table></figure><blockquote><p>1、所有的数据都是以文件的形式存放在数据库目录下<br>    2、数据库目录 ：/var/lib/mysql</p></blockquote><h4 id="表记录管理"><a href="#表记录管理" class="headerlink" title="表记录管理"></a>表记录管理</h4><ol><li>插入(insert)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、insert into 表名 values(值1),(值2),...;</span><br><span class="line">2、insert into 表名(字段1,...) values(值1),...;</span><br></pre></td></tr></table></figure><ol start="2"><li>查询(select)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、select * from 表名 [where 条件];</span><br><span class="line">2、select 字段1,字段名2 from 表名 [where 条件];</span><br></pre></td></tr></table></figure><h2 id="如何更改默认字符集"><a href="#如何更改默认字符集" class="headerlink" title="如何更改默认字符集"></a>如何更改默认字符集</h2><p>方法(通过更改MySQL配置文件实现)<br>步骤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、获取root权限</span><br><span class="line">sudo -i</span><br><span class="line">2、cd /etc/mysql/mysql.conf.d/</span><br><span class="line">3、备份 ：cp mysqld.cnf mysqld.cnf.bak</span><br><span class="line">4、vim mysqld.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server = utf8</span><br><span class="line">5、重启mysql服务</span><br><span class="line">/etc/init.d/mysql restart</span><br></pre></td></tr></table></figure><p>mac上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置文件路径</span><br><span class="line">/etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure><h2 id="客户端把数据存储到数据库服务器上的过程"><a href="#客户端把数据存储到数据库服务器上的过程" class="headerlink" title="客户端把数据存储到数据库服务器上的过程"></a>客户端把数据存储到数据库服务器上的过程</h2><ol><li>连接到数据服务器 mysql -uroot -p123456</li><li>选择一个库  use 库名</li><li>创建表/修改表  update 表名…</li><li>断开与数据库连接  exit; | quit; | \q;</li></ol><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h3><h4 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h4><ol><li>int 大整型(4个字节)<br>取值范围 ：2**32 - 1(42亿多)</li><li>tinyint 微小整型(1个字节)<ol><li>有符号(signed默认) : -128 ~ 127</li><li>无符号(unsigned) : 0 ~ 255<br>   age tinyint unsigned,</li></ol></li><li>smallint 小整型(2个字节)</li><li>bigint 极大整型(8个字节)</li></ol><h4 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h4><ol><li>float(4个字节,最多显示7个有效位)<br>字段名 float(m,n)  m-&gt;总位数 n-&gt;小数位位数<br>   float(5,2)取值范围？ -999.99 ~ 999.99</li><li>decimal(最多显示28个有效位)<br> 1、decimal(m,n)<br> 2、存储空间(整数、小数分开存储)<br>   规则：将9的倍数包装成4个字节</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">余数    字节</span><br><span class="line">  0       0</span><br><span class="line"> 1-2      1</span><br><span class="line"> 3-4      2</span><br><span class="line"> 5-6      3</span><br><span class="line"> 7-9      4</span><br><span class="line"></span><br><span class="line">示例：decimal(19,9)</span><br><span class="line">整数部分：10/9=商1余1 4字节+1字节=5字节</span><br><span class="line">小数部分：9/9=商1余0 4字节+0字节=4字节</span><br><span class="line">占：9字节</span><br></pre></td></tr></table></figure><h4 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h4><ol><li>char(定长)<br>取值范围：1~255;浪费存储空间,性能高</li><li>varchar(变长)<br>取值范围：1~65535;节省存储空间,性能低</li><li>text / longtext(4G) / blob / longblob(4G)</li></ol><h5 id="区别："><a href="#区别：" class="headerlink" title="区别："></a>区别：</h5><ol><li>字符类型宽度和数值类型宽度的区别</li><li>数值类型宽度为显示宽度,只用于select查询显示,和占用存储无关,可用zerofill查看效果</li><li>字符类型的宽度超过之后则无法存储</li></ol><h4 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h4><ol><li>单选(enum) ：字段名 enum(值1,值2,…)</li><li>多选(set)  ：字段名 set(值1,值2,…)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t5(</span><br><span class="line">id int(3) zerofill,</span><br><span class="line">name varchar(15),</span><br><span class="line">sex enum(&quot;M&quot;,&quot;F&quot;,&quot;Secret&quot;),</span><br><span class="line">likes set(&quot;F&quot;,&quot;M&quot;,&quot;study&quot;,&quot;Python&quot;)</span><br><span class="line">);</span><br><span class="line">insert into t5(likes) values(&quot;F,study,Python&quot;);</span><br></pre></td></tr></table></figure><h4 id="日期时间类型"><a href="#日期时间类型" class="headerlink" title="日期时间类型"></a>日期时间类型</h4><ol><li>date ：”YYYY-MM-DD”</li><li>time ：”HH:MM:SS”</li><li>datetime ：”YYYY-MM-DD HH:MM:SS”</li><li>timestamp ：”YYYY-MM-DD HH:MM:SS”</li><li>注意<ol><li>datetime ：不给值默认返回NULL值</li><li>timestamp ：不给值默认返回系统当前时间</li></ol></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table t7(</span><br><span class="line">id int,</span><br><span class="line">name varchar(15),</span><br><span class="line">birthday date,</span><br><span class="line">money int,</span><br><span class="line">shijian datetime</span><br><span class="line">);</span><br><span class="line">insert into t7 values(2,&quot;王&quot;,date(now()),10000,now());</span><br></pre></td></tr></table></figure><h5 id="日期时间函数"><a href="#日期时间函数" class="headerlink" title="日期时间函数"></a>日期时间函数</h5><ol><li><strong>now()</strong>  返回服务器当前时间</li><li><strong>curdate()</strong> 返回当前日期</li><li><strong>curtime()</strong> 返回当前时间</li><li><strong>year(date)</strong> 返回指定时间的年份</li><li><strong>date(date)</strong> 返回指定时间的日期</li><li><strong>time(date)</strong> 返回指定时间的时间</li><li>示例<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1、在表中插入3条记录</span><br><span class="line">insert into t7 values</span><br><span class="line">(3,&quot;小昭&quot;,19000520,3000,20180630000000),</span><br><span class="line">(4,&quot;赵敏&quot;,19000521,4000,20180702000000),</span><br><span class="line">(5,&quot;周芷若&quot;,19010522,3500,20180702100000);</span><br><span class="line">2、查找2018年7月2日有哪些用户充值了</span><br><span class="line">   select * from t7 where date(shijian)=&quot;2018-07-02&quot;;</span><br><span class="line"></span><br><span class="line">    3、查找2018年7月份充值的信息</span><br><span class="line">      select * from t7 </span><br><span class="line">      where </span><br><span class="line">      date(shijian)&gt;=&quot;2018-07-01&quot; and date(shijian)&lt;=&quot;2018-07-31&quot;;</span><br><span class="line"></span><br><span class="line">    4、查找7月30日10:00-12:00充值的信息</span><br><span class="line">      select * from t7</span><br><span class="line">      where</span><br><span class="line">      date(shijian)=&quot;2018-07-31&quot; and </span><br><span class="line">      time(shijian)&gt;=&quot;10:00:00&quot; and </span><br><span class="line">      time(shijian)&lt;=&quot;12:00:00&quot;;</span><br></pre></td></tr></table></figure><h5 id="日期时间运算"><a href="#日期时间运算" class="headerlink" title="日期时间运算"></a>日期时间运算</h5></li><li>语法格式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名</span><br><span class="line">where 字段名 运算符 (时间-interval 时间间隔单位);</span><br><span class="line">    </span><br><span class="line">时间间隔单位：</span><br><span class="line">1 day | 2 hour | 1 minute | 2 year | 3 month</span><br></pre></td></tr></table></figure><p>示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、查询1天以内的记录</span><br><span class="line">  select * from t7 </span><br><span class="line">  where shijian &gt; (now()-interval 1 day);</span><br><span class="line">        age     &gt;   20</span><br><span class="line">2、查询1年以前的记录</span><br><span class="line">  select * from t7</span><br><span class="line">  where shijian &lt; (now()-interval 1 year);</span><br><span class="line">3、查询1天以前,3天以内的记录</span><br><span class="line">select * from t7</span><br><span class="line">where</span><br><span class="line">shijian &lt; (now()-interval 1 day) and</span><br><span class="line">shijian &gt; (now()-interval 3 day);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;数据库软件：一个软件,看的见,可操作,实现数据库的逻辑功能&lt;br&gt;数据库：是一种逻辑概念,用来存放数据的仓库,侧重存储&lt;br&gt;数据仓库：从数据量上来说,比数据库庞大的多,主要用于数据分析和&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="MySQL" scheme="https://rencheng.cc/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-教程02</title>
    <link href="https://rencheng.cc/2019/07/02/mysql/%E6%95%99%E7%A8%8B02/"/>
    <id>https://rencheng.cc/2019/07/02/mysql/%E6%95%99%E7%A8%8B02/</id>
    <published>2019-07-02T12:02:43.000Z</published>
    <updated>2019-07-02T12:02:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>数据库软件：一个软件,看的见,可操作,实现数据库的逻辑功能<br>数据库：是一种逻辑概念,用来存放数据的仓库,侧重存储<br>数据仓库：从数据量上来说,比数据库庞大的多,主要用于数据分析和</p><span id="more"></span><h2 id="表字段的操作"><a href="#表字段的操作" class="headerlink" title="表字段的操作"></a>表字段的操作</h2><p>1、语法 ：alter table 表名 执行动作;<br>2、添加字段(add)<br>    alter table 表名 add 字段名 数据类型;<br>    alter table 表名 add 字段名 数据类型 first;<br>    alter table 表名 add 字段名 数据类型 after 字段名;<br>  3、删除字段(drop)<br>    alter table 表名 drop 字段名;<br>  4、修改数据类型(modify)<br>    alter table 表名 modify 字段名 新数据类型;<br>  5、表重命名(rename)<br>    alter table 表名 rename 新表名;<br>  6、练习<br>    1、创建库 studb2<br>    2、在库中创建表 t1 ,字段有3个：name、age、phnumber<br>      use studb2;<br>      create table t1(<br>      name char(20),<br>      age tinyint unsigned,<br>      phnumber char(11)<br>      );<br>    3、查看表结构<br>      desc t1;<br>    4、在表中第一列添加一个 id 字段<br>      alter table t1 add id int first;<br>    5、把 phnumber 的数据类型改为 bigint<br>      alter table t1 modify phnumber bigint;<br>    6、在表中最后一列添加一个字段 address<br>      alter table t1 add address varchar(50);<br>    7、删除表中的 age 字段<br>      alter table t1 drop age;<br>    8、查看表结构<br>      desc t1;</p><p>5、表记录管理<br>  1、删除表记录<br>    1、delete from 表名 where 条件;<br>    2、注意<br>      delete语句后如果不加where条件,所有记录全部清空<br>  2、更新表记录<br>    1、update 表名 set 字段1=值1,字段2=值2,… where 条件;<br>    2、注意<br>      必须加where条件<br>  3、练习(表hero)<br>    1、查找所有蜀国人的信息<br>      select * from hero where country=”蜀国”;<br>    2、查找所有女英雄的姓名、性别和国家<br>      select name,sex,country from hero<br>      where sex=”女”;<br>    3、把id为2的记录改为典韦,性别男,国家魏国<br>      update hero set name=”典韦”,sex=”男”,country=”魏国” where id=2;<br>    4、删除所有蜀国英雄<br>      delete from hero where country=”蜀国”;<br>    5、把貂蝉的国籍改为魏国<br>      update hero set country=”魏国”<br>      where name=”貂蝉”;<br>    6、删除所有表记录<br>      delete from hero;<br>4、运算符操作<br>  1、数值比较/字符比较<br>    1、数值比较 ：= != &gt; &gt;= &lt; &lt;=<br>    2、字符比较 ：= !=<br>    3、练习<br>      1、查找攻击力高于150的英雄的名字和攻击值<br>        select name,gongji from sanguo where gongji&gt;150;<br>      2、将赵云的攻击力设置为360,防御力设置为68<br>        update sanguo set gongji=360,fangyu=68<br>        where name=”赵云”;<br>  2、逻辑比较<br>    1、and (两个或多个条件同时成立)<br>    2、or (任意一个条件成立即可)<br>    3、练习<br>      1、找出攻击值高于200的蜀国英雄的名字、攻击力<br>        select name as n,gongji as g from sanguo<br>    where gongji&gt;200 and country=”蜀国”;<br>      2、将吴国英雄中攻击值为110的英雄的攻击值改为100,防御力改为60<br>        update sanguo set gongji=100,fangyu=60<br>    where country=”吴国” and gongji=110;<br>      3、查找蜀国和魏国的英雄信息<br>        select * from sanguo<br>    where country=”蜀国” or country=”魏国”;<br>  3、范围内比较<br>    1、between 值1 and 值2<br>    2、where 字段名 in(值1,值2,…)<br>    3、where 字段名 not in(值1,值2,…)<br>    4、练习<br>      1、查找攻击值100-200的蜀国英雄信息<br>        select * from sanguo<br>    where gongji between 100 and 200 and<br>    country=”蜀国”;<br>      2、找到蜀国和吴国以外的国家的女英雄信息<br>        select * from sanguo<br>    where country not in(“蜀国”,”吴国”)<br>    and sex=”女”;<br>      3、找到id为1、3或5的蜀国英雄 和 貂蝉的信息<br>        select * from sanguo<br>    where<br>    (id in(1,3,5) and country=”蜀国”) or name=”貂蝉”;<br>  4、匹配空、非空<br>    1、空 ：where name is null<br>    2、非空:where name is not null<br>    3、示例<br>      1、姓名为NULL值的蜀国女英雄信息<br>        select * from sanguo<br>        where<br>        name is null and country=”蜀国” and sex=”女”;<br>      2、姓名为 “” 的英雄信息<br>        select * from sanguo where name=””;<br>    4、注意<br>      1、NULL ：空值,只能用 is 或者 is not 去匹配<br>      2、””   ：空字符串,用 = 或者 != 去匹配<br>  5、模糊比较<br>    1、where 字段名 like 表达式<br>    2、表达式<br>      1、_ : 匹配单个字符<br>      2、% : 匹配0到多个字符<br>    3、示例<br>      select name from sanguo where name like “<em>%</em>“;<br>      select name from sanguo where name like “%”;<br>        ## NULL不会被统计,只能用is、is not去匹配<br>      select name from sanguo where name like “___”;<br>      select name from sanguo where name like “赵%”;<br>5、SQL查询<br>  1、总结<br>    3、select …聚合函数 from 表名<br>    1、where …<br>    2、group by …<br>    4、having …<br>    5、order by …<br>    6、limit …;<br>  2、order by<br>    1、给查询结果进行排序<br>    2、… order by 字段名 ASC/DESC<br>    3、升序：ASC(默认)<br>       降序：DESC<br>    4、示例<br>      1、将英雄按防御值从高到低排序</p><pre><code>  2、将蜀国英雄按攻击值从高到低排序  3、将魏蜀两国英雄中名字为三个字的按防御值升序排列    select * from sanguo     where    country in(&quot;蜀国&quot;,&quot;魏国&quot;) and name like &quot;___&quot;    order by fangyu ASC;select * from sanguo    where    (country=&quot;魏国&quot; or country=&quot;蜀国&quot;) and name like &quot;___&quot;    order by fangyu;</code></pre><p>  3、limit (永远放在SQL语句的最后写)<br>    1、作用 ：限制显示查询记录的个数<br>    2、用法<br>      1、limit n  -&gt; 显示 n 条记录<br>      2、limit m,n<br>        m 表示 从第m+1条记录开始显示,显示 n 条<br>        limit 2,3  : 第 3、4、5 三条记录<br>    3、示例<br>      1、在蜀国英雄中,查找防御值倒数第二名至倒数第四名的英雄的记录<br>        select * from sanguo<br>        where country=”蜀国”<br>        order by fangyu asc<br>        limit 1,3;<br>      2、在蜀国英雄中,查找攻击值前3名且名字不为 NULL 的英雄的姓名、攻击值和国家<br>        select name,gongji,country from sanguo<br>        where<br>        country=”蜀国” and name is not NULL<br>        order by gongji DESC<br>        limit 3;<br>    4、分页<br>      每页显示5条记录,显示第4页的内容</p><pre><code>  第1页 ：limit 0,5        # 1 2 3 4 5   第2页 ：limit (2-1)*5,5  # 6 7 8 9 10  第3页 ：limit (3-1)*5,5  # 11 12 13 14 15  第4页 ：limit (4-1)*5,5  # 16 17 18 19 20  每页显示n条记录,显示第m页 ：limit (m-1)*n,n</code></pre><p>  4、聚合函数<br>    1、分类<br>      avg(字段名) : 求该字段平均值<br>      sum(字段名) : 求和<br>      max(字段名) : 最大值<br>      min(字段名) : 最小值<br>      count(字段名) : 统计该字段记录的个数<br>    2、示例<br>      1、攻击力最强值是多少<br>        select max(gongji) from MOSHOU.sanguo;<br>      2、统计id 、name 两个字段分别有几条记录<br>        select count(id),count(name) from sanguo;<br>    ## 空值 NULL 不会被统计,””会被统计</p><pre><code>  3、计算蜀国英雄的总攻击力    select sum(gongji) from MOSHOU.sanguowhere country=&quot;蜀国&quot;;  4、统计蜀国英雄中攻击值大于200的英雄的数量    select count(*) from MOSHOU.sanguowhere gongji&gt;200 and country=&quot;蜀国&quot;;</code></pre>]]></content>
    
    
    <summary type="html">&lt;p&gt;数据库软件：一个软件,看的见,可操作,实现数据库的逻辑功能&lt;br&gt;数据库：是一种逻辑概念,用来存放数据的仓库,侧重存储&lt;br&gt;数据仓库：从数据量上来说,比数据库庞大的多,主要用于数据分析和&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="数据库" scheme="https://rencheng.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="MySQL" scheme="https://rencheng.cc/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>机器学习-数学基础</title>
    <link href="https://rencheng.cc/2019/06/02/ml/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"/>
    <id>https://rencheng.cc/2019/06/02/ml/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/</id>
    <published>2019-06-02T09:55:15.000Z</published>
    <updated>2019-06-02T09:55:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>深度学习通常又需要哪些数学基础？深度学习里的数学到底难在哪里？通常初学者都会有这些问题，在网络推荐及书本推荐里，经常看到会列出一系列数学科目，比如微积分、线性代数、概率论、复变函数、数值计算、优化理论、信息论等等。这些数学知识有相关性，但实际上按照这样的知识范围来学习，学习成本会很久，而且会很枯燥，本章我们通过选举一些数学基础里容易混淆的一些概念做以介绍，帮助大家更好的理清这些易混淆概念之间的关系。</p><span id="more"></span><h2 id="1-1-向量和矩阵"><a href="#1-1-向量和矩阵" class="headerlink" title="1.1 向量和矩阵"></a>1.1 向量和矩阵</h2><h3 id="1-1-1-标量、向量、矩阵、张量之间的联系"><a href="#1-1-1-标量、向量、矩阵、张量之间的联系" class="headerlink" title="1.1.1 标量、向量、矩阵、张量之间的联系"></a>1.1.1 标量、向量、矩阵、张量之间的联系</h3><p><strong>标量（scalar）</strong><br>一个标量表示一个单独的数，它不同于线性代数中研究的其他大部分对象（通常是多个数的数组）。我们用斜体表示标量。标量通常被赋予小写的变量名称。 </p><p><strong>向量（vector）</strong><br>​一个向量表示一组有序排列的数。通过次序中的索引，我们可以确定每个单独的数。通常我们赋予向量粗体的小写变量名称，比如xx。向量中的元素可以通过带脚标的斜体表示。向量$X$的第一个元素是$X_1$，第二个元素是$X_2$，以此类推。我们也会注明存储在向量中的元素的类型（实数、虚数等）。</p><p><strong>矩阵（matrix）</strong><br>​矩阵是具有相同特征和纬度的对象的集合，表现为一张二维数据表。其意义是一个对象表示为矩阵中的一行，一个特征表示为矩阵中的一列，每个特征都有数值型的取值。通常会赋予矩阵粗体的大写变量名称，比如$A$。</p><p><strong>张量（tensor）</strong><br>​在某些情况下，我们会讨论坐标超过两维的数组。一般地，一个数组中的元素分布在若干维坐标的规则网格中，我们将其称之为张量。使用 $A$ 来表示张量“A”。张量$A$中坐标为$(i,j,k)$的元素记作$A_{(i,j,k)}$。 </p><p><strong>四者之间关系</strong>  </p><blockquote><p>标量是0阶张量，向量是一阶张量。举例：<br>​标量就是知道棍子的长度，但是你不会知道棍子指向哪儿。<br>​向量就是不但知道棍子的长度，还知道棍子指向前面还是后面。<br>​张量就是不但知道棍子的长度，也知道棍子指向前面还是后面，还能知道这棍子又向上/下和左/右偏转了多少。</p></blockquote><h3 id="1-1-2-张量与矩阵的区别"><a href="#1-1-2-张量与矩阵的区别" class="headerlink" title="1.1.2 张量与矩阵的区别"></a>1.1.2 张量与矩阵的区别</h3><ul><li>从代数角度讲， 矩阵它是向量的推广。向量可以看成一维的“表格”（即分量按照顺序排成一排）， 矩阵是二维的“表格”（分量按照纵横位置排列）， 那么$n$阶张量就是所谓的$n$维的“表格”。 张量的严格定义是利用线性映射来描述。</li><li>从几何角度讲， 矩阵是一个真正的几何量，也就是说，它是一个不随参照系的坐标变换而变化的东西。向量也具有这种特性。</li><li>张量可以用3×3矩阵形式来表达。 </li><li>表示标量的数和表示向量的三维数组也可分别看作1×1，1×3的矩阵。 </li></ul><h3 id="1-1-3-矩阵和向量相乘结果"><a href="#1-1-3-矩阵和向量相乘结果" class="headerlink" title="1.1.3 矩阵和向量相乘结果"></a>1.1.3 矩阵和向量相乘结果</h3><p>若使用爱因斯坦求和约定（Einstein summation convention），矩阵$A$, $B$相乘得到矩阵$C$可以用下式表示：<br>$$ a_{ik}*b_{kj}=c_{ij} \tag{1.3-1} $$<br>其中，$a_{ik}$, $b_{kj}$, $c_{ij}$分别表示矩阵$A, B, C$的元素，$k$出现两次，是一个哑变量（Dummy Variables）表示对该参数进行遍历求和。<br>而矩阵和向量相乘可以看成是矩阵相乘的一个特殊情况，例如：矩阵$B$是一个$n \times 1$的矩阵。</p><h3 id="1-1-4-向量和矩阵的范数归纳"><a href="#1-1-4-向量和矩阵的范数归纳" class="headerlink" title="1.1.4 向量和矩阵的范数归纳"></a>1.1.4 向量和矩阵的范数归纳</h3><p><strong>向量的范数(norm)</strong><br>​    定义一个向量为：$\vec{a}=[-5, 6, 8, -10]$。任意一组向量设为$\vec{x}=(x_1,x_2,…,x_N)$。其不同范数求解如下：</p><ul><li>向量的1范数：向量的各个元素的绝对值之和，上述向量$\vec{a}$的1范数结果就是：29。</li></ul><p>$$<br>\Vert\vec{x}\Vert_1=\sum_{i=1}^N\vert{x_i}\vert<br>$$</p><ul><li>向量的2范数：向量的每个元素的平方和再开平方根，上述$\vec{a}$的2范数结果就是：15。</li></ul><p>$$<br>\Vert\vec{x}\Vert_2=\sqrt{\sum_{i=1}^N{\vert{x_i}\vert}^2}<br>$$</p><ul><li>向量的负无穷范数：向量的所有元素的绝对值中最小的：上述向量$\vec{a}$的负无穷范数结果就是：5。  </li></ul><p>$$<br>\Vert\vec{x}\Vert_{-\infty}=\min{|{x_i}|}<br>$$</p><ul><li>向量的正无穷范数：向量的所有元素的绝对值中最大的：上述向量$\vec{a}$的正无穷范数结果就是：10。 </li></ul><p>$$<br>\Vert\vec{x}\Vert_{+\infty}=\max{|{x_i}|}<br>$$</p><ul><li>向量的p范数：</li></ul><p>$$<br>L_p=\Vert\vec{x}\Vert_p=\sqrt[p]{\sum_{i=1}^{N}|{x_i}|^p}<br>$$</p><p><strong>矩阵的范数</strong>  </p><p>定义一个矩阵$A=[-1, 2, -3; 4, -6, 6]$。 任意矩阵定义为：$A_{m\times n}$，其元素为 $a_{ij}$。</p><p>矩阵的范数定义为</p><p>$$<br>\Vert{A}\Vert_p :=\sup_{x\neq 0}\frac{\Vert{Ax}\Vert_p}{\Vert{x}\Vert_p}<br>$$</p><p>当向量取不同范数时, 相应得到了不同的矩阵范数。</p><ul><li><p><strong>矩阵的1范数（列范数）</strong>：矩阵的每一列上的元</p><p>素绝对值先求和，再从中取个最大的,（列和最大），上述矩阵$A$的1范数先得到$[5,8,9]$，再取最大的最终结果就是：9。<br>$$<br>\Vert A\Vert_1=\max_{1\le j\le n}\sum_{i=1}^m|{a_{ij}}|<br>$$</p></li><li><p><strong>矩阵的2范数</strong>：矩阵$A^TA$的最大特征值开平方根，上述矩阵$A$的2范数得到的最终结果是：10.0623。 </p></li></ul><p>$$<br>\Vert A\Vert_2=\sqrt{\lambda_{max}(A^T A)}<br>$$</p><p>其中， $\lambda_{max}(A^T A)$ 为 $A^T A​$ 的特征值绝对值的最大值。</p><ul><li><p><strong>矩阵的无穷范数（行范数）</strong>：矩阵的每一行上的元素绝对值先求和，再从中取个最大的，（行和最大），上述矩阵$A$的行范数先得到$[6；16]$，再取最大的最终结果就是：16。<br>$$<br>\Vert A\Vert_{\infty}=\max_{1\le i \le m}\sum_{j=1}^n |{a_{ij}}|<br>$$</p></li><li><p><strong>矩阵的核范数</strong>：矩阵的奇异值（将矩阵svd分解）之和，这个范数可以用来低秩表示（因为最小化核范数，相当于最小化矩阵的秩——低秩），上述矩阵A最终结果就是：10.9287。  </p></li><li><p><strong>矩阵的L0范数</strong>：矩阵的非0元素的个数，通常用它来表示稀疏，L0范数越小0元素越多，也就越稀疏，上述矩阵$A$最终结果就是：6。</p></li><li><p><strong>矩阵的L1范数</strong>：矩阵中的每个元素绝对值之和，它是L0范数的最优凸近似，因此它也可以表示稀疏，上述矩阵$A$最终结果就是：22。  </p></li><li><p><strong>矩阵的F范数</strong>：矩阵的各个元素平方之和再开平方根，它通常也叫做矩阵的L2范数，它的优点在于它是一个凸函数，可以求导求解，易于计算，上述矩阵A最终结果就是：10.0995。  </p></li></ul><p>$$<br>\Vert A\Vert_F=\sqrt{(\sum_{i=1}^m\sum_{j=1}^n{| a_{ij}|}^2)}<br>$$</p><ul><li><strong>矩阵的L21范数</strong>：矩阵先以每一列为单位，求每一列的F范数（也可认为是向量的2范数），然后再将得到的结果求L1范数（也可认为是向量的1范数），很容易看出它是介于L1和L2之间的一种范数，上述矩阵$A$最终结果就是：17.1559。 </li><li><strong>矩阵的 p范数</strong> </li></ul><p>$$<br>\Vert A\Vert_p=\sqrt[p]{(\sum_{i=1}^m\sum_{j=1}^n{| a_{ij}|}^p)}<br>$$</p><h3 id="1-1-5-如何判断一个矩阵为正定"><a href="#1-1-5-如何判断一个矩阵为正定" class="headerlink" title="1.1.5 如何判断一个矩阵为正定"></a>1.1.5 如何判断一个矩阵为正定</h3><p>判定一个矩阵是否为正定，通常有以下几个方面：  </p><ul><li>顺序主子式全大于0；  </li><li>存在可逆矩阵$C$使$C^TC$等于该矩阵；</li><li>正惯性指数等于$n$；</li><li>合同于单位矩阵$E$（即：规范形为$E$）</li><li>标准形中主对角元素全为正；</li><li>特征值全为正；</li><li>是某基的度量矩阵。</li></ul><h2 id="1-2-导数和偏导数"><a href="#1-2-导数和偏导数" class="headerlink" title="1.2 导数和偏导数"></a>1.2 导数和偏导数</h2><h3 id="1-2-1-导数偏导计算"><a href="#1-2-1-导数偏导计算" class="headerlink" title="1.2.1 导数偏导计算"></a>1.2.1 导数偏导计算</h3><p><strong>导数定义</strong>:</p><p>导数(derivative)代表了在自变量变化趋于无穷小的时候，函数值的变化与自变量的变化的比值。几何意义是这个点的切线。物理意义是该时刻的（瞬时）变化率。<br>​</p><p><em>注意</em>：在一元函数中，只有一个自变量变动，也就是说只存在一个方向的变化率，这也就是为什么一元函数没有偏导数的原因。在物理学中有平均速度和瞬时速度之说。平均速度有</p><p>$$<br>v=\frac{s}{t}<br>$$</p><p>其中$v$表示平均速度，$s$表示路程，$t$表示时间。这个公式可以改写为</p><p>$$<br>\bar{v}=\frac{\Delta s}{\Delta t}=\frac{s(t_0+\Delta t)-s(t_0)}{\Delta t}<br>$$</p><p>其中$\Delta s$表示两点之间的距离，而$\Delta t$表示走过这段距离需要花费的时间。当$\Delta t$趋向于0（$\Delta t \to 0$）时，也就是时间变得很短时，平均速度也就变成了在$t_0$时刻的瞬时速度，表示成如下形式：</p><p>$$<br>v(t_0)=\lim_{\Delta t \to 0}{\bar{v}}=\lim_{\Delta t \to 0}{\frac{\Delta s}{\Delta t}}=\lim_{\Delta t \to 0}{\frac{s(t_0+\Delta t)-s(t_0)}{\Delta t}}<br>$$</p><p>实际上，上式表示的是路程$s$关于时间$t$的函数在$t=t_0$处的导数。一般的，这样定义导数：如果平均变化率的极限存在，即有</p><p>$$<br>\lim_{\Delta x \to 0}{\frac{\Delta y}{\Delta x}}=\lim_{\Delta x \to 0}{\frac{f(x_0+\Delta x)-f(x_0)}{\Delta x}}<br>$$</p><p>则称此极限为函数 $y=f(x)$ 在点 $x_0$ 处的导数。记作 $f’(x_0)$ 或 $y’\vert_{x=x_0}$ 或 $\frac{dy}{dx}\vert_{x=x_0}$ 或 $\frac{df(x)}{dx}\vert_{x=x_0}$。</p><p>通俗地说，导数就是曲线在某一点切线的斜率。</p><p><strong>偏导数</strong>:</p><p>既然谈到偏导数(partial derivative)，那就至少涉及到两个自变量。以两个自变量为例，$z=f(x,y)​$，从导数到偏导数，也就是从曲线来到了曲面。曲线上的一点，其切线只有一条。但是曲面上的一点，切线有无数条。而偏导数就是指多元函数沿着坐标轴的变化率。 </p><p><em>注意</em>：直观地说，偏导数也就是函数在某一点上沿坐标轴正方向的的变化率。</p><p>设函数$z=f(x,y)​$在点$(x_0,y_0)​$的领域内有定义，当$y=y_0​$时，$z​$可以看作关于$x​$的一元函数$f(x,y_0)​$，若该一元函数在$x=x_0​$处可导，即有</p><p>$$<br>\lim_{\Delta x \to 0}{\frac{f(x_0+\Delta x,y_0)-f(x_0,y_0)}{\Delta x}}=A<br>$$</p><p>函数的极限$A$存在。那么称$A$为函数$z=f(x,y)$在点$(x_0,y_0)$处关于自变量$x$的偏导数，记作$f_x(x_0,y_0)$或$\frac{\partial z}{\partial x}\vert_{y=y_0}^{x=x_0}$或$\frac{\partial f}{\partial x}\vert_{y=y_0}^{x=x_0}$或$z_x\vert_{y=y_0}^{x=x_0}$。</p><p>偏导数在求解时可以将另外一个变量看做常数，利用普通的求导方式求解，比如$z=3x^2+xy$关于$x$的偏导数就为$z_x=6x+y$，这个时候$y$相当于$x$的系数。</p><p>某点$(x_0,y_0)$处的偏导数的几何意义为曲面$z=f(x,y)$与面$x=x_0$或面$y=y_0$交线在$y=y_0$或$x=x_0$处切线的斜率。  </p><h3 id="1-2-2-导数和偏导数有什么区别？"><a href="#1-2-2-导数和偏导数有什么区别？" class="headerlink" title="1.2.2 导数和偏导数有什么区别？"></a>1.2.2 导数和偏导数有什么区别？</h3><p>导数和偏导没有本质区别，如果极限存在，都是当自变量的变化量趋于0时，函数值的变化量与自变量变化量比值的极限。  </p><blockquote><ul><li>一元函数，一个$y$对应一个$x$，导数只有一个。  </li><li>二元函数，一个$z$对应一个$x$和一个$y$，有两个导数：一个是$z$对$x$的导数，一个是$z$对$y$的导数，称之为偏导。  </li><li>求偏导时要注意，对一个变量求导，则视另一个变量为常数，只对改变量求导，从而将偏导的求解转化成了一元函数的求导。</li></ul></blockquote><h2 id="1-3-特征值和特征向量"><a href="#1-3-特征值和特征向量" class="headerlink" title="1.3 特征值和特征向量"></a>1.3 特征值和特征向量</h2><h3 id="1-3-1-特征值分解与特征向量"><a href="#1-3-1-特征值分解与特征向量" class="headerlink" title="1.3.1 特征值分解与特征向量"></a>1.3.1 特征值分解与特征向量</h3><ul><li><p>特征值分解可以得到特征值(eigenvalues)与特征向量(eigenvectors)；</p></li><li><p>特征值表示的是这个特征到底有多重要，而特征向量表示这个特征是什么。  </p><p>如果说一个向量$\vec{v}$是方阵$A$的特征向量，将一定可以表示成下面的形式：</p></li></ul><p>$$<br>A\nu = \lambda \nu<br>$$</p><p>$\lambda$为特征向量$\vec{v}$对应的特征值。特征值分解是将一个矩阵分解为如下形式： </p><p>$$<br>A=Q\sum Q^{-1}<br>$$</p><p>其中，$Q$是这个矩阵$A$的特征向量组成的矩阵，$\sum$是一个对角矩阵，每一个对角线元素就是一个特征值，里面的特征值是由大到小排列的，这些特征值所对应的特征向量就是描述这个矩阵变化方向（从主要的变化到次要的变化排列）。也就是说矩阵$A$的信息可以由其特征值和特征向量表示。</p><h3 id="1-3-2-奇异值与特征值有什么关系"><a href="#1-3-2-奇异值与特征值有什么关系" class="headerlink" title="1.3.2 奇异值与特征值有什么关系"></a>1.3.2 奇异值与特征值有什么关系</h3><p>那么奇异值和特征值是怎么对应起来的呢？我们将一个矩阵$A$的转置乘以$A$，并对$A^TA​$求特征值，则有下面的形式：</p><p>$$<br>(A^TA)V = \lambda V<br>$$</p><p>这里$V​$就是上面的右奇异向量，另外还有：</p><p>$$<br>\sigma_i = \sqrt{\lambda_i}, u_i=\frac{1}{\sigma_i}A\mu_i<br>$$</p><p>这里的$\sigma​$就是奇异值，$u​$就是上面说的左奇异向量。【证明那个哥们也没给】<br>​奇异值$\sigma​$跟特征值类似，在矩阵$\sum​$中也是从大到小排列，而且$\sigma​$的减少特别的快，在很多情况下，前10%甚至1%的奇异值的和就占了全部的奇异值之和的99%以上了。也就是说，我们也可以用前$r​$（$r​$远小于$m、n​$）个的奇异值来近似描述矩阵，即部分奇异值分解：<br>$$<br>A_{m\times n}\approx U_{m \times r}\sum_{r\times r}V_{r \times n}^T<br>$$</p><p>右边的三个矩阵相乘的结果将会是一个接近于$A$的矩阵，在这儿，$r$越接近于$n$，则相乘的结果越接近于$A$。</p><h2 id="1-4-概率分布与随机变量"><a href="#1-4-概率分布与随机变量" class="headerlink" title="1.4 概率分布与随机变量"></a>1.4 概率分布与随机变量</h2><h3 id="1-4-1-机器学习为什么要使用概率"><a href="#1-4-1-机器学习为什么要使用概率" class="headerlink" title="1.4.1 机器学习为什么要使用概率"></a>1.4.1 机器学习为什么要使用概率</h3><p>事件的概率是衡量该事件发生的可能性的量度。虽然在一次随机试验中某个事件的发生是带有偶然性的，但那些可在相同条件下大量重复的随机试验却往往呈现出明显的数量规律。<br>​机器学习除了处理不确定量，也需处理随机量。不确定性和随机性可能来自多个方面，使用概率论来量化不确定性。<br>​概率论在机器学习中扮演着一个核心角色，因为机器学习算法的设计通常依赖于对数据的概率假设。  </p><blockquote><p>​    例如在机器学习（Andrew Ng）的课中，会有一个朴素贝叶斯假设就是条件独立的一个例子。该学习算法对内容做出假设，用来分辨电子邮件是否为垃圾邮件。假设无论邮件是否为垃圾邮件，单词x出现在邮件中的概率条件独立于单词y。很明显这个假设不是不失一般性的，因为某些单词几乎总是同时出现。然而，最终结果是，这个简单的假设对结果的影响并不大，且无论如何都可以让我们快速判别垃圾邮件。</p></blockquote><h3 id="1-4-2-变量与随机变量有什么区别"><a href="#1-4-2-变量与随机变量有什么区别" class="headerlink" title="1.4.2 变量与随机变量有什么区别"></a>1.4.2 变量与随机变量有什么区别</h3><p><strong>随机变量</strong>（random variable）</p><p>表示随机现象（在一定条件下，并不总是出现相同结果的现象称为随机现象）中各种结果的实值函数（一切可能的样本点）。例如某一时间内公共汽车站等车乘客人数，电话交换台在一定时间内收到的呼叫次数等，都是随机变量的实例。<br>​随机变量与模糊变量的不确定性的本质差别在于，后者的测定结果仍具有不确定性，即模糊性。</p><p><strong>变量与随机变量的区别：</strong><br>​当变量的取值的概率不是1时,变量就变成了随机变量；当随机变量取值的概率为1时,随机变量就变成了变量。</p><blockquote><p>比如：<br>​    当变量$x$值为100的概率为1的话,那么$x=100$就是确定了的,不会再有变化,除非有进一步运算.<br>​    当变量$x$的值为100的概率不为1,比如为50的概率是0.5,为100的概率是0.5,那么这个变量就是会随不同条件而变化的,是随机变量,取到50或者100的概率都是0.5,即50%。  </p></blockquote><h3 id="1-4-3-随机变量与概率分布的联系"><a href="#1-4-3-随机变量与概率分布的联系" class="headerlink" title="1.4.3 随机变量与概率分布的联系"></a>1.4.3 随机变量与概率分布的联系</h3><p>一个随机变量仅仅表示一个可能取得的状态，还必须给定与之相伴的概率分布来制定每个状态的可能性。用来描述随机变量或一簇随机变量的每一个可能的状态的可能性大小的方法，就是 <strong>概率分布(probability distribution)</strong>.</p><p>随机变量可以分为离散型随机变量和连续型随机变量。</p><p>相应的描述其概率分布的函数是 </p><p>概率质量函数(Probability Mass Function, PMF):描述离散型随机变量的概率分布，通常用大写字母 $P$表示。</p><p>概率密度函数(Probability Density Function, PDF):描述连续型随机变量的概率分布，通常用小写字母$p$表示。</p><h3 id="1-4-4-离散型随机变量和概率质量函数"><a href="#1-4-4-离散型随机变量和概率质量函数" class="headerlink" title="1.4.4 离散型随机变量和概率质量函数"></a>1.4.4 离散型随机变量和概率质量函数</h3><p>PMF 将随机变量能够取得的每个状态映射到随机变量取得该状态的概率。</p><ul><li>一般而言，$P(x)​$ 表示时$X=x​$的概率.</li><li>有时候为了防止混淆，要明确写出随机变量的名称$P(​$x$=x)​$ </li><li>有时候需要先定义一个随机变量，然后制定它遵循的概率分布x服从$P(​$x​$)​$ </li></ul><p>PMF 可以同时作用于多个随机变量，即联合概率分布(joint probability distribution) $P(X=x,Y=y)$*表示 $X=x$和$Y=y$同时发生的概率，也可以简写成 $P(x,y)$.</p><p>如果一个函数$P​$是随机变量 $X​$ 的 PMF， 那么它必须满足如下三个条件</p><ul><li>$P​$的定义域必须是的所有可能状态的集合</li><li>$∀x∈​$x, $0 \leq P(x) \leq 1 ​$. </li><li>$∑_{x∈X} P(x)=1$. 我们把这一条性质称之为 归一化的(normalized)</li></ul><h3 id="1-4-5-连续型随机变量和概率密度函数"><a href="#1-4-5-连续型随机变量和概率密度函数" class="headerlink" title="1.4.5 连续型随机变量和概率密度函数"></a>1.4.5 连续型随机变量和概率密度函数</h3><p>如果一个函数$p​$是x的PDF，那么它必须满足如下几个条件</p><ul><li>$p$的定义域必须是 xx 的所有可能状态的集合。</li><li>$∀x∈X,p(x)≥0$. 注意，我们并不要求$ p(x)≤1$，因为此处 $p(x)$不是表示的对应此状态具体的概率，而是概率的一个相对大小(密度)。具体的概率，需要积分去求。</li><li>$∫p(x)dx=1$, 积分下来，总和还是1，概率之和还是1.</li></ul><p>注：PDF$p(x)$并没有直接对特定的状态给出概率，给出的是密度，相对的，它给出了落在面积为 $δx$的无线小的区域内的概率为$ p(x)δx$. 由此，我们无法求得具体某个状态的概率，我们可以求得的是 某个状态 $x$ 落在 某个区间$[a,b]$内的概率为$ \int_{a}^{b}p(x)dx$.</p><h3 id="1-4-6-举例理解条件概率"><a href="#1-4-6-举例理解条件概率" class="headerlink" title="1.4.6 举例理解条件概率"></a>1.4.6 举例理解条件概率</h3><p>条件概率公式如下：<br>$$<br>P(A|B) = P(A\cap B) / P(B)<br>$$<br>说明：在同一个样本空间$\Omega$中的事件或者子集$A$与$B$，如果随机从$\Omega$中选出的一个元素属于$B$，那么下一个随机选择的元素属于$A$ 的概率就定义为在$B$的前提下$A$的条件概率。条件概率文氏图示意如图1.1所示。<br><img src="./img/ch1/conditional_probability.jpg" alt="条件概率"></p><p>图1.1 条件概率文氏图示意</p><p>根据文氏图，可以很清楚地看到在事件B发生的情况下，事件A发生的概率就是$P(A\bigcap B)$除以$P(B)$。<br>​举例：一对夫妻有两个小孩，已知其中一个是女孩，则另一个是女孩子的概率是多少？（面试、笔试都碰到过）<br>​<strong>穷举法</strong>：已知其中一个是女孩，那么样本空间为男女，女女，女男，则另外一个仍然是女生的概率就是1/3。<br>​<strong>条件概率法</strong>：$P(女|女)=P(女女)/P(女)$,夫妻有两个小孩，那么它的样本空间为女女，男女，女男，男男，则$P(女女)$为1/4，$P（女）= 1-P(男男)=3/4$,所以最后$1/3$。<br>这里大家可能会误解，男女和女男是同一种情况，但实际上类似姐弟和兄妹是不同情况。 </p><h3 id="1-4-7-联合概率与边缘概率联系区别"><a href="#1-4-7-联合概率与边缘概率联系区别" class="headerlink" title="1.4.7 联合概率与边缘概率联系区别"></a>1.4.7 联合概率与边缘概率联系区别</h3><p><strong>区别：</strong><br>​联合概率：联合概率指类似于$P(X=a,Y=b)$这样，包含多个条件，且所有条件同时成立的概率。联合概率是指在多元的概率分布中多个随机变量分别满足各自条件的概率。<br>​边缘概率：边缘概率是某个事件发生的概率，而与其它事件无关。边缘概率指类似于$P(X=a)$，$P(Y=b)$这样，仅与单个随机变量有关的概率。</p><p><strong>联系：</strong><br>​联合分布可求边缘分布，但若只知道边缘分布，无法求得联合分布。  </p><h3 id="1-4-8-条件概率的链式法则"><a href="#1-4-8-条件概率的链式法则" class="headerlink" title="1.4.8 条件概率的链式法则"></a>1.4.8 条件概率的链式法则</h3><p>由条件概率的定义，可直接得出下面的乘法公式：<br>​乘法公式 设$A, B$是两个事件，并且$P(A) &gt; 0$, 则有<br>$$<br>P(AB) = P(B|A)P(A)<br>$$<br>推广<br>$$<br>P(ABC)=P(C|AB)P(B|A)P(A)<br>$$<br>一般地，用归纳法可证：若$P(A_1A_2…A_n)&gt;0$，则有<br>$$<br>P(A_1A_2…A_n)=P(A_n|A_1A_2…A_{n-1})P(A_{n-1}|A_1A_2…A_{n-2})…P(A_2|A_1)P(A_1)<br>=P(A_1)\prod_{i=2}^{n}P(A_i|A_1A_2…A_{i-1})<br>$$<br>任何多维随机变量联合概率分布，都可以分解成只有一个变量的条件概率相乘形式。 </p><h3 id="1-4-9-独立性和条件独立性"><a href="#1-4-9-独立性和条件独立性" class="headerlink" title="1.4.9 独立性和条件独立性"></a>1.4.9 独立性和条件独立性</h3><p><strong>独立性</strong><br>​两个随机变量$x$和$y$，概率分布表示成两个因子乘积形式，一个因子只包含$x$，另一个因子只包含$y$，两个随机变量相互独立(independent)。<br>​条件有时为不独立的事件之间带来独立，有时也会把本来独立的事件，因为此条件的存在，而失去独立性。<br>​举例：$P(XY)=P(X)P(Y)$, 事件$X$和事件$Y$独立。此时给定$Z$，<br>$$<br>P(X,Y|Z) \not = P(X|Z)P(Y|Z)<br>$$<br>事件独立时，联合概率等于概率的乘积。这是一个非常好的数学性质，然而不幸的是，无条件的独立是十分稀少的，因为大部分情况下，事件之间都是互相影响的。 </p><p><strong>条件独立性</strong><br>​给定$Z$的情况下,$X$和$Y$条件独立，当且仅当<br>$$<br>X\bot Y|Z \iff P(X,Y|Z) = P(X|Z)P(Y|Z)<br>$$<br>$X$和$Y$的关系依赖于$Z$，而不是直接产生。  </p><blockquote><p><strong>举例</strong>定义如下事件：<br>$X$：明天下雨；<br>$Y$：今天的地面是湿的；<br>$Z$：今天是否下雨；<br>$Z$事件的成立，对$X$和$Y$均有影响，然而，在$Z$事件成立的前提下，今天的地面情况对明天是否下雨没有影响。 </p></blockquote><h2 id="1-5-常见概率分布"><a href="#1-5-常见概率分布" class="headerlink" title="1.5 常见概率分布"></a>1.5 常见概率分布</h2><h3 id="1-5-1-Bernoulli分布"><a href="#1-5-1-Bernoulli分布" class="headerlink" title="1.5.1 Bernoulli分布"></a>1.5.1 Bernoulli分布</h3><p><strong>Bernoulli分布</strong>是单个二值随机变量分布, 单参数$\phi​$∈[0,1]控制,$\phi​$给出随机变量等于1的概率. 主要性质有:<br>$$<br>\begin{align*}<br>P(x=1) &amp;= \phi \<br>P(x=0) &amp;= 1-\phi  \<br>P(x=x) &amp;= \phi^x(1-\phi)^{1-x} \<br>\end{align*}<br>$$<br>其期望和方差为：<br>$$<br>\begin{align*}<br>E_x[x] &amp;= \phi \<br>Var_x(x) &amp;= \phi{(1-\phi)}<br>\end{align*}<br>$$<br><strong>Multinoulli分布</strong>也叫<strong>范畴分布</strong>, 是单个<em>k</em>值随机分布,经常用来表示<strong>对象分类的分布</strong>. 其中$k$是有限值.Multinoulli分布由向量$\vec{p}\in[0,1]^{k-1}$参数化,每个分量$p_i$表示第$i$个状态的概率, 且$p_k=1-1^Tp​$.</p><p><strong>适用范围</strong>: <strong>伯努利分布</strong>适合对<strong>离散型</strong>随机变量建模.</p><h3 id="1-5-2-高斯分布"><a href="#1-5-2-高斯分布" class="headerlink" title="1.5.2 高斯分布"></a>1.5.2 高斯分布</h3><p>高斯也叫正态分布(Normal Distribution), 概率度函数如下:<br>$$<br>N(x;\mu,\sigma^2) = \sqrt{\frac{1}{2\pi\sigma^2}}exp\left ( -\frac{1}{2\sigma^2}(x-\mu)^2 \right )<br>$$<br>其中, $\mu​$和$\sigma​$分别是均值和方差, 中心峰值x坐标由$\mu​$给出, 峰的宽度受$\sigma​$控制, 最大点在$x=\mu​$处取得, 拐点为$x=\mu\pm\sigma​$</p><p>正态分布中，±1$\sigma$、±2$\sigma$、±3$\sigma$下的概率分别是68.3%、95.5%、99.73%，这3个数最好记住。 </p><p>此外, 令$\mu=0,\sigma=1​$高斯分布即简化为标准正态分布:<br>$$<br>N(x;\mu,\sigma^2) = \sqrt{\frac{1}{2\pi}}exp\left ( -\frac{1}{2}x^2 \right )<br>$$<br>对概率密度函数高效求值:<br>$$<br>N(x;\mu,\beta^{-1})=\sqrt{\frac{\beta}{2\pi}}exp\left(-\frac{1}{2}\beta(x-\mu)^2\right)<br>$$</p><p>其中，$\beta=\frac{1}{\sigma^2}$通过参数$\beta∈（0，\infty）​$来控制分布精度。</p><h3 id="1-5-3-何时采用正态分布"><a href="#1-5-3-何时采用正态分布" class="headerlink" title="1.5.3 何时采用正态分布"></a>1.5.3 何时采用正态分布</h3><p>问: 何时采用正态分布?<br>答: 缺乏实数上分布的先验知识, 不知选择何种形式时, 默认选择正态分布总是不会错的, 理由如下: </p><ol><li>中心极限定理告诉我们, 很多独立随机变量均近似服从正态分布, 现实中很多复杂系统都可以被建模成正态分布的噪声, 即使该系统可以被结构化分解. </li><li>正态分布是具有相同方差的所有概率分布中, 不确定性最大的分布, 换句话说, 正态分布是对模型加入先验知识最少的分布.</li></ol><p>正态分布的推广:<br>正态分布可以推广到$R^n$空间, 此时称为<strong>多位正态分布</strong>, 其参数是一个正定对称矩阵$\Sigma​$:<br>$$<br>N(x;\vec\mu,\Sigma)=\sqrt{\frac{1}{(2\pi)^ndet(\Sigma)}}exp\left(-\frac{1}{2}(\vec{x}-\vec{\mu})^T\Sigma^{-1}(\vec{x}-\vec{\mu})\right)<br>$$<br>对多为正态分布概率密度高效求值:<br>$$<br>N(x;\vec{\mu},\vec\beta^{-1}) = \sqrt{det(\vec\beta)}{(2\pi)^n}exp\left(-\frac{1}{2}(\vec{x}-\vec\mu)^T\beta(\vec{x}-\vec\mu)\right)<br>$$<br>此处，$\vec\beta$是一个精度矩阵。</p><h3 id="1-5-4-指数分布"><a href="#1-5-4-指数分布" class="headerlink" title="1.5.4 指数分布"></a>1.5.4 指数分布</h3><p>深度学习中, 指数分布用来描述在$x=0​$点处取得边界点的分布, 指数分布定义如下:<br>$$<br>p(x;\lambda)=\lambda I_{x\geq 0}exp(-\lambda{x})<br>$$<br>指数分布用指示函数$I_{x\geq 0}​$来使$x​$取负值时的概率为零。</p><h3 id="1-5-5-Laplace-分布"><a href="#1-5-5-Laplace-分布" class="headerlink" title="1.5.5 Laplace 分布"></a>1.5.5 Laplace 分布</h3><p>一个联系紧密的概率分布是 Laplace 分布（Laplace distribution），它允许我们在任意一点 $\mu$处设置概率质量的峰值<br>$$<br>Laplace(x;\mu;\gamma)=\frac{1}{2\gamma}exp\left(-\frac{|x-\mu|}{\gamma}\right)<br>$$</p><h3 id="1-5-6-Dirac分布和经验分布"><a href="#1-5-6-Dirac分布和经验分布" class="headerlink" title="1.5.6 Dirac分布和经验分布"></a>1.5.6 Dirac分布和经验分布</h3><p>Dirac分布可保证概率分布中所有质量都集中在一个点上. Diract分布的狄拉克$\delta​$函数(也称为<strong>单位脉冲函数</strong>)定义如下:<br>$$<br>p(x)=\delta(x-\mu), x\neq \mu<br>$$</p><p>$$<br>\int_{a}^{b}\delta(x-\mu)dx = 1, a &lt; \mu &lt; b<br>$$</p><p>Dirac 分布经常作为 经验分布（empirical distribution）的一个组成部分出现<br>$$<br>\hat{p}(\vec{x})=\frac{1}{m}\sum_{i=1}^{m}\delta(\vec{x}-{\vec{x}}^{(i)})<br>$$<br>, 其中, m个点$x^{1},…,x^{m}$是给定的数据集, <strong>经验分布</strong>将概率密度$\frac{1}{m}​$赋给了这些点.</p><p>当我们在训练集上训练模型时, 可以认为从这个训练集上得到的经验分布指明了<strong>采样来源</strong>.</p><p><strong>适用范围</strong>: 狄拉克δ函数适合对<strong>连续型</strong>随机变量的经验分布.</p><blockquote></blockquote><h2 id="1-6-期望、方差、协方差、相关系数"><a href="#1-6-期望、方差、协方差、相关系数" class="headerlink" title="1.6 期望、方差、协方差、相关系数"></a>1.6 期望、方差、协方差、相关系数</h2><h3 id="1-6-1-期望"><a href="#1-6-1-期望" class="headerlink" title="1.6.1 期望"></a>1.6.1 期望</h3><p>在概率论和统计学中，数学期望（或均值，亦简称期望）是试验中每次可能结果的概率乘以其结果的总和。它反映随机变量平均取值的大小。</p><ul><li>线性运算： $E(ax+by+c) = aE(x)+bE(y)+c$  </li><li>推广形式： $E(\sum_{k=1}^{n}{a_ix_i+c}) = \sum_{k=1}^{n}{a_iE(x_i)+c}$ </li><li>函数期望：设$f(x)$为$x$的函数，则$f(x)$的期望为<ul><li>离散函数： $E(f(x))=\sum_{k=1}^{n}{f(x_k)P(x_k)}$</li><li>连续函数： $E(f(x))=\int_{-\infty}^{+\infty}{f(x)p(x)dx}$</li></ul></li></ul><blockquote><p>注意：</p><ul><li>函数的期望大于等于期望的函数（Jensen不等式），即$E(f(x))\geqslant f(E(x))$  </li><li>一般情况下，乘积的期望不等于期望的乘积。  </li><li>如果$X$和$Y$相互独立，则$E(xy)=E(x)E(y)​$。  </li></ul></blockquote><h3 id="1-6-2-方差"><a href="#1-6-2-方差" class="headerlink" title="1.6.2 方差"></a>1.6.2 方差</h3><p>概率论中方差用来度量随机变量和其数学期望（即均值）之间的偏离程度。方差是一种特殊的期望。定义为：</p><p>$$<br>Var(x) = E((x-E(x))^2)<br>$$</p><blockquote><p>方差性质：  </p><p>1）$Var(x) = E(x^2) -E(x)^2$<br>2）常数的方差为0;<br>3）方差不满足线性性质;<br>4）如果$X$和$Y$相互独立, $Var(ax+by)=a^2Var(x)+b^2Var(y)$   </p></blockquote><h3 id="1-6-3-协方差"><a href="#1-6-3-协方差" class="headerlink" title="1.6.3 协方差"></a>1.6.3 协方差</h3><p>协方差是衡量两个变量线性相关性强度及变量尺度。  两个随机变量的协方差定义为：<br>$$<br>Cov(x,y)=E((x-E(x))(y-E(y)))<br>$$</p><p>方差是一种特殊的协方差。当$X=Y$时，$Cov(x,y)=Var(x)=Var(y)$。</p><blockquote><p>协方差性质：  </p><p>1）独立变量的协方差为0。<br>2）协方差计算公式：</p></blockquote><p>$$<br>Cov(\sum_{i=1}^{m}{a_ix_i}, \sum_{j=1}^{m}{b_jy_j}) = \sum_{i=1}^{m} \sum_{j=1}^{m}{a_ib_jCov(x_iy_i)}<br>$$</p><blockquote><p>3）特殊情况：</p></blockquote><p>$$<br>Cov(a+bx, c+dy) = bdCov(x, y)<br>$$</p><h3 id="1-6-4-相关系数"><a href="#1-6-4-相关系数" class="headerlink" title="1.6.4 相关系数"></a>1.6.4 相关系数</h3><p>相关系数是研究变量之间线性相关程度的量。两个随机变量的相关系数定义为：<br>$$<br>Corr(x,y) = \frac{Cov(x,y)}{\sqrt{Var(x)Var(y)}}<br>$$</p><blockquote><p>相关系数的性质：<br>1）有界性。相关系数的取值范围是 [-1,1]，可以看成无量纲的协方差。<br>2）值越接近1，说明两个变量正相关性（线性）越强。越接近-1，说明负相关性越强，当为0时，表示两个变量没有相关性。  </p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;深度学习通常又需要哪些数学基础？深度学习里的数学到底难在哪里？通常初学者都会有这些问题，在网络推荐及书本推荐里，经常看到会列出一系列数学科目，比如微积分、线性代数、概率论、复变函数、数值计算、优化理论、信息论等等。这些数学知识有相关性，但实际上按照这样的知识范围来学习，学习成本会很久，而且会很枯燥，本章我们通过选举一些数学基础里容易混淆的一些概念做以介绍，帮助大家更好的理清这些易混淆概念之间的关系。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="AI进阶" scheme="https://rencheng.cc/tags/AI%E8%BF%9B%E9%98%B6/"/>
    
    <category term="机器学习" scheme="https://rencheng.cc/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>机器学习-人脸识别</title>
    <link href="https://rencheng.cc/2019/05/17/ml/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/"/>
    <id>https://rencheng.cc/2019/05/17/ml/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/</id>
    <published>2019-05-17T08:37:09.000Z</published>
    <updated>2019-05-17T08:37:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>人脸识别，是基于人的脸部特征信息进行身份识别的一种生物识别技术。用摄像机或摄像头采集含有人脸的图像或视频流，并自动在图像中检测和跟踪人脸，进而对检测到的人脸进行脸部识别的一系列相关技术，通常也叫做人像识别、面部识别。</p><span id="more"></span><h1 id="视频捕捉"><a href="#视频捕捉" class="headerlink" title="视频捕捉"></a>视频捕捉</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line">vc = cv.VideoCapture(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">frame = vc.read()[<span class="number">1</span>]</span><br><span class="line">cv.imshow(<span class="string">&#x27;VideoCapture&#x27;</span>, frame)</span><br><span class="line"><span class="keyword">if</span> cv.waitKey(<span class="number">33</span>) == <span class="number">27</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">vc.release()</span><br><span class="line">cv.destroyAllWindows()</span><br></pre></td></tr></table></figure><h1 id="人脸定位"><a href="#人脸定位" class="headerlink" title="人脸定位"></a>人脸定位</h1><p>从整个画面中定位人脸的位置和范围</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;人脸识别，是基于人的脸部特征信息进行身份识别的一种生物识别技术。用摄像机或摄像头采集含有人脸的图像或视频流，并自动在图像中检测和跟踪人脸，进而对检测到的人脸进行脸部识别的一系列相关技术，通常也叫做人像识别、面部识别。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://rencheng.cc/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="AI进阶" scheme="https://rencheng.cc/tags/AI%E8%BF%9B%E9%98%B6/"/>
    
    <category term="机器学习" scheme="https://rencheng.cc/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="图像识别" scheme="https://rencheng.cc/tags/%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB/"/>
    
    <category term="人脸识别" scheme="https://rencheng.cc/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/"/>
    
  </entry>
  
</feed>
